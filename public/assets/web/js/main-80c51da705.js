"use strict";var app;!function(){var e=function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&t[n]&&(e[n]=t[n])};function t(t){if(t&&(this._config={chunkSize:1048576},!(this._config.chunkSize&&this._config.chunkSize<102400)&&(e(this._config,t),(this._config.aliyunCredential||this._config.stsToken)&&this._config.endpoint))){var n=window.ALY;this._config.stsToken?this.oss=new n.OSS({accessKeyId:this._config.stsToken.Credentials.AccessKeyId,secretAccessKey:this._config.stsToken.Credentials.AccessKeySecret,securityToken:this._config.stsToken.Credentials.SecurityToken,endpoint:this._config.endpoint,apiVersion:"2013-10-15"}):this.oss=new n.OSS({accessKeyId:this._config.aliyunCredential.accessKeyId,secretAccessKey:this._config.aliyunCredential.secretAccessKey,endpoint:this._config.endpoint,apiVersion:"2013-10-15"});var o=this._config.endpoint.split("://");o.length<2||(this._config.endpoint={protocol:o[0],host:o[1]})}}t.prototype.upload=function(t){if(t)if(t.file){var n=t.file;if(t.key){t.key.replace(new RegExp("^/"),"");var o=this;!function(e){var r={chunksHash:{},chunks:[]},i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=o._config.chunkSize,s=Math.ceil(n.size/a),c=0,l=function(t){r.chunks[c]=t.target.result,++c<s?d():(r.file_size=n.size,e(null,r))},p=function(){console.error("读取文件失败"),"function"==typeof t.onerror&&t.onerror("读取文件失败")};function d(){var e=new FileReader;e.onload=l,e.onerror=p;var t=c*a,o=t+a>=n.size?n.size:t+a,r=i.call(n,t,o);e.readAsArrayBuffer(r)}d()}(function(r,i){var a=function(e,n){e?"function"==typeof t.onerror&&t.onerror(e):"function"==typeof t.oncomplete&&t.oncomplete(n)};1==i.chunks.length?function(r,i){var a={Bucket:o._config.bucket,Key:t.key,Body:r.chunks[0],ContentType:n.type||""};e(a,t.headers),o.oss.putObject(a,i).on("httpUploadProgress",function(e){"function"==typeof t.onprogress&&t.onprogress({loaded:e.loaded,total:n.size})})}(i,a):function(r,i){var a,s,c=t.maxRetry||3,l=0,p=-1,d=0,u={Parts:[]},h=function(e){if(!(e>=r.chunks.length)){p<e&&(p=e),++d<o._config.concurrency&&e<r.chunks.length-1&&h(e+1);var s={Body:r.chunks[e],Bucket:o._config.bucket,Key:t.key,PartNumber:String(e+1),UploadId:a},g=1,m=function(){u.Parts[e]={PartNumber:e+1,loaded:0},o.oss.uploadPart(s,function(t,n){t?g>c?i(t):(u.Parts[e].loaded=0,g++,m()):(u.Parts[e].ETag=n.ETag,u.Parts[e].loaded=s.Body.byteLength,d--,++l==r.chunks.length?f():h(p+1))}).on("httpUploadProgress",function(o){u.Parts[e].loaded=o.loaded;var r=0;for(var i in u.Parts)r+=u.Parts[i].loaded;"function"==typeof t.onprogress&&t.onprogress({loaded:r,total:n.size})})};m()}},f=function(){for(var e in u.Parts)delete u.Parts[e].loaded;var n={Bucket:o._config.bucket,Key:t.key,CompleteMultipartUpload:u,UploadId:a};o.oss.completeMultipartUpload(n,i)};s={Bucket:o._config.bucket,Key:t.key,ContentType:n.type||""},e(s,t.headers),o.oss.createMultipartUpload(s,function(e,t){e?i(e):(a=t.UploadId,h(0))})}(i,a)})}else"function"==typeof t.onerror&&t.onerror("需要 key")}else"function"==typeof t.onerror&&t.onerror("需要 file");else"function"==typeof t.onerror&&t.onerror("需要 options")},window.OssUpload=t}(),function(){var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){switch(t.which){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return!!(t.metaKey||t.ctrlKey||t.altKey)},isFunctionKey:function(e){return(e=e.which?e.which:e)>=112&&e<=123},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)},toSeparator:function(t){var n={ENTER:"\n",TAB:"\t",SPACE:" "}[t];return n||(e[t]?void 0:t)}};function t(e){return angular.isUndefined(e)||null===e}void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),void 0===angular.element.prototype.closest&&(angular.element.prototype.closest=function(e){for(var t=this[0],n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(n.bind(t)(e))return t;t=t.parentElement}return!1});var n=0,o=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,skipFocusser:!1,dropdownPosition:"auto",removeSelected:!0,resetSearchInput:!1,generateId:function(){return n++},appendToBody:!1,spinnerEnabled:!1,spinnerClass:"glyphicon glyphicon-refresh ui-select-spin",backspaceReset:!0}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments).message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(t)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,n,o,r){r(e,function(e){t.append(e)})}}}).filter("highlight",function(){return function(e,t){return t&&e?(""+e).replace(new RegExp((""+t).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"gi"),'<span class="ui-select-highlight">$&</span>'):e}}).factory("uisOffset",["$document","$window",function(e,t){return function(n){var o=n[0].getBoundingClientRect();return{width:o.width||n.prop("offsetWidth"),height:o.height||n.prop("offsetHeight"),top:o.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:o.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);o.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile","$window",function(e,t,n,o,r){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){return t.addClass("ui-select-choices"),(t.parent().attr("theme")||e.theme)+"/choices.tpl.html"},compile:function(o,i){if(!i.repeat)throw n("repeat","Expected 'repeat' expression.");var a=i.groupBy,s=i.groupFilter;if(a){var c=o.querySelectorAll(".ui-select-choices-group");if(1!==c.length)throw n("rows","Expected 1 .ui-select-choices-group but got '{0}'.",c.length);c.attr("ng-repeat",t.getGroupNgRepeatExpression())}var l=t.parse(i.repeat),p=o.querySelectorAll(".ui-select-choices-row");if(1!==p.length)throw n("rows","Expected 1 .ui-select-choices-row but got '{0}'.",p.length);p.attr("ng-repeat",l.repeatExpression(a)).attr("ng-if","$select.open");var d=o.querySelectorAll(".ui-select-choices-row-inner");if(1!==d.length)throw n("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",d.length);return d.attr("uis-transclude-append",""),(r.document.addEventListener?p:d).attr("ng-click","$select.select("+l.itemName+",$select.skipFocusser,$event)"),function(t,n,r,i){i.parseRepeatAttr(r.repeat,a,s),i.disableChoiceExpression=r.uiDisableChoice,i.onHighlightCallback=r.onHighlight,i.minimumInputLength=parseInt(r.minimumInputLength)||0,i.dropdownPosition=r.position?r.position.toLowerCase():e.dropdownPosition,t.$watch("$select.search",function(e){e&&!i.open&&i.multiple&&i.activate(!1,!0),i.activeIndex=i.tagging.isActivated?-1:0,!r.minimumInputLength||i.search.length>=r.minimumInputLength?i.refresh(r.refresh):i.items=[]}),r.$observe("refreshDelay",function(){var n=t.$eval(r.refreshDelay);i.refreshDelay=void 0!==n?n:e.refreshDelay}),t.$watch("$select.open",function(e){e?(o.attr("role","listbox"),i.refresh(r.refresh)):n.removeAttr("role")})}}}}]),o.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","$$uisDebounce","uisRepeatParser","uiSelectMinErr","uiSelectConfig","$parse","$injector","$window",function(n,o,r,i,a,s,c,l,p,d,u){var h,f=this,g="";if(f.placeholder=l.placeholder,f.searchEnabled=l.searchEnabled,f.sortable=l.sortable,f.refreshDelay=l.refreshDelay,f.paste=l.paste,f.resetSearchInput=l.resetSearchInput,f.refreshing=!1,f.spinnerEnabled=l.spinnerEnabled,f.spinnerClass=l.spinnerClass,f.removeSelected=l.removeSelected,f.closeOnSelect=!0,f.skipFocusser=!1,f.search=g,f.activeIndex=0,f.items=[],f.open=!1,f.focus=!1,f.disabled=!1,f.selected=void 0,f.dropdownPosition="auto",f.focusser=void 0,f.multiple=void 0,f.disableChoiceExpression=void 0,f.tagging={isActivated:!1,fct:void 0},f.taggingTokens={isActivated:!1,tokens:void 0},f.lockChoiceExpression=void 0,f.clickTriggeredSelect=!1,f.$filter=i,f.$element=o,f.$animate=function(){try{return d.get("$animate")}catch(e){return null}}(),f.searchInput=o.querySelectorAll("input.ui-select-search"),1!==f.searchInput.length)throw c("searchInput","Expected 1 input.ui-select-search but got '{0}'.",f.searchInput.length);function m(){f.resetSearchInput&&(f.search=g,f.selected&&f.items.length&&!f.multiple&&(f.activeIndex=function(e,t,n){if(e.findIndex)return e.findIndex(t,n);for(var o,r=Object(e),i=r.length>>>0,a=0;a<i;a++)if(o=r[a],t.call(n,o,a,r))return a;return-1}(f.items,function(e){return angular.equals(this,e)},f.selected)))}f.isEmpty=function(){return t(f.selected)||""===f.selected||f.multiple&&0===f.selected.length},f.activate=function(e,t){if(f.disabled||f.open)f.open&&!f.searchEnabled&&f.close();else{t||m(),n.$broadcast("uis:activate"),f.open=!0,f.activeIndex=f.activeIndex>=f.items.length?0:f.activeIndex,-1===f.activeIndex&&!1!==f.taggingLabel&&(f.activeIndex=0);var i=o.querySelectorAll(".ui-select-choices-content"),a=o.querySelectorAll(".ui-select-search");if(f.$animate&&f.$animate.on&&f.$animate.enabled(i[0])){var s=function(t,n){"start"===n&&0===f.items.length?(f.$animate.off("removeClass",a[0],s),r(function(){f.focusSearchInput(e)})):"close"===n&&(f.$animate.off("enter",i[0],s),r(function(){f.focusSearchInput(e)}))};f.items.length>0?f.$animate.on("enter",i[0],s):f.$animate.on("removeClass",a[0],s)}else r(function(){f.focusSearchInput(e),!f.tagging.isActivated&&f.items.length>1&&C()})}},f.focusSearchInput=function(e){f.search=e||f.search,f.searchInput[0].focus()},f.findGroupByName=function(e){return f.groups&&f.groups.filter(function(t){return t.name===e})[0]},f.parseRepeatAttr=function(e,t,o){f.setItemsFn=t?function(e){var r=n.$eval(t);if(f.groups=[],angular.forEach(e,function(e){var t=angular.isFunction(r)?r(e):e[r],n=f.findGroupByName(t);n?n.items.push(e):f.groups.push({name:t,items:[e]})}),o){var i=n.$eval(o);angular.isFunction(i)?f.groups=i(f.groups):angular.isArray(i)&&(f.groups=function(e,t){var n,o,r=[];for(n=0;n<t.length;n++)for(o=0;o<e.length;o++)e[o].name==[t[n]]&&r.push(e[o]);return r}(f.groups,i))}f.items=[],f.groups.forEach(function(e){f.items=f.items.concat(e.items)})}:function(e){f.items=e||[]},f.parserResult=s.parse(e),f.isGrouped=!!t,f.itemProperty=f.parserResult.itemName;var r=f.parserResult.source,i=function(){var e=r(n);n.$uisSource=Object.keys(e).map(function(t){var n={};return n[f.parserResult.keyName]=t,n.value=e[t],n})};f.parserResult.keyName&&(i(),f.parserResult.source=p("$uisSource"+f.parserResult.filters),n.$watch(r,function(e,t){e!==t&&i()},!0)),f.refreshItems=function(e){e=e||f.parserResult.source(n);var t=f.selected;if(f.isEmpty()||angular.isArray(t)&&!t.length||!f.multiple||!f.removeSelected)f.setItemsFn(e);else if(null!=e){var o=e.filter(function(e){return angular.isArray(t)?t.every(function(t){return!angular.equals(e,t)}):!angular.equals(e,t)});f.setItemsFn(o)}"auto"!==f.dropdownPosition&&"up"!==f.dropdownPosition||n.calculateDropdownPos(),n.$broadcast("uis:refresh")},n.$watchCollection(f.parserResult.source,function(e){if(null==e)f.items=[];else{if(!angular.isArray(e))throw c("items","Expected an array but got '{0}'.",e);f.refreshItems(e),angular.isDefined(f.ngModel.$modelValue)&&(f.ngModel.$modelValue=null)}})},f.refresh=function(e){void 0!==e&&(h&&r.cancel(h),h=r(function(){if(n.$select.search.length>=n.$select.minimumInputLength){var t=n.$eval(e);t&&angular.isFunction(t.then)&&!f.refreshing&&(f.refreshing=!0,t.finally(function(){f.refreshing=!1}))}},f.refreshDelay))},f.isActive=function(e){if(!f.open)return!1;var t=f.items.indexOf(e[f.itemProperty]),n=t==f.activeIndex;return!(!n||t<0)&&(n&&!angular.isUndefined(f.onHighlightCallback)&&e.$eval(f.onHighlightCallback),n)};var v=function(e){return f.selected&&angular.isArray(f.selected)&&f.selected.filter(function(t){return angular.equals(t,e)}).length>0},y=[];function b(e){return y.indexOf(e)>-1}f.isDisabled=function(e){if(f.open){var t=e[f.itemProperty],n=!1;if(f.items.indexOf(t)>=0&&(angular.isDefined(f.disableChoiceExpression)||f.multiple)){if(t.isTag)return!1;f.multiple&&(n=v(t)),!n&&angular.isDefined(f.disableChoiceExpression)&&(n=!!e.$eval(f.disableChoiceExpression)),function(e,t){var n=y.indexOf(e);t&&-1===n&&y.push(e),!t&&n>-1&&y.splice(n,1)}(t,n)}return n}},f.select=function(e,o,r){if(t(e)||!b(e)){if(!f.items&&!f.search&&!f.tagging.isActivated)return;if(!e||!b(e)){if(f.clickTriggeredSelect=!1,r&&("click"===r.type||"touchend"===r.type)&&e&&(f.clickTriggeredSelect=!0),f.tagging.isActivated&&!1===f.clickTriggeredSelect){if(!1===f.taggingLabel)if(f.activeIndex<0){if(void 0===e&&(e=void 0!==f.tagging.fct?f.tagging.fct(f.search):f.search),!e||angular.equals(f.items[0],e))return}else e=f.items[f.activeIndex];else if(0===f.activeIndex){if(void 0===e)return;if(void 0!==f.tagging.fct&&"string"==typeof e){if(!(e=f.tagging.fct(e)))return}else"string"==typeof e&&(e=e.replace(f.taggingLabel,"").trim())}if(v(e))return void f.close(o)}m(),n.$broadcast("uis:select",e),f.closeOnSelect&&f.close(o)}}},f.close=function(e){f.open&&(f.ngModel&&f.ngModel.$setTouched&&f.ngModel.$setTouched(),f.open=!1,m(),n.$broadcast("uis:close",e))},f.setFocus=function(){f.focus||f.focusInput[0].focus()},f.clear=function(e){f.select(null),e.stopPropagation(),r(function(){f.focusser[0].focus()},0,!1)},f.toggle=function(e){f.open?(f.close(),e.preventDefault(),e.stopPropagation()):f.activate()},f.isLocked=function(){return!1},n.$watch(function(){return angular.isDefined(f.lockChoiceExpression)&&""!==f.lockChoiceExpression},function(e){if(!e)return;var t=[];f.isLocked=function(e,n){var o=!1,r=f.selected[n];return r&&(e?(o=!!e.$eval(f.lockChoiceExpression),function(e,n){var o=t.indexOf(e);n&&-1===o&&t.push(e);!n&&o>-1&&t.splice(o,1)}(r,o)):o=function(e){return t.indexOf(e)>-1}(r)),o}});var w=null,x=!1;function C(){var e=o.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw c("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(!(f.activeIndex<0)){var n=t[f.activeIndex],r=n.offsetTop+n.clientHeight-e[0].scrollTop,i=e[0].offsetHeight;r>i?e[0].scrollTop+=r-i:r<n.clientHeight&&(f.isGrouped&&0===f.activeIndex?e[0].scrollTop=0:e[0].scrollTop-=n.clientHeight-r)}}f.sizeSearchInput=function(){var e=f.searchInput[0],t=f.$element[0],o=function(){return t.clientWidth*!!e.offsetParent},i=function(t){if(0===t)return!1;var n=t-e.offsetLeft;return n<50&&(n=t),f.searchInput.css("width",n+"px"),!0};f.searchInput.css("width","10px"),r(function(){null!==w||i(o())||(w=n.$watch(function(){x||(x=!0,n.$$postDigest(function(){x=!1,i(o())&&(w(),w=null)}))},angular.noop))})},f.searchInput.on("keydown",function(t){var o=t.which;~[e.ENTER,e.ESC].indexOf(o)&&(t.preventDefault(),t.stopPropagation()),n.$apply(function(){var n=!1;if((f.items.length>0||f.tagging.isActivated)&&(function(t){var n=!0;switch(t){case e.DOWN:if(!f.open&&f.multiple)f.activate(!1,!0);else if(f.activeIndex<f.items.length-1)for(var o=++f.activeIndex;b(f.items[o])&&o<f.items.length;)f.activeIndex=++o;break;case e.UP:var r=0===f.search.length&&f.tagging.isActivated?-1:0;if(!f.open&&f.multiple)f.activate(!1,!0);else if(f.activeIndex>r)for(var i=--f.activeIndex;b(f.items[i])&&i>r;)f.activeIndex=--i;break;case e.TAB:f.multiple&&!f.open||f.select(f.items[f.activeIndex],!0);break;case e.ENTER:f.open&&(f.tagging.isActivated||f.activeIndex>=0)?f.select(f.items[f.activeIndex],f.skipFocusser):f.activate(!1,!0);break;case e.ESC:f.close();break;default:n=!1}return n}(o)||f.searchEnabled||(t.preventDefault(),t.stopPropagation()),f.taggingTokens.isActivated)){for(var i=0;i<f.taggingTokens.tokens.length;i++)f.taggingTokens.tokens[i]===e.MAP[t.keyCode]&&f.search.length>0&&(n=!0);n&&r(function(){f.searchInput.triggerHandler("tagged");var n=f.search.replace(e.MAP[t.keyCode],"").trim();f.tagging.fct&&(n=f.tagging.fct(n)),n&&f.select(n,!0)})}}),e.isVerticalMovement(o)&&f.items.length>0&&C(),o!==e.ENTER&&o!==e.ESC||(t.preventDefault(),t.stopPropagation())}),f.searchInput.on("paste",function(t){var n;if(n=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain"),(n=f.search+n)&&n.length>0)if(f.taggingTokens.isActivated){for(var o=[],r=0;r<f.taggingTokens.tokens.length;r++){var i=e.toSeparator(f.taggingTokens.tokens[r])||f.taggingTokens.tokens[r];if(n.indexOf(i)>-1){o=n.split(i);break}}0===o.length&&(o=[n]);var a=f.search;angular.forEach(o,function(e){var t=f.tagging.fct?f.tagging.fct(e):e;t&&f.select(t,!0)}),f.search=a||g,t.preventDefault(),t.stopPropagation()}else f.paste&&(f.paste(n),f.search=g,t.preventDefault(),t.stopPropagation())}),f.searchInput.on("tagged",function(){r(function(){m()})});var S=a(function(){f.sizeSearchInput()},50);angular.element(u).bind("resize",S),n.$on("$destroy",function(){f.searchInput.off("keyup keydown tagged blur paste"),angular.element(u).off("resize",S)}),n.$watch("$select.activeIndex",function(e){e&&o.find("input").attr("aria-activedescendant","ui-select-choices-row-"+f.generatedId+"-"+e)}),n.$watch("$select.open",function(e){e||o.find("input").removeAttr("aria-activedescendant")})}]),o.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,n,o,r,i,a){return{restrict:"EA",templateUrl:function(e,n){return(n.theme||t.theme)+(angular.isDefined(n.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(r,s){var c=/{(.*)}\s*{(.*)}/.exec(s.ngClass);if(c){var l="{"+c[1]+", "+c[2]+"}";s.ngClass=l,r.attr("ng-class",l)}return angular.isDefined(s.multiple)?r.append("<ui-select-multiple/>").removeAttr("multiple"):r.append("<ui-select-single/>"),s.inputId&&(r.querySelectorAll("input.ui-select-search")[0].id=s.inputId),function(r,s,c,l,p){var d=l[0],u=l[1];function h(e){if(d.open){if(!(window.jQuery?window.jQuery.contains(s[0],e.target):s[0].contains(e.target))&&!d.clickTriggeredSelect){var t;if(d.skipFocusser)t=!0;else{var n=angular.element(e.target).controller("uiSelect");(t=n&&n!==d)||(t=~["input","button","textarea","select"].indexOf(e.target.tagName.toLowerCase()))}d.close(t),r.$digest()}d.clickTriggeredSelect=!1}}d.generatedId=t.generateId(),d.baseTitle=c.title||"Select box",d.focusserTitle=d.baseTitle+" focus",d.focusserId="focusser-"+d.generatedId,d.closeOnSelect=angular.isDefined(c.closeOnSelect)?i(c.closeOnSelect)():t.closeOnSelect,r.$watch("skipFocusser",function(){var e=r.$eval(c.skipFocusser);d.skipFocusser=void 0!==e?e:t.skipFocusser}),d.onSelectCallback=i(c.onSelect),d.onRemoveCallback=i(c.onRemove),d.ngModel=u,d.choiceGrouped=function(e){return d.isGrouped&&e&&e.name},c.tabindex&&c.$observe("tabindex",function(e){d.focusInput.attr("tabindex",e),s.removeAttr("tabindex")}),r.$watch(function(){return r.$eval(c.searchEnabled)},function(e){d.searchEnabled=void 0!==e?e:t.searchEnabled}),r.$watch("sortable",function(){var e=r.$eval(c.sortable);d.sortable=void 0!==e?e:t.sortable}),c.$observe("backspaceReset",function(){var e=r.$eval(c.backspaceReset);d.backspaceReset=void 0===e||e}),c.$observe("limit",function(){d.limit=angular.isDefined(c.limit)?parseInt(c.limit,10):void 0}),r.$watch("removeSelected",function(){var e=r.$eval(c.removeSelected);d.removeSelected=void 0!==e?e:t.removeSelected}),c.$observe("disabled",function(){d.disabled=void 0!==c.disabled&&c.disabled}),c.$observe("resetSearchInput",function(){var e=r.$eval(c.resetSearchInput);d.resetSearchInput=void 0===e||e}),c.$observe("paste",function(){d.paste=r.$eval(c.paste)}),c.$observe("tagging",function(){if(void 0!==c.tagging){var e=r.$eval(c.tagging);d.tagging={isActivated:!0,fct:!0!==e?e:void 0}}else d.tagging={isActivated:!1,fct:void 0}}),c.$observe("taggingLabel",function(){void 0!==c.tagging&&("false"===c.taggingLabel?d.taggingLabel=!1:d.taggingLabel=void 0!==c.taggingLabel?c.taggingLabel:"(new)")}),c.$observe("taggingTokens",function(){if(void 0!==c.tagging){var e=void 0!==c.taggingTokens?c.taggingTokens.split("|"):[",","ENTER"];d.taggingTokens={isActivated:!0,tokens:e}}}),c.$observe("spinnerEnabled",function(){var e=r.$eval(c.spinnerEnabled);d.spinnerEnabled=void 0!==e?e:t.spinnerEnabled}),c.$observe("spinnerClass",function(){var e=c.spinnerClass;d.spinnerClass=void 0!==e?c.spinnerClass:t.spinnerClass}),angular.isDefined(c.autofocus)&&a(function(){d.setFocus()}),angular.isDefined(c.focusOn)&&r.$on(c.focusOn,function(){a(function(){d.setFocus()})}),e.on("click",h),r.$on("$destroy",function(){e.off("click",h)}),p(r,function(e){var t=angular.element("<div>").append(e),o=t.querySelectorAll(".ui-select-match");if(o.removeAttr("ui-select-match"),o.removeAttr("data-ui-select-match"),1!==o.length)throw n("transcluded","Expected 1 .ui-select-match but got '{0}'.",o.length);s.querySelectorAll(".ui-select-match").replaceWith(o);var r=t.querySelectorAll(".ui-select-choices");if(r.removeAttr("ui-select-choices"),r.removeAttr("data-ui-select-choices"),1!==r.length)throw n("transcluded","Expected 1 .ui-select-choices but got '{0}'.",r.length);s.querySelectorAll(".ui-select-choices").replaceWith(r);var i=t.querySelectorAll(".ui-select-no-choice");i.removeAttr("ui-select-no-choice"),i.removeAttr("data-ui-select-no-choice"),1==i.length&&s.querySelectorAll(".ui-select-no-choice").replaceWith(i)});var f=r.$eval(c.appendToBody);(void 0!==f?f:t.appendToBody)&&(r.$watch("$select.open",function(t){var n;t?(n=o(s),(g=angular.element('<div class="ui-select-placeholder"></div>'))[0].style.width=n.width+"px",g[0].style.height=n.height+"px",s.after(g),m=s[0].style.width,e.find("body").append(s),s[0].style.position="absolute",s[0].style.left=n.left+"px",s[0].style.top=n.top+"px",s[0].style.width=n.width+"px"):v()}),r.$on("$destroy",function(){v()}));var g=null,m="";function v(){null!==g&&(g.replaceWith(s),g=null,s[0].style.position="",s[0].style.left="",s[0].style.top="",s[0].style.width=m,d.setFocus())}var y=null;r.$watch("$select.open",function(){"auto"!==d.dropdownPosition&&"up"!==d.dropdownPosition||r.calculateDropdownPos()});var b=function(e,t){e=e||o(s),t=t||o(y),y[0].style.position="absolute",y[0].style.top=-1*t.height+"px",s.addClass("direction-up")},w=function(){a(function(){if("up"===d.dropdownPosition)b();else{s.removeClass("direction-up");var t=o(s),n=o(y),r=e[0].documentElement.scrollTop||e[0].body.scrollTop;t.top+t.height+n.height>r+e[0].documentElement.clientHeight?b(t,n):function(e,t){s.removeClass("direction-up"),e=e||o(s),t=t||o(y),y[0].style.position="",y[0].style.top=""}(t,n)}y[0].style.opacity=1})},x=!1;r.calculateDropdownPos=function(){if(d.open){if(0===(y=angular.element(s).querySelectorAll(".ui-select-dropdown")).length)return;if(""!==d.search||x||(y[0].style.opacity=0,x=!0),!o(y).height&&d.$animate&&d.$animate.on&&d.$animate.enabled(y)){var e=!0;d.$animate.on("enter",y,function(t,n){"close"===n&&e&&(w(),e=!1)})}else w()}else{if(null===y||0===y.length)return;y[0].style.opacity=0,y[0].style.position="",y[0].style.top="",s.removeClass("direction-up")}}}}}}]),o.directive("uiSelectMatch",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(n){n.addClass("ui-select-match");var o=n.parent();return(t(o,"theme")||e.theme)+(angular.isDefined(t(o,"multiple"))?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,n,o,r){function i(e){r.allowClear=!!angular.isDefined(e)&&(""===e||"true"===e.toLowerCase())}r.lockChoiceExpression=o.uiLockChoice,o.$observe("placeholder",function(t){r.placeholder=void 0!==t?t:e.placeholder}),o.$observe("allowClear",i),i(o.allowClear),r.multiple&&r.sizeSearchInput()}};function t(e,t){return e[0].hasAttribute(t)?e.attr(t):e[0].hasAttribute("data-"+t)?e.attr("data-"+t):e[0].hasAttribute("x-"+t)?e.attr("x-"+t):void 0}}]),o.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(n,o){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var n,o=this,r=e.$select;angular.isUndefined(r.selected)&&(r.selected=[]),e.$evalAsync(function(){n=e.ngModel}),o.activeMatchIndex=-1,o.updateModel=function(){n.$setViewValue(Date.now()),o.refreshComponent()},o.refreshComponent=function(){r.refreshItems&&r.refreshItems(),r.sizeSearchInput&&r.sizeSearchInput()},o.removeChoice=function(n){if(r.isLocked(null,n))return!1;var i=r.selected[n],a={};return a[r.parserResult.itemName]=i,r.selected.splice(n,1),o.activeMatchIndex=-1,r.sizeSearchInput(),t(function(){r.onRemoveCallback(e,{$item:i,$model:r.parserResult.modelMapper(e,a)})}),o.updateModel(),!0},o.getPlaceholder=function(){if(!r.selected||!r.selected.length)return r.placeholder}}],controllerAs:"$selectMultiple",link:function(r,i,a,s){var c=s[0],l=r.ngModel=s[1],p=r.$selectMultiple;function d(e){return void 0!==e&&void 0!==c.search&&e.filter(function(e){return void 0!==c.search.toUpperCase()&&void 0!==e&&e.toUpperCase()===c.search.toUpperCase()}).length>0}function u(e,t){var n=-1;if(angular.isArray(e))for(var o=angular.copy(e),r=0;r<o.length;r++)if(void 0===c.tagging.fct)o[r]+" "+c.taggingLabel===t&&(n=r);else{var i=o[r];angular.isObject(i)&&(i.isTag=!0),angular.equals(i,t)&&(n=r)}return n}c.multiple=!0,c.focusInput=c.searchInput,l.$isEmpty=function(e){return!e||0===e.length},l.$parsers.unshift(function(){for(var e,t={},n=[],o=c.selected.length-1;o>=0;o--)(t={})[c.parserResult.itemName]=c.selected[o],e=c.parserResult.modelMapper(r,t),n.unshift(e);return n}),l.$formatters.unshift(function(e){var t,n=c.parserResult&&c.parserResult.source(r,{$select:{search:""}}),o={};if(!n)return e;var i=[],a=function(e,n){if(e&&e.length){for(var a=e.length-1;a>=0;a--){if(o[c.parserResult.itemName]=e[a],t=c.parserResult.modelMapper(r,o),c.parserResult.trackByExp){var s=/(\w*)\./.exec(c.parserResult.trackByExp),l=/\.([^\s]+)/.exec(c.parserResult.trackByExp);if(s&&s.length>0&&s[1]==c.parserResult.itemName&&l&&l.length>0&&t[l[1]]==n[l[1]])return i.unshift(e[a]),!0}if(angular.equals(t,n))return i.unshift(e[a]),!0}return!1}};if(!e)return i;for(var s=e.length-1;s>=0;s--)a(c.selected,e[s])||a(n,e[s])||i.unshift(e[s]);return i}),r.$watchCollection(function(){return l.$modelValue},function(e,t){t!=e&&(angular.isDefined(l.$modelValue)&&(l.$modelValue=null),p.refreshComponent())}),l.$render=function(){if(!angular.isArray(l.$viewValue)){if(!t(l.$viewValue))throw n("multiarr","Expected model value to be array but got '{0}'",l.$viewValue);l.$viewValue=[]}c.selected=l.$viewValue,p.refreshComponent(),r.$evalAsync()},r.$on("uis:select",function(e,t){if(!(c.selected.length>=c.limit)){c.selected.push(t);var n={};n[c.parserResult.itemName]=t,o(function(){c.onSelectCallback(r,{$item:t,$model:c.parserResult.modelMapper(r,n)})}),p.updateModel()}}),r.$on("uis:activate",function(){p.activeMatchIndex=-1}),r.$watch("$select.disabled",function(e,t){t&&!e&&c.sizeSearchInput()}),c.searchInput.on("keydown",function(t){var n=t.which;r.$apply(function(){var o=!1;e.isHorizontalMovement(n)&&(o=function(t){var n=(d=c.searchInput[0],angular.isNumber(d.selectionStart)?d.selectionStart:d.value.length),o=c.selected.length,r=o-1,i=p.activeMatchIndex,a=p.activeMatchIndex+1,s=p.activeMatchIndex-1,l=i;var d;if(n>0||c.search.length&&t==e.RIGHT)return!1;c.close(),l=function(){switch(t){case e.LEFT:return~p.activeMatchIndex?s:r;case e.RIGHT:return~p.activeMatchIndex&&i!==r?a:(c.activate(),!1);case e.BACKSPACE:return~p.activeMatchIndex?p.removeChoice(i)?s:i:r;case e.DELETE:return!!~p.activeMatchIndex&&(p.removeChoice(p.activeMatchIndex),i)}}(),c.selected.length&&!1!==l?p.activeMatchIndex=Math.min(r,Math.max(0,l)):p.activeMatchIndex=-1;return!0}(n)),o&&n!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),c.searchInput.on("keyup",function(t){if(e.isVerticalMovement(t.which)||r.$evalAsync(function(){c.activeIndex=!1===c.taggingLabel?-1:0}),c.tagging.isActivated&&c.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;if(c.activeIndex=!1===c.taggingLabel?-1:0,!1===c.taggingLabel)return;var n,o,i,a=angular.copy(c.items),s=angular.copy(c.items),l=!1,p=-1;if(void 0!==c.tagging.fct){if((o=c.$filter("filter")(a,{isTag:!0})).length>0&&(i=o[0]),a.length>0&&i&&(l=!0,a=a.slice(1,a.length),s=s.slice(1,s.length)),n=c.tagging.fct(c.search),s.some(function(e){return angular.equals(e,n)})||c.selected.some(function(e){return angular.equals(e,n)}))return void r.$evalAsync(function(){c.activeIndex=0,c.items=a});n&&(n.isTag=!0)}else{if((o=c.$filter("filter")(a,function(e){return e.match(c.taggingLabel)})).length>0&&(i=o[0]),void 0!==a[0]&&a.length>0&&i&&(l=!0,a=a.slice(1,a.length),s=s.slice(1,s.length)),n=c.search+" "+c.taggingLabel,u(c.selected,c.search)>-1)return;if(d(s.concat(c.selected)))return void(l&&(a=s,r.$evalAsync(function(){c.activeIndex=0,c.items=a})));if(d(s))return void(l&&(c.items=s.slice(1,s.length)))}l&&(p=u(c.selected,n)),p>-1?a=a.slice(p+1,a.length-1):(a=[],n&&a.push(n),a=a.concat(s)),r.$evalAsync(function(){if(c.activeIndex=0,c.items=a,c.isGrouped){var e=n?a.slice(1):a;c.setItemsFn(e),n&&(c.items.unshift(n),c.groups.unshift({name:"",items:[n],tagging:!0}))}})}}),c.searchInput.on("blur",function(){o(function(){p.activeMatchIndex=-1})})}}}]),o.directive("uiSelectNoChoice",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){return t.addClass("ui-select-no-choice"),(t.parent().attr("theme")||e.theme)+"/no-choice.tpl.html"}}}]),o.directive("uiSelectSingle",["$timeout","$compile",function(n,o){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(r,i,a,s){var c=s[0],l=s[1];l.$parsers.unshift(function(e){if(t(e))return e;var n={};return n[c.parserResult.itemName]=e,c.parserResult.modelMapper(r,n)}),l.$formatters.unshift(function(e){if(t(e))return e;var n=c.parserResult&&c.parserResult.source(r,{$select:{search:""}}),o={};if(n){var i=function(t){return o[c.parserResult.itemName]=t,c.parserResult.modelMapper(r,o)===e};if(c.selected&&i(c.selected))return c.selected;for(var a=n.length-1;a>=0;a--)if(i(n[a]))return n[a]}return e}),r.$watch("$select.selected",function(e){l.$viewValue!==e&&l.$setViewValue(e)}),l.$render=function(){c.selected=l.$viewValue},r.$on("uis:select",function(e,o){c.selected=o;var i={};i[c.parserResult.itemName]=o,n(function(){c.onSelectCallback(r,{$item:o,$model:t(o)?o:c.parserResult.modelMapper(r,i)})})}),r.$on("uis:close",function(e,t){n(function(){c.focusser.prop("disabled",!1),t||c.focusser[0].focus()},0,!1)}),r.$on("uis:activate",function(){p.prop("disabled",!0)});var p=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");o(p)(r),c.focusser=p,c.focusInput=p,i.parent().append(p),p.bind("focus",function(){r.$evalAsync(function(){c.focus=!0})}),p.bind("blur",function(){r.$evalAsync(function(){c.focus=!1})}),p.bind("keydown",function(t){if(t.which===e.BACKSPACE&&!1!==c.backspaceReset)return t.preventDefault(),t.stopPropagation(),c.select(void 0),void r.$apply();t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||(t.which!=e.DOWN&&t.which!=e.UP&&t.which!=e.ENTER&&t.which!=e.SPACE||(t.preventDefault(),t.stopPropagation(),c.activate()),r.$digest())}),p.bind("keyup input",function(t){t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE||(c.activate(p.val()),p.val(""),r.$digest())})}}}]),o.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,n){return{require:["^^uiSelect","^ngModel"],link:function(t,o,r,i){if(null===t[r.uiSelectSort])throw n("sort","Expected a list to sort");var a=i[0],s=i[1],c=angular.extend({axis:"horizontal"},t.$eval(r.uiSelectSortOptions)).axis;t.$watch(function(){return a.sortable},function(e){e?o.attr("draggable",!0):o.removeAttr("draggable")}),o.on("dragstart",function(e){o.addClass("dragging"),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text",t.$index.toString())}),o.on("dragend",function(){p("dragging")});var l,p=function(e){angular.forEach(a.$element.querySelectorAll("."+e),function(t){angular.element(t).removeClass(e)})},d=function(e){e.preventDefault(),("vertical"===c?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0))<this["vertical"===c?"offsetHeight":"offsetWidth"]/2?(p("dropping-after"),o.addClass("dropping-before")):(p("dropping-before"),o.addClass("dropping-after"))},u=function(t){t.preventDefault();var n=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text"),10);e.cancel(l),l=e(function(){h(n)},20)},h=function(e){var n=t.$eval(r.uiSelectSort),i=n[e],a=null;a=o.hasClass("dropping-before")?e<t.$index?t.$index-1:t.$index:e<t.$index?t.$index:t.$index+1,function(e,t){this.splice(t,0,this.splice(e,1)[0])}.apply(n,[e,a]),s.$setViewValue(Date.now()),t.$apply(function(){t.$emit("uiSelectSort:change",{array:n,item:i,from:e,to:a})}),p("dropping"),p("dropping-before"),p("dropping-after"),o.off("drop",u)};o.on("dragenter",function(){o.hasClass("dragging")||(o.addClass("dropping"),o.on("dragover",d),o.on("drop",u))}),o.on("dragleave",function(e){e.target==o&&(p("dropping"),p("dropping-before"),p("dropping-after"),o.off("dragover",d),o.off("drop",u))})}}}]),o.factory("$$uisDebounce",["$timeout",function(e){return function(t,n){var o;return function(){var r=this,i=Array.prototype.slice.call(arguments);o&&e.cancel(o),o=e(function(){t.apply(r,i)},n)}}}]),o.directive("uisOpenClose",["$parse","$timeout",function(e,t){return{restrict:"A",require:"uiSelect",link:function(n,o,r,i){i.onOpenCloseCallback=e(r.uisOpenClose),n.$watch("$select.open",function(e,o){e!==o&&t(function(){i.onOpenCloseCallback(n,{isOpen:e})})})}}}]),o.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){this.parse=function(n){var o;if(!(o=n.match(/^\s*(?:([\s\S]+?)\s+as\s+)?(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(\s*[\s\S]+?)?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/)))throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);var r=o[5],i="";if(o[3]){r=o[5].replace(/(^\()|(\)$)/g,"");var a=o[5].match(/^\s*(?:[\s\S]+?)(?:[^\|]|\|\|)+([\s\S]*)\s*$/);a&&a[1].trim()&&(i=a[1],r=r.replace(i,""))}return{itemName:o[4]||o[2],keyName:o[3],source:t(r),filters:i,trackByExp:o[6],modelMapper:t(o[1]||o[4]||o[2]),repeatExpression:function(e){var t=this.itemName+" in "+(e?"$group.items":"$select.items");return this.trackByExp&&(t+=" track by "+this.trackByExp),t}}},this.getGroupNgRepeatExpression=function(){return"$group in $select.groups track by $group.name"}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices ui-select-dropdown selectize-dropdown" ng-class="{\'single\': !$select.multiple, \'multi\': $select.multiple}"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match-multiple.tpl.html",'<div class="ui-select-match" data-value="" ng-repeat="$item in $select.selected track by $index" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'active\':$selectMultiple.activeMatchIndex === $index}" ui-select-sort="$select.selected"><span class="ui-select-match-item" ng-class="{\'select-locked\':$select.isLocked(this, $index)}"><span uis-transclude-append=""></span> <span class="remove ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&times;</span></span></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="$select.searchEnabled && ($select.open || $select.isEmpty())" class="ui-select-match"><span ng-show="!$select.searchEnabled && ($select.isEmpty() || $select.open)" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty() || $select.open" ng-transclude=""></span></div>'),e.put("selectize/no-choice.tpl.html",'<div class="ui-select-no-choice selectize-dropdown" ng-show="$select.items.length == 0"><div class="selectize-dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("selectize/select-multiple.tpl.html",'<div class="ui-select-container selectize-control multi plugin-remove_button" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-model="$select.search" ng-disabled="$select.disabled" aria-expanded="{{$select.open}}" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus, \'refreshing\': $select.open && $select.refreshing && $select.spinnerEnabled }" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><i class="iconfont iconspinner fa-pulse"></i><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.isEmpty() && !$select.open" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu" ng-show="$select.open && $select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><span class="ui-select-choices-row-inner"></span></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected track by $index"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/no-choice.tpl.html",'<ul class="ui-select-no-choice dropdown-menu" ng-show="$select.items.length == 0"><li ng-transclude=""></li></ul>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-expanded="{{$select.open}}" aria-label="{{$select.baseTitle}}" ng-class="{\'spinner\': $select.refreshing}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><span ng-show="$select.open && $select.refreshing && $select.spinnerEnabled" class="ui-select-refreshing {{$select.spinnerClass}}"></span> <input type="search" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" class="form-control ui-select-search" ng-class="{ \'ui-select-search-hidden\' : !$select.searchEnabled }" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.open"><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>')}]),window,document,angular.module("toaster",[]).constant("toasterConfig",{limit:0,"tap-to-dismiss":!0,"close-button":!1,"close-html":'<button class="toast-close-button" type="button">&times;</button>',"newest-on-top":!0,"time-out":5e3,"icon-classes":{error:"toast-error",info:"toast-info",wait:"toast-wait",success:"toast-success",warning:"toast-warning"},"body-output-type":"","body-template":"toasterBodyTmpl.html","icon-class":"toast-info","position-class":"toast-top-right","title-class":"toast-title","message-class":"toast-message","prevent-duplicates":!1,"mouseover-timer-stop":!0}).run(["$templateCache",function(e){e.put("angularjs-toaster/toast.html",'<div id="toast-container" ng-class="[config.position, config.animation]"><div ng-repeat="toaster in toasters" class="toast" ng-class="toaster.type" ng-click="click($event, toaster)" ng-mouseover="stopTimer(toaster)" ng-mouseout="restartTimer(toaster)"><div ng-if="toaster.showCloseButton" ng-click="click($event, toaster, true)" ng-bind-html="toaster.closeHtml"></div><div ng-class="config.title">{{toaster.title}}</div><div ng-class="config.message" ng-switch on="toaster.bodyOutputType"><div ng-switch-when="trustedHtml" ng-bind-html="toaster.html"></div><div ng-switch-when="template"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="templateWithData"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="directive"><div directive-template directive-name="{{toaster.html}}" directive-data="{{toaster.directiveData}}"></div></div><div ng-switch-default >{{toaster.body}}</div></div></div></div>')}]).service("toaster",["$rootScope","toasterConfig",function(e,t){var n=function(){var e={newGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};return e}();for(var o in this.pop=function(t,o,r,i,a,s,c,l,p,d){if(angular.isObject(t)){var u=t;this.toast={type:u.type,title:u.title,body:u.body,timeout:u.timeout,bodyOutputType:u.bodyOutputType,clickHandler:u.clickHandler,showCloseButton:u.showCloseButton,closeHtml:u.closeHtml,toastId:u.toastId,onShowCallback:u.onShowCallback,onHideCallback:u.onHideCallback,directiveData:u.directiveData,tapToDismiss:u.tapToDismiss},c=u.toasterId}else this.toast={type:t,title:o,body:r,timeout:i,bodyOutputType:a,clickHandler:s,showCloseButton:l,toastId:p,onHideCallback:d};return this.toast.toastId&&this.toast.toastId.length||(this.toast.toastId=n.newGuid()),e.$emit("toaster-newToast",c,this.toast.toastId),{toasterId:c,toastId:this.toast.toastId,toaster:this.toast}},this.clear=function(t,n){angular.isObject(t)?e.$emit("toaster-clearToasts",t.toasterId,t.toastId):e.$emit("toaster-clearToasts",t,n)},this.reset=function(t){e.$emit("toaster-resetToasts",t.toasterId,t.toastId)},t["icon-classes"])this[o]=r(o);function r(e){return function(t,n,o,r,i,a,s,c,l){return angular.isString(t)?this.pop(e,t,n,o,r,i,a,s,c,l):this.pop(angular.extend(t,{type:e}))}}}]).factory("toasterEventRegistry",["$rootScope",function(e){var t,n=null,o=null,r=null,i=[],a=[],s=[];return{setup:(t={setup:function(){n||(n=e.$on("toaster-newToast",function(e,t,n){for(var o=0,r=i.length;o<r;o++)i[o](e,t,n)})),o||(o=e.$on("toaster-clearToasts",function(e,t,n){for(var o=0,r=a.length;o<r;o++)a[o](e,t,n)})),r||(r=e.$on("toaster-resetToasts",function(e,t,n){for(var o=0,r=s.length;o<r;o++)s[o](e,t,n)}))},subscribeToNewToastEvent:function(e){i.push(e)},subscribeToClearToastsEvent:function(e){a.push(e)},subscribeToResetToastsEvent:function(e){s.push(e)},unsubscribeToNewToastEvent:function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1),0===i.length&&(n(),n=null)},unsubscribeToClearToastsEvent:function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1),0===a.length&&(o(),o=null)},unsubscribeToResetToastsEvent:function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&(r(),r=null)}}).setup,subscribeToNewToastEvent:t.subscribeToNewToastEvent,subscribeToClearToastsEvent:t.subscribeToClearToastsEvent,subscribeToResetToastsEvent:t.subscribeToResetToastsEvent,unsubscribeToNewToastEvent:t.unsubscribeToNewToastEvent,unsubscribeToClearToastsEvent:t.unsubscribeToClearToastsEvent,unsubscribeToResetToastsEvent:t.unsubscribeToResetToastsEvent}}]).directive("directiveTemplate",["$compile","$injector","$interval",function(e,t,n){return{restrict:"A",scope:{directiveName:"@directiveName",directiveData:"@directiveData"},replace:!0,link:function(n,o,r){n.$watch("directiveName",function(i){if(angular.isUndefined(i)||i.length<=0)throw new Error("A valid directive name must be provided via the toast body argument when using bodyOutputType: directive");var a;try{a=t.get(r.$normalize(i)+"Directive")}catch(e){throw new Error(i+" could not be found. The name should appear as it exists in the markup, not camelCased as it would appear in the directive declaration, e.g. directive-name not directiveName.")}var s=a[0];if(!0!==s.scope&&s.scope)throw new Error("Cannot use a directive with an isolated scope. The scope must be either true or falsy (e.g. false/null/undefined). Occurred for directive "+i+".");if(s.restrict.indexOf("A")<0)throw new Error('Directives must be usable as attributes. Add "A" to the restrict option (or remove the option entirely). Occurred for directive '+i+".");n.directiveData&&(n.directiveData=angular.fromJson(n.directiveData));var c=e("<div "+i+"></div>")(n);o.append(c)})}}}]).directive("toasterContainer",["$parse","$rootScope","$interval","$sce","toasterConfig","toaster","toasterEventRegistry",function(e,t,n,o,r,i,a){return{replace:!0,restrict:"EA",scope:!0,link:function(t,s,c){var l;function p(e){var o=t.toasters[e];o.timeoutPromise&&n.cancel(o.timeoutPromise),t.toasters.splice(e,1),angular.isFunction(o.onHideCallback)&&o.onHideCallback(o)}function d(e){return angular.isUndefined(e)||null===e}l=angular.extend({},r,t.$eval(c.toasterOptions)),t.config={toasterId:l["toaster-id"],position:l["position-class"],title:l["title-class"],message:l["message-class"],tap:l["tap-to-dismiss"],closeButton:l["close-button"],closeHtml:l["close-html"],animation:l["animation-class"],mouseoverTimer:l["mouseover-timer-stop"]},t.$on("$destroy",function(){a.unsubscribeToNewToastEvent(t._onNewToast),a.unsubscribeToClearToastsEvent(t._onClearToasts),a.unsubscribeToResetToastsEvent(t._onResetToasts)}),t.configureTimer=function(e){var o=angular.isNumber(e.timeout)?e.timeout:l["time-out"];"object"==typeof o&&(o=o[e.type]),o>0&&function(e,o){e.timeoutPromise=n(function(){t.removeToast(e.toastId)},o,1)}(e,o)},t.removeToast=function(e){var n,o;for(n=0,o=t.toasters.length;n<o;n++)if(t.toasters[n].toastId===e){p(n);break}},t.toasters=[],t._onNewToast=function(n,r,a){(d(t.config.toasterId)&&d(r)||!d(t.config.toasterId)&&!d(r)&&t.config.toasterId==r)&&function(n,r){if(n.type=l["icon-classes"][n.type],n.type||(n.type=l["icon-class"]),!0===l["prevent-duplicates"]&&t.toasters.length){if(t.toasters[t.toasters.length-1].body===n.body)return;var i,a,s=!1;for(i=0,a=t.toasters.length;i<a;i++)if(t.toasters[i].toastId===r){s=!0;break}if(s)return}var c=l["close-button"];if("boolean"==typeof n.showCloseButton);else if("boolean"==typeof c)n.showCloseButton=c;else if("object"==typeof c){var p=c[n.type];null!=p&&(n.showCloseButton=p)}else n.showCloseButton=!1;switch(n.showCloseButton&&(n.closeHtml=o.trustAsHtml(n.closeHtml||t.config.closeHtml)),n.bodyOutputType=n.bodyOutputType||l["body-output-type"],n.bodyOutputType){case"trustedHtml":n.html=o.trustAsHtml(n.body);break;case"template":n.bodyTemplate=n.body||l["body-template"];break;case"templateWithData":var d=e(n.body||l["body-template"])(t);n.bodyTemplate=d.template,n.data=d.data;break;case"directive":n.html=n.body}t.configureTimer(n),!0===l["newest-on-top"]?(t.toasters.unshift(n),l.limit>0&&t.toasters.length>l.limit&&t.toasters.pop()):(t.toasters.push(n),l.limit>0&&t.toasters.length>l.limit&&t.toasters.shift()),angular.isFunction(n.onShowCallback)&&n.onShowCallback(n)}(i.toast,a)},t._onClearToasts=function(e,n,o){("*"==n||d(t.config.toasterId)&&d(n)||!d(t.config.toasterId)&&!d(n)&&t.config.toasterId==n)&&function(e){for(var n=t.toasters.length-1;n>=0;n--)d(e)?p(n):t.toasters[n].toastId==e&&p(n)}(o)},t._onResetToasts=function(e,o,r){i.toast.timeoutPromise&&(n.cancel(i.toast.timeoutPromise),i.toast.timeoutPromise=null),t.configureTimer(i.toast)},a.setup(),a.subscribeToNewToastEvent(t._onNewToast),a.subscribeToClearToastsEvent(t._onClearToasts),a.subscribeToResetToastsEvent(t._onResetToasts)},controller:["$scope","$element","$attrs",function(e,t,o){e.stopTimer=function(t){!0===e.config.mouseoverTimer&&t.timeoutPromise&&(n.cancel(t.timeoutPromise),t.timeoutPromise=null)},e.restartTimer=function(t){!0===e.config.mouseoverTimer?t.timeoutPromise||e.configureTimer(t):null===t.timeoutPromise&&e.removeToast(t.toastId)},e.click=function(t,n,o){if(t.stopPropagation(),!0===("boolean"==typeof n.tapToDismiss?n.tapToDismiss:e.config.tap)||!0===n.showCloseButton&&!0===o){var r=!0;n.clickHandler&&(angular.isFunction(n.clickHandler)?r=n.clickHandler(n,o):angular.isFunction(e.$parent.$eval(n.clickHandler))&&(r=e.$parent.$eval(n.clickHandler)(n,o))),r&&e.removeToast(n.toastId)}}}],templateUrl:"angularjs-toaster/toast.html"}}]),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.frappe=t()}(this,function(){function e(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function t(e){var t=e.getBoundingClientRect();return{top:t.top+(document.documentElement.scrollTop||document.body.scrollTop),left:t.left+(document.documentElement.scrollLeft||document.body.scrollLeft)}}function n(e){return e.titleHeight+e.margins.top+e.paddings.top}function o(e){return e.margins.left+e.paddings.left}function r(e){return e.margins.top+e.margins.bottom+e.paddings.top+e.paddings.bottom+e.titleHeight+e.legendHeight}function i(e){return e.margins.left+e.margins.right+e.paddings.left+e.paddings.right}function a(e){return parseFloat(e.toFixed(2))}function s(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n||(n=o?e[0]:e[e.length-1]);var r=new Array(Math.abs(t)).fill(n);return o?r.concat(e):e.concat(r)}function c(e,t){return(e+"").length*t}function l(e,t){return{x:Math.sin(e*le)*t,y:Math.cos(e*le)*t}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(Number.isNaN(e)||void 0===e||!Number.isFinite(e)||t&&e<0)}function d(e,t){var n=void 0,o=void 0;return e<=t?(n=t-e,o=e):(n=e-t,o=t),[n,o]}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e.length;return n>0?e=s(e,n):t=s(t,n),[e,t]}function h(e,t){if(e)return e.length>t?e.slice(0,t-3)+"...":e}function f(e,t){for(var n=[],o=0;o<e.length;o++)n.push([e[o],t[o]]);var r=function(e,t,n,o){var r=function(e,t){var n=t[0]-e[0],o=t[1]-e[1];return{length:Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),angle:Math.atan2(o,n)}}(t||e,n||e),i=r.angle+(o?Math.PI:0),a=.2*r.length;return[e[0]+Math.cos(i)*a,e[1]+Math.sin(i)*a]};return n.reduce(function(e,t,n,o){return 0===n?t[0]+","+t[1]:e+" "+function(e,t,n){var o=r(n[t-1],n[t-2],e),i=r(e,n[t-1],n[t+1],!0);return"C "+o[0]+","+o[1]+" "+i[0]+","+i[1]+" "+e[0]+","+e[1]}(t,n,o)},"")}function g(e){return e>255?255:e<0?0:e}function m(e,t){var n=ue(e),o=!1;"#"==n[0]&&(n=n.slice(1),o=!0);var r=parseInt(n,16),i=g((r>>16)+t),a=g((r>>8&255)+t);return(o?"#":"")+(g((255&r)+t)|a<<8|i<<16).toString(16)}function v(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function y(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var o in t){var r=t[o];if("inside"===o)v(r).appendChild(n);else if("around"===o){var i=v(r);i.parentNode.insertBefore(n,i),n.appendChild(i)}else"styles"===o?"object"===(void 0===r?"undefined":K(r))&&Object.keys(r).map(function(e){n.style[e]=r[e]}):("className"===o&&(o="class"),"innerHTML"===o?n.textContent=r:n.setAttribute(o,r))}return n}function b(e,t,n,o){return y("stop",{inside:e,style:"stop-color: "+n,offset:t,"stop-opacity":o})}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o={className:e,transform:t};return n&&(o.inside=n),y("g",o)}function x(e){return y("path",{className:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d:e,styles:{stroke:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",fill:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none","stroke-width":arguments.length>4&&void 0!==arguments[4]?arguments[4]:2}})}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="path-fill-gradient-"+t+"-"+(n?"lighter":"default"),r=function(e,t){return y("linearGradient",{inside:e,id:t,x1:0,x2:0,y1:0,y2:1})}(e,o),i=[1,.6,.2];return n&&(i=[.4,.2,0]),b(r,"0%",t,i[0]),b(r,"50%",t,i[1]),b(r,"100%",t,i[2]),o}function S(e,t,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s={className:e,x:t,y:n,width:o,height:o,rx:r,fill:i};return Object.keys(a).map(function(e){s[e]=a[e]}),y("rect",s)}function I(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=r.fontSize||me;return y("text",{className:e,x:t,y:n,dy:(void 0!==r.dy?r.dy:i/2)+"px","font-size":i+"px",fill:r.fill||ye,"text-anchor":r.textAnchor||"start",innerHTML:o})}function N(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.stroke||(r.stroke=ve),r.lineType||(r.lineType=""),r.shortenNumbers&&(t=function(e){var t=void 0;if("number"==typeof e)t=e;else if("string"==typeof e&&(t=Number(e),Number.isNaN(t)))return e;var n=Math.floor(Math.log10(Math.abs(t)));if(n<=2)return t;var o=Math.floor(n/3),r=Math.pow(10,n-3*o)*+(t/Math.pow(10,n)).toFixed(1);return Math.round(100*r)/100+" "+["","K","M","B","T"][o]}(t));var i=y("line",{className:"line-horizontal "+r.className+("dashed"===r.lineType?"dashed":""),x1:n,x2:o,y1:0,y2:0,styles:{stroke:r.stroke}}),a=y("text",{x:n<o?n-fe:n+fe,y:0,dy:me/2-2+"px","font-size":me+"px","text-anchor":n<o?"end":"start",innerHTML:t+""}),s=y("g",{transform:"translate(0, "+e+")","stroke-opacity":1});return 0!==a&&"0"!==a||(s.style.stroke="rgba(27, 31, 35, 0.6)"),s.appendChild(i),s.appendChild(a),s}function _(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};p(e)||(e=0),o.pos||(o.pos="bottom"),o.offset||(o.offset=0),o.mode||(o.mode="span"),o.stroke||(o.stroke=ve),o.className||(o.className="");var r=n+he,i="span"===o.mode?-1*he:n;return"tick"===o.mode&&"top"===o.pos&&(r=-1*he,i=0),function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.stroke||(r.stroke=ve);var i=y("line",{className:"line-vertical "+r.className,x1:0,x2:0,y1:n,y2:o,styles:{stroke:r.stroke}}),a=y("text",{x:0,y:n>o?n+fe:n-fe-me,dy:me+"px","font-size":me+"px","text-anchor":"middle",innerHTML:t+""}),s=y("g",{transform:"translate("+e+", 0)"});return s.appendChild(i),s.appendChild(a),s}(e,t,r,i,{stroke:o.stroke,className:o.className,lineType:o.lineType})}function T(e,t,n,o){var r="string"==typeof t?t:t.join(", ");return[e,{transform:n.join(", ")},o,Ne,"translate",{transform:r}]}function E(e,t,n){return T(e,[0,n],[0,t],Se)}function k(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=d(n,(arguments.length>5&&void 0!==arguments[5]?arguments[5]:{}).zeroLine),a=ee(i,2),s=a[0],c=a[1];return c-=r,"rect"!==e.nodeName?[[e.childNodes[0],{width:o,height:s},xe,Ne],T(e,e.getAttribute("transform").split("(")[1].slice(0,-1),[t,c],Se)]:[[e,{width:o,height:s,x:t,y:c},xe,Ne]]}function $(e,t){return[e,{d:t},xe,Ne]}function P(e,t){e.style.transform=t,e.style.webkitTransform=t,e.style.msTransform=t,e.style.mozTransform=t,e.style.oTransform=t}function O(e,t){var n=[],o=[];t.map(function(e){var t,r,i=e[0],a=i.parentNode;e[0]=i;var s=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=e.cloneNode(!0),s=e.cloneNode(!0);for(var c in t){var l=void 0;l="transform"===c?document.createElementNS("http://www.w3.org/2000/svg","animateTransform"):document.createElementNS("http://www.w3.org/2000/svg","animate");var p=i[c]||e.getAttribute(c),d=t[c],u={attributeName:c,from:p,to:d,begin:"0s",dur:n/1e3+"s",values:p+";"+d,keySplines:_e[o],keyTimes:"0;1",calcMode:"spline",fill:"freeze"};for(var h in r&&(u.type=r),u)l.setAttribute(h,u[h]);a.appendChild(l),r?s.setAttribute(c,"translate("+d+")"):s.setAttribute(c,d)}return[a,s]}.apply(void 0,te(e)),c=ee(s,2);t=c[0],r=c[1],n.push(r),o.push([t,a]),a&&a.replaceChild(t,i)});var r=e.cloneNode(!0);return o.map(function(e,o){e[1]&&(e[1].replaceChild(n[o],e[0]),t[o][0]=n[o])}),r}function A(t){var n=t.cloneNode(!0);n.classList.add("chart-container"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var o=e.create("style",{innerHTML:Te});n.insertBefore(o,n.firstChild);var r=e.create("div");return r.appendChild(n),r.innerHTML}function M(e){var t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function D(e){var t=e.getDate(),n=e.getMonth()+1;return[e.getFullYear(),(n>9?"":"0")+n,(t>9?"":"0")+t].join("-")}function L(e){return new Date(e.getTime())}function R(e,t){var n=G(e);return Math.ceil(function(e,t){var n=Oe*Pe;return(M(t)-M(e))/n}(n,t)/$e)}function U(e,t){return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function z(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ae[e];return t?n.slice(0,3):n}function j(e,t){return new Date(t,e+1,0)}function G(e){var t=L(e),n=t.getDay();return 0!==n&&F(t,-1*n),t}function F(e,t){e.setDate(e.getDate()+t)}function B(e,t,n){var o=Object.keys(Le).filter(function(t){return e.includes(t)}),r=Le[o[0]];return Object.assign(r,{constants:t,getData:n}),new De(r)}function H(e){if(0===e)return[0,0];if(isNaN(e))return{mantissa:-6755399441055744,exponent:972};var t=e>0?1:-1;if(!isFinite(e))return{mantissa:4503599627370496*t,exponent:972};e=Math.abs(e);var n=Math.floor(Math.log10(e));return[t*(e/Math.pow(10,n)),n]}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=H(e),o=ee(n,2),r=o[0],i=o[1],a=t?t/Math.pow(10,i):0,s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Math.ceil(e),o=Math.floor(t),r=n-o,i=r,a=1;r>5&&(r%2!=0&&(r=++n-o),i=r/2,a=2),r<=2&&(a=r/(i=4)),0===r&&(i=5,a=1);for(var s=[],c=0;c<=i;c++)s.push(o+a*c);return s}(r=r.toFixed(6),a);return s.map(function(e){return e*Math.pow(10,i)})}function V(e){return e[1]-e[0]}function X(e,t){return a(t.zeroLine-e*t.scaleMultiplier)}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}('.chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#969699}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#969699;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ol,.graph-svg-tip ul{padding-left:0;display:-webkit-box;display:-ms-flexbox;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;-webkit-box-flex:1;-ms-flex:1;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:" ";border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}');var K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q=(function(){function e(e){function t(o,r){try{var i=e[o](r),a=i.value;a instanceof function(e){this.value=e}?Promise.resolve(a.value).then(function(e){t("next",e)},function(e){t("throw",e)}):n(i.done?"return":"normal",i.value)}catch(e){n("throw",e)}}function n(e,n){switch(e){case"return":o.resolve({value:n,done:!0});break;case"throw":o.reject(n);break;default:o.resolve({value:n,done:!1})}(o=o.next)?t(o.key,o.arg):r=null}var o,r;this._invoke=function(e,n){return new Promise(function(i,a){var s={key:e,arg:n,resolve:i,reject:a,next:null};r?r=r.next=s:(o=r=s,t(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),W=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),J=function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(o):void 0},Z=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Q=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ee=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),te=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};e.create=function(t,n){var o=document.createElement(t);for(var r in n){var i=n[r];if("inside"===r)e(i).appendChild(o);else if("around"===r){var a=e(i);a.parentNode.insertBefore(o,a),o.appendChild(a)}else"styles"===r?"object"===(void 0===i?"undefined":K(i))&&Object.keys(i).map(function(e){o.style[e]=i[e]}):r in o?o[r]=i:o.setAttribute(r,i)}return o};var ne={margins:{top:5,bottom:5,left:5,right:5},paddings:{top:5,bottom:5,left:20,right:5},baseWidth:420,baseHeight:240,titleHeight:0,legendHeight:24,titleFontSize:12},oe=700,re=["line","bar"],ie=2,ae=7,se=["light-blue","blue","violet","red","orange","yellow","green","light-green","purple","magenta","light-grey","dark-grey"],ce={bar:se,line:se,pie:se,percentage:se,heatmap:["#ebedf0","#c6e48b","#7bc96f","#239a3b","#196127"],donut:se},le=Math.PI/180,pe=function(){function t(e){var n=e.parent,o=void 0===n?null:n,r=e.colors,i=void 0===r?[]:r;q(this,t),this.parent=o,this.colors=i,this.titleName="",this.titleValue="",this.listValues=[],this.titleValueFirst=0,this.x=0,this.y=0,this.top=0,this.left=0,this.setup()}return W(t,[{key:"setup",value:function(){this.makeTooltip()}},{key:"refresh",value:function(){this.fill(),this.calcPosition()}},{key:"makeTooltip",value:function(){var t=this;this.container=e.create("div",{inside:this.parent,className:"graph-svg-tip comparison",innerHTML:'<span class="title"></span>\n\t\t\t\t<ul class="data-point-list"></ul>\n\t\t\t\t<div class="svg-pointer"></div>'}),this.hideTip(),this.title=this.container.querySelector(".title"),this.dataPointList=this.container.querySelector(".data-point-list"),this.parent.addEventListener("mouseleave",function(){t.hideTip()})}},{key:"fill",value:function(){var t,n=this;this.index&&this.container.setAttribute("data-point-index",this.index),t=this.titleValueFirst?"<strong>"+this.titleValue+"</strong>"+this.titleName:this.titleName+"<strong>"+this.titleValue+"</strong>",this.title.innerHTML=t,this.dataPointList.innerHTML="",this.listValues.map(function(t,o){var r=n.colors[o]||"black",i=0===t.formatted||t.formatted?t.formatted:t.value,a=e.create("li",{styles:{"border-top":"3px solid "+r},innerHTML:'<strong style="display: block;">'+(0===i||i?i:"")+"</strong>\n\t\t\t\t\t"+(t.title?t.title:"")});n.dataPointList.appendChild(a)})}},{key:"calcPosition",value:function(){var e=this.container.offsetWidth;this.top=this.y-this.container.offsetHeight-5,this.left=this.x-e/2;var t=this.parent.offsetWidth-e,n=this.container.querySelector(".svg-pointer");if(this.left<0)n.style.left="calc(50% - "+-1*this.left+"px)",this.left=0;else if(this.left>t){var o="calc(50% + "+(this.left-t)+"px)";n.style.left=o,this.left=t}else n.style.left="50%"}},{key:"setValues",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;this.titleName=n.name,this.titleValue=n.value,this.listValues=o,this.x=e,this.y=t,this.titleValueFirst=n.valueFirst||0,this.index=r,this.refresh()}},{key:"hideTip",value:function(){this.container.style.top="0px",this.container.style.left="0px",this.container.style.opacity="0"}},{key:"showTip",value:function(){this.container.style.top=this.top+"px",this.container.style.left=this.left+"px",this.container.style.opacity="1"}}]),t}(),de={"light-blue":"#7cd6fd",blue:"#5e64ff",violet:"#743ee2",red:"#ff5858",orange:"#ffa00a",yellow:"#feef72",green:"#28a745","light-green":"#98d85b",purple:"#b554ff",magenta:"#ffa3ef",black:"#36114C",grey:"#bdd3e6","light-grey":"#f0f4f7","dark-grey":"#b8c2cc"},ue=function(e){return/rgb[a]{0,1}\([\d, ]+\)/gim.test(e)?/\D+(\d*)\D+(\d*)\D+(\d*)/gim.exec(e).map(function(e,t){return 0!==t?Number(e).toString(16):"#"}).reduce(function(e,t){return""+e+t}):de[e]||e},he=6,fe=4,ge=15,me=10,ve="#454647",ye="#969696",be={bar:function(e){var t=void 0;"rect"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var n=e.cloneNode();return n.style.fill="#000000",n.style.opacity="0.4",t&&n.setAttribute("transform",t),n},dot:function(e){var t=void 0;"circle"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var n=e.cloneNode(),o=e.getAttribute("r"),r=e.getAttribute("fill");return n.setAttribute("r",parseInt(o)+4),n.setAttribute("fill",r),n.style.opacity="0.6",t&&n.setAttribute("transform",t),n},heat_square:function(e){var t=void 0;"circle"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var n=e.cloneNode(),o=e.getAttribute("r"),r=e.getAttribute("fill");return n.setAttribute("r",parseInt(o)+4),n.setAttribute("fill",r),n.style.opacity="0.6",t&&n.setAttribute("transform",t),n}},we={bar:function(e,t){var n=void 0;"rect"!==e.nodeName&&(n=e.getAttribute("transform"),e=e.childNodes[0]);var o=["x","y","width","height"];Object.values(e.attributes).filter(function(e){return o.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),n&&t.setAttribute("transform",n)},dot:function(e,t){var n=void 0;"circle"!==e.nodeName&&(n=e.getAttribute("transform"),e=e.childNodes[0]);var o=["cx","cy"];Object.values(e.attributes).filter(function(e){return o.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),n&&t.setAttribute("transform",n)},heat_square:function(e,t){var n=void 0;"circle"!==e.nodeName&&(n=e.getAttribute("transform"),e=e.childNodes[0]);var o=["cx","cy"];Object.values(e.attributes).filter(function(e){return o.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),n&&t.setAttribute("transform",n)}},xe=350,Ce=350,Se=xe,Ie=250,Ne="easein",_e={ease:"0.25 0.1 0.25 1",linear:"0 0 1 1",easein:"0.1 0.8 0.2 1",easeout:"0 0 0.58 1",easeinout:"0.42 0 0.58 1"},Te=".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}",Ee=function(){function e(t,n){if(q(this,e),n=function e(t){var n=void 0,o=void 0,r=void 0;if(t instanceof Date)return new Date(t.getTime());if("object"!==(void 0===t?"undefined":K(t))||null===t)return t;for(r in n=Array.isArray(t)?[]:{},t)o=t[r],n[r]=e(o);return n}(n),this.parent="string"==typeof t?document.querySelector(t):t,!(this.parent instanceof HTMLElement||this.parent instanceof SVGElement))throw new Error("No `parent` element to render on was provided.");this.rawChartArgs=n,this.title=n.title||"",this.type=n.type||"",this.realData=this.prepareData(n.data),this.data=this.prepareFirstData(this.realData),this.colors=this.validateColors(n.colors,this.type),this.config={showTooltip:1,showLegend:1,isNavigable:n.isNavigable||0,animate:void 0!==n.animate?n.animate:1,truncateLegends:n.truncateLegends||1},this.measures=JSON.parse(JSON.stringify(ne));var o=this.measures;this.setMeasures(n),this.title.length||(o.titleHeight=0),this.config.showLegend||(o.legendHeight=0),this.argHeight=n.height||o.baseHeight,this.argWidth=n.width||o.baseWidth,this.state={},this.options={},this.initTimeout=oe,this.config.isNavigable&&(this.overlays=[]),this.configure(n)}return W(e,[{key:"prepareData",value:function(e){return e}},{key:"prepareFirstData",value:function(e){return e}},{key:"validateColors",value:function(e,t){var n=[];return(e=(e||[]).concat(ce[t])).forEach(function(e){var t=ue(e);!function(e){return/(^\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i.test(e)||/(^\s*)(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/i.test(e)}(t)?console.warn('"'+e+'" is not a valid color.'):n.push(t)}),n}},{key:"setMeasures",value:function(){}},{key:"configure",value:function(){var e=this,t=this.argHeight;this.baseHeight=t,this.baseWidth=this.argWidth,this.height=t-r(this.measures),this.boundDrawFn=function(){return e.draw(!0)},ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.boundDrawFn),this.resizeObserver.observe(this.parent)),window.addEventListener("resize",this.boundDrawFn),window.addEventListener("orientationchange",this.boundDrawFn)}},{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),window.removeEventListener("resize",this.boundDrawFn),window.removeEventListener("orientationchange",this.boundDrawFn)}},{key:"setup",value:function(){this.makeContainer(),this.updateWidth(),this.makeTooltip(),this.draw(!1,!0)}},{key:"makeContainer",value:function(){this.parent.innerHTML="";var e={inside:this.parent,className:"chart-container"};this.independentWidth&&(e.styles={width:this.independentWidth+"px"}),this.container=w(e.className,"",e.inside)}},{key:"makeTooltip",value:function(){this.tip=new pe({parent:this.container,colors:this.colors}),this.bindTooltip()}},{key:"bindTooltip",value:function(){}},{key:"draw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&function(e){return null===e.offsetParent}(this.parent)||(this.updateWidth(),this.calc(t),this.makeChartArea(),this.setupComponents(),this.components.forEach(function(t){return t.setup(e.drawArea)}),this.render(this.components,!1),n&&(this.data=this.realData,setTimeout(function(){e.update(e.data)},this.initTimeout)),this.renderLegend(),this.setupNavigation(n))}},{key:"calc",value:function(){}},{key:"updateWidth",value:function(){this.width=this.baseWidth-i(this.measures)}},{key:"makeChartArea",value:function(){if(this.svg){var e=this.container;this.container.childNodes.forEach(function(t){t.classList.value.indexOf("frappe-chart")>-1&&e.removeChild(t)}),delete this.svg}var t=this.measures;this.svg=w("frappe-chart chart","",this.container),this.svgDefs=function(e){return y("defs",{inside:e})}(this.svg),this.title.length&&(this.titleEL=I("title",t.margins.left,t.margins.top,this.title,{fontSize:t.titleFontSize,fill:"#666666",dy:t.titleFontSize}));var r=n(t);this.drawArea=w(this.type+"-chart chart-draw-area","translate("+o(t)+", "+(t.legendHeight+r)+")"),this.config.showLegend&&(this.legendArea=w("chart-legend","translate("+o(t)+", "+r+")")),this.title.length&&this.svg.appendChild(this.titleEL),this.svg.appendChild(this.drawArea),this.config.showLegend&&this.svg.appendChild(this.legendArea),this.updateTipOffset(o(t),n(t))}},{key:"updateTipOffset",value:function(e,t){this.tip.offset={x:e,y:t}}},{key:"setupComponents",value:function(){this.components=new Map}},{key:"update",value:function(e){e||console.error("No data to update."),this.data=this.prepareData(e),this.calc(),this.render(this.components,this.config.animate),this.renderLegend()}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.components,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.config.isNavigable&&this.overlays.map(function(e){return e.parentNode.removeChild(e)});var o=[];t.forEach(function(e){o=o.concat(e.update(n))}),o.length>0?(function(e,t,n){if(0!==n.length){var o=O(t,n);t.parentNode==e&&(e.removeChild(t),e.appendChild(o)),setTimeout(function(){o.parentNode==e&&(e.removeChild(o),e.appendChild(t))},Ie)}}(this.container,this.svg,o),setTimeout(function(){t.forEach(function(e){return e.make()}),e.updateNav()},400)):(t.forEach(function(e){return e.make()}),this.updateNav())}},{key:"updateNav",value:function(){this.config.isNavigable&&(this.makeOverlay(),this.bindUnits())}},{key:"renderLegend",value:function(){}},{key:"setupNavigation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.config.isNavigable&&t&&(this.bindOverlay(),this.keyActions={13:this.onEnterKey.bind(this),37:this.onLeftArrow.bind(this),38:this.onUpArrow.bind(this),39:this.onRightArrow.bind(this),40:this.onDownArrow.bind(this)},document.addEventListener("keydown",function(t){(function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)})(e.container)&&(t=t||window.event,e.keyActions[t.keyCode]&&e.keyActions[t.keyCode]())}))}},{key:"makeOverlay",value:function(){}},{key:"updateOverlay",value:function(){}},{key:"bindOverlay",value:function(){}},{key:"bindUnits",value:function(){}},{key:"onLeftArrow",value:function(){}},{key:"onRightArrow",value:function(){}},{key:"onUpArrow",value:function(){}},{key:"onDownArrow",value:function(){}},{key:"onEnterKey",value:function(){}},{key:"addDataPoint",value:function(){}},{key:"removeDataPoint",value:function(){}},{key:"getDataPoint",value:function(){}},{key:"setCurrentDataPoint",value:function(){}},{key:"updateDataset",value:function(){}},{key:"export",value:function(){var e=A(this.svg);!function(e,t){var n=document.createElement("a");n.style="display: none";var o=new Blob(t,{type:"image/svg+xml; charset=utf-8"}),r=window.URL.createObjectURL(o);n.href=r,n.download=e,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)},300)}(this.title||"Chart",[e])}}]),e}(),ke=function(e){function t(e,n){return q(this,t),Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return Z(t,Ee),W(t,[{key:"configure",value:function(e){J(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configure",this).call(this,e),this.config.formatTooltipY=(e.tooltipOptions||{}).formatTooltipY,this.config.maxSlices=e.maxSlices||20,this.config.maxLegendPoints=e.maxLegendPoints||20}},{key:"calc",value:function(){var e=this,t=this.state,n=this.config.maxSlices;t.sliceTotals=[];var o=this.data.labels.map(function(t,n){var o=0;return e.data.datasets.map(function(e){o+=e.values[n]}),[o,t]}).filter(function(e){return e[0]>=0}),r=o;if(o.length>n){o.sort(function(e,t){return t[0]-e[0]}),r=o.slice(0,n-1);var i=0;o.slice(n-1).map(function(e){i+=e[0]}),r.push([i,"Rest"]),this.colors[n-1]="grey"}t.labels=[],r.map(function(e){t.sliceTotals.push(function(e){return Number(Math.round(e+"e4")+"e-4")}(e[0])),t.labels.push(e[1])}),t.grandTotal=t.sliceTotals.reduce(function(e,t){return e+t},0),this.center={x:this.width/2,y:this.height/2}}},{key:"renderLegend",value:function(){var e=this,t=this.state;this.legendArea.textContent="",this.legendTotals=t.sliceTotals.slice(0,this.config.maxLegendPoints);var n=0,o=0;this.legendTotals.map(function(r,a){var s=150,c=Math.floor((e.width-i(e.measures))/s);e.legendTotals.length<c&&(s=e.width/e.legendTotals.length),n>c&&(n=0,o+=20);var l=s*n+5,p=e.config.truncateLegends?h(t.labels[a],s/10):t.labels[a],d=e.config.formatTooltipY?e.config.formatTooltipY(r):r,u=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments[4];r=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?h(r,ge):r;var i={className:"legend-dot",cx:0,cy:0,r:n,fill:o},a=y("text",{className:"legend-dataset-text",x:0,y:0,dx:me+"px",dy:me/3+"px","font-size":1.2*me+"px","text-anchor":"start",fill:ye,innerHTML:r}),s=y("g",{transform:"translate("+e+", "+t+")"});return s.appendChild(y("circle",i)),s.appendChild(a),s}(l,o,5,e.colors[a],p+": "+d,!1);e.legendArea.appendChild(u),n++})}}]),t}(),$e=7,Pe=1e3,Oe=86400,Ae=["January","February","March","April","May","June","July","August","September","October","November","December"],Me=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],De=function(){function e(t){var n=t.layerClass,o=void 0===n?"":n,r=t.layerTransform,i=void 0===r?"":r,a=t.constants,s=t.getData,c=t.makeElements,l=t.animateElements;q(this,e),this.layerTransform=i,this.constants=a,this.makeElements=c,this.getData=s,this.animateElements=l,this.store=[],this.labels=[],this.layerClass=o,this.layerClass="function"==typeof this.layerClass?this.layerClass():this.layerClass,this.refresh()}return W(e,[{key:"refresh",value:function(e){this.data=e||this.getData()}},{key:"setup",value:function(e){this.layer=w(this.layerClass,this.layerTransform,e)}},{key:"make",value:function(){this.render(this.data),this.oldData=this.data}},{key:"render",value:function(e){var t=this;this.store=this.makeElements(e),this.layer.textContent="",this.store.forEach(function(e){t.layer.appendChild(e)}),this.labels.forEach(function(e){t.layer.appendChild(e)})}},{key:"update",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.refresh();var t=[];return e&&(t=this.animateElements(this.data)||[]),t}}]),e}(),Le={donutSlices:{layerClass:"donut-slices",makeElements:function(e){return e.sliceStrings.map(function(t,n){var o=x(t,"donut-path",e.colors[n],"none",e.strokeWidth);return o.style.transition="transform .3s;",o})},animateElements:function(e){return this.store.map(function(t,n){return $(t,e.sliceStrings[n])})}},pieSlices:{layerClass:"pie-slices",makeElements:function(e){return e.sliceStrings.map(function(t,n){var o=x(t,"pie-path","none",e.colors[n]);return o.style.transition="transform .3s;",o})},animateElements:function(e){return this.store.map(function(t,n){return $(t,e.sliceStrings[n])})}},percentageBars:{layerClass:"percentage-bars",makeElements:function(e){var t=this;return e.xPositions.map(function(n,o){return function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ie,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none";return y("rect",{className:"percentage-bar",x:e,y:t,width:n,height:o,fill:i,styles:{stroke:m(i,-25),"stroke-dasharray":"0, "+(o+n)+", "+n+", "+o,"stroke-width":r}})}(n,0,e.widths[o],t.constants.barHeight,t.constants.barDepth,e.colors[o])})},animateElements:function(e){if(e)return[]}},yAxis:{layerClass:"y axis",makeElements:function(e){var t=this;return e.positions.map(function(n,o){return function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};p(e)||(e=0),o.pos||(o.pos="left"),o.offset||(o.offset=0),o.mode||(o.mode="span"),o.stroke||(o.stroke=ve),o.className||(o.className="");var r=-1*he,i="span"===o.mode?n+he:0;return"tick"===o.mode&&"right"===o.pos&&(r=n+he,i=n),N(e,t,r+=o.offset,i+=o.offset,{stroke:o.stroke,className:o.className,lineType:o.lineType,shortenNumbers:o.shortenNumbers})}(n,e.labels[o],t.constants.width,{mode:t.constants.mode,pos:t.constants.pos,shortenNumbers:t.constants.shortenNumbers})})},animateElements:function(e){var t=e.positions,n=e.labels,o=this.oldData.positions,r=this.oldData.labels,i=u(o,t),a=ee(i,2);o=a[0],t=a[1];var s=u(r,n),c=ee(s,2);return r=c[0],n=c[1],this.render({positions:o,labels:n}),this.store.map(function(e,n){return E(e,t[n],o[n])})}},xAxis:{layerClass:"x axis",makeElements:function(e){var t=this;return e.positions.map(function(n,o){return _(n,e.calcLabels[o],t.constants.height,{mode:t.constants.mode,pos:t.constants.pos})})},animateElements:function(e){var t=e.positions,n=e.calcLabels,o=this.oldData.positions,r=this.oldData.calcLabels,i=u(o,t),a=ee(i,2);o=a[0],t=a[1];var s=u(r,n),c=ee(s,2);return r=c[0],n=c[1],this.render({positions:o,calcLabels:n}),this.store.map(function(e,n){return function(e,t,n){return T(e,[n,0],[t,0],Se)}(e,t[n],o[n])})}},yMarkers:{layerClass:"y-markers",makeElements:function(e){var t=this;return e.map(function(e){return function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o.labelPos||(o.labelPos="right");var r=y("text",{className:"chart-label",x:"left"===o.labelPos?fe:n-c(t,5)-fe,y:0,dy:me/-2+"px","font-size":me+"px","text-anchor":"start",innerHTML:t+""}),i=N(e,"",0,n,{stroke:o.stroke||ve,className:o.className||"",lineType:o.lineType});return i.appendChild(r),i}(e.position,e.label,t.constants.width,{labelPos:e.options.labelPos,mode:"span",lineType:"dashed"})})},animateElements:function(e){var t=u(this.oldData,e),n=ee(t,2);this.oldData=n[0];var o=(e=n[1]).map(function(e){return e.position}),r=e.map(function(e){return e.label}),i=e.map(function(e){return e.options}),a=this.oldData.map(function(e){return e.position});return this.render(a.map(function(e,t){return{position:a[t],label:r[t],options:i[t]}})),this.store.map(function(e,t){return E(e,o[t],a[t])})}},yRegions:{layerClass:"y-regions",makeElements:function(e){var t=this;return e.map(function(e){return function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=e-t,a=y("rect",{className:"bar mini",styles:{fill:"rgba(228, 234, 239, 0.49)",stroke:ve,"stroke-dasharray":n+", "+i},x:0,y:0,width:n,height:i});r.labelPos||(r.labelPos="right");var s=y("text",{className:"chart-label",x:"left"===r.labelPos?fe:n-c(o+"",4.5)-fe,y:0,dy:me/-2+"px","font-size":me+"px","text-anchor":"start",innerHTML:o+""}),l=y("g",{transform:"translate(0, "+t+")"});return l.appendChild(a),l.appendChild(s),l}(e.startPos,e.endPos,t.constants.width,e.label,{labelPos:e.options.labelPos})})},animateElements:function(e){var t=u(this.oldData,e),n=ee(t,2);this.oldData=n[0];var o=(e=n[1]).map(function(e){return e.endPos}),r=e.map(function(e){return e.label}),i=e.map(function(e){return e.startPos}),a=e.map(function(e){return e.options}),s=this.oldData.map(function(e){return e.endPos}),c=this.oldData.map(function(e){return e.startPos});this.render(s.map(function(e,t){return{startPos:c[t],endPos:s[t],label:r[t],options:a[t]}}));var l=[];return this.store.map(function(e,t){l=l.concat(function(e,t,n,o){var r=t-n,i=e.childNodes[0];return[[i,{height:r,"stroke-dasharray":i.getAttribute("width")+", "+r},Se,Ne],T(e,[0,o],[0,n],Se)]}(e,i[t],o[t],s[t]))}),l}},heatDomain:{layerClass:function(){return"heat-domain domain-"+this.constants.index},makeElements:function(e){var t=this,n=this.constants,o=n.index,r=n.colWidth,i=n.rowHeight,a=n.squareSize,s=n.radius,c=n.xTranslate,l=0;return this.serializedSubDomains=[],e.cols.map(function(e,n){1===n&&t.labels.push(I("domain-name",c,-12,z(o,!0).toUpperCase(),{fontSize:9})),e.map(function(e,n){if(e.fill){var o={"data-date":e.yyyyMmDd,"data-value":e.dataValue,"data-day":n},r=S("day",c,l,a,s,e.fill,o);t.serializedSubDomains.push(r)}l+=i}),l=0,c+=r}),this.serializedSubDomains},animateElements:function(e){if(e)return[]}},barGraph:{layerClass:function(){return"dataset-units dataset-bars dataset-"+this.constants.index},makeElements:function(e){var t=this.constants;return this.unitType="bar",this.units=e.yPositions.map(function(n,o){return function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=d(t,s.zeroLine),l=ee(c,2),u=l[0],h=l[1];h-=a,0===u&&(u=s.minHeight,h-=s.minHeight),p(e)||(e=0),p(h)||(h=0),p(u,!0)||(u=0),p(n,!0)||(n=0);var f=y("rect",{className:"bar mini",style:"fill: "+o,"data-point-index":i,x:e,y:h,width:n,height:u});if((r+="")||r.length){f.setAttribute("y",0),f.setAttribute("x",0);var g=y("text",{className:"data-point-value",x:n/2,y:0,dy:me/2*-1+"px","font-size":me+"px","text-anchor":"middle",innerHTML:r}),m=y("g",{"data-point-index":i,transform:"translate("+e+", "+h+")"});return m.appendChild(f),m.appendChild(g),m}return f}(e.xPositions[o],n,e.barWidth,t.color,e.labels[o],o,e.offsets[o],{zeroLine:e.zeroLine,barsWidth:e.barsWidth,minHeight:t.minHeight})}),this.units},animateElements:function(e){var t=e.xPositions,n=e.yPositions,o=e.offsets,r=e.labels,i=this.oldData.xPositions,a=this.oldData.yPositions,s=this.oldData.offsets,c=this.oldData.labels,l=u(i,t),p=ee(l,2);i=p[0],t=p[1];var d=u(a,n),h=ee(d,2);a=h[0],n=h[1];var f=u(s,o),g=ee(f,2);s=g[0],o=g[1];var m=u(c,r),v=ee(m,2);c=v[0],r=v[1],this.render({xPositions:i,yPositions:a,offsets:s,labels:r,zeroLine:this.oldData.zeroLine,barsWidth:this.oldData.barsWidth,barWidth:this.oldData.barWidth});var y=[];return this.store.map(function(r,i){y=y.concat(k(r,t[i],n[i],e.barWidth,o[i],{zeroLine:e.zeroLine}))}),y}},lineGraph:{layerClass:function(){return"dataset-units dataset-line dataset-"+this.constants.index},makeElements:function(e){var t=this.constants;return this.unitType="dot",this.paths={},t.hideLine||(this.paths=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=t.map(function(t,n){return e[n]+","+t}).join("L");o.spline&&(i=f(e,t));var a=x("M"+i,"line-graph-path",n);if(o.heatline){var s=C(r.svgDefs,n);a.style.stroke="url(#"+s+")"}var c={path:a};if(o.regionFill){var l=C(r.svgDefs,n,!0),p="M"+e[0]+","+r.zeroLine+"L"+i+"L"+e.slice(-1)[0]+","+r.zeroLine;c.region=x(p,"region-fill","none","url(#"+l+")")}return c}(e.xPositions,e.yPositions,t.color,{heatline:t.heatline,regionFill:t.regionFill,spline:t.spline},{svgDefs:t.svgDefs,zeroLine:e.zeroLine})),this.units=[],t.hideDots||(this.units=e.yPositions.map(function(n,o){return function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=y("circle",{style:"fill: "+o,"data-point-index":i,cx:e,cy:t,r:n});if((r+="")||r.length){a.setAttribute("cy",0),a.setAttribute("cx",0);var s=y("text",{className:"data-point-value",x:0,y:0,dy:me/2*-1-n+"px","font-size":me+"px","text-anchor":"middle",innerHTML:r}),c=y("g",{"data-point-index":i,transform:"translate("+e+", "+t+")"});return c.appendChild(a),c.appendChild(s),c}return a}(e.xPositions[o],n,e.radius,t.color,t.valuesOverPoints?e.values[o]:"",o)})),Object.values(this.paths).concat(this.units)},animateElements:function(e){var t=e.xPositions,n=e.yPositions,o=e.values,r=this.oldData.xPositions,i=this.oldData.yPositions,a=this.oldData.values,s=u(r,t),c=ee(s,2);r=c[0],t=c[1];var l=u(i,n),p=ee(l,2);i=p[0],n=p[1];var d=u(a,o),h=ee(d,2);a=h[0],o=h[1],this.render({xPositions:r,yPositions:i,values:o,zeroLine:this.oldData.zeroLine,radius:this.oldData.radius});var g=[];return Object.keys(this.paths).length&&(g=g.concat(function(e,t,n,o,r){var i=[],a=n.map(function(e,n){return t[n]+","+e}).join("L");r&&(a=f(t,n));var s=[e.path,{d:"M"+a},Ce,Ne];if(i.push(s),e.region){var c=t[0]+","+o+"L",l="L"+t.slice(-1)[0]+", "+o,p=[e.region,{d:"M"+c+a+l},Ce,Ne];i.push(p)}return i}(this.paths,t,n,e.zeroLine,this.constants.spline))),this.units.length&&this.units.map(function(e,o){g=g.concat(function(e,t,n){return"circle"!==e.nodeName?[T(e,e.getAttribute("transform").split("(")[1].slice(0,-1),[t,n],Se)]:[[e,{cx:t,cy:n},xe,Ne]]}(e,t[o],n[o]))}),g}}},Re=function(e){function n(e,t){q(this,n);var o=Q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));return o.type="percentage",o.setup(),o}return Z(n,ke),W(n,[{key:"setMeasures",value:function(e){var t=this.measures;this.barOptions=e.barOptions||{};var n=this.barOptions;n.height=n.height||20,n.depth=n.depth||ie,t.paddings.right=30,t.legendHeight=60,t.baseHeight=8*(n.height+.5*n.depth)}},{key:"setupComponents",value:function(){var e=this.state,t=[["percentageBars",{barHeight:this.barOptions.height,barDepth:this.barOptions.depth},function(){return{xPositions:e.xPositions,widths:e.widths,colors:this.colors}}.bind(this)]];this.components=new Map(t.map(function(e){var t=B.apply(void 0,te(e));return[e[0],t]}))}},{key:"calc",value:function(){var e=this;J(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var t=this.state;t.xPositions=[],t.widths=[];var o=0;t.sliceTotals.map(function(n){var r=e.width*n/t.grandTotal;t.widths.push(r),t.xPositions.push(o),o+=r})}},{key:"makeDataByIndex",value:function(){}},{key:"bindTooltip",value:function(){var e=this,n=this.state;this.container.addEventListener("mousemove",function(o){var r=e.components.get("percentageBars").store,i=o.target;if(r.includes(i)){var a=r.indexOf(i),s=t(e.container),c=t(i),l=c.left-s.left+parseInt(i.getAttribute("width"))/2,p=c.top-s.top,d=(e.formattedLabels&&e.formattedLabels.length>0?e.formattedLabels[a]:e.state.labels[a])+": ",u=n.sliceTotals[a]/n.grandTotal;e.tip.setValues(l,p,{name:d,value:(100*u).toFixed(1)+"%"}),e.tip.showTip()}})}}]),n}(),Ue=function(e){function n(e,t){q(this,n);var o=Q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));return o.type="pie",o.initTimeout=0,o.init=1,o.setup(),o}return Z(n,ke),W(n,[{key:"configure",value:function(e){J(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"configure",this).call(this,e),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=e.hoverRadio||.1,this.config.startAngle=e.startAngle||0,this.clockWise=e.clockWise||!1}},{key:"calc",value:function(){var e=this;J(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var t=this.state;this.radius=this.height>this.width?this.center.x:this.center.y;var o=this.radius,r=this.clockWise,i=t.slicesProperties||[];t.sliceStrings=[],t.slicesProperties=[];var a=180-this.config.startAngle;t.sliceTotals.map(function(n,s){var c=a,p=n/t.grandTotal*360,d=p>180?1:0,u=r?-p:p,h=a+=u,f=l(c,o),g=l(h,o),m=e.init&&i[s],v=void 0,y=void 0;e.init?(v=m?m.startPosition:f,y=m?m.endPosition:f):(v=f,y=g);var b=360===p?function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=n.x+e.x,s=n.y+e.y,c=n.x+t.x,l=2*n.y,p=n.y+t.y;return"M"+n.x+" "+n.y+"\n\t\tL"+a+" "+s+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+c+" "+l+" z\n\t\tL"+a+" "+l+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+c+" "+p+" z"}(v,y,e.center,e.radius,r,d):function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=n.x+e.x,s=n.y+e.y,c=n.x+t.x,l=n.y+t.y;return"M"+n.x+" "+n.y+"\n\t\tL"+a+" "+s+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+c+" "+l+" z"}(v,y,e.center,e.radius,r,d);t.sliceStrings.push(b),t.slicesProperties.push({startPosition:f,endPosition:g,value:n,total:t.grandTotal,startAngle:c,endAngle:h,angle:u})}),this.init=0}},{key:"setupComponents",value:function(){var e=this.state,t=[["pieSlices",{},function(){return{sliceStrings:e.sliceStrings,colors:this.colors}}.bind(this)]];this.components=new Map(t.map(function(e){var t=B.apply(void 0,te(e));return[e[0],t]}))}},{key:"calTranslateByAngle",value:function(e){var t=this.radius,n=this.hoverRadio,o=l(e.startAngle+e.angle/2,t);return"translate3d("+o.x*n+"px,"+o.y*n+"px,0)"}},{key:"hoverSlice",value:function(e,n,o,r){if(e){var i=this.colors[n];if(o){P(e,this.calTranslateByAngle(this.state.slicesProperties[n])),e.style.fill=m(i,50);var a=t(this.svg),s=r.pageX-a.left+10,c=r.pageY-a.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[n]:this.state.labels[n])+": ",p=(100*this.state.sliceTotals[n]/this.state.grandTotal).toFixed(1);this.tip.setValues(s,c,{name:l,value:p+"%"}),this.tip.showTip()}else P(e,"translate3d(0,0,0)"),this.tip.hideTip(),e.style.fill=i}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(e){var t=e.target,n=this.components.get("pieSlices").store,o=this.curActiveSliceIndex,r=this.curActiveSlice;if(n.includes(t)){var i=n.indexOf(t);this.hoverSlice(r,o,!1),this.curActiveSlice=t,this.curActiveSliceIndex=i,this.hoverSlice(t,i,!0,e)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),n}(),ze=function(e){function t(e,n){q(this,t);var o=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));o.type="heatmap",o.countLabel=n.countLabel||"";var r=["Sunday","Monday"],i=r.includes(n.startSubDomain)?n.startSubDomain:"Sunday";return o.startSubDomainIndex=r.indexOf(i),o.setup(),o}return Z(t,Ee),W(t,[{key:"setMeasures",value:function(e){var t=this.measures;this.discreteDomains=0===e.discreteDomains?0:1,t.paddings.top=36,t.paddings.bottom=0,t.legendHeight=24,t.baseHeight=12*$e+r(t);var n=this.data,o=this.discreteDomains?12:0;this.independentWidth=12*(R(n.start,n.end)+o)+i(t)}},{key:"updateWidth",value:function(){var e=this.discreteDomains?12:0,t=this.state.noOfWeeks?this.state.noOfWeeks:52;this.baseWidth=12*(t+e)+i(this.measures)}},{key:"prepareData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data;if(e.start&&e.end&&e.start>e.end)throw new Error("Start date cannot be greater than end date.");if(e.start||(e.start=new Date,e.start.setFullYear(e.start.getFullYear()-1)),e.end||(e.end=new Date),e.dataPoints=e.dataPoints||{},parseInt(Object.keys(e.dataPoints)[0])>1e5){var t={};Object.keys(e.dataPoints).forEach(function(n){var o=new Date(n*Pe);t[D(o)]=e.dataPoints[n]}),e.dataPoints=t}return e}},{key:"calc",value:function(){var e=this.state;e.start=L(this.data.start),e.end=L(this.data.end),e.firstWeekStart=L(e.start),e.noOfWeeks=R(e.start,e.end),e.distribution=function(e,t){for(var n=Math.max.apply(Math,te(e)),o=1/(t-1),r=[],i=0;i<t;i++){var a=n*(o*i);r.push(a)}return r}(Object.values(this.data.dataPoints),5),e.domainConfigs=this.getDomains()}},{key:"setupComponents",value:function(){var e=this,t=this.state,n=this.discreteDomains?0:1,o=t.domainConfigs.map(function(o,r){return["heatDomain",{index:o.index,colWidth:12,rowHeight:12,squareSize:10,radius:e.rawChartArgs.radius||0,xTranslate:12*t.domainConfigs.filter(function(e,t){return t<r}).map(function(e){return e.cols.length-n}).reduce(function(e,t){return e+t},0)},function(){return t.domainConfigs[r]}.bind(e)]});this.components=new Map(o.map(function(e,t){var n=B.apply(void 0,te(e));return[e[0]+"-"+t,n]}));var r=0;Me.forEach(function(t,n){if([1,3,5].includes(n)){var o=I("subdomain-name",-6,r,t,{fontSize:10,dy:8,textAnchor:"end"});e.drawArea.appendChild(o)}r+=12})}},{key:"update",value:function(e){e||console.error("No data to update."),this.data=this.prepareData(e),this.draw(),this.bindTooltip()}},{key:"bindTooltip",value:function(){var e=this;this.container.addEventListener("mousemove",function(t){e.components.forEach(function(n){var o=n.store,r=t.target;if(o.includes(r)){var i=r.getAttribute("data-value"),a=r.getAttribute("data-date").split("-"),s=z(parseInt(a[1])-1,!0),c=e.container.getBoundingClientRect(),l=r.getBoundingClientRect(),p=parseInt(t.target.getAttribute("width")),d=l.left-c.left+p/2,u=l.top-c.top,h=i+" "+e.countLabel,f=" on "+s+" "+a[0]+", "+a[2];e.tip.setValues(d,u,{name:f,value:h,valueFirst:1},[]),e.tip.showTip()}})})}},{key:"renderLegend",value:function(){var e=this;this.legendArea.textContent="";var t=0,n=this.rawChartArgs.radius||0,o=I("subdomain-name",t,12,"Less",{fontSize:11,dy:9});t=30,this.legendArea.appendChild(o),this.colors.slice(0,5).map(function(o,r){var i=S("heatmap-legend-unit",t+15*r,12,10,n,o);e.legendArea.appendChild(i)});var r=I("subdomain-name",t+75+3,12,"More",{fontSize:11,dy:9});this.legendArea.appendChild(r)}},{key:"getDomains",value:function(){for(var e=this.state,t=[e.start.getMonth(),e.start.getFullYear()],n=t[0],o=t[1],r=[e.end.getMonth(),e.end.getFullYear()],i=r[0]-n+1+12*(r[1]-o),a=[],s=L(e.start),c=0;c<i;c++){var l=e.end;if(!U(s,e.end)){var p=[s.getMonth(),s.getFullYear()];l=j(p[0],p[1])}a.push(this.getDomainConfig(s,l)),F(l,1),s=l}return a}},{key:"getDomainConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[e.getMonth(),e.getFullYear()],o=n[0],r=n[1],i=G(e),a={index:o,cols:[]};F(t=L(t)||j(o,r),1);for(var s=R(i,t),c=[],l=void 0,p=0;p<s;p++)l=this.getCol(i,o),c.push(l),F(i=new Date(l[$e-1].yyyyMmDd),1);return void 0!==l[$e-1].dataValue&&(F(i,1),c.push(this.getCol(i,o,!0))),a.cols=c,a}},{key:"getCol",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.state,r=L(e),i=[],a=0;a<$e;a++,F(r,1)){var s={},c=r>=o.start&&r<=o.end;n||r.getMonth()!==t||!c?s.yyyyMmDd=D(r):s=this.getSubDomainConfig(r),i.push(s)}return i}},{key:"getSubDomainConfig",value:function(e){var t=D(e),n=this.data.dataPoints[t];return{yyyyMmDd:t,dataValue:n||0,fill:this.colors[function(e,t){return t.filter(function(t){return t<e}).length}(n,this.state.distribution)]}}}]),t}(),je=function(e){function r(e,t){q(this,r);var n=Q(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return n.barOptions=t.barOptions||{},n.lineOptions=t.lineOptions||{},n.type=t.type||"line",n.init=1,n.setup(),n}return Z(r,Ee),W(r,[{key:"setMeasures",value:function(){this.data.datasets.length<=1&&(this.config.showLegend=0,this.measures.paddings.bottom=30)}},{key:"configure",value:function(e){J(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"configure",this).call(this,e),e.axisOptions=e.axisOptions||{},e.tooltipOptions=e.tooltipOptions||{},this.config.xAxisMode=e.axisOptions.xAxisMode||"span",this.config.yAxisMode=e.axisOptions.yAxisMode||"span",this.config.xIsSeries=e.axisOptions.xIsSeries||0,this.config.shortenYAxisNumbers=e.axisOptions.shortenYAxisNumbers||0,this.config.formatTooltipX=e.tooltipOptions.formatTooltipX,this.config.formatTooltipY=e.tooltipOptions.formatTooltipY,this.config.valuesOverPoints=e.valuesOverPoints}},{key:"prepareData",value:function(){return function(e,t){e.labels=e.labels||[];var n=e.labels.length,o=e.datasets,r=new Array(n).fill(0);return o||(o=[{values:r}]),o.map(function(e){if(e.values){var o=e.values;o=(o=o.map(function(e){return isNaN(e)?0:e})).length>n?o.slice(0,n):s(o,n-o.length,0),e.values=o}else e.values=r;e.chartType||(re.includes(t),e.chartType=t)}),e.yRegions&&e.yRegions.map(function(e){if(e.end<e.start){var t=[e.end,e.start];e.start=t[0],e.end=t[1]}}),e}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,this.type)}},{key:"prepareFirstData",value:function(){return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,t=e.labels.length,n=new Array(t).fill(0),o={labels:e.labels.slice(0,-1),datasets:e.datasets.map(function(e){return{name:"",values:n.slice(0,-1),chartType:e.chartType}})},e.yMarkers&&(o.yMarkers=[{value:0,label:""}]),e.yRegions&&(o.yRegions=[{start:0,end:0,label:""}]),o;var e,t,n,o}},{key:"calc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.calcXPositions(),e||this.calcYAxisParameters(this.getAllYValues(),"line"===this.type),this.makeDataByIndex()}},{key:"calcXPositions",value:function(){var e=this.state,t=this.data.labels;e.datasetLength=t.length,e.unitWidth=this.width/e.datasetLength,e.xOffset=e.unitWidth/2,e.xAxis={labels:t,positions:t.map(function(t,n){return a(e.xOffset+n*e.unitWidth)})}}},{key:"calcYAxisParameters",value:function(e){var t=function(e){function t(e,t){for(var n=Y(e),o=n[1]-n[0],r=0,i=1;r<t;i++)r+=o,n.unshift(-1*r);return n}var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=Math.max.apply(Math,te(e)),r=Math.min.apply(Math,te(e)),i=[];if(o>=0&&r>=0)H(o)[1],i=n?Y(o,r):Y(o);else if(o>0&&r<0){var a=Math.abs(r);o>=a?(H(o)[1],i=t(o,a)):(H(a)[1],i=t(a,o).reverse().map(function(e){return-1*e}))}else if(o<=0&&r<=0){var s=Math.abs(r),c=Math.abs(o);H(s)[1],i=(i=n?Y(s,c):Y(s)).reverse().map(function(e){return-1*e})}return i}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false"),n=this.height/function(e){return e[e.length-1]-e[0]}(t),o=V(t)*n,r=this.height-function(e){var t=V(e);return e.indexOf(0)>=0?e.indexOf(0):e[0]>0?-1*e[0]/t:-1*e[e.length-1]/t+(e.length-1)}(t)*o;this.state.yAxis={labels:t,positions:t.map(function(e){return r-e*n}),scaleMultiplier:n,zeroLine:r},this.calcDatasetPoints(),this.calcYExtremes(),this.calcYRegions()}},{key:"calcDatasetPoints",value:function(){var e=this.state,t=function(t){return t.map(function(t){return X(t,e.yAxis)})};e.datasets=this.data.datasets.map(function(e,n){var o=e.values,r=e.cumulativeYs||[];return{name:e.name&&e.name.replace(/<|>|&/g,function(e){return"&"==e?"&amp;":"<"==e?"&lt;":"&gt;"}),index:n,chartType:e.chartType,values:o,yPositions:t(o),cumulativeYs:r,cumulativeYPos:t(r)}})}},{key:"calcYExtremes",value:function(){var e=this.state;this.barOptions.stacked?e.yExtremes=e.datasets[e.datasets.length-1].cumulativeYPos:(e.yExtremes=new Array(e.datasetLength).fill(9999),e.datasets.map(function(t){t.yPositions.map(function(t,n){t<e.yExtremes[n]&&(e.yExtremes[n]=t)})}))}},{key:"calcYRegions",value:function(){var e=this.state;this.data.yMarkers&&(this.state.yMarkers=this.data.yMarkers.map(function(t){return t.position=X(t.value,e.yAxis),t.options||(t.options={}),t})),this.data.yRegions&&(this.state.yRegions=this.data.yRegions.map(function(t){return t.startPos=X(t.start,e.yAxis),t.endPos=X(t.end,e.yAxis),t.options||(t.options={}),t}))}},{key:"getAllYValues",value:function(){var e,t=this,n="values";if(this.barOptions.stacked){n="cumulativeYs";var o=new Array(this.state.datasetLength).fill(0);this.data.datasets.map(function(e,r){var i=t.data.datasets[r].values;e[n]=o=o.map(function(e,t){return e+i[t]})})}var r=this.data.datasets.map(function(e){return e[n]});return this.data.yMarkers&&r.push(this.data.yMarkers.map(function(e){return e.value})),this.data.yRegions&&this.data.yRegions.map(function(e){r.push([e.end,e.start])}),(e=[]).concat.apply(e,te(r))}},{key:"setupComponents",value:function(){var e=this,t=[["yAxis",{mode:this.config.yAxisMode,width:this.width,shortenNumbers:this.config.shortenYAxisNumbers},function(){return this.state.yAxis}.bind(this)],["xAxis",{mode:this.config.xAxisMode,height:this.height},function(){var e=this.state;return e.xAxis.calcLabels=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=e/t.length;o<=0&&(o=1);var r=o/ae,i=void 0;if(n){var a=Math.max.apply(Math,te(t.map(function(e){return e.length})));i=Math.ceil(a/r)}return t.map(function(e,t){return(e+="").length>r&&(n?t%i!=0&&(e=""):e=r-3>0?e.slice(0,r-3)+" ...":e.slice(0,r)+".."),e})}(this.width,e.xAxis.labels,this.config.xIsSeries),e.xAxis}.bind(this)],["yRegions",{width:this.width,pos:"right"},function(){return this.state.yRegions}.bind(this)]],n=this.state.datasets.filter(function(e){return"bar"===e.chartType}),o=this.state.datasets.filter(function(e){return"line"===e.chartType}),r=n.map(function(t){var o=t.index;return["barGraph-"+t.index,{index:o,color:e.colors[o],stacked:e.barOptions.stacked,valuesOverPoints:e.config.valuesOverPoints,minHeight:0*e.height},function(){var e=this.state,t=e.datasets[o],r=this.barOptions.stacked,i=this.barOptions.spaceRatio||.5,a=e.unitWidth*(1-i),s=a/(r?1:n.length),c=e.xAxis.positions.map(function(e){return e-a/2});r||(c=c.map(function(e){return e+s*o}));var l=new Array(e.datasetLength).fill("");this.config.valuesOverPoints&&(l=r&&t.index===e.datasets.length-1?t.cumulativeYs:t.values);var p=new Array(e.datasetLength).fill(0);return r&&(p=t.yPositions.map(function(e,n){return e-t.cumulativeYPos[n]})),{xPositions:c,yPositions:t.yPositions,offsets:p,labels:l,zeroLine:e.yAxis.zeroLine,barsWidth:a,barWidth:s}}.bind(e)]}),i=o.map(function(t){var n=t.index;return["lineGraph-"+t.index,{index:n,color:e.colors[n],svgDefs:e.svgDefs,heatline:e.lineOptions.heatline,regionFill:e.lineOptions.regionFill,spline:e.lineOptions.spline,hideDots:e.lineOptions.hideDots,hideLine:e.lineOptions.hideLine,valuesOverPoints:e.config.valuesOverPoints},function(){var e=this.state,t=e.datasets[n],o=e.yAxis.positions[0]<e.yAxis.zeroLine?e.yAxis.positions[0]:e.yAxis.zeroLine;return{xPositions:e.xAxis.positions,yPositions:t.yPositions,values:t.values,zeroLine:o,radius:this.lineOptions.dotSize||4}}.bind(e)]}),a=[["yMarkers",{width:this.width,pos:"right"},function(){return this.state.yMarkers}.bind(this)]];t=t.concat(r,i,a);var s=["yMarkers","yRegions"];this.dataUnitComponents=[],this.components=new Map(t.filter(function(t){return!s.includes(t[0])||e.state[t[0]]}).map(function(t){var n=B.apply(void 0,te(t));return(t[0].includes("lineGraph")||t[0].includes("barGraph"))&&e.dataUnitComponents.push(n),[t[0],n]}))}},{key:"makeDataByIndex",value:function(){var e=this;this.dataByIndex={};var t=this.state,n=this.config.formatTooltipX,o=this.config.formatTooltipY;t.xAxis.labels.map(function(r,i){var a=e.state.datasets.map(function(t,n){var r=t.values[i];return{title:t.name,value:r,yPos:t.yPositions[i],color:e.colors[n],formatted:o?o(r):r}});e.dataByIndex[i]={label:r,formattedLabel:n?n(r):r,xPos:t.xAxis.positions[i],values:a,yExtreme:t.yExtremes[i]}})}},{key:"bindTooltip",value:function(){var e=this;this.container.addEventListener("mousemove",function(r){var i=e.measures,a=t(e.container),s=r.pageX-a.left-o(i),c=r.pageY-a.top;c<e.height+n(i)&&c>n(i)?e.mapTooltipXPosition(s):e.tip.hideTip()})}},{key:"mapTooltipXPosition",value:function(e){var t=this.state;if(t.yExtremes){var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t},[]);return n?t.indexOf(o):o}(e,t.xAxis.positions,!0);if(n>=0){var o=this.dataByIndex[n];this.tip.setValues(o.xPos+this.tip.offset.x,o.yExtreme+this.tip.offset.y,{name:o.formattedLabel,value:""},o.values,n),this.tip.showTip()}}}},{key:"renderLegend",value:function(){var e=this,t=this.data;t.datasets.length>1&&(this.legendArea.textContent="",t.datasets.map(function(t,n){var o=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments[4];r=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?h(r,ge):r;var i={className:"legend-bar",x:0,y:0,width:n,height:n,rx:1,fill:o},a=y("text",{className:"legend-dataset-text",x:n+6,y:0,dy:n/2+"px","font-size":1.2*me+"px","text-anchor":"start","dominant-baseline":"middle",fill:ye,innerHTML:r}),s=y("g",{transform:"translate("+e+", "+t+")"});return s.appendChild(y("rect",i)),s.appendChild(a),s}(60*n,"0",8,e.colors[n],t.name,e.config.truncateLegends);e.legendArea.appendChild(o)}))}},{key:"makeOverlay",value:function(){var e=this;this.init?this.init=0:(this.overlayGuides&&this.overlayGuides.forEach(function(e){var t=e.overlay;t.parentNode.removeChild(t)}),this.overlayGuides=this.dataUnitComponents.map(function(e){return{type:e.unitType,overlay:void 0,units:e.units}}),void 0===this.state.currentIndex&&(this.state.currentIndex=this.state.datasetLength-1),this.overlayGuides.map(function(t){var n=t.units[e.state.currentIndex];t.overlay=be[t.type](n),e.drawArea.appendChild(t.overlay)}))}},{key:"updateOverlayGuides",value:function(){this.overlayGuides&&this.overlayGuides.forEach(function(e){var t=e.overlay;t.parentNode.removeChild(t)})}},{key:"bindOverlay",value:function(){var e=this;this.parent.addEventListener("data-select",function(){e.updateOverlay()})}},{key:"bindUnits",value:function(){var e=this;this.dataUnitComponents.map(function(t){t.units.map(function(t){t.addEventListener("click",function(){var n=t.getAttribute("data-point-index");e.setCurrentDataPoint(n)})})}),this.tip.container.addEventListener("click",function(){var t=e.tip.container.getAttribute("data-point-index");e.setCurrentDataPoint(t)})}},{key:"updateOverlay",value:function(){var e=this;this.overlayGuides.map(function(t){var n=t.units[e.state.currentIndex];we[t.type](n,t.overlay)})}},{key:"onLeftArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex-1)}},{key:"onRightArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex+1)}},{key:"getDataPoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.currentIndex,t=this.state;return{index:e,label:t.xAxis.labels[e],values:t.datasets.map(function(t){return t.values[e]})}}},{key:"setCurrentDataPoint",value:function(e){var t=this.state;(e=parseInt(e))<0&&(e=0),e>=t.xAxis.labels.length&&(e=t.xAxis.labels.length-1),e!==t.currentIndex&&(t.currentIndex=e,function(e,t,n){var o=document.createEvent("HTMLEvents");for(var r in o.initEvent(t,!0,!0),n)o[r]=n[r];e.dispatchEvent(o)}(this.parent,"data-select",this.getDataPoint()))}},{key:"addDataPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.datasetLength;J(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"addDataPoint",this).call(this,e,t,n),this.data.labels.splice(n,0,e),this.data.datasets.map(function(e,o){e.values.splice(n,0,t[o])}),this.update(this.data)}},{key:"removeDataPoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.datasetLength-1;this.data.labels.length<=1||(J(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"removeDataPoint",this).call(this,e),this.data.labels.splice(e,1),this.data.datasets.map(function(t){t.values.splice(e,1)}),this.update(this.data))}},{key:"updateDataset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.data.datasets[t].values=e,this.update(this.data)}},{key:"updateDatasets",value:function(e){this.data.datasets.map(function(t,n){e[n]&&(t.values=e[n])}),this.update(this.data)}}]),r}(),Ge=function(e){function n(e,t){q(this,n);var o=Q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));return o.type="donut",o.initTimeout=0,o.init=1,o.setup(),o}return Z(n,ke),W(n,[{key:"configure",value:function(e){J(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"configure",this).call(this,e),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=e.hoverRadio||.1,this.config.startAngle=e.startAngle||0,this.clockWise=e.clockWise||!1,this.strokeWidth=e.strokeWidth||30}},{key:"calc",value:function(){var e=this;J(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var t=this.state;this.radius=this.height>this.width?this.center.x-this.strokeWidth/2:this.center.y-this.strokeWidth/2;var o=this.radius,r=this.clockWise,i=t.slicesProperties||[];t.sliceStrings=[],t.slicesProperties=[];var a=180-this.config.startAngle;t.sliceTotals.map(function(n,s){var c=a,p=n/t.grandTotal*360,d=p>180?1:0,u=r?-p:p,h=a+=u,f=l(c,o),g=l(h,o),m=e.init&&i[s],v=void 0,y=void 0;e.init?(v=m?m.startPosition:f,y=m?m.endPosition:f):(v=f,y=g);var b=360===p?function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=n.x+e.x,s=n.y+e.y,c=n.x+t.x,l=2*o+s;return"M"+a+" "+s+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+c+" "+l+"\n\t\tM"+a+" "+l+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+c+" "+(n.y+e.y)}(v,y,e.center,e.radius,e.clockWise,d):function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return"M"+(n.x+e.x)+" "+(n.y+e.y)+"\n\t\tA "+o+" "+o+" 0 "+i+" "+(r?1:0)+"\n\t\t"+(n.x+t.x)+" "+(n.y+t.y)}(v,y,e.center,e.radius,e.clockWise,d);t.sliceStrings.push(b),t.slicesProperties.push({startPosition:f,endPosition:g,value:n,total:t.grandTotal,startAngle:c,endAngle:h,angle:u})}),this.init=0}},{key:"setupComponents",value:function(){var e=this.state,t=[["donutSlices",{},function(){return{sliceStrings:e.sliceStrings,colors:this.colors,strokeWidth:this.strokeWidth}}.bind(this)]];this.components=new Map(t.map(function(e){var t=B.apply(void 0,te(e));return[e[0],t]}))}},{key:"calTranslateByAngle",value:function(e){var t=this.radius,n=this.hoverRadio,o=l(e.startAngle+e.angle/2,t);return"translate3d("+o.x*n+"px,"+o.y*n+"px,0)"}},{key:"hoverSlice",value:function(e,n,o,r){if(e){var i=this.colors[n];if(o){P(e,this.calTranslateByAngle(this.state.slicesProperties[n])),e.style.stroke=m(i,50);var a=t(this.svg),s=r.pageX-a.left+10,c=r.pageY-a.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[n]:this.state.labels[n])+": ",p=(100*this.state.sliceTotals[n]/this.state.grandTotal).toFixed(1);this.tip.setValues(s,c,{name:l,value:p+"%"}),this.tip.showTip()}else P(e,"translate3d(0,0,0)"),this.tip.hideTip(),e.style.stroke=i}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(e){var t=e.target,n=this.components.get("donutSlices").store,o=this.curActiveSliceIndex,r=this.curActiveSlice;if(n.includes(t)){var i=n.indexOf(t);this.hoverSlice(r,o,!1),this.curActiveSlice=t,this.curActiveSliceIndex=i,this.hoverSlice(t,i,!0,e)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),n}(),Fe={bar:je,line:je,percentage:Re,heatmap:ze,pie:Ue,donut:Ge},Be=Object.freeze({Chart:function e(t,n){return q(this,e),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"line",t=arguments[1],n=arguments[2];return"axis-mixed"===e?(n.type="line",new je(t,n)):Fe[e]?new Fe[e](t,n):void console.error("Undefined chart type: "+e)}(n.type,t,n)},PercentageChart:Re,PieChart:Ue,Heatmap:ze,AxisChart:je}),He={NAME:"Frappe Charts",VERSION:"1.5.8"};return Object.assign({},He,Be)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TheGraph=e()}}(function(){return function(){return function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){return r(t[a][1][e]||e)},p,p.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}}()({1:[function(e,t,n){var o={};o.fbpGraph=e("fbp-graph"),o.Ease=e("ease-component"),"undefined"!=typeof window&&void 0===window.Ease&&(window.Ease=o.Ease);var r={TheGraph:o};o.factories=e("./the-graph/factories.js"),o.merge=e("./the-graph/merge.js"),e("./the-graph/the-graph.js").register(r),e("./the-graph/the-graph-app.js").register(r),e("./the-graph/the-graph-graph.js").register(r),e("./the-graph/the-graph-node-options.js").register(r),e("./the-graph/the-graph-node.js").register(r),e("./the-graph/the-graph-node2.js").register(r),e("./the-graph/the-graph-comment.js").register(r),e("./the-graph/the-graph-port.js").register(r),e("./the-graph/the-graph-port2.js").register(r),e("./the-graph/the-graph-edge.js").register(r),e("./the-graph/the-graph-group.js").register(r),e("./the-graph/iconfont-unicode-map.js").register(r),o.mixins=e("./the-graph/mixins.js"),o.arcs=e("./the-graph/arcs.js"),o.thumb=e("./the-graph-thumb/the-graph-thumb.js"),o.nav=e("./the-graph-nav/the-graph-nav.js"),o.autolayout=e("./the-graph/the-graph-autolayout.js"),o.library=e("./the-graph/the-graph-library.js"),o.EdgeAnimator=e("./the-graph/the-graph-edge-animator.js"),t.exports=o},{"./the-graph-nav/the-graph-nav.js":19,"./the-graph-thumb/the-graph-thumb.js":20,"./the-graph/arcs.js":21,"./the-graph/factories.js":23,"./the-graph/iconfont-unicode-map.js":24,"./the-graph/merge.js":25,"./the-graph/mixins.js":26,"./the-graph/the-graph-app.js":27,"./the-graph/the-graph-autolayout.js":28,"./the-graph/the-graph-comment.js":29,"./the-graph/the-graph-edge-animator.js":30,"./the-graph/the-graph-edge.js":31,"./the-graph/the-graph-graph.js":32,"./the-graph/the-graph-group.js":33,"./the-graph/the-graph-library.js":34,"./the-graph/the-graph-node-options.js":35,"./the-graph/the-graph-node.js":36,"./the-graph/the-graph-node2.js":37,"./the-graph/the-graph-port.js":38,"./the-graph/the-graph-port2.js":39,"./the-graph/the-graph.js":40,"ease-component":6,"fbp-graph":8}],2:[function(e,t,n){n.byteLength=function(e){var t=l(e),n=t[0],o=t[1];return 3*(n+o)/4-o},n.toByteArray=function(e){var t,n,o=l(e),a=o[0],s=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),p=0,d=s>0?a-4:a;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[p++]=t>>16&255,c[p++]=t>>8&255,c[p++]=255&t;2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[p++]=255&t);1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[p++]=t>>8&255,c[p++]=255&t);return c},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],a=0,s=n-r;a<s;a+=16383)i.push(p(e,a,a+16383>s?s:a+16383));1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)o[s]=a[s],r[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function p(e,t,n){for(var r,i,a=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(o[(i=r)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],3:[function(e,t,n){},{}],4:[function(e,t,n){(function(t){(function(){var t=e("base64-js"),o=e("ieee754"),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=s,n.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},n.INSPECT_MAX_BYTES=50;var i=2147483647;function a(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return p(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),o=a(n),r=o.write(e,t);r!==n&&(o=o.slice(0,r));return o}(e,t);if(ArrayBuffer.isView(e))return function(e){if(z(e,Uint8Array)){var t=new Uint8Array(e);return u(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer))return u(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return u(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return s.from(o,t,n);var r=function(e){if(s.isBuffer(e)){var t=0|h(e.length),n=a(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(void 0!==e.length)return"number"!=typeof e.length||j(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function p(e){return l(e),a(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),n=a(t),o=0;o<t;o+=1)n[o]=255&e[o];return n}function u(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var o;return o=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(o,s.prototype),o}function h(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function f(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(e).length;default:if(r)return o?-1:L(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function m(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),j(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=s.from(t,o)),s.isBuffer(t))return 0===t.length?-1:v(e,t,n,o,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,o,r){var i,a=1,s=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var p=-1;for(i=n;i<s;i++)if(l(e,i)===l(t,-1===p?0:i-p)){if(-1===p&&(p=i),i-p+1===c)return p*a}else-1!==p&&(i-=i-p),p=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var d=!0,u=0;u<c;u++)if(l(e,i+u)!==l(t,u)){d=!1;break}if(d)return i}return-1}function y(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;o>i/2&&(o=i/2);for(var a=0;a<o;++a){var s=parseInt(t.substr(2*a,2),16);if(j(s))return a;e[n+a]=s}return a}function b(e,t,n,o){return U(L(t,e.length-n),e,n,o)}function w(e,t,n,o){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function x(e,t,n,o){return U(R(t),e,n,o)}function C(e,t,n,o){return U(function(e,t){for(var n,o,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),o=n>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function S(e,n,o){return 0===n&&o===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,o))}function I(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,a,s,c,l=e[r],p=null,d=l>239?4:l>223?3:l>191?2:1;if(r+d<=n)switch(d){case 1:l<128&&(p=l);break;case 2:128==(192&(i=e[r+1]))&&(c=(31&l)<<6|63&i)>127&&(p=c);break;case 3:i=e[r+1],a=e[r+2],128==(192&i)&&128==(192&a)&&(c=(15&l)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(p=c);break;case 4:i=e[r+1],a=e[r+2],s=e[r+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(p=c)}null===p?(p=65533,d=1):p>65535&&(p-=65536,o.push(p>>>10&1023|55296),p=56320|1023&p),o.push(p),r+=d}return function(e){var t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);var n="",o=0;for(;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=N));return n}(o)}n.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},s.allocUnsafe=function(e){return p(e)},s.allocUnsafeSlow=function(e){return p(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=s.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var i=e[n];if(z(i,Uint8Array))r+i.length>o.length?s.from(i).copy(o,r):Uint8Array.prototype.set.call(o,i,r);else{if(!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,r)}r+=i.length}return o},s.byteLength=f,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):function(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return _(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,n,o,r){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(o>>>=0),a=(n>>>=0)-(t>>>=0),c=Math.min(i,a),l=this.slice(o,r),p=e.slice(t,n),d=0;d<c;++d)if(l[d]!==p[d]){i=l[d],a=p[d];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},s.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":case"latin1":case"binary":return w(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function _(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function T(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function E(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=G[e[i]];return r}function k(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length-1;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function $(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,o,r,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function O(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function A(e,t,n,r,i){return t=+t,n>>>=0,i||O(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function M(e,t,n,r,i){return t=+t,n>>>=0,i||O(e,0,n,8),o.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var o=this.subarray(e,t);return Object.setPrototypeOf(o,s.prototype),o},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||$(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||$(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||$(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||$(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||$(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||$(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||$(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||$(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||$(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},s.prototype.readInt8=function(e,t){return e>>>=0,t||$(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||$(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||$(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||$(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||$(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||$(e,4,this.length),o.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||$(e,4,this.length),o.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||$(e,8,this.length),o.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||$(e,8,this.length),o.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,o){(e=+e,t>>>=0,n>>>=0,o)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,o){(e=+e,t>>>=0,n>>>=0,o)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t>>>=0,!o){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},s.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t>>>=0,!o){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return A(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return A(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return M(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return M(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,o){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r=o-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,o):Uint8Array.prototype.set.call(e,this.subarray(n,o),t),r},s.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!s.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(1===e.length){var r=e.charCodeAt(0);("utf8"===o&&r<128||"latin1"===o)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=s.isBuffer(e)?e:s.from(e,o),c=a.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%c]}return this};var D=/[^+/0-9A-Za-z-_]/g;function L(e,t){var n;t=t||1/0;for(var o=e.length,r=null,i=[],a=0;a<o;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function R(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function j(e){return e!=e}var G=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,o=0;o<16;++o)e[n+o]="0123456789abcdef"[t]+"0123456789abcdef"[o];return e}()}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":2,buffer:4,ieee754:16}],5:[function(e,t,n){(function(e){(function(){var n=function(){function t(e,t){return null!=t&&e instanceof t}var n,o,r;try{n=Map}catch(e){n=function(){}}try{o=Set}catch(e){o=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,c,l,p,d){"object"==typeof c&&(l=c.depth,p=c.prototype,d=c.includeNonEnumerable,c=c.circular);var u=[],h=[],f=void 0!==e;return void 0===c&&(c=!0),void 0===l&&(l=1/0),function a(l,g){if(null===l)return null;if(0===g)return l;var m,v;if("object"!=typeof l)return l;if(t(l,n))m=new n;else if(t(l,o))m=new o;else if(t(l,r))m=new r(function(e,t){l.then(function(t){e(a(t,g-1))},function(e){t(a(e,g-1))})});else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,s(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(f&&e.isBuffer(l))return m=e.allocUnsafe?e.allocUnsafe(l.length):new e(l.length),l.copy(m),m;t(l,Error)?m=Object.create(l):void 0===p?(v=Object.getPrototypeOf(l),m=Object.create(v)):(m=Object.create(p),v=p)}if(c){var y=u.indexOf(l);if(-1!=y)return h[y];u.push(l),h.push(m)}for(var b in t(l,n)&&l.forEach(function(e,t){var n=a(t,g-1),o=a(e,g-1);m.set(n,o)}),t(l,o)&&l.forEach(function(e){var t=a(e,g-1);m.add(t)}),l){var w;v&&(w=Object.getOwnPropertyDescriptor(v,b)),w&&null==w.set||(m[b]=a(l[b],g-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(b=0;b<x.length;b++){var C=x[b];(!(I=Object.getOwnPropertyDescriptor(l,C))||I.enumerable||d)&&(m[C]=a(l[C],g-1),I.enumerable||Object.defineProperty(m,C,{enumerable:!1}))}}if(d){var S=Object.getOwnPropertyNames(l);for(b=0;b<S.length;b++){var I,N=S[b];(I=Object.getOwnPropertyDescriptor(l,N))&&I.enumerable||(m[N]=a(l[N],g-1),Object.defineProperty(m,N,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=s,i}();"object"==typeof t&&t.exports&&(t.exports=n)}).call(this)}).call(this,e("buffer").Buffer)},{buffer:4}],6:[function(e,t,n){n.linear=function(e){return e},n.inQuad=function(e){return e*e},n.outQuad=function(e){return e*(2-e)},n.inOutQuad=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},n.inCube=function(e){return e*e*e},n.outCube=function(e){return--e*e*e+1},n.inOutCube=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},n.inQuart=function(e){return e*e*e*e},n.outQuart=function(e){return 1- --e*e*e*e},n.inOutQuart=function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},n.inQuint=function(e){return e*e*e*e*e},n.outQuint=function(e){return--e*e*e*e*e+1},n.inOutQuint=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},n.inSine=function(e){return 1-Math.cos(e*Math.PI/2)},n.outSine=function(e){return Math.sin(e*Math.PI/2)},n.inOutSine=function(e){return.5*(1-Math.cos(Math.PI*e))},n.inExpo=function(e){return 0==e?0:Math.pow(1024,e-1)},n.outExpo=function(e){return 1==e?e:1-Math.pow(2,-10*e)},n.inOutExpo=function(e){return 0==e?0:1==e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},n.inCirc=function(e){return 1-Math.sqrt(1-e*e)},n.outCirc=function(e){return Math.sqrt(1- --e*e)},n.inOutCirc=function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},n.inBack=function(e){var t=1.70158;return e*e*((t+1)*e-t)},n.outBack=function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},n.inOutBack=function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},n.inBounce=function(e){return 1-n.outBounce(1-e)},n.outBounce=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},n.inOutBounce=function(e){return e<.5?.5*n.inBounce(2*e):.5*n.outBounce(2*e-1)+.5},n["in-quad"]=n.inQuad,n["out-quad"]=n.outQuad,n["in-out-quad"]=n.inOutQuad,n["in-cube"]=n.inCube,n["out-cube"]=n.outCube,n["in-out-cube"]=n.inOutCube,n["in-quart"]=n.inQuart,n["out-quart"]=n.outQuart,n["in-out-quart"]=n.inOutQuart,n["in-quint"]=n.inQuint,n["out-quint"]=n.outQuint,n["in-out-quint"]=n.inOutQuint,n["in-sine"]=n.inSine,n["out-sine"]=n.outSine,n["in-out-sine"]=n.inOutSine,n["in-expo"]=n.inExpo,n["out-expo"]=n.outExpo,n["in-out-expo"]=n.inOutExpo,n["in-circ"]=n.inCirc,n["out-circ"]=n.outCirc,n["in-out-circ"]=n.inOutCirc,n["in-back"]=n.inBack,n["out-back"]=n.outBack,n["in-out-back"]=n.inOutBack,n["in-bounce"]=n.inBounce,n["out-bounce"]=n.outBounce,n["in-out-bounce"]=n.inOutBounce},{}],7:[function(e,t,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var t,n,o,s,c,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var p=new Error('Uncaught, unspecified "error" event. ('+t+")");throw p.context=t,p}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(l=n.slice()).length,c=0;c<o;c++)l[c].apply(this,s);return!0},o.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?o.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function o(){this.removeListener(e,o),n||(n=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},o.prototype.removeListener=function(e,t){var n,o,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},o.listenerCount=function(e,t){return e.listenerCount(t)}},{}],8:[function(e,t,n){n.graph=e("./lib/Graph"),n.Graph=n.graph.Graph,n.journal=e("./lib/Journal"),n.Journal=n.journal.Journal},{"./lib/Graph":9,"./lib/Journal":10}],9:[function(e,t,n){(function(){var t,o,r,i,a,s,c={}.hasOwnProperty;t=e("events").EventEmitter,r=e("clone"),a=e("./Platform"),o=function(n){function o(e,t){this.name=null!=e?e:"",null==t&&(t={}),this.properties={},this.nodes=[],this.edges=[],this.initializers=[],this.exports=[],this.inports={},this.outports={},this.groups=[],this.transaction={id:null,depth:0},this.caseSensitive=t.caseSensitive||!1}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(o,t),o.prototype.name="",o.prototype.caseSensitive=!1,o.prototype.properties={},o.prototype.nodes=[],o.prototype.edges=[],o.prototype.initializers=[],o.prototype.exports=[],o.prototype.inports={},o.prototype.outports={},o.prototype.groups=[],o.prototype.getPortName=function(e){return this.caseSensitive?e:e.toLowerCase()},o.prototype.startTransaction=function(e,t){if(this.transaction.id)throw Error("Nested transactions not supported");return this.transaction.id=e,this.transaction.depth=1,this.emit("startTransaction",e,t)},o.prototype.endTransaction=function(e,t){if(!this.transaction.id)throw Error("Attempted to end non-existing transaction");return this.transaction.id=null,this.transaction.depth=0,this.emit("endTransaction",e,t)},o.prototype.checkTransactionStart=function(){return this.transaction.id?"implicit"===this.transaction.id?this.transaction.depth+=1:void 0:this.startTransaction("implicit")},o.prototype.checkTransactionEnd=function(){if("implicit"===this.transaction.id&&(this.transaction.depth-=1),0===this.transaction.depth)return this.endTransaction("implicit")},o.prototype.setProperties=function(e){var t,n,o;for(n in this.checkTransactionStart(),t=r(this.properties),e)o=e[n],this.properties[n]=o;return this.emit("changeProperties",this.properties,t),this.checkTransactionEnd()},o.prototype.addExport=function(e,t,n,o){var r;if(null==o&&(o={x:0,y:0}),a.deprecated("fbp-graph.Graph exports is deprecated: please use specific inport or outport instead"),this.getNode(t))return this.checkTransactionStart(),r={public:this.getPortName(e),process:t,port:this.getPortName(n),metadata:o},this.exports.push(r),this.emit("addExport",r),this.checkTransactionEnd()},o.prototype.removeExport=function(e){var t,n,o,r,i,s;for(a.deprecated("fbp-graph.Graph exports is deprecated: please use specific inport or outport instead"),e=this.getPortName(e),n=null,r=o=0,i=(s=this.exports).length;o<i;r=++o)(t=s[r]).public===e&&(n=t);if(n)return this.checkTransactionStart(),this.exports.splice(this.exports.indexOf(n),1),this.emit("removeExport",n),this.checkTransactionEnd()},o.prototype.addInport=function(e,t,n,o){if(this.getNode(t))return e=this.getPortName(e),this.checkTransactionStart(),this.inports[e]={process:t,port:this.getPortName(n),metadata:o},this.emit("addInport",e,this.inports[e]),this.checkTransactionEnd()},o.prototype.removeInport=function(e){var t;if(e=this.getPortName(e),this.inports[e])return this.checkTransactionStart(),t=this.inports[e],this.setInportMetadata(e,{}),delete this.inports[e],this.emit("removeInport",e,t),this.checkTransactionEnd()},o.prototype.renameInport=function(e,t){if(e=this.getPortName(e),t=this.getPortName(t),this.inports[e])return this.checkTransactionStart(),this.inports[t]=this.inports[e],delete this.inports[e],this.emit("renameInport",e,t),this.checkTransactionEnd()},o.prototype.setInportMetadata=function(e,t){var n,o,i;if(e=this.getPortName(e),this.inports[e]){for(o in this.checkTransactionStart(),n=r(this.inports[e].metadata),this.inports[e].metadata||(this.inports[e].metadata={}),t)null!=(i=t[o])?this.inports[e].metadata[o]=i:delete this.inports[e].metadata[o];return this.emit("changeInport",e,this.inports[e],n),this.checkTransactionEnd()}},o.prototype.addOutport=function(e,t,n,o){if(this.getNode(t))return e=this.getPortName(e),this.checkTransactionStart(),this.outports[e]={process:t,port:this.getPortName(n),metadata:o},this.emit("addOutport",e,this.outports[e]),this.checkTransactionEnd()},o.prototype.removeOutport=function(e){var t;if(e=this.getPortName(e),this.outports[e])return this.checkTransactionStart(),t=this.outports[e],this.setOutportMetadata(e,{}),delete this.outports[e],this.emit("removeOutport",e,t),this.checkTransactionEnd()},o.prototype.renameOutport=function(e,t){if(e=this.getPortName(e),t=this.getPortName(t),this.outports[e])return this.checkTransactionStart(),this.outports[t]=this.outports[e],delete this.outports[e],this.emit("renameOutport",e,t),this.checkTransactionEnd()},o.prototype.setOutportMetadata=function(e,t){var n,o,i;if(e=this.getPortName(e),this.outports[e]){for(o in this.checkTransactionStart(),n=r(this.outports[e].metadata),this.outports[e].metadata||(this.outports[e].metadata={}),t)null!=(i=t[o])?this.outports[e].metadata[o]=i:delete this.outports[e].metadata[o];return this.emit("changeOutport",e,this.outports[e],n),this.checkTransactionEnd()}},o.prototype.addGroup=function(e,t,n){var o;return this.checkTransactionStart(),o={name:e,nodes:t,metadata:n},this.groups.push(o),this.emit("addGroup",o),this.checkTransactionEnd()},o.prototype.renameGroup=function(e,t){var n,o,r,i;for(this.checkTransactionStart(),o=0,r=(i=this.groups).length;o<r;o++)(n=i[o])&&n.name===e&&(n.name=t,this.emit("renameGroup",e,t));return this.checkTransactionEnd()},o.prototype.removeGroup=function(e){var t,n,o,r;for(this.checkTransactionStart(),n=0,o=(r=this.groups).length;n<o;n++)(t=r[n])&&t.name===e&&(this.setGroupMetadata(t.name,{}),this.groups.splice(this.groups.indexOf(t),1),this.emit("removeGroup",t));return this.checkTransactionEnd()},o.prototype.setGroupMetadata=function(e,t){var n,o,i,a,s,c,l;for(this.checkTransactionStart(),i=0,s=(c=this.groups).length;i<s;i++)if((o=c[i])&&o.name===e){for(a in n=r(o.metadata),t)null!=(l=t[a])?o.metadata[a]=l:delete o.metadata[a];this.emit("changeGroup",o,n)}return this.checkTransactionEnd()},o.prototype.addNode=function(e,t,n){var o;return this.checkTransactionStart(),n||(n={}),o={id:e,component:t,metadata:n},this.nodes.push(o),this.emit("addNode",o),this.checkTransactionEnd(),o},o.prototype.removeNode=function(e){var t,n,o,r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N,_,T,E,k,$,P,O;if(x=this.getNode(e)){for(this.checkTransactionStart(),O=[],r=0,p=(_=this.edges).length;r<p;r++)(t=_[r]).from.node!==x.id&&t.to.node!==x.id||O.push(t);for(s=0,d=O.length;s<d;s++)t=O[s],this.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);for(O=[],c=0,u=(T=this.initializers).length;c<u;c++)(a=T[c]).to.node===x.id&&O.push(a);for(l=0,h=O.length;l<h;l++)a=O[l],this.removeInitial(a.to.node,a.to.port);for(O=[],b=0,f=(E=this.exports).length;b<f;b++)n=E[b],this.getPortName(e)===n.process&&O.push(n);for(w=0,g=O.length;w<g;w++)n=O[w],this.removeExport(n.public);for(I in O=[],k=this.inports)k[I].process===e&&O.push(I);for(C=0,m=O.length;C<m;C++)I=O[C],this.removeInport(I);for(I in O=[],$=this.outports)$[I].process===e&&O.push(I);for(S=0,v=O.length;S<v;S++)I=O[S],this.removeOutport(I);for(N=0,y=(P=this.groups).length;N<y;N++)(o=P[N])&&-1!==(i=o.nodes.indexOf(e))&&o.nodes.splice(i,1);return this.setNodeMetadata(e,{}),-1!==this.nodes.indexOf(x)&&this.nodes.splice(this.nodes.indexOf(x),1),this.emit("removeNode",x),this.checkTransactionEnd()}},o.prototype.getNode=function(e){var t,n,o,r;for(t=0,n=(r=this.nodes).length;t<n;t++)if((o=r[t])&&o.id===e)return o;return null},o.prototype.renameNode=function(e,t){var n,o,r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S;if(this.checkTransactionStart(),g=this.getNode(e)){for(g.id=t,i=0,d=(y=this.edges).length;i<d;i++)(n=y[i])&&(n.from.node===e&&(n.from.node=t),n.to.node===e&&(n.to.node=t));for(c=0,u=(b=this.initializers).length;c<u;c++)(a=b[c])&&a.to.node===e&&(a.to.node=t);for(v in w=this.inports)(m=w[v]).process===e&&(m.process=t);for(v in x=this.outports)(m=x[v]).process===e&&(m.process=t);for(l=0,h=(C=this.exports).length;l<h;l++)(o=C[l]).process===e&&(o.process=t);for(p=0,f=(S=this.groups).length;p<f;p++)(r=S[p])&&-1!==(s=r.nodes.indexOf(e))&&(r.nodes[s]=t);return this.emit("renameNode",e,t),this.checkTransactionEnd()}},o.prototype.setNodeMetadata=function(e,t){var n,o,i,a;if(i=this.getNode(e)){for(o in this.checkTransactionStart(),n=r(i.metadata),i.metadata||(i.metadata={}),t)null!=(a=t[o])?i.metadata[o]=a:delete i.metadata[o];return this.emit("changeNode",i,n),this.checkTransactionEnd()}},o.prototype.addEdge=function(e,t,n,o,r){var i,a,s,c;for(null==r&&(r={}),t=this.getPortName(t),o=this.getPortName(o),a=0,s=(c=this.edges).length;a<s;a++)if((i=c[a]).from.node===e&&i.from.port===t&&i.to.node===n&&i.to.port===o)return;if(this.getNode(e)&&this.getNode(n))return this.checkTransactionStart(),i={from:{node:e,port:t},to:{node:n,port:o},metadata:r},this.edges.push(i),this.emit("addEdge",i),this.checkTransactionEnd(),i},o.prototype.addEdgeIndex=function(e,t,n,o,r,i,a){var s;if(null==a&&(a={}),this.getNode(e)&&this.getNode(o))return t=this.getPortName(t),r=this.getPortName(r),null===i&&(i=void 0),null===n&&(n=void 0),a||(a={}),this.checkTransactionStart(),s={from:{node:e,port:t,index:n},to:{node:o,port:r,index:i},metadata:a},this.edges.push(s),this.emit("addEdge",s),this.checkTransactionEnd(),s},o.prototype.removeEdge=function(e,t,n,o){var r,i,a,s,c,l,p,d,u,h,f,g;if(this.checkTransactionStart(),t=this.getPortName(t),o=this.getPortName(o),g=[],f=[],n&&o)for(a=i=0,l=(u=this.edges).length;i<l;a=++i)(r=u[a]).from.node===e&&r.from.port===t&&r.to.node===n&&r.to.port===o?(this.setEdgeMetadata(r.from.node,r.from.port,r.to.node,r.to.port,{}),g.push(r)):f.push(r);else for(a=s=0,p=(h=this.edges).length;s<p;a=++s)(r=h[a]).from.node===e&&r.from.port===t||r.to.node===e&&r.to.port===t?(this.setEdgeMetadata(r.from.node,r.from.port,r.to.node,r.to.port,{}),g.push(r)):f.push(r);for(this.edges=f,c=0,d=g.length;c<d;c++)r=g[c],this.emit("removeEdge",r);return this.checkTransactionEnd()},o.prototype.getEdge=function(e,t,n,o){var r,i,a,s,c;for(t=this.getPortName(t),o=this.getPortName(o),a=i=0,s=(c=this.edges).length;i<s;a=++i)if((r=c[a])&&r.from.node===e&&r.from.port===t&&r.to.node===n&&r.to.port===o)return r;return null},o.prototype.setEdgeMetadata=function(e,t,n,o,i){var a,s,c,l;if(s=this.getEdge(e,t,n,o)){for(c in this.checkTransactionStart(),a=r(s.metadata),s.metadata||(s.metadata={}),i)null!=(l=i[c])?s.metadata[c]=l:delete s.metadata[c];return this.emit("changeEdge",s,a),this.checkTransactionEnd()}},o.prototype.addInitial=function(e,t,n,o){var r;if(this.getNode(t))return n=this.getPortName(n),this.checkTransactionStart(),r={from:{data:e},to:{node:t,port:n},metadata:o},this.initializers.push(r),this.emit("addInitial",r),this.checkTransactionEnd(),r},o.prototype.addInitialIndex=function(e,t,n,o,r){var i;if(this.getNode(t))return null===o&&(o=void 0),n=this.getPortName(n),this.checkTransactionStart(),i={from:{data:e},to:{node:t,port:n,index:o},metadata:r},this.initializers.push(i),this.emit("addInitial",i),this.checkTransactionEnd(),i},o.prototype.addGraphInitial=function(e,t,n){var o;if(o=this.inports[t])return this.addInitial(e,o.process,o.port,n)},o.prototype.addGraphInitialIndex=function(e,t,n,o){var r;if(r=this.inports[t])return this.addInitialIndex(e,r.process,r.port,n,o)},o.prototype.removeInitial=function(e,t){var n,o,r,i,a,s,c,l,p;for(t=this.getPortName(t),this.checkTransactionStart(),p=[],l=[],r=o=0,a=(c=this.initializers).length;o<a;r=++o)(n=c[r]).to.node===e&&n.to.port===t?p.push(n):l.push(n);for(this.initializers=l,i=0,s=p.length;i<s;i++)n=p[i],this.emit("removeInitial",n);return this.checkTransactionEnd()},o.prototype.removeGraphInitial=function(e){var t;if(t=this.inports[e])return this.removeInitial(t.process,t.port)},o.prototype.toDOT=function(){var e,t,n,o,r,i,a,s,c,l,p,d,u,h,f,g;for(e=function(e){return e.replace(/\s*/g,"")},t=function(e){return e.replace(/\./g,"")},n="digraph {\n",r=0,l=(h=this.nodes).length;r<l;r++)n+="    "+e((u=h[r]).id)+" [label="+u.id+" shape=box]\n";for(i=s=0,p=(f=this.initializers).length;s<p;i=++s)n+="    data"+i+" [label=\"'"+("function"==typeof(a=f[i]).from.data?"Function":a.from.data)+"'\" shape=plaintext]\n",n+="    data"+i+" -> "+e(a.to.node)+"[headlabel="+t(a.to.port)+" labelfontcolor=blue labelfontsize=8.0]\n";for(c=0,d=(g=this.edges).length;c<d;c++)n+="    "+e((o=g[c]).from.node)+" -> "+e(o.to.node)+"[taillabel="+t(o.from.port)+" headlabel="+t(o.to.port)+" labelfontcolor=blue labelfontsize=8.0]\n";return n+="}"},o.prototype.toYUML=function(){var e,t,n,o,r,i,a,s,c;for(c=[],t=0,r=(a=this.initializers).length;t<r;t++)n=a[t],c.push("(start)["+n.to.port+"]->("+n.to.node+")");for(o=0,i=(s=this.edges).length;o<i;o++)e=s[o],c.push("("+e.from.node+")["+e.from.port+"]->("+e.to.node+")");return c.join(",")},o.prototype.toJSON=function(){var e,t,n,o,r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N,_,T,E,k;for(b in c={caseSensitive:this.caseSensitive,properties:{},inports:{},outports:{},groups:[],processes:{},connections:[]},this.name&&(c.properties.name=this.name),x=this.properties)k=x[b],c.properties[b]=k;for(w in C=this.inports)y=C[w],c.inports[w]=y;for(w in S=this.outports)y=S[w],c.outports[w]=y;for(i=0,d=(I=this.exports).length;i<d;i++)n=I[i],c.exports||(c.exports=[]),c.exports.push(n);for(s=0,u=(N=this.groups).length;s<u;s++)r={name:(o=N[s]).name,nodes:o.nodes},Object.keys(o.metadata).length&&(r.metadata=o.metadata),c.groups.push(r);for(l=0,h=(_=this.nodes).length;l<h;l++)v=_[l],c.processes[v.id]={component:v.component},v.metadata&&(c.processes[v.id].metadata=v.metadata);for(p=0,f=(T=this.edges).length;p<f;p++)e={src:{process:(t=T[p]).from.node,port:t.from.port,index:t.from.index},tgt:{process:t.to.node,port:t.to.port,index:t.to.index}},Object.keys(t.metadata).length&&(e.metadata=t.metadata),c.connections.push(e);for(m=0,g=(E=this.initializers).length;m<g;m++)a=E[m],c.connections.push({data:a.from.data,tgt:{process:a.to.node,port:a.to.port,index:a.to.index}});return c},o.prototype.save=function(t,n){var o;return a.isBrowser()?n(new Error("Saving graphs not supported on browser")):(o=JSON.stringify(this.toJSON(),null,4),e("fs").writeFile(t+".json",o,"utf-8",function(e,o){if(e)throw e;return n(t)}))},o}(),n.Graph=o,n.createGraph=function(e,t){return new o(e,t)},n.loadJSON=function(e,t,n){var r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N,_,T,E,k,$,P;for(x in null==n&&(n={}),"string"==typeof e&&(e=JSON.parse(e)),e.properties||(e.properties={}),e.processes||(e.processes={}),e.connections||(e.connections=[]),r=e.caseSensitive||!1,(c=new o(e.properties.name,{caseSensitive:r})).startTransaction("loadJSON",n),w={},S=e.properties)P=S[x],"name"!==x&&(w[x]=P);for(d in c.setProperties(w),I=e.processes)(a=I[d]).metadata||(a.metadata={}),c.addNode(d,a.component,a.metadata);for(p=0,f=(N=e.connections).length;p<f;p++)n=(i=N[p]).metadata?i.metadata:{},void 0===i.data?"number"!=typeof i.src.index&&"number"!=typeof i.tgt.index?c.addEdge(i.src.process,c.getPortName(i.src.port),i.tgt.process,c.getPortName(i.tgt.port),n):c.addEdgeIndex(i.src.process,c.getPortName(i.src.port),i.src.index,i.tgt.process,c.getPortName(i.tgt.port),i.tgt.index,n):"number"==typeof i.tgt.index?c.addInitialIndex(i.data,i.tgt.process,c.getPortName(i.tgt.port),i.tgt.index,n):c.addInitial(i.data,i.tgt.process,c.getPortName(i.tgt.port),n);if(e.exports&&e.exports.length)for(u=0,g=(_=e.exports).length;u<g;u++){if((s=_[u]).private){if(2!==($=s.private.split(".")).length)continue;for(d in b=$[0],v=$[1],e.processes)c.getPortName(d)===c.getPortName(b)&&(b=d)}else b=s.process,v=c.getPortName(s.port);c.addExport(s.public,b,v,s.metadata)}if(e.inports)for(C in T=e.inports)y=T[C],c.addInport(C,y.process,c.getPortName(y.port),y.metadata);if(e.outports)for(C in E=e.outports)y=E[C],c.addOutport(C,y.process,c.getPortName(y.port),y.metadata);if(e.groups)for(h=0,m=(k=e.groups).length;h<m;h++)l=k[h],c.addGroup(l.name,l.nodes,l.metadata||{});return c.endTransaction("loadJSON"),t(null,c)},n.loadFBP=function(t,o,r,i){var a,s;null==r&&(r={}),null==i&&(i=!1);try{a=e("fbp").parse(t,{caseSensitive:i})}catch(s){return o(s)}return n.loadJSON(a,o,r)},n.loadHTTP=function(e,t){var n;return(n=new XMLHttpRequest).onreadystatechange=function(){if(4===n.readyState)return 200!==n.status?t(new Error("Failed to load "+e+": HTTP "+n.status)):t(null,n.responseText)},n.open("GET",e,!0),n.send()},n.loadFile=function(t,o,r,i){if(null==r&&(r={}),null==i&&(i=!1),!a.isBrowser())return e("fs").readFile(t,"utf-8",function(e,r){var a;return e?o(e):"fbp"===t.split(".").pop()?n.loadFBP(r,o,{},i):(a=JSON.parse(r),n.loadJSON(a,o,{}))});n.loadHTTP(t,function(e,i){var a;return e?o(e):"fbp"===t.split(".").pop()?n.loadFBP(i,o,r):(a=JSON.parse(i),n.loadJSON(a,o,r))})},s=function(e){var t,n,o,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N;for(i=0,p=(y=r(e.groups).reverse()).length;i<p;i++)null!=(o=y[i])&&e.removeGroup(o.name);for(v in b=r(e.outports))b[v],e.removeOutport(v);for(v in w=r(e.inports))w[v],e.removeInport(v);for(s=0,d=(x=r(e.exports.reverse())).length;s<d;s++)n=x[s],e.removeExport(n.public);for(e.setProperties({}),c=0,u=(C=r(e.initializers).reverse()).length;c<u;c++)a=C[c],e.removeInitial(a.to.node,a.to.port);for(l=0,h=(S=r(e.edges).reverse()).length;l<h;l++)t=S[l],e.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);for(N=[],g=0,f=(I=r(e.nodes).reverse()).length;g<f;g++)m=I[g],N.push(e.removeNode(m.id));return N},i=function(e,t){var n,o,r,i,a,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N,_,T;for(s(e),i=0,d=(w=t.nodes).length;i<d;i++)v=w[i],e.addNode(v.id,v.component,v.metadata);for(c=0,u=(x=t.edges).length;c<u;c++)n=x[c],e.addEdge(n.from.node,n.from.port,n.to.node,n.to.port,n.metadata);for(l=0,h=(C=t.initializers).length;l<h;l++)a=C[l],e.addInitial(a.from.data,a.to.node,a.to.port,a.metadata);for(p=0,f=(S=t.exports).length;p<f;p++)o=S[p],e.addExport(o.public,o.node,o.port,o.metadata);for(b in e.setProperties(t.properties),I=t.inports)y=I[b],e.addInport(b,y.process,y.port,y.metadata);for(b in N=t.outports)y=N[b],e.addOutport(b,y.process,y.port,y.metadata);for(T=[],m=0,g=(_=t.groups).length;m<g;m++)r=_[m],T.push(e.addGroup(r.name,r.nodes,r.metadata));return T},n.equivalent=function(e,t,n){return null==n&&(n={}),JSON.stringify(e)===JSON.stringify(t)},n.mergeResolveTheirs=i}).call(this)},{"./Platform":11,clone:5,events:7,fbp:13,fs:3}],10:[function(e,t,n){(function(){var t,o,r,i,a,s,c,l=function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function o(){this.constructor=e}return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},p={}.hasOwnProperty,d=function(e,t){return function(){return e.apply(t,arguments)}};t=e("events").EventEmitter,s=e("clone"),c=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return t.id+"("+t.component+")";case"removeNode":return"DEL "+t.id+"("+t.component+")";case"renameNode":return"RENAME "+t.oldId+" "+t.newId;case"changeNode":return"META "+t.id;case"addEdge":return t.from.node+" "+t.from.port+" -> "+t.to.port+" "+t.to.node;case"removeEdge":return t.from.node+" "+t.from.port+" -X> "+t.to.port+" "+t.to.node;case"changeEdge":return"META "+t.from.node+" "+t.from.port+" -> "+t.to.port+" "+t.to.node;case"addInitial":return"'"+t.from.data+"' -> "+t.to.port+" "+t.to.node;case"removeInitial":return"'"+t.from.data+"' -X> "+t.to.port+" "+t.to.node;case"startTransaction":return">>> "+e.rev+": "+t.id;case"endTransaction":return"<<< "+e.rev+": "+t.id;case"changeProperties":return"PROPERTIES";case"addGroup":return"GROUP "+t.name;case"renameGroup":return"RENAME GROUP "+t.oldName+" "+t.newName;case"removeGroup":return"DEL GROUP "+t.name;case"changeGroup":return"META GROUP "+t.name;case"addInport":return"INPORT "+t.name;case"removeInport":return"DEL INPORT "+t.name;case"renameInport":return"RENAME INPORT "+t.oldId+" "+t.newId;case"changeInport":return"META INPORT "+t.name;case"addOutport":return"OUTPORT "+t.name;case"removeOutport":return"DEL OUTPORT "+t.name;case"renameOutport":return"RENAME OUTPORT "+t.oldId+" "+t.newId;case"changeOutport":return"META OUTPORT "+t.name;default:throw new Error("Unknown journal entry: "+e.cmd)}},a=function(e,t){var n,o,r;for(n in o={},e)r=e[n],o[n]=null;for(n in t)r=t[n],o[n]=r;return o},r=function(e){function n(e){this.graph=e,this.lastRevision=0}return l(n,t),n.prototype.lastRevision=0,n.prototype.putTransaction=function(e,t){return e>this.lastRevision&&(this.lastRevision=e),this.emit("transaction",e)},n.prototype.fetchTransaction=function(e,t){},n}(),i=function(e){function t(e){t.__super__.constructor.call(this,e),this.transactions=[]}return l(t,r),t.prototype.putTransaction=function(e,n){return t.__super__.putTransaction.call(this,e,n),this.transactions[e]=n},t.prototype.fetchTransaction=function(e){return this.transactions[e]},t}(),o=function(n){function o(e,t,n){var o,r,a,s,c,l,p,u,h,f,g,m,v,y,b,w,x,C,S,I,N;if(this.endTransaction=d(this.endTransaction,this),this.startTransaction=d(this.startTransaction,this),this.graph=e,this.entries=[],this.subscribed=!0,this.store=n||new i(this.graph),0===this.store.transactions.length){for(this.currentRevision=-1,this.startTransaction("initial",t),s=0,p=(y=this.graph.nodes).length;s<p;s++)v=y[s],this.appendCommand("addNode",v);for(l=0,u=(b=this.graph.edges).length;l<u;l++)o=b[l],this.appendCommand("addEdge",o);for(g=0,h=(w=this.graph.initializers).length;g<h;g++)a=w[g],this.appendCommand("addInitial",a);for(c in Object.keys(this.graph.properties).length>0&&this.appendCommand("changeProperties",this.graph.properties,{}),x=this.graph.inports)I=x[c],this.appendCommand("addInport",{name:c,port:I});for(c in C=this.graph.outports)I=C[c],this.appendCommand("addOutport",{name:c,port:I});for(m=0,f=(S=this.graph.groups).length;m<f;m++)r=S[m],this.appendCommand("addGroup",r);this.endTransaction("initial",t)}else this.currentRevision=this.store.lastRevision;this.graph.on("addNode",(N=this,function(e){return N.appendCommand("addNode",e)})),this.graph.on("removeNode",function(e){return function(t){return e.appendCommand("removeNode",t)}}(this)),this.graph.on("renameNode",function(e){return function(t,n){var o;return o={oldId:t,newId:n},e.appendCommand("renameNode",o)}}(this)),this.graph.on("changeNode",function(e){return function(t,n){return e.appendCommand("changeNode",{id:t.id,new:t.metadata,old:n})}}(this)),this.graph.on("addEdge",function(e){return function(t){return e.appendCommand("addEdge",t)}}(this)),this.graph.on("removeEdge",function(e){return function(t){return e.appendCommand("removeEdge",t)}}(this)),this.graph.on("changeEdge",function(e){return function(t,n){return e.appendCommand("changeEdge",{from:t.from,to:t.to,new:t.metadata,old:n})}}(this)),this.graph.on("addInitial",function(e){return function(t){return e.appendCommand("addInitial",t)}}(this)),this.graph.on("removeInitial",function(e){return function(t){return e.appendCommand("removeInitial",t)}}(this)),this.graph.on("changeProperties",function(e){return function(t,n){return e.appendCommand("changeProperties",{new:t,old:n})}}(this)),this.graph.on("addGroup",function(e){return function(t){return e.appendCommand("addGroup",t)}}(this)),this.graph.on("renameGroup",function(e){return function(t,n){return e.appendCommand("renameGroup",{oldName:t,newName:n})}}(this)),this.graph.on("removeGroup",function(e){return function(t){return e.appendCommand("removeGroup",t)}}(this)),this.graph.on("changeGroup",function(e){return function(t,n){return e.appendCommand("changeGroup",{name:t.name,new:t.metadata,old:n})}}(this)),this.graph.on("addExport",function(e){return function(t){return e.appendCommand("addExport",t)}}(this)),this.graph.on("removeExport",function(e){return function(t){return e.appendCommand("removeExport",t)}}(this)),this.graph.on("addInport",function(e){return function(t,n){return e.appendCommand("addInport",{name:t,port:n})}}(this)),this.graph.on("removeInport",function(e){return function(t,n){return e.appendCommand("removeInport",{name:t,port:n})}}(this)),this.graph.on("renameInport",function(e){return function(t,n){return e.appendCommand("renameInport",{oldId:t,newId:n})}}(this)),this.graph.on("changeInport",function(e){return function(t,n,o){return e.appendCommand("changeInport",{name:t,new:n.metadata,old:o})}}(this)),this.graph.on("addOutport",function(e){return function(t,n){return e.appendCommand("addOutport",{name:t,port:n})}}(this)),this.graph.on("removeOutport",function(e){return function(t,n){return e.appendCommand("removeOutport",{name:t,port:n})}}(this)),this.graph.on("renameOutport",function(e){return function(t,n){return e.appendCommand("renameOutport",{oldId:t,newId:n})}}(this)),this.graph.on("changeOutport",function(e){return function(t,n,o){return e.appendCommand("changeOutport",{name:t,new:n.metadata,old:o})}}(this)),this.graph.on("startTransaction",function(e){return function(t,n){return e.startTransaction(t,n)}}(this)),this.graph.on("endTransaction",function(e){return function(t,n){return e.endTransaction(t,n)}}(this))}return l(o,t),o.prototype.graph=null,o.prototype.entries=[],o.prototype.subscribed=!0,o.prototype.startTransaction=function(e,t){if(this.subscribed){if(this.entries.length>0)throw Error("Inconsistent @entries");return this.currentRevision++,this.appendCommand("startTransaction",{id:e,metadata:t},this.currentRevision)}},o.prototype.endTransaction=function(e,t){if(this.subscribed)return this.appendCommand("endTransaction",{id:e,metadata:t},this.currentRevision),this.store.putTransaction(this.currentRevision,this.entries),this.entries=[]},o.prototype.appendCommand=function(e,t,n){var o;if(this.subscribed)return o={cmd:e,args:s(t)},null!=n&&(o.rev=n),this.entries.push(o)},o.prototype.executeEntry=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return this.graph.addNode(t.id,t.component);case"removeNode":return this.graph.removeNode(t.id);case"renameNode":return this.graph.renameNode(t.oldId,t.newId);case"changeNode":return this.graph.setNodeMetadata(t.id,a(t.old,t.new));case"addEdge":return this.graph.addEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"removeEdge":return this.graph.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"changeEdge":return this.graph.setEdgeMetadata(t.from.node,t.from.port,t.to.node,t.to.port,a(t.old,t.new));case"addInitial":return this.graph.addInitial(t.from.data,t.to.node,t.to.port);case"removeInitial":return this.graph.removeInitial(t.to.node,t.to.port);case"startTransaction":case"endTransaction":return null;case"changeProperties":return this.graph.setProperties(t.new);case"addGroup":return this.graph.addGroup(t.name,t.nodes,t.metadata);case"renameGroup":return this.graph.renameGroup(t.oldName,t.newName);case"removeGroup":return this.graph.removeGroup(t.name);case"changeGroup":return this.graph.setGroupMetadata(t.name,a(t.old,t.new));case"addInport":return this.graph.addInport(t.name,t.port.process,t.port.port,t.port.metadata);case"removeInport":return this.graph.removeInport(t.name);case"renameInport":return this.graph.renameInport(t.oldId,t.newId);case"changeInport":return this.graph.setInportMetadata(t.name,a(t.old,t.new));case"addOutport":return this.graph.addOutport(t.name,t.port.process,t.port.port,t.port.metadata(t.name));case"removeOutport":return this.graph.removeOutport;case"renameOutport":return this.graph.renameOutport(t.oldId,t.newId);case"changeOutport":return this.graph.setOutportMetadata(t.name,a(t.old,t.new));default:throw new Error("Unknown journal entry: "+e.cmd)}},o.prototype.executeEntryInversed=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return this.graph.removeNode(t.id);case"removeNode":return this.graph.addNode(t.id,t.component);case"renameNode":return this.graph.renameNode(t.newId,t.oldId);case"changeNode":return this.graph.setNodeMetadata(t.id,a(t.new,t.old));case"addEdge":return this.graph.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"removeEdge":return this.graph.addEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"changeEdge":return this.graph.setEdgeMetadata(t.from.node,t.from.port,t.to.node,t.to.port,a(t.new,t.old));case"addInitial":return this.graph.removeInitial(t.to.node,t.to.port);case"removeInitial":return this.graph.addInitial(t.from.data,t.to.node,t.to.port);case"startTransaction":case"endTransaction":return null;case"changeProperties":return this.graph.setProperties(t.old);case"addGroup":return this.graph.removeGroup(t.name);case"renameGroup":return this.graph.renameGroup(t.newName,t.oldName);case"removeGroup":return this.graph.addGroup(t.name,t.nodes,t.metadata);case"changeGroup":return this.graph.setGroupMetadata(t.name,a(t.new,t.old));case"addInport":return this.graph.removeInport(t.name);case"removeInport":return this.graph.addInport(t.name,t.port.process,t.port.port,t.port.metadata);case"renameInport":return this.graph.renameInport(t.newId,t.oldId);case"changeInport":return this.graph.setInportMetadata(t.name,a(t.new,t.old));case"addOutport":return this.graph.removeOutport(t.name);case"removeOutport":return this.graph.addOutport(t.name,t.port.process,t.port.port,t.port.metadata);case"renameOutport":return this.graph.renameOutport(t.newId,t.oldId);case"changeOutport":return this.graph.setOutportMetadata(t.name,a(t.new,t.old));default:throw new Error("Unknown journal entry: "+e.cmd)}},o.prototype.moveToRevision=function(e){var t,n,o,r,i,a,s,c,l,p,d,u,h;if(e!==this.currentRevision){if(this.subscribed=!1,e>this.currentRevision)for(l=r=p=this.currentRevision+1,d=e;p<=d?r<=d:r>=d;l=p<=d?++r:--r)for(i=0,a=(u=this.store.fetchTransaction(l)).length;i<a;i++)n=u[i],this.executeEntry(n);else for(l=s=this.currentRevision,h=e+1;s>=h;l=s+=-1)for(o=c=(t=this.store.fetchTransaction(l)).length-1;c>=0;o=c+=-1)this.executeEntryInversed(t[o]);return this.currentRevision=e,this.subscribed=!0}},o.prototype.undo=function(){if(this.canUndo())return this.moveToRevision(this.currentRevision-1)},o.prototype.canUndo=function(){return this.currentRevision>0},o.prototype.redo=function(){if(this.canRedo())return this.moveToRevision(this.currentRevision+1)},o.prototype.canRedo=function(){return this.currentRevision<this.store.lastRevision},o.prototype.toPrettyString=function(e,t){var n,o,r,i,a,s,l,p,d;for(s=[],l=r=p=e|=0,d=t|=this.store.lastRevision;p<=d?r<d:r>d;l=p<=d?++r:--r)for(i=0,a=(n=this.store.fetchTransaction(l)).length;i<a;i++)o=n[i],s.push(c(o));return s.join("\n")},o.prototype.toJSON=function(e,t){var n,o,r,i,a,s,l,p;for(n=[],s=r=e|=0,l=t|=this.store.lastRevision;r<l;s=r+=1)for(i=0,a=(p=this.store.fetchTransaction(s)).length;i<a;i++)o=p[i],n.push(c(o));return n},o.prototype.save=function(t,n){var o;return o=JSON.stringify(this.toJSON(),null,4),e("fs").writeFile(t+".json",o,"utf-8",function(e,o){if(e)throw e;return n(t)})},o}(),n.Journal=o,n.JournalStore=r,n.MemoryJournalStore=i}).call(this)},{clone:5,events:7,fs:3}],11:[function(e,t,n){(function(e){(function(){(function(){n.isBrowser=function(){return void 0===e||!e.execPath||!e.execPath.match(/node|iojs/)},n.deprecated=function(t){if(!n.isBrowser()){if(e.env.NOFLO_FATAL_DEPRECATED)throw new Error(t);return console.warn(t)}if(window.NOFLO_FATAL_DEPRECATED)throw new Error(t);console.warn(t)}}).call(this)}).call(this)}).call(this,e("_process"))},{_process:17}],12:[function(e,t,n){t.exports=function(){function t(e,n,o,r){this.message=e,this.expected=n,this.found=o,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(t,Error),{SyntaxError:t,parse:function(n){var o,r,i=arguments.length>1?arguments[1]:{},a=this,s={},c={start:ln},l=ln,p=function(){return a.getResult()},d="INPORT=",u={type:"literal",value:"INPORT=",description:'"INPORT="'},h=".",f={type:"literal",value:".",description:'"."'},g=":",m={type:"literal",value:":",description:'":"'},v=function(e,t,n){return a.registerInports(e,t,n)},y="OUTPORT=",b={type:"literal",value:"OUTPORT=",description:'"OUTPORT="'},w=function(e,t,n){return a.registerOutports(e,t,n)},x="DEFAULT_INPORT=",C={type:"literal",value:"DEFAULT_INPORT=",description:'"DEFAULT_INPORT="'},S=function(e){Un=e},I="DEFAULT_OUTPORT=",N={type:"literal",value:"DEFAULT_OUTPORT=",description:'"DEFAULT_OUTPORT="'},_=function(e){zn=e},T=function(e){return a.registerAnnotation(e[0],e[1])},E=function(e){return a.registerEdges(e)},k=",",$={type:"literal",value:",",description:'","'},P=/^[\n\r\u2028\u2029]/,O={type:"class",value:"[\\n\\r\\u2028\\u2029]",description:"[\\n\\r\\u2028\\u2029]"},A="#",M={type:"literal",value:"#",description:'"#"'},D="->",L={type:"literal",value:"->",description:'"->"'},R=function(e,t){return[e,t]},U=function(e,t,n){return[{tgt:Yn(t,e)},{src:Vn(t,n)}]},z=function(e,t){return{src:Vn(e,t)}},j=function(e,t){return{tgt:Yn(t,e)}},G="'",F={type:"literal",value:"'",description:'"\'"'},B=function(e){return{data:e.join("")}},H=function(e){return{data:e}},Y=function(e){return e},V=/^[a-zA-Z_]/,X={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},K=/^[a-zA-Z0-9_\-]/,q={type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},W=function(e){return Bn(e)},J=function(e,t){return a.addNode(e,t),e},Z=function(e){return a.addAnonymousNode(e,an(Qt,Zt).start.offset)},Q="(",ee={type:"literal",value:"(",description:'"("'},te=/^[a-zA-Z\/\-0-9_]/,ne={type:"class",value:"[a-zA-Z/\\-0-9_]",description:"[a-zA-Z/\\-0-9_]"},oe=")",re={type:"literal",value:")",description:'")"'},ie=function(e,t){var n={};return n.comp=e?e.join(""):"",t&&(n.meta=t.join("").split(",")),n},ae=/^[a-zA-Z\/=_,0-9]/,se={type:"class",value:"[a-zA-Z/=_,0-9]",description:"[a-zA-Z/=_,0-9]"},ce=function(e){return e},le="@",pe={type:"literal",value:"@",description:'"@"'},de=/^[a-zA-Z0-9\-_]/,ue={type:"class",value:"[a-zA-Z0-9\\-_]",description:"[a-zA-Z0-9\\-_]"},he=/^[a-zA-Z0-9\-_ .]/,fe={type:"class",value:"[a-zA-Z0-9\\-_ \\.]",description:"[a-zA-Z0-9\\-_ \\.]"},ge=function(e,t){return[e.join(""),t.join("")]},me=function(e,t){return{port:i.caseSensitive?e:e.toLowerCase(),index:null!=t?t:void 0}},ve=function(e){return e},ye=/^[a-zA-Z.0-9_]/,be={type:"class",value:"[a-zA-Z.0-9_]",description:"[a-zA-Z.0-9_]"},we=function(e){return Bn(e)},xe="[",Ce={type:"literal",value:"[",description:'"["'},Se=/^[0-9]/,Ie={type:"class",value:"[0-9]",description:"[0-9]"},Ne="]",_e={type:"literal",value:"]",description:'"]"'},Te=function(e){return parseInt(e.join(""))},Ee=/^[^\n\r\u2028\u2029]/,ke={type:"class",value:"[^\\n\\r\\u2028\\u2029]",description:"[^\\n\\r\\u2028\\u2029]"},$e=/^[\\]/,Pe={type:"class",value:"[\\\\]",description:"[\\\\]"},Oe=/^[']/,Ae={type:"class",value:"[']",description:"[']"},Me=function(){return"'"},De=/^[^']/,Le={type:"class",value:"[^']",description:"[^']"},Re=" ",Ue={type:"literal",value:" ",description:'" "'},ze=function(e){return e},je="{",Ge={type:"literal",value:"{",description:'"{"'},Fe="}",Be={type:"literal",value:"}",description:'"}"'},He={type:"other",description:"whitespace"},Ye=/^[ \t\n\r]/,Ve={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Xe="false",Ke={type:"literal",value:"false",description:'"false"'},qe=function(){return!1},We="null",Je={type:"literal",value:"null",description:'"null"'},Ze=function(){return null},Qe="true",et={type:"literal",value:"true",description:'"true"'},tt=function(){return!0},nt=function(e,t){return t},ot=function(e,t){var n,o={};for(o[e.name]=e.value,n=0;n<t.length;n++)o[t[n].name]=t[n].value;return o},rt=function(e){return null!==e?e:{}},it=function(e,t){return{name:e,value:t}},at=function(e,t){return t},st=function(e,t){return[e].concat(t)},ct=function(e){return null!==e?e:[]},lt={type:"other",description:"number"},pt=function(){return parseFloat(n.substring(Qt,Zt))},dt=/^[1-9]/,ut={type:"class",value:"[1-9]",description:"[1-9]"},ht=/^[eE]/,ft={type:"class",value:"[eE]",description:"[eE]"},gt="-",mt={type:"literal",value:"-",description:'"-"'},vt="+",yt={type:"literal",value:"+",description:'"+"'},bt="0",wt={type:"literal",value:"0",description:'"0"'},xt={type:"other",description:"string"},Ct=function(e){return e.join("")},St='"',It={type:"literal",value:'"',description:'"\\""'},Nt="\\",_t={type:"literal",value:"\\",description:'"\\\\"'},Tt="/",Et={type:"literal",value:"/",description:'"/"'},kt="b",$t={type:"literal",value:"b",description:'"b"'},Pt=function(){return"\b"},Ot="f",At={type:"literal",value:"f",description:'"f"'},Mt=function(){return"\f"},Dt="n",Lt={type:"literal",value:"n",description:'"n"'},Rt=function(){return"\n"},Ut="r",zt={type:"literal",value:"r",description:'"r"'},jt=function(){return"\r"},Gt="t",Ft={type:"literal",value:"t",description:'"t"'},Bt=function(){return"\t"},Ht="u",Yt={type:"literal",value:"u",description:'"u"'},Vt=function(e){return String.fromCharCode(parseInt(e,16))},Xt=function(e){return e},Kt=/^[^\0-\x1F"\\]/,qt={type:"class",value:"[^\\0-\\x1F\\x22\\x5C]",description:"[^\\0-\\x1F\\x22\\x5C]"},Wt=/^[0-9a-f]/i,Jt={type:"class",value:"[0-9a-f]i",description:"[0-9a-f]i"},Zt=0,Qt=0,en=[{line:1,column:1,seenCR:!1}],tn=0,nn=[],on=0;if("startRule"in i){if(!(i.startRule in c))throw new Error("Can't start parsing from rule \""+i.startRule+'".');l=c[i.startRule]}function rn(e){var t,o,r=en[e];if(r)return r;for(t=e-1;!en[t];)t--;for(r={line:(r=en[t]).line,column:r.column,seenCR:r.seenCR};t<e;)"\n"===(o=n.charAt(t))?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1),t++;return en[e]=r,r}function an(e,t){var n=rn(e),o=rn(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:o.line,column:o.column}}}function sn(e){Zt<tn||(Zt>tn&&(tn=Zt,nn=[]),nn.push(e))}function cn(e,n,o,r){return null!==n&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new t(null!==e?e:function(e,t){var n,o=new Array(e.length);for(n=0;n<e.length;n++)o[n]=e[n].description;return"Expected "+(e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(n,o),n,o,r)}function ln(){var e,t,n;for(e=Zt,t=[],n=pn();n!==s;)t.push(n),n=pn();return t!==s&&(Qt=e,t=p()),e=t}function pn(){var e,t,o,r,i,a,c,l,p;return e=Zt,(t=_n())!==s?(n.substr(Zt,7)===d?(o=d,Zt+=7):(o=s,0===on&&sn(u)),o!==s&&(r=gn())!==s?(46===n.charCodeAt(Zt)?(i=h,Zt++):(i=s,0===on&&sn(f)),i!==s&&(a=Sn())!==s?(58===n.charCodeAt(Zt)?(c=g,Zt++):(c=s,0===on&&sn(m)),c!==s&&(l=Sn())!==s&&_n()!==s?((p=dn())===s&&(p=null),p!==s?(Qt=e,e=t=v(r,a,l)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=_n())!==s?(n.substr(Zt,8)===y?(o=y,Zt+=8):(o=s,0===on&&sn(b)),o!==s&&(r=gn())!==s?(46===n.charCodeAt(Zt)?(i=h,Zt++):(i=s,0===on&&sn(f)),i!==s&&(a=Sn())!==s?(58===n.charCodeAt(Zt)?(c=g,Zt++):(c=s,0===on&&sn(m)),c!==s&&(l=Sn())!==s&&_n()!==s?((p=dn())===s&&(p=null),p!==s?(Qt=e,e=t=w(r,a,l)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=_n())!==s?(n.substr(Zt,15)===x?(o=x,Zt+=15):(o=s,0===on&&sn(C)),o!==s&&(r=Sn())!==s&&(i=_n())!==s?((a=dn())===s&&(a=null),a!==s?(Qt=e,e=t=S(r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=_n())!==s?(n.substr(Zt,16)===I?(o=I,Zt+=16):(o=s,0===on&&sn(N)),o!==s&&(r=Sn())!==s&&(i=_n())!==s?((a=dn())===s&&(a=null),a!==s?(Qt=e,e=t=_(r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=function(){var e,t,o,r,i,a,c;if(e=Zt,35===n.charCodeAt(Zt)?(t=A,Zt++):(t=s,0===on&&sn(M)),t!==s)if(Tn()!==s)if(64===n.charCodeAt(Zt)?(o=le,Zt++):(o=s,0===on&&sn(pe)),o!==s){if(r=[],de.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(ue)),i!==s)for(;i!==s;)r.push(i),de.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(ue));else r=s;if(r!==s)if((i=Tn())!==s){if(a=[],he.test(n.charAt(Zt))?(c=n.charAt(Zt),Zt++):(c=s,0===on&&sn(fe)),c!==s)for(;c!==s;)a.push(c),he.test(n.charAt(Zt))?(c=n.charAt(Zt),Zt++):(c=s,0===on&&sn(fe));else a=s;a!==s?(Qt=e,t=ge(r,a),e=t):(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s}else Zt=e,e=s;else Zt=e,e=s;else Zt=e,e=s;return e}())!==s&&(o=un())!==s?(Qt=e,e=t=T(t)):(Zt=e,e=s),e===s&&(e=Zt,(t=hn())!==s?((o=un())===s&&(o=null),o!==s?e=t=[t,o]:(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=_n())!==s&&(o=un())!==s?e=t=[t,o]:(Zt=e,e=s),e===s&&(e=Zt,(t=_n())!==s&&(o=function e(){var t,o,r,i;return t=Zt,(o=function(){var e;return(e=fn())===s&&(e=function(){var e,t,n;return e=Zt,(t=gn())!==s?((n=Cn())===s&&(n=null),n!==s?(Qt=e,t=z(t,n),e=t):(Zt=e,e=s)):(Zt=e,e=s),e}())===s&&(e=function(){var e,t,o,r;if(e=Zt,39===n.charCodeAt(Zt)?(t=G,Zt++):(t=s,0===on&&sn(F)),t!==s){for(o=[],r=Nn();r!==s;)o.push(r),r=Nn();o!==s?(39===n.charCodeAt(Zt)?(r=G,Zt++):(r=s,0===on&&sn(F)),r!==s?(Qt=e,t=B(o),e=t):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e===s&&(e=Zt,(t=function(){var e,t,n;return e=Zt,(t=kn())!==s&&(n=$n())!==s&&kn()!==s?(Qt=e,t=ze(n),e=t):(Zt=e,e=s),e}())!==s&&(Qt=e,t=H(t)),e=t),e}()),e}())!==s&&_n()!==s?(n.substr(Zt,2)===D?(r=D,Zt+=2):(r=s,0===on&&sn(L)),r!==s&&_n()!==s&&(i=e())!==s?(Qt=t,o=R(o,i),t=o):(Zt=t,t=s)):(Zt=t,t=s),t===s&&(t=function(){var e;return(e=function(){var e,t,n;return e=Zt,(t=xn())===s&&(t=null),t!==s&&(n=gn())!==s?(Qt=e,t=j(t,n),e=t):(Zt=e,e=s),e}())===s&&(e=fn()),e}()),t}())!==s&&(r=_n())!==s?((i=dn())===s&&(i=null),i!==s?(Qt=e,e=t=E(o)):(Zt=e,e=s)):(Zt=e,e=s)))))))),e}function dn(){var e,t,o,r,i;return e=Zt,(t=_n())!==s?(44===n.charCodeAt(Zt)?(o=k,Zt++):(o=s,0===on&&sn($)),o===s&&(o=null),o!==s?((r=hn())===s&&(r=null),r!==s?((i=un())===s&&(i=null),i!==s?e=t=[t,o,r,i]:(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e}function un(){var e;return P.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(O)),e}function hn(){var e,t,o,r,i;if(e=Zt,(t=_n())!==s)if(35===n.charCodeAt(Zt)?(o=A,Zt++):(o=s,0===on&&sn(M)),o!==s){for(r=[],i=In();i!==s;)r.push(i),i=In();r!==s?e=t=[t,o,r]:(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s;return e}function fn(){var e,t,n,o;return e=Zt,(t=xn())!==s&&(n=gn())!==s&&(o=Cn())!==s?(Qt=e,e=t=U(t,n,o)):(Zt=e,e=s),e===s&&(e=Zt,(t=xn())===s&&(t=null),t!==s&&(n=function(){var e;return(e=vn())===s&&(e=yn()),e}())!==s?((o=Cn())===s&&(o=null),o!==s?(Qt=e,e=t=U(t,n,o)):(Zt=e,e=s)):(Zt=e,e=s)),e}function gn(){var e,t;return e=Zt,(t=vn())!==s&&(Qt=e,t=Y(t)),(e=t)===s&&(e=Zt,(t=mn())!==s&&(Qt=e,t=Y(t)),(e=t)===s&&(e=Zt,(t=yn())!==s&&(Qt=e,t=Y(t)),e=t)),e}function mn(){var e,t,o,r,i;if(e=Zt,t=Zt,V.test(n.charAt(Zt))?(o=n.charAt(Zt),Zt++):(o=s,0===on&&sn(X)),o!==s){for(r=[],K.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(q));i!==s;)r.push(i),K.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(q));r!==s?t=o=[o,r]:(Zt=t,t=s)}else Zt=t,t=s;return t!==s&&(Qt=e,t=W(t)),e=t}function vn(){var e,t,n;return e=Zt,(t=mn())!==s&&(n=bn())!==s?(Qt=e,e=t=J(t,n)):(Zt=e,e=s),e}function yn(){var e,t;return e=Zt,(t=bn())!==s&&(Qt=e,t=Z(t)),e=t}function bn(){var e,t,o,r,i;if(e=Zt,40===n.charCodeAt(Zt)?(t=Q,Zt++):(t=s,0===on&&sn(ee)),t!==s){for(o=[],te.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(ne));r!==s;)o.push(r),te.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(ne));o===s&&(o=null),o!==s?((r=function(){var e,t,o,r;if(e=Zt,58===n.charCodeAt(Zt)?(t=g,Zt++):(t=s,0===on&&sn(m)),t!==s){if(o=[],ae.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(se)),r!==s)for(;r!==s;)o.push(r),ae.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(se));else o=s;o!==s?(Qt=e,t=ce(o),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(r=null),r!==s?(41===n.charCodeAt(Zt)?(i=oe,Zt++):(i=s,0===on&&sn(re)),i!==s?(Qt=e,e=t=ie(o,r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e}function wn(){var e,t,o;return e=Zt,(t=Sn())!==s?((o=function(){var e,t,o,r;if(e=Zt,91===n.charCodeAt(Zt)?(t=xe,Zt++):(t=s,0===on&&sn(Ce)),t!==s){if(o=[],Se.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(Ie)),r!==s)for(;r!==s;)o.push(r),Se.test(n.charAt(Zt))?(r=n.charAt(Zt),Zt++):(r=s,0===on&&sn(Ie));else o=s;o!==s?(93===n.charCodeAt(Zt)?(r=Ne,Zt++):(r=s,0===on&&sn(_e)),r!==s?(Qt=e,t=Te(o),e=t):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(o=null),o!==s?(Qt=e,e=t=me(t,o)):(Zt=e,e=s)):(Zt=e,e=s),e}function xn(){var e,t;return e=Zt,(t=wn())!==s&&Tn()!==s?(Qt=e,e=t=ve(t)):(Zt=e,e=s),e}function Cn(){var e,t;return e=Zt,Tn()!==s&&(t=wn())!==s?(Qt=e,e=ve(t)):(Zt=e,e=s),e}function Sn(){var e,t,o,r,i;if(e=Zt,t=Zt,V.test(n.charAt(Zt))?(o=n.charAt(Zt),Zt++):(o=s,0===on&&sn(X)),o!==s){for(r=[],ye.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(be));i!==s;)r.push(i),ye.test(n.charAt(Zt))?(i=n.charAt(Zt),Zt++):(i=s,0===on&&sn(be));r!==s?t=o=[o,r]:(Zt=t,t=s)}else Zt=t,t=s;return t!==s&&(Qt=e,t=we(t)),e=t}function In(){var e;return Ee.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(ke)),e}function Nn(){var e,t,o;return e=Zt,$e.test(n.charAt(Zt))?(t=n.charAt(Zt),Zt++):(t=s,0===on&&sn(Pe)),t!==s?(Oe.test(n.charAt(Zt))?(o=n.charAt(Zt),Zt++):(o=s,0===on&&sn(Ae)),o!==s?(Qt=e,e=t=Me()):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(De.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(Le))),e}function _n(){var e,t;for(e=[],32===n.charCodeAt(Zt)?(t=Re,Zt++):(t=s,0===on&&sn(Ue));t!==s;)e.push(t),32===n.charCodeAt(Zt)?(t=Re,Zt++):(t=s,0===on&&sn(Ue));return e===s&&(e=null),e}function Tn(){var e,t;if(e=[],32===n.charCodeAt(Zt)?(t=Re,Zt++):(t=s,0===on&&sn(Ue)),t!==s)for(;t!==s;)e.push(t),32===n.charCodeAt(Zt)?(t=Re,Zt++):(t=s,0===on&&sn(Ue));else e=s;return e}function En(){var e,t,o,r;return e=Zt,(t=kn())!==s?(44===n.charCodeAt(Zt)?(o=k,Zt++):(o=s,0===on&&sn($)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}function kn(){var e,t;for(on++,e=[],Ye.test(n.charAt(Zt))?(t=n.charAt(Zt),Zt++):(t=s,0===on&&sn(Ve));t!==s;)e.push(t),Ye.test(n.charAt(Zt))?(t=n.charAt(Zt),Zt++):(t=s,0===on&&sn(Ve));return on--,e===s&&(t=s,0===on&&sn(He)),e}function $n(){var e;return(e=function(){var e,t;return e=Zt,n.substr(Zt,5)===Xe?(t=Xe,Zt+=5):(t=s,0===on&&sn(Ke)),t!==s&&(Qt=e,t=qe()),e=t}())===s&&(e=function(){var e,t;return e=Zt,n.substr(Zt,4)===We?(t=We,Zt+=4):(t=s,0===on&&sn(Je)),t!==s&&(Qt=e,t=Ze()),e=t}())===s&&(e=function(){var e,t;return e=Zt,n.substr(Zt,4)===Qe?(t=Qe,Zt+=4):(t=s,0===on&&sn(et)),t!==s&&(Qt=e,t=tt()),e=t}())===s&&(e=function(){var e,t,o,r,i,a,c,l;if(e=Zt,(t=function(){var e,t,o,r;return e=Zt,(t=kn())!==s?(123===n.charCodeAt(Zt)?(o=je,Zt++):(o=s,0===on&&sn(Ge)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s){if(o=Zt,(r=Pn())!==s){for(i=[],a=Zt,(c=En())!==s&&(l=Pn())!==s?(Qt=a,c=nt(r,l),a=c):(Zt=a,a=s);a!==s;)i.push(a),a=Zt,(c=En())!==s&&(l=Pn())!==s?(Qt=a,c=nt(r,l),a=c):(Zt=a,a=s);i!==s?(Qt=o,r=ot(r,i),o=r):(Zt=o,o=s)}else Zt=o,o=s;o===s&&(o=null),o!==s&&(r=function(){var e,t,o,r;return e=Zt,(t=kn())!==s?(125===n.charCodeAt(Zt)?(o=Fe,Zt++):(o=s,0===on&&sn(Be)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s?(Qt=e,t=rt(o),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(e=function(){var e,t,o,r,i,a,c,l;if(e=Zt,(t=function(){var e,t,o,r;return e=Zt,(t=kn())!==s?(91===n.charCodeAt(Zt)?(o=xe,Zt++):(o=s,0===on&&sn(Ce)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s){if(o=Zt,(r=$n())!==s){for(i=[],a=Zt,(c=En())!==s&&(l=$n())!==s?(Qt=a,c=at(r,l),a=c):(Zt=a,a=s);a!==s;)i.push(a),a=Zt,(c=En())!==s&&(l=$n())!==s?(Qt=a,c=at(r,l),a=c):(Zt=a,a=s);i!==s?(Qt=o,r=st(r,i),o=r):(Zt=o,o=s)}else Zt=o,o=s;o===s&&(o=null),o!==s&&(r=function(){var e,t,o,r;return e=Zt,(t=kn())!==s?(93===n.charCodeAt(Zt)?(o=Ne,Zt++):(o=s,0===on&&sn(_e)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s?(Qt=e,t=ct(o),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(e=function(){var e,t,o,r;return on++,e=Zt,(t=On())===s&&(t=null),t!==s&&function(){var e,t,o,r;if((e=function(){var e;return 48===n.charCodeAt(Zt)?(e=bt,Zt++):(e=s,0===on&&sn(wt)),e}())===s)if(e=Zt,(t=function(){var e;return dt.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(ut)),e}())!==s){for(o=[],r=Ln();r!==s;)o.push(r),r=Ln();o!==s?e=t=[t,o]:(Zt=e,e=s)}else Zt=e,e=s;return e}()!==s?((o=function(){var e,t,o,r;if(e=Zt,(t=function(){var e;return 46===n.charCodeAt(Zt)?(e=h,Zt++):(e=s,0===on&&sn(f)),e}())!==s){if(o=[],(r=Ln())!==s)for(;r!==s;)o.push(r),r=Ln();else o=s;o!==s?e=t=[t,o]:(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(o=null),o!==s?((r=function(){var e,t,o,r,i;if(e=Zt,(t=function(){var e;return ht.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(ft)),e}())!==s)if((o=On())===s&&(o=function(){var e;return 43===n.charCodeAt(Zt)?(e=vt,Zt++):(e=s,0===on&&sn(yt)),e}()),o===s&&(o=null),o!==s){if(r=[],(i=Ln())!==s)for(;i!==s;)r.push(i),i=Ln();else r=s;r!==s?e=t=[t,o,r]:(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s;return e}())===s&&(r=null),r!==s?(Qt=e,t=pt(),e=t):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),on--,e===s&&(t=s,0===on&&sn(lt)),e}())===s&&(e=An()),e}function Pn(){var e,t,o;return e=Zt,(t=An())!==s&&function(){var e,t,o,r;return e=Zt,(t=kn())!==s?(58===n.charCodeAt(Zt)?(o=g,Zt++):(o=s,0===on&&sn(m)),o!==s&&(r=kn())!==s?e=t=[t,o,r]:(Zt=e,e=s)):(Zt=e,e=s),e}()!==s&&(o=$n())!==s?(Qt=e,e=t=it(t,o)):(Zt=e,e=s),e}function On(){var e;return 45===n.charCodeAt(Zt)?(e=gt,Zt++):(e=s,0===on&&sn(mt)),e}function An(){var e,t,n;if(on++,e=Zt,Dn()!==s){for(t=[],n=Mn();n!==s;)t.push(n),n=Mn();t!==s&&(n=Dn())!==s?(Qt=e,e=Ct(t)):(Zt=e,e=s)}else Zt=e,e=s;return on--,e===s&&0===on&&sn(xt),e}function Mn(){var e,t,o,r,i,a,c,l,p;return(e=function(){var e;return Kt.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(qt)),e}())===s&&(e=Zt,function(){var e;return 92===n.charCodeAt(Zt)?(e=Nt,Zt++):(e=s,0===on&&sn(_t)),e}()!==s?(34===n.charCodeAt(Zt)?(t=St,Zt++):(t=s,0===on&&sn(It)),t===s&&(92===n.charCodeAt(Zt)?(t=Nt,Zt++):(t=s,0===on&&sn(_t)),t===s&&(47===n.charCodeAt(Zt)?(t=Tt,Zt++):(t=s,0===on&&sn(Et)),t===s&&(t=Zt,98===n.charCodeAt(Zt)?(o=kt,Zt++):(o=s,0===on&&sn($t)),o!==s&&(Qt=t,o=Pt()),(t=o)===s&&(t=Zt,102===n.charCodeAt(Zt)?(o=Ot,Zt++):(o=s,0===on&&sn(At)),o!==s&&(Qt=t,o=Mt()),(t=o)===s&&(t=Zt,110===n.charCodeAt(Zt)?(o=Dt,Zt++):(o=s,0===on&&sn(Lt)),o!==s&&(Qt=t,o=Rt()),(t=o)===s&&(t=Zt,114===n.charCodeAt(Zt)?(o=Ut,Zt++):(o=s,0===on&&sn(zt)),o!==s&&(Qt=t,o=jt()),(t=o)===s&&(t=Zt,116===n.charCodeAt(Zt)?(o=Gt,Zt++):(o=s,0===on&&sn(Ft)),o!==s&&(Qt=t,o=Bt()),(t=o)===s&&(t=Zt,117===n.charCodeAt(Zt)?(o=Ht,Zt++):(o=s,0===on&&sn(Yt)),o!==s?(r=Zt,i=Zt,(a=Rn())!==s&&(c=Rn())!==s&&(l=Rn())!==s&&(p=Rn())!==s?i=a=[a,c,l,p]:(Zt=i,i=s),(r=i!==s?n.substring(r,Zt):i)!==s?(Qt=t,t=o=Vt(r)):(Zt=t,t=s)):(Zt=t,t=s))))))))),t!==s?(Qt=e,e=Xt(t)):(Zt=e,e=s)):(Zt=e,e=s)),e}function Dn(){var e;return 34===n.charCodeAt(Zt)?(e=St,Zt++):(e=s,0===on&&sn(It)),e}function Ln(){var e;return Se.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(Ie)),e}function Rn(){var e;return Wt.test(n.charAt(Zt))?(e=n.charAt(Zt),Zt++):(e=s,0===on&&sn(Jt)),e}var Un="IN",zn="OUT";delete(a=this).properties,delete a.inports,delete a.outports,delete a.groups,a.edges=[],r={},a.validateContents=function(e,t){e.processes&&Object.keys(e.processes).forEach(function(t){if(!e.processes[t].component)throw new Error('Node "'+t+'" does not have a component defined')}),e.inports&&Object.keys(e.inports).forEach(function(t){var n=e.inports[t];if(!e.processes[n.process])throw new Error('Inport "'+t+'" is connected to an undefined target node "'+n.process+'"')}),e.outports&&Object.keys(e.outports).forEach(function(t){var n=e.outports[t];if(!e.processes[n.process])throw new Error('Outport "'+t+'" is connected to an undefined source node "'+n.process+'"')}),e.connections&&e.connections.forEach(function(t){if(t.tgt&&!e.processes[t.tgt.process]){if(t.data)throw new Error('IIP containing "'+t.data+'" is connected to an undefined target node "'+t.tgt.process+'"');throw new Error('Edge from "'+t.src.process+'" port "'+t.src.port+'" is connected to an undefined target node "'+t.tgt.process+'"')}if(t.src&&!e.processes[t.src.process])throw new Error('Edge to "'+t.tgt.process+'" port "'+t.tgt.port+'" is connected to an undefined source node "'+t.src.process+'"')})},a.addNode=function(e,t){if(r[e]||(r[e]={}),t.comp&&(r[e].component=t.comp),t.meta){for(var n={},o=0;o<t.meta.length;o++){var i=t.meta[o].split("=");1===i.length&&(i=["routes",i[0]]);var a=i[0],s=i[1];"x"!==a&&"y"!==a||(s=parseFloat(s)),n[a]=s}r[e].metadata=n}};var jn={},Gn={};a.addAnonymousNode=function(e,t){if(!Gn[t]){var n=e.comp.replace(/[^a-zA-Z0-9]+/,"_");jn[n]=(jn[n]||0)+1,Gn[t]="_"+n+"_"+jn[n],this.addNode(Gn[t],e)}return Gn[t]},a.getResult=function(){var t={inports:a.inports||{},outports:a.outports||{},groups:a.groups||[],processes:r||{},connections:a.processEdges()};a.properties&&(t.properties=a.properties),t.caseSensitive=i.caseSensitive||!1;var n=a.validateSchema;if(void 0!==i.validateSchema&&(n=i.validateSchema),n){if(void 0===o)var o=e("tv4");var s=e("../schema/graph.json"),c=o.validateMultiple(t,s);if(!c.valid)throw new Error("fbp: Did not validate againt graph schema:\n"+JSON.stringify(c.errors,null,2))}return(void 0===i.validateContents||i.validateContents)&&a.validateContents(t),t};var Fn=function(e,t){for(var n=-1,o=e?e.length:0,r=[];++n<o;){var i=e[n];i instanceof Array?Array.prototype.push.apply(r,t?i:Fn(i)):r.push(i)}return r};function Bn(e){return e[0]+e[1].join("")}function Hn(e,t,n){i.caseSensitive||(n=n.toLowerCase());var o={process:e,port:t?t.port:n};return t&&null!=t.index&&(o.index=t.index),o}function Yn(e,t){return Hn(e,t,Un)}function Vn(e,t){return Hn(e,t,zn)}if(a.registerAnnotation=function(e,t){if(a.properties||(a.properties={}),"runtime"===e)return a.properties.environment={},void(a.properties.environment.type=t);a.properties[e]=t},a.registerInports=function(e,t,n){a.inports||(a.inports={}),i.caseSensitive||(n=n.toLowerCase(),t=t.toLowerCase()),a.inports[n]={process:e,port:t}},a.registerOutports=function(e,t,n){a.outports||(a.outports={}),i.caseSensitive||(n=n.toLowerCase(),t=t.toLowerCase()),a.outports[n]={process:e,port:t}},a.registerEdges=function(e){Array.isArray(e)&&e.forEach(function(e,t){a.edges.push(e)})},a.processEdges=function(){var e,t;e=Fn(a.edges),t=[];for(var n=1;n<e.length;n+=1)("src"in e[n-1]||"data"in e[n-1])&&"tgt"in e[n]&&(e[n-1].tgt=e[n].tgt,t.push(e[n-1]),n++);return t},(o=l())!==s&&Zt===n.length)return o;throw o!==s&&Zt<n.length&&sn({type:"end",description:"end of input"}),cn(null,nn,tn<n.length?n.charAt(tn):null,tn<n.length?an(tn,tn+1):an(tn,tn))}}}()},{"../schema/graph.json":15,tv4:18}],13:[function(e,t,n){var o=e("./fbp"),r=e("./serialize");t.exports={SyntaxError:o.SyntaxError,parse:o.parse,serialize:r}},{"./fbp":12,"./serialize":14}],14:[function(e,t,n){var o=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};t.exports=function(e,t){var n,r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C,S,I,N;for(p in null==t&&(t={}),c="string"==typeof e?JSON.parse(e):e,d=[],h="",i=function(e){return null!=c.processes[e].metadata&&(e=c.processes[e].metadata.label),e.indexOf("/")>-1&&(e=e.split("/").pop()),e},r=function(e,t){return null!=t.process&&null!=c.processes[t.process].metadata?e=c.processes[t.process].metadata.label:null!=t.process&&(e=t.process),e.indexOf("/")>-1&&(e=e.split("/").pop()),e},c.properties&&(c.properties.environment&&c.properties.environment.type&&(h+="# @runtime "+c.properties.environment.type+"\n"),Object.keys(c.properties).forEach(function(e){if(e.match(/^[a-zA-Z0-9\-_]+$/)){var t=c.properties[e];"string"==typeof t&&t.match(/^[a-zA-Z0-9\-_\s\.]+$/)&&(h+="# @"+e+" "+t+"\n")}})),g=c.inports)f=r(p,s=g[p]),p=c.caseSensitive?p:p.toUpperCase(),s.port=c.caseSensitive?s.port:s.port.toUpperCase(),h+="INPORT="+f+"."+s.port+":"+p+"\n";for(p in m=c.outports)f=r(p,u=m[p]),p=c.caseSensitive?p:p.toUpperCase(),u.port=c.caseSensitive?u.port:u.port.toUpperCase(),h+="OUTPORT="+f+"."+u.port+":"+p+"\n";for(h+="\n",a=0,l=(v=c.connections).length;a<l;a++)null!=(n=v[a]).data?(I=c.caseSensitive?n.tgt.port:n.tgt.port.toUpperCase(),S=n.tgt.process,N=c.processes[S].component,C=i(S),o.call(d,N)<0&&(C+="("+N+")",d.push(N)),h+='"'+n.data+'" -> '+I+" "+C+"\n"):(w=c.caseSensitive?n.src.port:n.src.port.toUpperCase(),b=n.src.process,x=c.processes[b].component,y=i(b),o.call(d,x)<0&&(y+="("+x+")",d.push(x)),I=c.caseSensitive?n.tgt.port:n.tgt.port.toUpperCase(),S=n.tgt.process,N=c.processes[S].component,C=i(S),o.call(d,N)<0&&(C+="("+N+")",d.push(N)),h+=y+" "+w+" -> "+I+" "+C+"\n");return h}},{}],15:[function(e,t,n){t.exports={$schema:"http://json-schema.org/draft-04/schema",id:"graph.json",title:"FBP graph",description:"A graph of FBP processes and connections between them.\nThis is the primary way of specifying FBP programs.\n",name:"graph",type:"object",additionalProperties:!1,properties:{caseSensitive:{type:"boolean",description:"Whether the graph port identifiers should be treated as case-sensitive"},properties:{type:"object",description:"User-defined properties attached to the graph.",additionalProperties:!0,properties:{name:{type:"string",description:"Name of the graph"},environment:{type:"object",description:"Information about the execution environment for the graph",additionalProperties:!0,required:["type"],properties:{type:{type:"string",description:"Runtime type the graph is for",example:"noflo-nodejs"},content:{type:"string",description:"HTML fixture for browser-based graphs"}}},description:{type:"string",description:"Graph description"},icon:{type:"string",description:"Name of the icon that can be used for depicting the graph"}}},inports:{type:["object","undefined"],description:"Exported inports of the graph",additionalProperties:!0,patternProperties:{"[a-z0-9]+":{type:"object",properties:{process:{type:"string"},port:{type:"string"},metadata:{type:"object",additionalProperties:!0,required:[],properties:{x:{type:"integer",description:"X coordinate of a graph inport"},y:{type:"integer",description:"Y coordinate of a graph inport"}}}}}}},outports:{type:["object","undefined"],description:"Exported outports of the graph",additionalProperties:!0,patternProperties:{"[a-z0-9]+":{type:"object",properties:{process:{type:"string"},port:{type:"string"},metadata:{type:"object",required:[],additionalProperties:!0,properties:{x:{type:"integer",description:"X coordinate of a graph outport"},y:{type:"integer",description:"Y coordinate of a graph outport"}}}}}}},groups:{type:"array",description:"List of groups of processes",items:{type:"object",additionalProperties:!1,properties:{name:{type:"string"},nodes:{type:"array",items:{type:"string"}},metadata:{type:"object",additionalProperties:!0,required:[],properties:{description:{type:"string"}}}}}},processes:{type:"object",description:"The processes of this graph.\nEach process is an instance of a component.\n",additionalProperties:!1,patternProperties:{"[a-zA-Z0-9_]+":{type:"object",properties:{component:{type:"string"},metadata:{type:"object",additionalProperties:!0,required:[],properties:{x:{type:"integer",description:"X coordinate of a graph node"},y:{type:"integer",description:"Y coordinate of a graph node"}}}}}}},connections:{type:"array",description:"Connections of the graph.\nA connection either connects ports of two processes, or specifices an IIP as initial input packet to a port.\n",items:{type:"object",additionalProperties:!1,properties:{src:{type:"object",additionalProperties:!1,properties:{process:{type:"string"},port:{type:"string"},index:{type:"integer"}}},tgt:{type:"object",additionalProperties:!1,properties:{process:{type:"string"},port:{type:"string"},index:{type:"integer"}}},data:{},metadata:{type:"object",additionalProperties:!0,required:[],properties:{route:{type:"integer",description:"Route identifier of a graph edge"},schema:{type:"string",format:"uri",description:"JSON schema associated with a graph edge"},secure:{type:"boolean",description:"Whether edge data should be treated as secure"}}}}}}}}},{}],16:[function(e,t,n){n.read=function(e,t,n,o,r){var i,a,s=8*r-o-1,c=(1<<s)-1,l=c>>1,p=-7,d=n?r-1:0,u=n?-1:1,h=e[t+d];for(d+=u,i=h&(1<<-p)-1,h>>=-p,p+=s;p>0;i=256*i+e[t+d],d+=u,p-=8);for(a=i&(1<<-p)-1,i>>=-p,p+=o;p>0;a=256*a+e[t+d],d+=u,p-=8);if(0===i)i=1-l;else{if(i===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,o),i-=l}return(h?-1:1)*a*Math.pow(2,i-o)},n.write=function(e,t,n,o,r,i){var a,s,c,l=8*i-r-1,p=(1<<l)-1,d=p>>1,u=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,f=o?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=p):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?u/c:u*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=p?(s=0,a=p):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+h]=255&s,h+=f,s/=256,r-=8);for(a=a<<r|s,l+=r;l>0;e[n+h]=255&a,h+=f,a/=256,l-=8);e[n+h-f]|=128*g}},{}],17:[function(e,t,n){var o,r,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(o===setTimeout)return setTimeout(e,0);if((o===a||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:a}catch(e){o=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,p=[],d=!1,u=-1;function h(){d&&l&&(d=!1,l.length?p=l.concat(p):u=-1,p.length&&f())}function f(){if(!d){var e=c(h);d=!0;for(var t=p.length;t;){for(l=p,p=[];++u<t;)l&&l[u].run();u=-1,t=p.length}l=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new g(e,t)),1!==p.length||d||c(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],18:[function(e,t,n){var o,r;o=this,r=function(){var e,t,n,o;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),o=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var i=[];for(var a in r)e.call(r,a)&&i.push(a);if(t)for(var s=0;s<o;s++)e.call(r,n[s])&&i.push(n[s]);return i})),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var o=0;if(arguments.length>1&&((o=Number(arguments[1]))!=o?o=0:0!==o&&o!==1/0&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=n)return-1;for(var r=o>=0?o:Math.max(n-Math.abs(o),0);r<n;r++)if(r in t&&t[r]===e)return r;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var r={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},i={"*":!0};function a(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function s(e){var t="";r[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var n="",o="",s=!0,c=!1,l=!1;"+"===t?s=!1:"."===t?(o=".",n="."):"/"===t?(o="/",n="/"):"#"===t?(o="#",s=!1):";"===t?(o=";",n=";",c=!0,l=!0):"?"===t?(o="?",n="&",c=!0):"&"===t&&(o="&",n="&",c=!0);for(var p=[],d=e.split(","),u=[],h={},f=0;f<d.length;f++){var g=d[f],m=null;if(-1!==g.indexOf(":")){var v=g.split(":");g=v[0],m=parseInt(v[1],10)}for(var y={};i[g.charAt(g.length-1)];)y[g.charAt(g.length-1)]=!0,g=g.substring(0,g.length-1);var b={truncate:m,name:g,suffices:y};u.push(b),h[g]=b,p.push(g)}var w=function(e){for(var t="",r=0,i=0;i<u.length;i++){var p=u[i],d=e(p.name);if(null==d||Array.isArray(d)&&0===d.length||"object"==typeof d&&0===Object.keys(d).length)r++;else if(t+=i===r?o:n||",",Array.isArray(d)){c&&(t+=p.name+"=");for(var h=0;h<d.length;h++)h>0&&(t+=p.suffices["*"]&&n||",",p.suffices["*"]&&c&&(t+=p.name+"=")),t+=s?encodeURIComponent(d[h]).replace(/!/g,"%21"):a(d[h])}else if("object"==typeof d){c&&!p.suffices["*"]&&(t+=p.name+"=");var f=!0;for(var g in d)f||(t+=p.suffices["*"]&&n||","),f=!1,t+=s?encodeURIComponent(g).replace(/!/g,"%21"):a(g),t+=p.suffices["*"]?"=":",",t+=s?encodeURIComponent(d[g]).replace(/!/g,"%21"):a(d[g])}else c&&(t+=p.name,l&&""===d||(t+="=")),null!=p.truncate&&(d=d.substring(0,p.truncate)),t+=s?encodeURIComponent(d).replace(/!/g,"%21"):a(d)}return t};return w.varNames=p,{prefix:o,substitution:w}}function c(e){if(!(this instanceof c))return new c(e);for(var t=e.split("{"),n=[t.shift()],o=[],r=[],i=[];t.length>0;){var a=t.shift(),l=a.split("}")[0],p=a.substring(l.length+1),d=s(l);r.push(d.substitution),o.push(d.prefix),n.push(p),i=i.concat(d.substitution.varNames)}this.fill=function(e){for(var t=n[0],o=0;o<r.length;o++){t+=(0,r[o])(e),t+=n[o+1]}return t},this.varNames=i,this.template=e}c.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(function(t){return e[t]})}};var l=function(e,t,n,o,r){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,o&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),r&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=n||v("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var i in e.definedKeywords)this.definedKeywords[i]=e.definedKeywords[i].slice(0)};function p(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!p(e[n],t[n]))return!1}else{var o;for(o in e)if(void 0===t[o]&&void 0!==e[o])return!1;for(o in t)if(void 0===e[o]&&void 0!==t[o])return!1;for(o in e)if(!p(e[o],t[o]))return!1}return!0}return!1}l.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},l.prototype.createError=function(e,t,n,o,r,i,a){var s=new C(e,t,n,o,r);return s.message=this.errorReporter(s,i,a),s},l.prototype.returnError=function(e){return e},l.prototype.collectError=function(e){return e&&this.errors.push(e),null},l.prototype.prefixErrors=function(e,t,n){for(var o=e;o<this.errors.length;o++)this.errors[o]=this.errors[o].prefixWith(t,n);return this},l.prototype.banUnknownProperties=function(e,t){for(var n in this.unknownPropertyPaths){var o=this.createError(y.UNKNOWN_PROPERTY,{path:n},n,"",null,e,t),r=this.handleError(o);if(r)return r}return null},l.prototype.addFormat=function(e,t){if("object"==typeof e){for(var n in e)this.addFormat(n,e[n]);return this}this.formatValidators[e]=t},l.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){if((t=t||{})[e.$ref])return this.createError(y.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},l.prototype.getSchema=function(e,t){var n;if(void 0!==this.schemas[e])return n=this.schemas[e],this.resolveRefs(n,t);var o=e,r="";if(-1!==e.indexOf("#")&&(r=e.substring(e.indexOf("#")+1),o=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[o]){n=this.schemas[o];var i=decodeURIComponent(r);if(""===i)return this.resolveRefs(n,t);if("/"!==i.charAt(0))return;for(var a=i.split("/").slice(1),s=0;s<a.length;s++){var c=a[s].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===n[c]){n=void 0;break}n=n[c]}if(void 0!==n)return this.resolveRefs(n,t)}void 0===this.missing[o]&&(this.missing.push(o),this.missing[o]=o,this.missingMap[o]=o)},l.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)this.searchSchemas(e[n],t);else if(e&&"object"==typeof e)for(var o in"string"==typeof e.id&&function(e,t){if(t.substring(0,e.length)===e){var n=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===n.charAt(0)||"?"===n.charAt(0))return!0}return!1}(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)if("enum"!==o)if("object"==typeof e[o])this.searchSchemas(e[o],t);else if("$ref"===o){var r=g(e[o]);r&&void 0===this.schemas[r]&&void 0===this.missingMap[r]&&(this.missingMap[r]=r)}},l.prototype.addSchema=function(e,t){if("string"!=typeof e||void 0===t){if("object"!=typeof e||"string"!=typeof e.id)return;e=(t=e).id}e===g(e)+"#"&&(e=g(e)),this.schemas[e]=t,delete this.missingMap[e],m(t,e),this.searchSchemas(t,e)},l.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},l.prototype.getSchemaUris=function(e){var t=[];for(var n in this.schemas)e&&!e.test(n)||t.push(n);return t},l.prototype.getMissingUris=function(e){var t=[];for(var n in this.missingMap)e&&!e.test(n)||t.push(n);return t},l.prototype.dropSchemas=function(){this.schemas={},this.reset()},l.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},l.prototype.validateAll=function(e,t,n,o,r){var i;if(!(t=this.resolveRefs(t)))return null;if(t instanceof C)return this.errors.push(t),t;var a,s=this.errors.length,c=null,l=null;if(this.checkRecursive&&e&&"object"==typeof e){if(i=!this.scanned.length,e[this.validatedSchemasKey]){var p=e[this.validatedSchemasKey].indexOf(t);if(-1!==p)return this.errors=this.errors.concat(e[this.validationErrorsKey][p]),null}if(Object.isFrozen(e)&&-1!==(a=this.scannedFrozen.indexOf(e))){var d=this.scannedFrozenSchemas[a].indexOf(t);if(-1!==d)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[a][d]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===a&&(a=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),c=this.scannedFrozenSchemas[a].length,this.scannedFrozenSchemas[a][c]=t,this.scannedFrozenValidationErrors[a][c]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}l=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][l]=t,e[this.validationErrorsKey][l]=[]}}var u=this.errors.length,h=this.validateBasic(e,t,r)||this.validateNumeric(e,t,r)||this.validateString(e,t,r)||this.validateArray(e,t,r)||this.validateObject(e,t,r)||this.validateCombinations(e,t,r)||this.validateHypermedia(e,t,r)||this.validateFormat(e,t,r)||this.validateDefinedKeywords(e,t,r)||null;if(i){for(;this.scanned.length;){delete this.scanned.pop()[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(h||u!==this.errors.length)for(;n&&n.length||o&&o.length;){var f=n&&n.length?""+n.pop():null,g=o&&o.length?""+o.pop():null;h&&(h=h.prefixWith(f,g)),this.prefixErrors(u,f,g)}return null!==c?this.scannedFrozenValidationErrors[a][c]=this.errors.slice(s):null!==l&&(e[this.validationErrorsKey][l]=this.errors.slice(s)),this.handleError(h)},l.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var n=this.formatValidators[t.format].call(null,e,t);return"string"==typeof n||"number"==typeof n?this.createError(y.FORMAT_CUSTOM,{message:n},"","/format",null,e,t):n&&"object"==typeof n?this.createError(y.FORMAT_CUSTOM,{message:n.message||"?"},n.dataPath||"",n.schemaPath||"/format",null,e,t):null},l.prototype.validateDefinedKeywords=function(e,t,n){for(var o in this.definedKeywords)if(void 0!==t[o])for(var r=this.definedKeywords[o],i=0;i<r.length;i++){var a=(0,r[i])(e,t[o],t,n);if("string"==typeof a||"number"==typeof a)return this.createError(y.KEYWORD_CUSTOM,{key:o,message:a},"","",null,e,t).prefixWith(null,o);if(a&&"object"==typeof a){var s=a.code;if("string"==typeof s){if(!y[s])throw new Error("Undefined error code (use defineError): "+s);s=y[s]}else"number"!=typeof s&&(s=y.KEYWORD_CUSTOM);var c="object"==typeof a.message?a.message:{key:o,message:a.message||"?"},l=a.schemaPath||"/"+o.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(s,c,a.dataPath||null,l,null,e,t)}}return null},l.prototype.validateBasic=function(e,t,n){var o;return(o=this.validateType(e,t,n))?o.prefixWith(null,"type"):(o=this.validateEnum(e,t,n))?o.prefixWith(null,"type"):null},l.prototype.validateType=function(e,t){if(void 0===t.type)return null;var n=typeof e;null===e?n="null":Array.isArray(e)&&(n="array");var o=t.type;Array.isArray(o)||(o=[o]);for(var r=0;r<o.length;r++){var i=o[r];if(i===n||"integer"===i&&"number"===n&&e%1==0)return null}return this.createError(y.INVALID_TYPE,{type:n,expected:o.join("/")},"","",null,e,t)},l.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var n=0;n<t.enum.length;n++){if(p(e,t.enum[n]))return null}return this.createError(y.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},l.prototype.validateNumeric=function(e,t,n){return this.validateMultipleOf(e,t,n)||this.validateMinMax(e,t,n)||this.validateNaN(e,t,n)||null};var d=Math.pow(2,-51),u=1-d;function h(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function f(e,t){return t=h(t||""),e=h(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+(n=t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname,o=[],n.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?o.pop():o.push(e)}),o.join("").replace(/^\//,"/"===n.charAt(0)?"/":""))+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null;var n,o}function g(e){return e.split("#")[0]}function m(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=f(t,e.id),e.id=t),Array.isArray(e))for(var n=0;n<e.length;n++)m(e[n],t);else for(var o in"string"==typeof e.$ref&&(e.$ref=f(t,e.$ref)),e)"enum"!==o&&m(e[o],t)}function v(e){var t=S[e=e||"en"];return function(e){var n=t[e.code]||x[e.code];if("string"!=typeof n)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var o=e.params;return n.replace(/\{([^{}]*)\}/g,function(e,t){var n=o[t];return"string"==typeof n||"number"==typeof n?n:e})}}l.prototype.validateMultipleOf=function(e,t){var n=t.multipleOf||t.divisibleBy;if(void 0===n)return null;if("number"==typeof e){var o=e/n%1;if(o>=d&&o<u)return this.createError(y.NUMBER_MULTIPLE_OF,{value:e,multipleOf:n},"","",null,e,t)}return null},l.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(y.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(y.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(y.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(y.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},l.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:!0===isNaN(e)||e===1/0||e===-1/0?this.createError(y.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},l.prototype.validateString=function(e,t,n){return this.validateStringLength(e,t,n)||this.validateStringPattern(e,t,n)||null},l.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(y.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(y.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},l.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var n;if(t.pattern instanceof RegExp)n=t.pattern;else{var o,r="",i=t.pattern.match(/^\/(.+)\/([img]*)$/);i?(o=i[1],r=i[2]):o=t.pattern,n=new RegExp(o,r)}return n.test(e)?null:this.createError(y.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},l.prototype.validateArray=function(e,t,n){return Array.isArray(e)&&(this.validateArrayLength(e,t,n)||this.validateArrayUniqueItems(e,t,n)||this.validateArrayItems(e,t,n))||null},l.prototype.validateArrayLength=function(e,t){var n;return void 0!==t.minItems&&e.length<t.minItems&&(n=this.createError(y.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(n))?n:void 0!==t.maxItems&&e.length>t.maxItems&&(n=this.createError(y.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(n))?n:null},l.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var n=0;n<e.length;n++)for(var o=n+1;o<e.length;o++)if(p(e[n],e[o])){var r=this.createError(y.ARRAY_UNIQUE,{match1:n,match2:o},"","/uniqueItems",null,e,t);if(this.handleError(r))return r}return null},l.prototype.validateArrayItems=function(e,t,n){if(void 0===t.items)return null;var o,r;if(Array.isArray(t.items)){for(r=0;r<e.length;r++)if(r<t.items.length){if(o=this.validateAll(e[r],t.items[r],[r],["items",r],n+"/"+r))return o}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(o=this.createError(y.ARRAY_ADDITIONAL_ITEMS,{},"/"+r,"/additionalItems",null,e,t),this.handleError(o)))return o}else if(o=this.validateAll(e[r],t.additionalItems,[r],["additionalItems"],n+"/"+r))return o}else for(r=0;r<e.length;r++)if(o=this.validateAll(e[r],t.items,[r],["items"],n+"/"+r))return o;return null},l.prototype.validateObject=function(e,t,n){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,n)||this.validateObjectRequiredProperties(e,t,n)||this.validateObjectProperties(e,t,n)||this.validateObjectDependencies(e,t,n)||null},l.prototype.validateObjectMinMaxProperties=function(e,t){var n,o=Object.keys(e);return void 0!==t.minProperties&&o.length<t.minProperties&&(n=this.createError(y.OBJECT_PROPERTIES_MINIMUM,{propertyCount:o.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(n))?n:void 0!==t.maxProperties&&o.length>t.maxProperties&&(n=this.createError(y.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:o.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(n))?n:null},l.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var n=0;n<t.required.length;n++){var o=t.required[n];if(void 0===e[o]){var r=this.createError(y.OBJECT_REQUIRED,{key:o},"","/required/"+n,null,e,t);if(this.handleError(r))return r}}return null},l.prototype.validateObjectProperties=function(e,t,n){var o;for(var r in e){var i=n+"/"+r.replace(/~/g,"~0").replace(/\//g,"~1"),a=!1;if(void 0!==t.properties&&void 0!==t.properties[r]&&(a=!0,o=this.validateAll(e[r],t.properties[r],[r],["properties",r],i)))return o;if(void 0!==t.patternProperties)for(var s in t.patternProperties){if(new RegExp(s).test(r)&&(a=!0,o=this.validateAll(e[r],t.patternProperties[s],[r],["patternProperties",s],i)))return o}if(a)this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(o=this.createError(y.OBJECT_ADDITIONAL_PROPERTIES,{key:r},"","/additionalProperties",null,e,t).prefixWith(r,null),this.handleError(o)))return o}else if(o=this.validateAll(e[r],t.additionalProperties,[r],["additionalProperties"],i))return o}else this.trackUnknownProperties&&!this.knownPropertyPaths[i]&&(this.unknownPropertyPaths[i]=!0)}return null},l.prototype.validateObjectDependencies=function(e,t,n){var o;if(void 0!==t.dependencies)for(var r in t.dependencies)if(void 0!==e[r]){var i=t.dependencies[r];if("string"==typeof i){if(void 0===e[i]&&(o=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:r,missing:i},"","",null,e,t).prefixWith(null,r).prefixWith(null,"dependencies"),this.handleError(o)))return o}else if(Array.isArray(i))for(var a=0;a<i.length;a++){var s=i[a];if(void 0===e[s]&&(o=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:r,missing:s},"","/"+a,null,e,t).prefixWith(null,r).prefixWith(null,"dependencies"),this.handleError(o)))return o}else if(o=this.validateAll(e,i,[],["dependencies",r],n))return o}return null},l.prototype.validateCombinations=function(e,t,n){return this.validateAllOf(e,t,n)||this.validateAnyOf(e,t,n)||this.validateOneOf(e,t,n)||this.validateNot(e,t,n)||null},l.prototype.validateAllOf=function(e,t,n){if(void 0===t.allOf)return null;for(var o,r=0;r<t.allOf.length;r++){var i=t.allOf[r];if(o=this.validateAll(e,i,[],["allOf",r],n))return o}return null},l.prototype.validateAnyOf=function(e,t,n){if(void 0===t.anyOf)return null;var o,r,i=[],a=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,r=this.knownPropertyPaths);for(var s=!0,c=0;c<t.anyOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=t.anyOf[c],p=this.errors.length,d=this.validateAll(e,l,[],["anyOf",c],n);if(null===d&&p===this.errors.length){if(this.errors=this.errors.slice(0,a),this.trackUnknownProperties){for(var u in this.knownPropertyPaths)r[u]=!0,delete o[u];for(var h in this.unknownPropertyPaths)r[h]||(o[h]=!0);s=!1;continue}return null}d&&i.push(d.prefixWith(null,""+c).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=r),s?(i=i.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(y.ANY_OF_MISSING,{},"","/anyOf",i,e,t)):void 0},l.prototype.validateOneOf=function(e,t,n){if(void 0===t.oneOf)return null;var o,r,i=null,a=[],s=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,r=this.knownPropertyPaths);for(var c=0;c<t.oneOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=t.oneOf[c],p=this.errors.length,d=this.validateAll(e,l,[],["oneOf",c],n);if(null===d&&p===this.errors.length){if(null!==i)return this.errors=this.errors.slice(0,s),this.createError(y.ONE_OF_MULTIPLE,{index1:i,index2:c},"","/oneOf",null,e,t);if(i=c,this.trackUnknownProperties){for(var u in this.knownPropertyPaths)r[u]=!0,delete o[u];for(var h in this.unknownPropertyPaths)r[h]||(o[h]=!0)}}else d&&a.push(d)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=r),null===i?(a=a.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),this.createError(y.ONE_OF_MISSING,{},"","/oneOf",a,e,t)):(this.errors=this.errors.slice(0,s),null)},l.prototype.validateNot=function(e,t,n){if(void 0===t.not)return null;var o,r,i=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,r=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var a=this.validateAll(e,t.not,null,null,n),s=this.errors.slice(i);return this.errors=this.errors.slice(0,i),this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=r),null===a&&0===s.length?this.createError(y.NOT_PASSED,{},"","/not",null,e,t):null},l.prototype.validateHypermedia=function(e,t,n){if(!t.links)return null;for(var o,r=0;r<t.links.length;r++){var i=t.links[r];if("describedby"===i.rel){for(var a=new c(i.href),s=!0,l=0;l<a.varNames.length;l++)if(!(a.varNames[l]in e)){s=!1;break}if(s){var p={$ref:a.fillFromObject(e)};if(o=this.validateAll(e,p,[],["links",r],n))return o}}}};var y={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},b={};for(var w in y)b[y[w]]=w;var x={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function C(e,t,n,o,r){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+o);this.message="",this.params=t,this.code=e,this.dataPath=n||"",this.schemaPath=o||"",this.subErrors=r||null;var i=new Error(this.message);if(this.stack=i.stack||i.stacktrace,!this.stack)try{throw i}catch(i){this.stack=i.stack||i.stacktrace}}C.prototype=Object.create(Error.prototype),C.prototype.constructor=C,C.prototype.name="ValidationError",C.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var n=0;n<this.subErrors.length;n++)this.subErrors[n].prefixWith(e,t);return this};var S={};var I=function e(t){var n,o,r=new l,i={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(o=e,!0)},addFormat:function(){r.addFormat.apply(r,arguments)},language:function(e){return e?(S[e]||(e=e.split("-")[0]),!!S[e]&&(n=e,e)):n},addLanguage:function(e,t){var n;for(n in y)t[n]&&!t[y[n]]&&(t[y[n]]=t[n]);var o=e.split("-")[0];if(S[o])for(n in S[e]=Object.create(S[o]),t)void 0===S[o][n]&&(S[o][n]=t[n]),S[e][n]=t[n];else S[e]=t,S[o]=t;return this},freshApi:function(t){var n=e();return t&&n.language(t),n},validate:function(e,t,i,a){var s=v(n),c=new l(r,!1,o?function(e,t,n){return o(e,t,n)||s(e,t,n)}:s,i,a);"string"==typeof t&&(t={$ref:t}),c.addSchema("",t);var p=c.validateAll(e,t,null,null,"");return!p&&a&&(p=c.banUnknownProperties(e,t)),this.error=p,this.missing=c.missing,this.valid=null===p,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,t,i,a){var s=v(n),c=new l(r,!0,o?function(e,t,n){return o(e,t,n)||s(e,t,n)}:s,i,a);"string"==typeof t&&(t={$ref:t}),c.addSchema("",t),c.validateAll(e,t,null,null,""),a&&c.banUnknownProperties(e,t);var p={toString:function(){return this.valid?"valid":this.error.message}};return p.errors=c.errors,p.missing=c.missing,p.valid=0===p.errors.length,p},addSchema:function(){return r.addSchema.apply(r,arguments)},getSchema:function(){return r.getSchema.apply(r,arguments)},getSchemaMap:function(){return r.getSchemaMap.apply(r,arguments)},getSchemaUris:function(){return r.getSchemaUris.apply(r,arguments)},getMissingUris:function(){return r.getMissingUris.apply(r,arguments)},dropSchemas:function(){r.dropSchemas.apply(r,arguments)},defineKeyword:function(){r.defineKeyword.apply(r,arguments)},defineError:function(e,t,n){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!=0||t<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==y[e])throw new Error("Error already defined: "+e+" as "+y[e]);if(void 0!==b[t])throw new Error("Error code already used: "+b[t]+" as "+t);for(var o in y[e]=t,b[t]=e,x[e]=x[t]=n,S){var r=S[o];r[e]&&(r[t]=r[t]||r[e])}},reset:function(){r.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:m,resolveUrl:f,getDocumentUri:g,errorCodes:y};return i.language(t||"en"),i}();return I.addLanguage("en-gb",x),I.tv4=I,I},void 0!==t&&t.exports?t.exports=r():o.tv4=r()},{}],19:[function(e,t,n){var o=e("../the-graph-thumb/the-graph-thumb.js");function r(e,t,n){e.clearRect(0,0,n.width,n.height),e.fillStyle=n.outsideFill;var o=Math.round((n.viewrectangle[0]/n.scale-n.thumbrectangle[0])*n.thumbscale),r=Math.round((n.viewrectangle[1]/n.scale-n.thumbrectangle[1])*n.thumbscale),i=Math.round(n.viewrectangle[2]*n.thumbscale/n.scale),a=Math.round(n.viewrectangle[3]*n.thumbscale/n.scale),s=!1;return o<0&&r<0&&i>n.width-o&&a>n.height-r?{hide:s=!0}:(s=!1,o<0?(i+=o,o=0,t.style.borderLeftColor=n.viewBoxBorder2):(t.style.borderLeftColor=n.viewBoxBorder,e.fillRect(0,0,o,n.height)),r<0?(a+=r,r=0,t.style.borderTopColor=n.viewBoxBorder2):(t.style.borderTopColor=n.viewBoxBorder,e.fillRect(o,0,i,r)),i>n.width-o?(i=n.width-o,t.style.borderRightColor=n.viewBoxBorder2):(t.style.borderRightColor=n.viewBoxBorder,e.fillRect(o+i,0,n.width-(o+i),n.height)),a>n.height-r?(a=n.height-r,t.style.borderBottomColor=n.viewBoxBorder2):(t.style.borderBottomColor=n.viewBoxBorder,e.fillRect(o,r+a,i,n.height-(r+a))),t.style.left=o+"px",t.style.top=r+"px",t.style.width=i+"px",t.style.height=a+"px",{hide:s})}var i=React.createClass({propTypes:{},getDefaultProps:function(){return{width:200,height:150,hidden:!1,backgroundColor:"hsla(184, 8%, 75%, 0.9)",outsideFill:"hsla(0, 0%, 0%, 0.4)",nodeSize:60,nodeLineWidth:1,viewrectangle:[0,0,0,0],viewscale:1,viewBoxBorder:"hsla(190, 100%, 80%, 0.4)",viewBoxBorder2:"hsla( 10,  60%, 32%, 0.3)",viewBoxBorderStyle:"dotted",graph:null}},getInitialState:function(){return{thumbscale:1,currentPan:[0,0]}},render:function(){var e=this.props,t={position:"absolute",top:0,left:0},n={height:e.height,width:e.width,overflow:"hidden",cursor:"move",backgroundColor:e.backgroundColor},o={key:"thumb",ref:this._refThumbCanvas,width:e.width,height:e.height,style:t},r={key:"viewbox",ref:this._refViewboxCanvas,width:e.width,height:e.height,style:t},i={key:"viewboxdiv",ref:this._refViewboxElement,style:{position:"absolute",top:0,left:0,width:e.width,height:e.height,borderStyle:"dotted",borderWidth:1}},a=React.DOM;return a.div({key:"nav",style:n,ref:this._refTopElement},[a.div(i),a.canvas(r),a.canvas(o)])},componentDidUpdate:function(){this._updatePan(),this._renderElements()},componentDidMount:function(){this._updatePan(),this._renderElements(),this._setupEvents()},_refThumbCanvas:function(e){this._thumbContext=e.getContext("2d")},_refViewboxCanvas:function(e){this._viewboxContext=e.getContext("2d")},_refViewboxElement:function(e){this._viewboxElement=e},_refTopElement:function(e){this._topElement=e},_renderElements:function(){var e=function(e,t){var n={};for(var r in t)n[r]=t[r];return n.graph=null,n.lineWidth=t.nodeLineWidth,o.render(e,t.graph,n)}(this._thumbContext,this.props);!function(e,t,n,o){var i={};for(var a in o)i[a]=o[a];i.graph=null,i.scale=o.viewscale;var s=n.rectangle[2],c=n.rectangle[3];i.thumbscale=s>c?o.width/s:o.height/c,i.thumbrectangle=n.rectangle,r(e,t,i)}(this._viewboxContext,this._viewboxElement,e,this.props)},_updatePan:function(){this.state.currentPan=[-this.props.viewrectangle[0],-this.props.viewrectangle[1]]},_setupEvents:function(){this.hammer=new Hammer.Manager(this._topElement,{recognizers:[[Hammer.Tap],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),this.hammer.on("tap",function(e){this.props.onTap&&this.props.onTap(null,e)}.bind(this)),this.hammer.on("panmove",function(e){if(this.props.onPanTo){var t=this.state.currentPan[0],n=this.state.currentPan[1],o=this.state.thumbscale/this.props.viewscale;t-=e.deltaX/o,n-=e.deltaY/o;var r={x:Math.round(t),y:Math.round(n)};this.state.currentPan[0]=r.x,this.state.currentPan[1]=r.y,this.props.onPanTo(r,e)}}.bind(this))}});t.exports={render:r,calculateStyleFromTheme:function(e){var t={};return"dark"===e?(t.viewBoxBorder="hsla(190, 100%, 80%, 0.4)",t.viewBoxBorder2="hsla( 10,  60%, 32%, 0.3)",t.outsideFill="hsla(0, 0%, 0%, 0.4)",t.backgroundColor="hsla(0, 0%, 0%, 0.9)"):(t.viewBoxBorder="hsla(190, 100%, 20%, 0.8)",t.viewBoxBorder2="hsla( 10,  60%, 80%, 0.8)",t.outsideFill="hsla(0, 0%, 100%, 0.4)",t.backgroundColor="hsla(0, 0%, 100%, 0.9)"),t},Component:i}},{"../the-graph-thumb/the-graph-thumb.js":20}],20:[function(e,t,n){function o(e,t,n,o,r,i){try{e.strokeStyle=i.edgeColors[0],r&&(e.strokeStyle=i.edgeColors[r]);var a=Math.round(n.metadata.x*t)-.5,s=Math.round(n.metadata.y*t)-.5,c=Math.round(o.metadata.x*t)-.5,l=Math.round(o.metadata.y*t)-.5;e.beginPath(),e.moveTo(a,s),e.lineTo(c,l),e.stroke()}catch(e){}}t.exports={render:function(e,t,n){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,n.width,n.height),e.lineWidth=n.lineWidth;var r=[],i=1/0,a=1/0,s=-1/0,c=-1/0,l={};if(t.nodes.forEach(function(e){!e.metadata||isNaN(e.metadata.x)||isNaN(e.metadata.y)||(r.push(e),l[e.id]=e,i=Math.min(i,e.metadata.x),a=Math.min(a,e.metadata.y),s=Math.max(s,e.metadata.x),c=Math.max(c,e.metadata.y))}.bind(this)),t.inports&&Object.keys(t.inports).forEach(function(e){var n=t.inports[e];!n.metadata||isNaN(n.metadata.x)||isNaN(n.metadata.y)||(r.push(n),i=Math.min(i,n.metadata.x),a=Math.min(a,n.metadata.y),s=Math.max(s,n.metadata.x),c=Math.max(c,n.metadata.y))}.bind(this)),t.outports&&Object.keys(t.outports).forEach(function(e){var n=t.outports[e];!n.metadata||isNaN(n.metadata.x)||isNaN(n.metadata.y)||(r.push(n),i=Math.min(i,n.metadata.x),a=Math.min(a,n.metadata.y),s=Math.max(s,n.metadata.x),c=Math.max(c,n.metadata.y))}.bind(this)),0===r.length)return{scale:1,rectangle:[0,0,0,0]};if(!(isFinite(i)&&isFinite(a)&&isFinite(s)&&isFinite(c)))throw new Error("the-graph-thumb: Invalid space spanned");i-=n.nodeSize,a-=n.nodeSize,s+=2*n.nodeSize,c+=2*n.nodeSize;var p=s-i,d=c-a,u=[];u[0]=i,u[1]=a,u[2]=p,u[3]=d;var h=p>d?n.width/p:n.height/d,f=h,g=Math.round(n.nodeSize*h)/2;return e.setTransform(1,0,0,1,0-i*h,0-a*h),t.inports&&Object.keys(t.inports).forEach(function(r){var i=t.inports[r];if(i.metadata&&!isNaN(i.metadata.x)&&!isNaN(i.metadata.y)){var a=l[i.process];if(!a)return;o(e,h,i,a,2,n)}}.bind(this)),t.outports&&Object.keys(t.outports).forEach(function(r){var i=t.outports[r];if(i.metadata&&!isNaN(i.metadata.x)&&!isNaN(i.metadata.y)){var a=l[i.process];if(!a)return;o(e,h,a,i,5,n)}}.bind(this)),t.edges.forEach(function(t){var r=l[t.from.node],i=l[t.to.node];r&&i&&o(e,h,r,i,t.metadata.route,n)}.bind(this)),r.forEach(function(t){var o=Math.round(t.metadata.x*h),r=Math.round(t.metadata.y*h);e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,e.beginPath(),t.process&&!t.component?e.arc(o,r,g/2,0,2*Math.PI,!1):e.arc(o,r,g,0,2*Math.PI,!1),e.fill(),e.stroke(),e.beginPath();var i=Math.max(g-1.5,1);t.process&&!t.component?e.arc(o,r,i/2,0,2*Math.PI,!1):e.arc(o,r,i,0,2*Math.PI,!1),e.fill()}.bind(this)),{rectangle:u,scale:f}},styleFromTheme:function(e){var t={};return"dark"===e?(t.fill="hsl(184, 8%, 10%)",t.stroke="hsl(180, 11%, 70%)",t.edgeColors=["white","hsl(  0, 100%, 46%)","hsl( 35, 100%, 46%)","hsl( 60, 100%, 46%)","hsl(135, 100%, 46%)","hsl(160, 100%, 46%)","hsl(185, 100%, 46%)","hsl(210, 100%, 46%)","hsl(285, 100%, 46%)","hsl(310, 100%, 46%)","hsl(335, 100%, 46%)"]):(t.fill="hsl(184, 8%, 75%)",t.stroke="hsl(180, 11%, 20%)",t.edgeColors=["hsl(  0,   0%, 50%)","hsl(  0, 100%, 40%)","hsl( 29, 100%, 40%)","hsl( 47, 100%, 40%)","hsl(138, 100%, 40%)","hsl(160,  73%, 50%)","hsl(181, 100%, 40%)","hsl(216, 100%, 40%)","hsl(260, 100%, 40%)","hsl(348, 100%, 50%)","hsl(328, 100%, 40%)"]),t}}},{}],21:[function(e,t,n){let o=function(e,t){return t*Math.cos(2*Math.PI*e)},r=function(e,t){return t*Math.sin(2*Math.PI*e)},i=function(e,t,n){return["M",o(e,n),r(e,n),"A",n,n,0,0,0,o(t,n),r(t,n)].join(" ")},a={n4:i(7/8,5/8,36),s4:i(3/8,1/8,36),e4:i(1/8,-1/8,36),w4:i(5/8,3/8,36),inport:i(-.25,.25,4),outport:i(.25,-.25,4),inportBig:i(-.25,.25,6),outportBig:i(.25,-.25,6)};t.exports=a},{}],22:[function(e,t,n){n.nodeStyles={default:{bg:"rgba(255,255,255,1)",color:"#555"},primary:{bg:"rgba(69,112,253,1)",color:"#fff"},info:{bg:"rgba(214,69,250,1)",color:"#fff"},success:{bg:"rgba(253,91,70,1)",color:"#fff"},warning:{bg:"rgba(254,70,144,1)",color:"#fff"},danger:{bg:"rgba(79,86,104,1)",color:"#fff"},orange:{bg:"rgba(243,152,0,1)",color:"#fff"},green:{bg:"rgba(0,153,68,1)",color:"#fff"},blue:{bg:"rgba(0,70,134,1)",color:"#fff"},cyan:{bg:"rgba(19,181,177,1)",color:"#fff"},golden:{bg:"rgba(237,0,27,1)",color:"#fff"},warmgreen:{bg:"rgba(179,212,101,1)",color:"#fff"}},n.iconSvgD={code:"M8,0C3.6,0,0,3.6,0,8s3.6,8,8,8s8-3.6,8-8S12.4,0,8,0z M5.4,9.9c0.3,0.3,0.3,0.8,0,1.2c-0.2,0.2-0.4,0.2-0.6,0.2 s-0.4-0.1-0.6-0.2L1.8,8.6c-0.3-0.3-0.3-0.8,0-1.2L4.3,5c0.3-0.3,0.8-0.3,1.2,0c0.3,0.3,0.3,0.8,0,1.2L3.5,8L5.4,9.9z M9.7,4.6 L7.8,12c-0.1,0.3-0.4,0.5-0.8,0.5c-0.1,0-0.2,0-0.3,0c-0.4-0.2-0.6-0.6-0.5-1L8.2,4c0.2-0.4,0.6-0.6,1-0.5C9.7,3.7,9.9,4.2,9.7,4.6z M11.7,11c-0.2,0.2-0.4,0.2-0.6,0.2c-0.2,0-0.4-0.1-0.6-0.2c-0.3-0.3-0.3-0.8,0-1.2L12.5,8L10.6,6c-0.3-0.3-0.3-0.8,0-1.2 c0.3-0.3,0.8-0.3,1.2,0l2.5,2.5c0.3,0.3,0.3,0.8,0,1.2L11.7,11z",alert:"M8,0C3.6,0,0,3.6,0,8s3.6,8,8,8s8-3.6,8-8S12.4,0,8,0 M8,13.7c-0.6,0-1.1-0.5-1.1-1.1c0-0.6,0.5-1.1,1.1-1.1c0.6,0,1.1,0.5,1.1,1.1C9.1,13.2,8.6,13.7,8,13.7 M9.5,5.1C9.5,5.1,9.5,5.1,9.5,5.1c0,0.1-1,4.6-1,4.6s0.1-0.3,0,0C8.5,10,8.3,10.2,8,10.2S7.5,9.9,7.5,9.6c-0.1-0.3-1-4.4-1-4.4c0-0.1-0.1-0.2-0.1-0.3c0-0.4,0.2-0.8,0.4-1.1S7.6,3.4,8,3.4c0.4,0,0.8,0.2,1.1,0.4s0.5,0.7,0.4,1.1C9.5,4.9,9.5,5,9.5,5.1",cube:"M16.2,27.1l11.5-6.3V9.3l-11.5,4.2V27.1z M15,11.5l12.6-4.6L15,2.3L2.4,6.9L15,11.5z M30,6.9v13.8c0,0.4-0.1,0.8-0.3,1.2 c-0.2,0.3-0.5,0.6-0.9,0.9l-12.7,6.9C15.8,29.9,15.4,30,15,30s-0.7-0.1-1.1-0.3L1.2,22.8c-0.4-0.2-0.7-0.5-0.9-0.9 C0.1,21.6,0,21.2,0,20.8V6.9C0,6.5,0.2,6,0.4,5.6C0.7,5.2,1.1,5,1.5,4.8l12.7-4.6C14.5,0.1,14.8,0,15,0s0.5,0,0.8,0.1l12.7,4.6 c0.4,0.1,0.8,0.4,1.1,0.9C29.9,6,30,6.5,30,6.9z",microchip:"M8.2,10.4h13.6v9.1H8.2C8.2,19.6,8.2,10.4,8.2,10.4z M4.1,6.2h21.8c0.2,0,0.4,0.2,0.4,0.4v16.7c0,0.2-0.2,0.4-0.4,0.4H4.1c-0.2,0-0.4-0.2-0.4-0.4V6.6C3.7,6.4,3.9,6.2,4.1,6.2z M6.6,21.1h16.8V8.9H6.6C6.6,8.9,6.6,21.1,6.6,21.1z M8.8,5.8V2.4c0.3-0.3,0.5-0.6,0.5-1C9.3,0.6,8.7,0,7.9,0c0,0,0,0,0,0C7.2,0,6.6,0.6,6.6,1.3l0,0c0,0.4,0.2,0.8,0.5,1v3.4C7.1,5.8,8.8,5.8,8.8,5.8z M13.5,5.8V2.4c0.3-0.3,0.5-0.6,0.5-1C14,0.6,13.4,0,12.6,0s-1.3,0.6-1.3,1.3c0,0.4,0.2,0.8,0.5,1v3.4C11.8,5.8,13.5,5.8,13.5,5.8z M18.2,5.8V2.4c0.3-0.3,0.5-0.6,0.5-1c0-0.7-0.6-1.3-1.3-1.3c0,0,0,0,0,0C16.6,0,16,0.6,16,1.3c0,0,0,0,0,0c0,0.4,0.2,0.8,0.5,1v3.4C16.5,5.8,18.2,5.8,18.2,5.8z M22.9,5.8V2.4c0.3-0.3,0.5-0.6,0.5-1c0-0.7-0.6-1.3-1.3-1.3c-0.7,0-1.3,0.6-1.3,1.3c0,0,0,0,0,0c0,0.4,0.2,0.8,0.5,1v3.4L22.9,5.8L22.9,5.8z M21.2,24.2v3.4c-0.3,0.3-0.5,0.6-0.5,1c0,0.7,0.6,1.3,1.3,1.3l0,0c0.7,0,1.3-0.6,1.3-1.3v0c0-0.4-0.2-0.8-0.5-1v-3.4H21.2L21.2,24.2z M16.5,24.2v3.4c-0.3,0.3-0.5,0.6-0.5,1c0,0.7,0.6,1.3,1.3,1.3h0c0.7,0,1.3-0.6,1.3-1.3v0c0-0.4-0.2-0.8-0.5-1v-3.4H16.5z M11.8,24.2v3.4c-0.3,0.3-0.5,0.6-0.5,1c0,0.7,0.6,1.3,1.3,1.3s1.3-0.6,1.3-1.3c0-0.4-0.2-0.8-0.5-1v-3.4C13.5,24.2,11.8,24.2,11.8,24.2z M7.1,24.2v3.4c-0.3,0.3-0.5,0.6-0.5,1c0,0.7,0.6,1.3,1.3,1.3c0,0,0,0,0,0c0.7,0,1.3-0.6,1.3-1.3c0,0,0,0,0,0c0-0.4-0.2-0.8-0.5-1v-3.4C8.8,24.2,7.1,24.2,7.1,24.2z",flask:"M28.6,25.8c0.7,1.2,0.9,2.2,0.4,3c-0.4,0.8-1.4,1.2-2.7,1.2H3.8c-1.4,0-2.3-0.4-2.7-1.2c-0.4-0.8-0.3-1.8,0.4-3l9.8-15.5 V2.5H10c-0.3,0-0.6-0.1-0.9-0.4C8.9,1.9,8.8,1.6,8.8,1.2s0.1-0.6,0.4-0.9C9.4,0.1,9.7,0,10,0h10c0.3,0,0.6,0.1,0.9,0.4 c0.2,0.2,0.4,0.5,0.4,0.9s-0.1,0.6-0.4,0.9c-0.2,0.2-0.5,0.4-0.9,0.4h-1.3v7.8L28.6,25.8z M13.4,11.6L8,20H22l-5.3-8.4L16.3,11V2.5 h-2.5V11L13.4,11.6z",globe:"M20.3,9.2C19.5,3.8,17.4,0,15,0s-4.5,3.8-5.4,9.2H20.3z M9.2,15c0,1.3,0.1,2.6,0.2,3.9h11.2c0.1-1.2,0.2-2.5,0.2-3.9\ts-0.1-2.6-0.2-3.9H9.4C9.2,12.4,9.2,13.7,9.2,15z M28.8,9.2c-1.7-4.1-5.2-7.3-9.6-8.6c1.5,2,2.5,5.1,3,8.6H28.8z M10.7,0.6\tC6.4,1.9,2.9,5.1,1.1,9.2h6.5C8.2,5.8,9.2,2.7,10.7,0.6z M29.5,11.1h-6.9c0.1,1.3,0.2,2.6,0.2,3.9s-0.1,2.6-0.2,3.9h6.9\tc0.3-1.2,0.5-2.5,0.5-3.9S29.8,12.4,29.5,11.1L29.5,11.1z M7.2,15c0-1.3,0.1-2.6,0.2-3.9H0.5C0.2,12.4,0,13.7,0,15s0.2,2.6,0.5,3.9\th6.9C7.3,17.6,7.2,16.3,7.2,15z M9.6,20.8c0.9,5.4,2.9,9.2,5.4,9.2s4.5-3.8,5.4-9.2H9.6z M19.3,29.4c4.3-1.3,7.8-4.5,9.6-8.6h-6.5\tC21.8,24.2,20.7,27.3,19.3,29.4z M1.1,20.8c1.7,4.1,5.2,7.3,9.6,8.6c-1.5-2-2.5-5.1-3-8.6C7.7,20.8,1.1,20.8,1.1,20.8z","chart-area":"M29.3,22.5c0.4,0,0.7,0.3,0.7,0.7v2.3c0,0.4-0.3,0.7-0.7,0.7H0.7c-0.4,0-0.7-0.3-0.7-0.7V4.5c0-0.4,0.3-0.7,0.7-0.7H3 c0.4,0,0.7,0.3,0.7,0.7v18H29.3z M21.8,9.3l-5,3.3l-5-6.7c-0.3-0.4-0.9-0.4-1.2,0.1l-5.1,8.5v6.1h22.5l-5.3-11 C22.7,9.2,22.2,9.1,21.8,9.3z",strikethrough:"M30,14.5v2.7h-6c1.4,2.9,1.3,10.9-8.5,10.9C4.2,28.2,4.6,19.3,4.6,19.3l5.4,0.1c0,4.6,4.3,4.6,5.2,4.5 c0.9-0.1,4.1-0.1,4.4-3.2c0.1-1.5-1.4-2.6-3-3.4H0v-2.7H30 M25.1,8.9l-5.4,0c0,0,0.2-3.8-4.5-3.8c-4.7,0-4.3,3-4.3,3.4 c0.1,0.4,0.5,2.3,4.1,3.2H6.4c0,0-4.8-9.2,6.9-10.7C25.2-0.7,25.1,8.9,25.1,8.9z","shekel-sign":"M16.6,9.1v11.3c0,0.6,0.5,1.1,1.1,1.1h3.2c0.6,0,1.1-0.5,1.1-1.1V9.1c0-5-4.1-9.1-9.1-9.1H1.6C0.7,0,0,0.7,0,1.6v27.3 C0,29.5,0.5,30,1.1,30h3.2c0.6,0,1.1-0.5,1.1-1.1V5.4h7.5C14.9,5.4,16.6,7,16.6,9.1z M28.9,0h-3.2c-0.6,0-1.1,0.5-1.1,1.1v19.8 c0,2.1-1.7,3.8-3.8,3.8h-7.5v-15c0-0.6-0.5-1.1-1.1-1.1H9.1C8.5,8.6,8,9.1,8,9.6v18.8C8,29.3,8.8,30,9.6,30h11.2 c5,0,9.1-4.1,9.1-9.1V1.1C30,0.5,29.5,0,28.9,0z",random:"M29.6,21c0.5,0.5,0.5,1.4,0,2l-4.7,4.7c-0.9,0.9-2.4,0.3-2.4-1v-2.3h-3.4c-0.2,0-0.4-0.1-0.5-0.2l-4.1-4.4l3.1-3.3l3.1,3.3\th1.9v-2.3c0-1.3,1.5-1.9,2.4-1L29.6,21z M0.7,10.3h4.9l3.1,3.3l3.1-3.3L7.7,5.8C7.6,5.7,7.4,5.6,7.2,5.6H0.7C0.3,5.6,0,5.9,0,6.3\tv3.3C0,10,0.3,10.3,0.7,10.3z M22.5,10.3v2.3c0,1.3,1.5,1.9,2.4,1L29.6,9c0.5-0.5,0.5-1.4,0-2l-4.7-4.7c-0.9-0.9-2.4-0.3-2.4,1v2.3\th-3.4c-0.2,0-0.4,0.1-0.5,0.2L5.6,19.7H0.7C0.3,19.7,0,20,0,20.4v3.3c0,0.4,0.3,0.7,0.7,0.7h6.5c0.2,0,0.4-0.1,0.5-0.2l12.9-13.8\tH22.5z",signature:"M18.8,18.2c-0.8-0.8-1.3-2-1.3-3.1c0-1.1,0.4-2.1,1.2-2.8c0,0,0,0,0,0c0.3-0.3,0.5-0.5,0.9-0.7c1.4-1.2,2.2-3,2.2-4.9C21.8,3,18.7,0,15,0S8.2,3,8.2,6.7c0,1.9,0.8,3.7,2.2,4.9c0.3,0.2,0.6,0.4,0.9,0.7c0,0,0,0,0,0c0.8,0.7,1.2,1.8,1.2,2.8c0,1.2-0.5,2.4-1.3,3.1h-10c-0.5,0-1,0.4-1,1v6.1h29.5v-6.1c0-0.5-0.4-1-1-1c0,0,0,0,0,0L18.8,18.2z M1.9,26.9h26.3V30H1.9V26.9z",adjust:"M15,2.9c6.7,0,12.1,5.4,12.1,12.1c0,6.7-5.4,12.1-12.1,12.1C8.3,27.1,2.9,21.7,2.9,15C2.9,8.3,8.3,2.9,15,2.9 M15,0C6.7,0,0,6.7,0,15s6.7,15,15,15s15-6.7,15-15S23.3,0,15,0z M15,5.8c-5.1,0-9.2,4.1-9.2,9.2s4.1,9.2,9.2,9.2V5.8z",atlas:"M20.5,12.2h-2.3c-0.1,1.6-0.4,3-0.8,4.1C19,15.5,20.2,14,20.5,12.2z M20.5,10.3C20.2,8.5,19,7,17.4,6.2\tc0.5,1.1,0.7,2.5,0.8,4.1H20.5z M15,5.7c-0.5,0.4-1.2,2-1.4,4.6h2.7C16.2,7.7,15.5,6.1,15,5.7z M12.6,6.2C11,7,9.8,8.5,9.5,10.3h2.3\tC11.8,8.7,12.1,7.3,12.6,6.2z M12.6,16.3c-0.4-1.1-0.7-2.5-0.8-4.1H9.5C9.8,14,11,15.5,12.6,16.3z M16.4,12.2h-2.7\tc0.2,2.6,0.9,4.2,1.4,4.6C15.5,16.4,16.2,14.8,16.4,12.2z M28.1,21V1.5c0-0.9-0.6-1.5-1.5-1.5H7.5C4.3,0,1.9,2.4,1.9,5.6v18.8\tc0,3.2,2.4,5.6,5.6,5.6h19.1c0.7,0,1.5-0.6,1.5-1.5v-0.9c0-0.4-0.2-0.8-0.6-1.1c-0.2-0.9-0.2-3.6,0-4.3C27.9,21.9,28.1,21.6,28.1,21\tL28.1,21z M15,3.8c4.1,0,7.5,3.4,7.5,7.5s-3.4,7.5-7.5,7.5s-7.5-3.4-7.5-7.5S10.9,3.8,15,3.8z M24.4,26.3H7.5\tc-1.1,0-1.9-0.8-1.9-1.9s0.9-1.9,1.9-1.9h16.9V26.3z",blanket:"M30,5.6C30,2.5,27.5,0,24.4,0H5.6C2.5,0,0,2.5,0,5.6v16.9C0,26.6,3.4,30,7.5,30h21.6c0.5,0,0.9-0.4,0.9-0.9v-1.9c0-0.5-0.4-0.9-0.9-0.9H7.5c-2.1,0-3.8-1.7-3.8-3.8s1.7-3.8,3.8-3.8h17.8c0.5,0,0.9,0.4,0.9,0.9s-0.4,0.9-0.9,0.9H7.5c-1,0-1.9,0.8-1.9,1.9s0.8,1.9,1.9,1.9H25c2.4,0,4.7-1.8,4.9-4.2C30,20,30,5.6,30,5.6z",burn:"M15,0C8.4,5.9,3.8,12.9,3.8,17.6C3.8,24.9,8.4,30,15,30s11.3-5.1,11.3-12.4C26.3,12.9,21.6,5.9,15,0z M15,26.3 c-3.3,0-5.6-2.3-5.6-5.6c0-0.8,0.3-3.6,5.6-9.4c5.4,5.8,5.6,8.7,5.6,9.4C20.6,24,18.3,26.3,15,26.3z",bong:"M19.6,30c1.4,0,2.6-0.7,3.3-1.9c0.9-1.6,1.5-3.6,1.5-5.6c0-2.1-0.6-4.1-1.6-5.8l2.5-2.5l0.5,0.5c0.4,0.4,1,0.4,1.3,0\tl0.7-0.7c0.4-0.4,0.4-1,0-1.3l-3.1-3.1c-0.4-0.4-1-0.4-1.3,0l-0.7,0.7c-0.4,0.4-0.4,1,0,1.3l0.5,0.5L21,14.5\tc-0.7-0.7-1.4-1.2-2.3-1.7v-9l0.9,0c0.5,0,0.9-0.4,0.9-0.9l0-1.9c0-0.5-0.4-0.9-0.9-0.9L6.6,0C6,0,5.6,0.4,5.6,1l0,1.9\tc0,0.5,0.4,0.9,0.9,0.9l0.9,0v9c-3.4,1.9-5.6,5.6-5.6,9.7c0,2,0.5,3.9,1.5,5.6C4,29.3,5.3,30,6.6,30H19.6z M8.9,15.2l1.4-0.8V3.7\tl5.6,0v10.6l1.4,0.8c1.5,0.8,2.6,2.1,3.3,3.5H5.6C6.3,17.3,7.5,16,8.9,15.2z","chart-line":"M29.1,22.5H3.8V4.7c0-0.5-0.4-0.9-0.9-0.9H0.9C0.4,3.8,0,4.2,0,4.7v19.7c0,1,0.8,1.9,1.9,1.9h27.2c0.5,0,0.9-0.4,0.9-0.9 v-1.9C30,22.9,29.6,22.5,29.1,22.5z M27.2,5.6h-6.9c-1.3,0-1.9,1.5-1,2.4l1.9,1.9l-4.3,4.3l-4.3-4.3c-0.7-0.7-1.9-0.7-2.7,0l-4,4 c-0.4,0.4-0.4,1,0,1.3l1.3,1.3c0.4,0.4,1,0.4,1.3,0l2.7-2.7l4.3,4.3c0.7,0.7,1.9,0.7,2.7,0l5.6-5.6l1.9,1.9c0.9,0.9,2.4,0.3,2.4-1 V6.6C28.1,6,27.7,5.6,27.2,5.6z",clone:"M27.2,0C28.7,0,30,1.3,30,2.8v16.9c0,1.6-1.3,2.8-2.8,2.8H10.3c-1.6,0-2.8-1.3-2.8-2.8V2.8C7.5,1.3,8.8,0,10.3,0H27.2 M10.3,24.4c-2.6,0-4.7-2.1-4.7-4.7V7.5H2.8C1.3,7.5,0,8.8,0,10.3v16.9C0,28.7,1.3,30,2.8,30h16.9c1.6,0,2.8-1.3,2.8-2.8v-2.8H10.3z","cloud-upload-alt":"M20,15.5c0-0.1,0-0.3-0.1-0.4l-5.5-5.5c-0.1-0.1-0.2-0.1-0.4-0.1s-0.3,0-0.4,0.1l-5.5,5.5C8.1,15.3,8,15.4,8,15.5\tc0,0.1,0,0.3,0.1,0.4S8.4,16,8.5,16H12v5.5c0,0.1,0,0.3,0.1,0.4c0.1,0.1,0.2,0.1,0.4,0.1h3c0.1,0,0.3,0,0.4-0.1\tc0.1-0.1,0.1-0.2,0.1-0.4V16h3.5c0.1,0,0.3,0,0.4-0.1C20,15.8,20,15.6,20,15.5L20,15.5z M30,20c0,1.7-0.6,3.1-1.8,4.2\tC27.1,25.4,25.7,26,24,26H7c-1.9,0-3.6-0.7-4.9-2.1S0,20.9,0,19c0-1.4,0.4-2.6,1.1-3.8s1.7-2,2.9-2.6c0-0.3,0-0.5,0-0.7\tc0-2.2,0.8-4.1,2.3-5.7S9.8,4,12,4c1.6,0,3.1,0.5,4.5,1.4c1.3,0.9,2.3,2.1,2.9,3.6C20.1,8.3,21,8,22,8c1.1,0,2,0.4,2.8,1.2\tC25.6,10,26,10.9,26,12c0,0.8-0.2,1.5-0.6,2.2c1.4,0.3,2.5,1,3.3,2.1C29.6,17.4,30,18.6,30,20L30,20z","code-branch":"M25.7,8.6c0-2.4-1.9-4.3-4.3-4.3s-4.3,1.9-4.3,4.3c0,1.5,0.9,2.8,1.9,3.6c-0.6,1.9-2.1,3.6-4.5,4.1c-1.5,0-2.8,0.6-3.9,1.3\tV7.9c1.3-0.6,2.1-2.1,2.1-3.6c0-2.4-1.9-4.3-4.3-4.3S4.3,1.9,4.3,4.3c0,1.5,0.9,3,2.1,3.6v14.1c-1.3,0.6-2.1,2.1-2.1,3.6\tc0,2.4,1.9,4.3,4.3,4.3s4.3-1.9,4.3-4.3c0-1.1-0.4-2.1-1.3-3c0.9-1.3,2.1-2.1,3.9-2.4c4.1-0.7,7.3-3.8,7.9-7.9\tC24.9,11.6,25.7,10.3,25.7,8.6L25.7,8.6z M8.6,2.1c1.3,0,2.1,0.9,2.1,2.1S9.9,6.4,8.6,6.4S6.4,5.6,6.4,4.3S7.3,2.1,8.6,2.1z\t M8.6,27.9c-1.3,0-2.1-0.9-2.1-2.1c0-1.3,0.9-2.1,2.1-2.1s2.1,0.9,2.1,2.1C10.7,27,9.9,27.9,8.6,27.9z M21.4,10.7\tc-1.3,0-2.1-0.9-2.1-2.1s0.9-2.1,2.1-2.1c1.3,0,2.1,0.9,2.1,2.1S22.7,10.7,21.4,10.7z","code-commit":"M23.3,12.9C22.4,9.2,19,6.6,15,6.6s-7.3,2.7-8.3,6.3H0v4.2h6.7c1,3.7,4.3,6.4,8.3,6.4s7.4-2.7,8.3-6.4H30v-4.2H23.3 M15,19.2c-2.3,0-4.3-1.9-4.3-4.2c0-2.4,1.9-4.2,4.3-4.2s4.3,1.8,4.3,4.2C19.3,17.3,17.3,19.2,15,19.2",cog:"M26.9,17.2l2.7,1.6c0.3,0.2,0.5,0.5,0.3,0.9c-0.7,2.3-1.9,4.3-3.5,6c-0.2,0.3-0.6,0.3-0.9,0.1l-2.7-1.6\tc-1.1,1-2.4,1.7-3.8,2.2v3.1c0,0.4-0.2,0.7-0.6,0.7c-2.2,0.5-4.6,0.5-6.9,0c-0.3-0.1-0.6-0.4-0.6-0.7v-3.1c-1.4-0.5-2.7-1.2-3.8-2.2\tl-2.7,1.6c-0.3,0.2-0.7,0.1-0.9-0.1c-1.6-1.7-2.8-3.7-3.5-6c-0.1-0.3,0-0.7,0.3-0.9l2.7-1.6c-0.3-1.5-0.3-3,0-4.4l-2.7-1.6\tc-0.3-0.2-0.5-0.5-0.3-0.9c0.7-2.3,1.9-4.3,3.5-6C3.7,4.1,4.1,4,4.4,4.2l2.7,1.6c1.1-1,2.4-1.7,3.8-2.2V0.5c0-0.4,0.2-0.7,0.6-0.7\tc2.2-0.5,4.6-0.5,6.9,0C18.8-0.2,19,0.1,19,0.5v3.1c1.4,0.5,2.7,1.2,3.8,2.2l2.7-1.6c0.3-0.2,0.7-0.1,0.9,0.1c1.6,1.7,2.8,3.7,3.5,6\tc0.1,0.3,0,0.7-0.3,0.9l-2.7,1.6C27.2,14.2,27.2,15.8,26.9,17.2L26.9,17.2z M20.1,15c0-2.8-2.3-5.1-5.1-5.1S9.9,12.2,9.9,15\ts2.3,5.1,5.1,5.1S20.1,17.8,20.1,15z",coins:"M0,23.7v2.5C0,28.3,5,30,11.3,30s11.3-1.7,11.3-3.8v-2.5c-2.4,1.7-6.8,2.5-11.3,2.5S2.4,25.5,0,23.7z M18.8,7.5\tC25,7.5,30,5.8,30,3.8S25,0,18.8,0S7.5,1.7,7.5,3.8S12.5,7.5,18.8,7.5z M0,17.6v3c0,2.1,5,3.8,11.3,3.8s11.3-1.7,11.3-3.8v-3\tc-2.4,2-6.8,3-11.3,3S2.4,19.6,0,17.6z M24.4,18.2c3.4-0.7,5.6-1.9,5.6-3.2v-2.5c-1.4,1-3.4,1.6-5.6,2V18.2z M11.3,9.4\tC5,9.4,0,11.5,0,14.1s5,4.7,11.3,4.7s11.3-2.1,11.3-4.7S17.5,9.4,11.3,9.4z M24.1,12.7C27.6,12,30,10.8,30,9.4V6.9\tc-2.1,1.5-5.7,2.3-9.4,2.4C22.3,10.2,23.6,11.3,24.1,12.7z",compass:"M13.6,13.6c-0.8,0.8-0.8,2,0,2.7c0.8,0.8,2,0.8,2.7,0c0.8-0.8,0.8-2,0-2.7C15.6,12.9,14.4,12.9,13.6,13.6z M15,0 C6.7,0,0,6.7,0,15s6.7,15,15,15s15-6.7,15-15S23.3,0,15,0z M22.6,9l-4,8.7c-0.2,0.4-0.5,0.8-1,1l-8.7,4c-1,0.5-2-0.6-1.6-1.6l4-8.7 c0.2-0.4,0.5-0.8,1-1l8.7-4C22.1,6.9,23.1,7.9,22.6,9L22.6,9z","conveyor-belt":"M6.8,15h16.5c0.4,0,0.8-0.3,0.8-0.8V3.8C24,3.3,23.7,3,23.3,3H18v6l-3-1.5L12,9V3H6.8C6.3,3,6,3.3,6,3.8v10.5 C6,14.7,6.3,15,6.8,15z M25.5,18h-21C2,18,0,20,0,22.5S2,27,4.5,27h21c2.5,0,4.5-2,4.5-4.5S28,18,25.5,18z M6,24 c-0.8,0-1.5-0.7-1.5-1.5S5.2,21,6,21s1.5,0.7,1.5,1.5S6.8,24,6,24z M15,24c-0.8,0-1.5-0.7-1.5-1.5S14.2,21,15,21s1.5,0.7,1.5,1.5 S15.8,24,15,24z M24,24c-0.8,0-1.5-0.7-1.5-1.5S23.2,21,24,21s1.5,0.7,1.5,1.5S24.8,24,24,24z",database:"M28.1,4.3V7c0,2.4-5.9,4.3-13.1,4.3S1.9,9.3,1.9,7V4.3C1.9,1.9,7.8,0,15,0S28.1,1.9,28.1,4.3z M28.1,10.3v6 c0,2.4-5.9,4.3-13.1,4.3S1.9,18.7,1.9,16.3v-6c2.8,1.9,8,2.8,13.1,2.8S25.3,12.3,28.1,10.3z M28.1,19.7v6c0,2.4-5.9, 4.3-13.1,4.3 S1.9,28.1,1.9,25.7v-6c2.8,1.9,8,2.8,13.1,2.8S25.3,21.6,28.1,19.7z",exchange:"M0,9.8V8.9c0-0.8,0.6-1.4,1.4-1.4h22.4L22,5.9c-0.6-0.5-0.6-1.5,0-2l0.6-0.6c0.5-0.5,1.4-0.5,2,0L29.5,8c0.7,0.7,0.7,1.9,0,2.7l-4.9,4.8c-0.5,0.5-1.4,0.5-2,0L22,14.9c-0.6-0.6-0.5-1.5,0-2l1.8-1.6H1.4C0.6,11.3,0,10.6,0,9.8z M28.6,18.8H6.2L8,17.1c0.6-0.5,0.6-1.5,0-2l-0.6-0.6c-0.5-0.5-1.4-0.5-2,0l-4.9,4.8c-0.7,0.7-0.7,1.9,0,2.7l4.9,4.8c0.5,0.5,1.4,0.5,2,0L8,26.1c0.6-0.6,0.5-1.5,0-2l-1.8-1.6h22.4c0.8,0,1.4-0.6,1.4-1.4v-0.9C30,19.4,29.4,18.8,28.6,18.8z",fire:"M16.4,1.4c0-1.4-1.8-1.9-2.6-0.8c-7.3,10.6,3.1,11.1,3.1,16.2c0,2.1-1.7,3.8-3.8,3.7c-2.1,0-3.7-1.7-3.7-3.8v-5 c0-1.3-1.6-1.9-2.4-1c-1.6,1.6-3.2,4.5-3.2,7.9C3.7,25,8.8,30,15,30s11.2-5,11.2-11.2C26.2,8.8,16.4,7.4,16.4,1.4L16.4,1.4z",fingerprint:"M15,14.4c-0.8,0-1.4,0.6-1.4,1.4c0.1,4.2-0.5,8.3-1.6,12.4c-0.2,0.6,0.1,1.8,1.4,1.8c0.6,0,1.2-0.4,1.4-1\tc0.8-2.8,1.8-7.3,1.7-13.2C16.4,15,15.8,14.4,15,14.4z M15,9.6c-3.6,0-6.1,2.8-6,5.9c0,2.8-0.2,5.6-0.8,8.4\tc-0.2,0.8,0.3,1.5,1.1,1.7c0.8,0.2,1.5-0.3,1.7-1.1c0.6-2.9,0.9-6,0.8-9c0-1.5,1.2-3.1,3.2-3.1c1.8,0,3.3,1.5,3.4,3.3\tc0,2.8-0.2,5.6-0.6,8.4c-0.1,0.8,0.4,1.5,1.2,1.6c1.2,0.2,1.6-0.9,1.6-1.2c0.5-2.9,0.7-5.9,0.7-8.9C21.1,12.4,18.3,9.7,15,9.6\tL15,9.6z M8.5,8.5C7.9,8,7,8.1,6.5,8.7c-1.5,1.8-2.3,4.2-2.3,6.6c0,2.2-0.1,4.4-0.5,6.6c-0.1,0.8,0.4,1.5,1.1,1.6\tc1.2,0.2,1.6-0.9,1.6-1.1C6.9,20,7.1,17.6,7,15.2c0-1.8,0.5-3.4,1.6-4.7C9.2,9.8,9.1,9,8.5,8.5z M14.9,4.8c-0.9,0-1.8,0.1-2.7,0.3\tc-0.8,0.2-1.2,0.9-1,1.7c0.2,0.8,0.9,1.2,1.7,1c0.6-0.2,1.3-0.2,2-0.2c4.4,0.1,8.1,3.6,8.1,7.9c0,2.2-0.1,4.5-0.3,6.7\tc-0.1,0.8,0.5,1.5,1.2,1.6c1,0.1,1.5-0.7,1.6-1.2c0.3-2.3,0.4-4.7,0.3-7C25.7,9.7,20.8,4.9,14.9,4.8L14.9,4.8z M29.7,11.9\tc-0.2-0.8-0.9-1.2-1.7-1.1c-0.8,0.2-1.2,0.9-1.1,1.7c0.3,1.3,0.3,2.2,0.3,3.6c0,0.8,0.6,1.4,1.4,1.4h0c0.8,0,1.4-0.6,1.4-1.4\tC30,14.9,30,13.6,29.7,11.9L29.7,11.9z M27.3,6.6C24.5,2.5,19.8,0.1,14.8,0C10.7,0,6.9,1.5,4.1,4.3C1.4,7-0.1,10.6,0,14.5l0,1.3\tc0,0.8,0.6,1.4,1.4,1.4c0,0,0,0,0,0c0.8,0,1.4-0.6,1.4-1.4l0-1.4c0-3.1,1.1-6,3.3-8.1c2.3-2.3,5.4-3.5,8.7-3.4\tc4.1,0.1,7.9,2.1,10.2,5.4c0.4,0.6,1.3,0.8,2,0.3C27.6,8.1,27.8,7.2,27.3,6.6L27.3,6.6z",gem:"M25.3,1.7L30,10h-5.3l-3.6-8.3H25.3z M18.6,1.7l3.6,8.3H7.8l3.6-8.3H18.6z M4.7,1.7h4.2L5.3,10H0L4.7,1.7z M0,11.7h5.2 l6.4,13.1c0.1,0.2-0.1,0.3-0.3,0.2L0,11.7z M7.7,11.7h14.6l-7.1,16.6c-0.1,0.1-0.2,0.1-0.3,0L7.7,11.7z M18.3,24.8l6.4-13.1H30 L18.6,24.9C18.5,25.1,18.3,24.9,18.3,24.8L18.3,24.8z",link:"M19.1,10.9c3.5,3.5,3.5,9.1,0,12.6c0,0,0,0,0,0l-3.9,3.9c-3.5,3.5-9.1,3.5-12.6,0c-3.5-3.5-3.5-9.1,0-12.6l2.2-2.2\tc0.6-0.6,1.6-0.2,1.6,0.6c0,1,0.2,2.1,0.6,3.1c0.1,0.3,0,0.7-0.2,1L6,18.1c-1.6,1.6-1.7,4.3-0.1,6c1.6,1.7,4.3,1.7,6,0l3.9-3.9\tc1.7-1.7,1.6-4.3,0-6c-0.2-0.2-0.4-0.4-0.6-0.5c-0.2-0.2-0.4-0.4-0.4-0.7c0-0.6,0.2-1.3,0.7-1.7l1.2-1.2c0.3-0.3,0.8-0.4,1.2-0.1\tC18.4,10.2,18.8,10.5,19.1,10.9L19.1,10.9z M27.4,2.6c-3.5-3.5-9.1-3.5-12.6,0l-3.9,3.9c0,0,0,0,0,0c-3.4,3.5-3.5,9.1,0,12.6\tc0.4,0.4,0.8,0.7,1.2,1c0.4,0.3,0.9,0.2,1.2-0.1l1.2-1.2c0.5-0.5,0.7-1.1,0.7-1.7c0-0.3-0.2-0.6-0.4-0.7c-0.2-0.1-0.4-0.3-0.6-0.5\tc-1.6-1.6-1.7-4.3,0-6l3.9-3.9c1.7-1.7,4.4-1.6,6,0c1.6,1.7,1.6,4.3-0.1,6l-0.8,0.8c-0.3,0.3-0.3,0.6-0.2,1c0.3,1,0.5,2.1,0.6,3.1\tc0,0.8,1,1.2,1.6,0.6l2.2-2.2C30.9,11.7,30.9,6.1,27.4,2.6L27.4,2.6z",retweet:"M29.6,16.6l-1.2-1.2c-0.3-0.3-0.9-0.3-1.2,0L25.7,17c-0.4,0.4-1,0.1-1-0.4V6.9c0-1.3-1-2.3-2.3-2.3H14\tc-0.5,0-0.9,0.4-0.9,0.9v1.7c0,0.5,0.4,0.9,0.9,0.9h6.3c0.5,0,0.9,0.4,0.9,0.9v7.6c0,0.5-0.6,0.7-1,0.4l-1.5-1.5\tc-0.3-0.3-0.9-0.3-1.2,0l-1.2,1.3c-0.3,0.3-0.3,0.9,0,1.2l6.1,6.1c0.3,0.3,0.9,0.3,1.2,0l6.1-6.1C29.9,17.5,29.9,17,29.6,16.6z\t M15.7,21.9H9.4c-0.5,0-0.9-0.4-0.9-0.9v-7.6c0-0.5,0.6-0.7,1-0.4l1.5,1.5c0.3,0.3,0.9,0.3,1.2,0l1.2-1.2c0.3-0.3,0.3-0.9,0-1.2\tL7.5,6C7.2,5.7,6.6,5.7,6.3,6l-6.2,6.1c-0.3,0.3-0.3,0.9,0,1.2l1.2,1.2c0.3,0.3,0.9,0.3,1.2,0L4.1,13c0.3-0.3,1-0.1,1,0.4v9.7\tc0,1.3,1.1,2.3,2.4,2.3h8.4c0.5,0,0.9-0.4,0.9-0.9v-1.7C16.6,22.3,16.2,21.9,15.7,21.9L15.7,21.9z",server:"M28.1,9.4H1.9C0.8,9.4,0,8.5,0,7.5V3.8c0-1,0.8-1.9,1.9-1.9h26.3c1,0,1.9,0.8,1.9,1.9v3.8C30,8.5,29.2,9.4,28.1,9.4z\t M25.3,4.2c-0.8,0-1.4,0.6-1.4,1.4S24.5,7,25.3,7s1.4-0.6,1.4-1.4S26.1,4.2,25.3,4.2z M21.6,4.2c-0.8,0-1.4,0.6-1.4,1.4\tS20.8,7,21.6,7S23,6.4,23,5.6S22.3,4.2,21.6,4.2z M28.1,18.8H1.9c-1,0-1.9-0.8-1.9-1.9v-3.8c0-1,0.8-1.9,1.9-1.9h26.3\tc1,0,1.9,0.8,1.9,1.9v3.8C30,17.9,29.2,18.8,28.1,18.8z M25.3,13.6c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4s1.4-0.6,1.4-1.4\tS26.1,13.6,25.3,13.6z M21.6,13.6c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4S23,15.8,23,15S22.3,13.6,21.6,13.6z M28.1,28.1H1.9\tc-1,0-1.9-0.8-1.9-1.9v-3.8c0-1,0.8-1.9,1.9-1.9h26.3c1,0,1.9,0.8,1.9,1.9v3.8C30,27.3,29.2,28.1,28.1,28.1z M25.3,23\tc-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4s1.4-0.6,1.4-1.4S26.1,23,25.3,23z M21.6,23c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4\ts1.4-0.6,1.4-1.4S22.3,23,21.6,23z","shield-check":"M15.3,30h-0.5c-0.2,0-0.4,0-0.5-0.1c-1-0.2-1.9-0.5-2.8-1c-1.7-0.9-3.3-2-4.6-3.4c-1.3-1.3-2.4-2.7-3.2-4.4\tc-0.7-1.3-1.1-2.8-1.1-4.3c0-4.1,0-8.2,0-12.3V4.4c0,0,0,0,0,0c0,0,0.1,0,0.1,0c1.1,0,2.3-0.1,3.4-0.3c1.1-0.2,2.1-0.5,3.2-0.9\tc1.4-0.5,2.7-1.2,4-2C13.9,0.9,14.5,0.5,15,0h0c0,0,0.1,0.1,0.1,0.1c1,0.8,2.1,1.4,3.2,2c1.5,0.7,2.9,1.4,4.5,1.8\tc0.8,0.2,1.7,0.4,2.5,0.4c0.6,0,1.2,0.1,1.8,0.1c0.1,0,0.3,0,0.4,0v0.2c0,4.1,0,8.2,0,12.3c0,0.3,0,0.6,0,0.9\tc-0.1,1.1-0.4,2.1-0.9,3c-0.6,1.4-1.5,2.6-2.5,3.8c-1.7,1.9-3.7,3.5-6,4.6c-0.7,0.3-1.4,0.6-2.1,0.7C15.7,29.9,15.5,30,15.3,30\tL15.3,30z M12.7,20.8c0.2,0.2,0.6,0.3,0.9,0L22.4,10c0.1-0.1,0.1-0.2,0-0.2l-0.8-0.7c-0.1-0.1-0.2-0.1-0.2,0l-8.1,8.3\tc-0.2,0.2-0.5,0.2-0.8,0.1l-3.8-2.7c-0.1-0.1-0.2,0-0.2,0l-0.8,0.9c-0.1,0.1,0,0.2,0,0.2L12.7,20.8L12.7,20.8z",vial:"M29.9,10.6L19.4,0.1c-0.2-0.2-0.5-0.2-0.7,0l-2.1,2.1c-0.2,0.2-0.2,0.5,0,0.7l0.7,0.7L2.1,18.8c-2.4,2.4-2.8,6.4-0.6,9 C2.8,29.2,4.6,30,6.4,30c1.7,0,3.3-0.6,4.6-1.9l15.4-15.4l0.7,0.7c0.2,0.2,0.5,0.2,0.7,0l2.1-2.1C30.1,11.1,30.1,10.8,29.9,10.6z M19.9,15h-9.8l9.3-9.2l4.9,4.9L19.9,15z",vials:"M3.4,6h1.1v11.3c0,2.1,1.7,3.8,3.8,3.8s3.8-1.7,3.8-3.8V6h1.1c0.2,0,0.4-0.2,0.4-0.4V3.4c0-0.2-0.2-0.4-0.4-0.4H3.4 C3.2,3,3,3.2,3,3.4v2.3C3,5.8,3.2,6,3.4,6z M6.8,6h3v4.5h-3V6z M29.3,24H0.8C0.3,24,0,24.3,0,24.8v1.5C0,26.7,0.3,27,0.8, 27h28.5 c0.4,0,0.8-0.3,0.8-0.8v-1.5C30,24.3,29.7,24,29.3,24z M16.9,6H18v11.3c0,2.1,1.7,3.8,3.8,3.8s3.8-1.7,3.8-3.8V6h1.1 C26.8,6,27,5.8,27,5.6V3.4C27,3.2,26.8,3,26.6,3h-9.8c-0.2,0-0.4,0.2-0.4,0.4v2.3C16.5,5.8,16.7,6,16.9,6z M20.3,6h3v4.5h-3V6z"}},{}],23:[function(e,t,n){n.createGroup=function(e,t){let n=[e];return Array.isArray(t)&&(n=n.concat(t)),React.DOM.g.apply(React.DOM.g,n)},n.createRect=function(e){return React.DOM.rect(e)},n.createRectImg=function(e){let t=React.DOM.image({x:e.x,y:e.y,width:e.width,height:e.height,xlinkHref:e.href}),n=React.DOM.pattern({patternUnits:"userSpaceOnUse",width:"100%",height:"100%",id:e.id},t);return React.DOM.defs(null,n)},n.createText=function(e){return React.DOM.text(e)},n.createCircle=function(e){return React.DOM.circle(e)},n.createPath=function(e){return React.DOM.path(e)},n.createPolygon=function(e){return React.DOM.polygon(e)},n.createImg=function(e){return TheGraph.SVGImage(e)},n.createCanvas=function(e){return React.DOM.canvas(e)},n.createSvg=function(e,t){let n=[e];return Array.isArray(t)&&(n=n.concat(t)),React.DOM.svg.apply(React.DOM.svg,n)},n.createAppDefs=function(){return React.DOM.defs({dangerouslySetInnerHTML:{__html:'<linearGradient id="icon-gradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(255,255,255);stop-opacity:0.6" /></linearGradient>'}})},n.strlen=function(e){let t=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);o>=1&&o<=126||65376<=o&&o<=65439?t++:t+=2}return t},n.strsub=function(e,t){let n=0,o=[],r="";const i=t-3;for(let a=0;a<e.length&&!(o.length>1);a++){let s=e.charCodeAt(a);s>=1&&s<=126||65376<=s&&s<=65439?n++:n+=2,r+=e[a],1==o.length&&n>=i&&a<e.length-1?(o.push(r+"..."),r="",n=0):Math.floor(n/t)>=1&&(o.push(r),r="",n=0)}return""!=r&&o.push(r),o}},{}],24:[function(e,t,n){t.exports.register=function(e){e.TheGraph.FONT_ICON={"500px":"",check:"",close:"",cog:"",jingshi:"",code:"",shouqi2:"",zhankai2:"",luansheng:"",cuowu:"",drag:"",xiangji:"",tuxiangcaiji:"",lingjianguanli:"",yibu:"",tongbu:"",huaxiaquexianxiaci:"",hanshu:"",weibiaoti:"",shengbochuanshu:"",tuichu:"",kongzhi:"",pianhao:"",bangzhuwendang:"",yonghu:"",yunhangshibai:"",yunhangchenggong:"",bangzhu:"",rizhi:"",OTSshuchu:"","quxiantu-mianji":"",tianchong:"",hebing:"",wenbenwenjian:"",neirongjuhe:"",lianjieguanxi:"",zhuanzhi:"",redisyunshujukuRedisban:"",dingshirenwu:"",shujuqingxi:"",zuidahua:"",huanyuan:"",strikethrough:"",jianmofangzhen:"",qianmianban:"",moxingyuce:"",shujuduxie:"",shujuchuli:"",luojikongzhi:"",kaifagongju:"",RPA:"",fuwu:"",tuxiangchuli:"",date:"",chanpin:"","uncheck-circle":"",checked:"","close-circle":"","warning-circle":"","check-circle":"",spinner:"","chart-area":"",fire:"",gem:"",link:"",signature:"",coins:"",random:"",vial:"",database:"",vials:"","conveyor-belt":"",clone:"",globe:"",server:"",retweet:"",burn:"",atlas:"",fingerprint:"",bong:"","code-commit":"","chart-line":"","cloud-upload-alt":"",compass:"",flask:"","shield-check":"",adjust:"",exchange:"",microchip:"","code-branch":"",blanket:"","shekel-sign":"","angle-double-down":"","full-screen":"",sun:"",history:"",cube:"",home:"",shebei:"",jinggao:"",xunwen:"",folder1:"",logout:"","mini-dot":"",view:"",download:"",language:"",user1:"",move:"",yunshujuku:"",spin:"",add:"",minus:"",right:"",down:"",copy1:"",chakanxiangqing:"",shanchu:"",gouxuan:"",del:"",xuanzhong:"",yincang:"",ziduan:"",toggle:"",edit:"",copy:"",share:"",delete:"",folder:"",xiala:"",shangla:"",zuo:"",you:"",dakai:"",chakan:"",gailan:"","shezhi-copy":"",zhihangtiaoyou:"",sousuo:"",suanfazujian:"",shoucang:"",zujian:"",neizhizujian:"",fenxiang1:"",gengduo:"",yunxing:"","zuhe-":"",dasan:"",xuanze:"",suoxiao:"",fangda:"",baocun:"",kan:"","shiyong-bai":"",shijian:"","shaixuan-bai":"","moban-bai":"",fangdajing:"",xinjianxiangmu:"","xiangmu-bai":"","zhuye-hui":"",xiazai:"","zhuce-bai":"","shoucang-bai":"","zhuye-bai":"",jia:"",zhiliangguanli:"",Pdf:"",moban:"",zhuye:"",quanbuxiangmu:"",RPAkaifa:"",jilikaifa:"",liuchengwajue:"",bianyuanjisuan:"",gongyechengxu:"",AIkaifa:""}}},{}],25:[function(e,t,n){t.exports=function(e,t,n){if(Array.isArray(e)||Array.isArray(t)||"object"!=typeof e||"object"!=typeof t)return t;n=n||!1;for(let o in e)"function"==typeof e[o]||t[o]&&!n||(t[o]=e[o]);return t}},{}],26:[function(e,t,n){let o={componentWillUnmount:function(){this._ismounted=!1},showTooltip:function(e){if(!this.shouldShowTooltip())return;const t=_.get(e,"target.id","");let n=new CustomEvent("the-graph-tooltip",{detail:{nodeId:t,tooltip:this.props.label,x:e.offsetX,y:e.offsetY,isIn:this.props.isIn},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(n),this.setState({tooltipId:t})},hideTooltip:function(e){const t=_.get(e,"target.id","");if(t===this.state.tooltipId||this.state.tooltip&&this.shouldShowTooltip()){this.setState({tooltipId:null});let e=new CustomEvent("the-graph-tooltip-hide",{detail:{nodeId:t},bubbles:!0});this._ismounted&&ReactDOM.findDOMNode(this).dispatchEvent(e)}},componentDidMount:function(){if(this._ismounted=!0,navigator&&-1!==navigator.userAgent.indexOf("Firefox"))return;let e=this.getTooltipTrigger();e.addEventListener("tap",this.showTooltip),e.addEventListener("mouseenter",this.showTooltip),e.addEventListener("mouseleave",this.hideTooltip)}};t.exports={Tooltip:o}},{}],27:[function(e,t,n){let o=window.unwrap?window.unwrap:function(e){return e},r={27:function(e){e.refs.graph&&e.refs.graph.cancelPreviewEdge()}},i=[70,83,27];t.exports.register=function(e){let t=e.TheGraph;t.config.app={container:{className:"the-graph-app",name:"app"},canvas:{ref:"canvas",className:"app-canvas"},svg:{className:"app-svg",ref:"svg"},svgGroup:{className:"view"},graph:{ref:"graph"},tooltip:{ref:"tooltip"},modal:{className:"context"}},t.factories.app={createAppContainer:function(e,t){let n=[e];Array.isArray(t)&&(n=n.concat(t));return React.DOM.div.apply(React.DOM.div,n)},createAppCanvas:t.factories.createCanvas,createAppSvg:t.factories.createSvg,createAppSvgGroup:t.factories.createGroup,createAppGraph:function(e){return t.Graph(e)},createAppModalGroup:t.factories.createGroup,createAppModalBackground:function(e){return t.ModalBG(e)}};let n=[];window.React.Animate&&n.push(React.Animate),t.App=React.createClass({displayName:"TheGraphApp",mixins:n,getDefaultProps:function(){return{width:null,height:null,readonly:!1,nodeIcons:{},minZoom:.15,maxZoom:15,offsetX:0,offsetY:0,menus:null,showScriptEditIcon:!1,getMenuDef:null,onPanScale:null,onNodeSelection:null,onNodeRectImgDblclick:null,onEdgeSelection:null,onClickEdgeCode:null,onGroupSelection:null,onExpandIconClicked:null}},getInitialState:function(){return{x:this.props.x,y:this.props.y,scale:this.props.scale||1,width:this.props.width,height:this.props.height,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,trackStartX:null,trackStartY:null,theme:appConfig.theme||"light",contextElement:null,contextType:null,offsetY:this.props.offsetY,offsetX:this.props.offsetX}},zoomFactor:0,zoomX:0,zoomY:0,onWheel:function(e){e.preventDefault(),this.zoomFactor||(this.zoomFactor=0),this.zoomFactor+=e.deltaY?e.deltaY:0-e.wheelDeltaY,this.zoomX=e.clientX-this.domNodeRect.x,this.zoomY=e.clientY-this.domNodeRect.y,requestAnimationFrame(this.scheduleWheelZoom)},scheduleWheelZoom:function(){if(isNaN(this.zoomFactor))return;let e=this.zoomFactor/-500;e=Math.min(.5,Math.max(-.5,e));let t=this.state.scale+this.state.scale*e;if(this.zoomFactor=0,t<this.state.minZoom?t=this.state.minZoom:t>this.state.maxZoom&&(t=this.state.maxZoom),t===this.state.scale)return;let n=t/this.state.scale,o=this.state.x,r=this.state.y,i=this.zoomX,a=this.zoomY,s=n*(o-i)+i,c=n*(r-a)+a;this.setState({scale:t,x:s,y:c},()=>{this.props.onMoved(s,c,t)})},lastScale:_.get(this.props,"scale")||1,lastX:0,lastY:0,pinching:!1,onTrackStart:function(e){let t=document.getElementById("editor");t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.moved=!1,this.setState({trackStartX:e.pageX,trackStartY:e.pageY})},onTrack:function(e){this.movedX=e.pageX-this.state.trackStartX,this.movedY=e.pageY-this.state.trackStartY,(Math.abs(this.movedX)>=5||Math.abs(this.movedY)>=5)&&(this.moved=!0,this.setState({x:this.state.x+this.movedX,y:this.state.y+this.movedY,trackStartX:e.pageX,trackStartY:e.pageY}))},onTrackEnd:function(e){this.moved=!1;let t=document.getElementById("editor");t.removeEventListener("mousemove",this.onTrack),t.removeEventListener("mouseup",this.onTrackEnd),this.setState({trackStartX:null,trackStartY:null}),this.props.onMoved(this.state.x,this.state.y,this.state.scale)},onPanScale:function(){this.props.onPanScale&&this.props.onPanScale(this.state.x,this.state.y,this.state.scale)},defaultGetMenuDef:function(e){if(e.type&&this.props.menus&&this.props.menus[e.type]){let t=this.props.menus[e.type];return t.callback?t.callback(t,e):t}return null},showContext:function(e){this.setState({contextMenu:e})},hideContext:function(e){this.setState({contextMenu:null})},triggerFit:function(e){let n=t.findFit(this.props.graph,this.props.width,this.props.height);this.setState({x:n.x,y:n.y,scale:n.scale})},focusNode:function(e){let n=t.config.focusAnimationDuration,o=t.findNodeFit(e,this.state.width,this.state.height),r={x:-(this.state.x-this.state.width/2)/this.state.scale,y:-(this.state.y-this.state.height/2)/this.state.scale},i={x:e.metadata.x,y:e.metadata.y},a=t.findAreaFit(r,i,this.state.width,this.state.height),s=Math.abs(a.scale-this.state.scale),c=Math.abs(o.scale-a.scale),l=s+c;this.animate?this.animate({x:a.x,y:a.y,scale:a.scale},n*(s/l),"in-quint",function(){this.animate({x:o.x,y:o.y,scale:o.scale},n*(c/l),"out-quint")}.bind(this)):this.setState({x:o.x,y:o.y,scale:o.scale})},edgeStart:function(e){this.refs.graph.edgeStart(e),this.hideContext()},updateDomOffset:function(){const e=ReactDOM.findDOMNode(this.refs.svg);this.domNodeRect=e.getBoundingClientRect()},componentDidMount:function(){let e=ReactDOM.findDOMNode(this.refs.svg);e.addEventListener("click",this.unselectAll),e.addEventListener("mousedown",this.onTrackStart),this.props.showContext&&(e.addEventListener("contextmenu",this.onShowContext),e.addEventListener("press",this.onShowContext)),void 0!==e.onwheel?e.addEventListener("wheel",this.onWheel):void 0!==e.onmousewheel&&e.addEventListener("mousewheel",this.onWheel),e.addEventListener("the-graph-edge-start",this.edgeStart);let t=o(ReactDOM.findDOMNode(this.refs.canvas));this.bgContext=o(t.getContext("2d")),this.componentDidUpdate(),setTimeout(function(){this.renderGraph()}.bind(this),500)},onShowContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:"main",x:t,y:n,graph:this.props.graph,itemKey:"graph",item:this.props.graph})},keyDown:function(e){(e.metaKey||e.ctrlKey)&&(t.metaKeyPressed=!0);let n=e.keyCode,o=r[n];if(o){let e=this.props.readonly;(!e||e&&i[n])&&o(this)}},keyUp:function(e){t.metaKeyPressed&&(t.metaKeyPressed=!1)},unselectAll:function(e){this.moved||(this.props.onNodeSelection&&this.props.onNodeSelection(e),this.props.onNodeRectImgDblclick&&this.props.onNodeRectImgDblclick(e),this.props.onEdgeSelection&&this.props.onEdgeSelection(),this.props.onGroupSelection&&this.props.onGroupSelection())},renderGraph:function(){this.refs.graph.markDirty({allNodeDirty:!0})},componentDidUpdate:function(e,t){t&&t.x===this.state.x&&t.y===this.state.y&&t.scale===this.state.scale||this.onPanScale(),t&&t.width===this.state.width&&t.height===this.state.height||this.updateDomOffset()},renderCanvas:function(e){e.clearRect(0,0,this.state.width,this.state.height);let n=this.state.scale,o=t.config.nodeSize*n,r=(this.state.x,this.state.y,Math.floor(this.state.width/o)+1),i=Math.floor(this.state.height/o)+1;Math.floor(this.state.x/o),this.state.x,Math.floor(this.state.y/o),this.state.y;for(;i--;){let t=r;for(;t--;){let n=Math.round(t*o),r=Math.round(i*o);e.strokeStyle="#f0f0f0",e.beginPath(),e.moveTo(n+o,r),e.lineTo(n,r),e.lineTo(n,r+o),e.stroke()}}},getContext:function(e,n,o){return t.Menu({menu:e,options:n,triggerHideContext:o,label:"Hello",graph:this.props.graph,node:this,ports:[],process:[],processKey:null,x:n.x,y:n.y,nodeWidth:this.props.width,nodeHeight:this.props.height,deltaX:0,deltaY:0,highlightPort:!1})},render:function(){const{x:e,y:n,scale:o,width:r,height:i,showPortDataNodes:a,theme:s}=this.state,c="matrix("+o+",0,0,"+o+","+e+","+n+")",l=o>t.zbpBig?"big":o>t.zbpNormal?"normal":"small";let p=null,d=this.props.getMenuDef||this.defaultGetMenuDef;if(this.state.contextMenu){let e=this.state.contextMenu,t=d(e);t&&Object.keys(t).length&&(p=e.element.getContext(t,e,this.hideContext))}let u=null;if(p){let e={width:r,height:i,triggerHideContext:this.hideContext,children:p};u=[t.factories.app.createAppModalBackground(e)],this.menuShown=!0}else this.menuShown=!1;let h={graph:this.props.graph,scale:o,app:this,moved:this.moved,library:this.props.library,nodeIcons:this.props.nodeIcons,theme:s,onNodeSelection:this.props.onNodeSelection,onNodeRectImgDblclick:this.props.onNodeRectImgDblclick,onEdgeSelection:this.props.onEdgeSelection,onClickEdgeCode:this.props.onClickEdgeCode,onGroupSelection:this.props.onGroupSelection,onExpandIconClicked:this.props.onExpandIconClicked,showContext:this.props.showContext,showPortDataNodes:a,allowEdgeStart:!this.props.readonly,showScriptEditIcon:this.props.showScriptEditIcon};h=t.merge(t.config.app.graph,h);let f=t.factories.app.createAppGraph.call(this,h),g=t.merge(t.config.app.svgGroup,{transform:c}),m=t.factories.app.createAppSvgGroup.call(this,g,[f]),v=t.merge(t.config.app.modal,{children:u}),y=[m,t.factories.app.createAppModalGroup.call(this,v)],b=t.merge(t.config.app.svg,{width:r,height:i,version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"}),w=t.factories.app.createAppSvg.call(this,b,y),x=t.merge(t.config.app.canvas,{width:r,height:i}),C=[t.factories.app.createAppCanvas.call(this,x),w],S=t.merge(t.config.app.container,{style:{width:r,height:i}});return S.className+=" "+l,t.factories.app.createAppContainer.call(this,S,C)}})}},{}],28:[function(e,t,n){t.exports={applyToGraph:function(e,t,n){console.error("DEPRECATED: TheGraph.autolayout.applyAutolayout() will be removed in next version");let o,r,i=t.children.slice();for(o=0,r=i.length;o<r;o++){let t=i[o],r=e.getNode(t.id);if(t.children){let o,r=t.children;for(o in r){let i=r[o];i.id&&e.setNodeMetadata(i.id,{x:Math.round((t.x+i.x)/n.snap)*n.snap,y:Math.round((t.y+i.y)/n.snap)*n.snap})}}if(r)e.setNodeMetadata(t.id,{x:Math.round(t.x/n.snap)*n.snap,y:Math.round(t.y/n.snap)*n.snap});else{let o=t.id.split(":::"),r=o[0],i=o[1];"inport"===r&&e.inports[i]?e.setInportMetadata(i,{x:Math.round(t.x/n.snap)*n.snap,y:Math.round(t.y/n.snap)*n.snap}):"outport"===r&&e.outports[i]&&e.setOutportMetadata(i,{x:Math.round(t.x/n.snap)*n.snap,y:Math.round(t.y/n.snap)*n.snap})}}}}},{}],29:[function(e,t,n){t.exports.register=function(e){const t=function(e,t){const n={light:!0,text:"#fff"};if(!e)return n;let o=null,r=1;var i;if(0==e.indexOf("#")&&(o=(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(function(e){var t=""+e,n=(t=0===t.indexOf("#")?t.slice(1,7):t.slice(0,6)).length;switch(n){case 3:t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`;break;case 5:t+=t[4];break;default:for(var o=0;o<6-n;o++)t+="0"}return"#"+t}(e)))?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null),e.indexOf("rgb")>-1){const t=e.indexOf("(")+1,n=e.indexOf(")");(o=e.slice(t,n).split(",").map(e=>Number(e.trim()))).length>3&&(r=o.pop(3))}return(o.findIndex(e=>e<160)>-1||r<.4)&&(t||(n.text="#fff"),n.light=!1),n};let n=e.TheGraph;n.config.comment={snap:n.config.nodeSize},n.factories.comment={createCommentGroup:n.factories.createGroup,createCommentBackgroundRect:n.factories.createRect,createComment:n.factories.createText},n.Comment=React.createFactory(React.createClass({displayName:"TheGraphComment",gutter:{.5:6,1:8,2:12},labelHeight:{.5:6,1:30,2:45},fontSize:{.5:12,1:12,2:14},getInitialState:function(){const{color:e,size:n}=this.props,o=t(e,n<1);return{labelSize:this.fontSize[n],lastTrackX:null,lastTrackY:null,lastNodeData:{},nodeColor:o}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.onTrackStart),this.props.onNodeSelection&&e.addEventListener("click",this.onNodeSelection)},componentWillReceiveProps(e){if(e.scale!==this.props.scale||e.size!==this.props.size){let t=this.state.labelSize;t=e.scale>=1.5?this.fontSize[e.size]-2:this.fontSize[e.size],this.setState({labelSize:t})}},shouldComponentUpdate(e){return e.dirty||e.x!==this.props.x||e.y!==this.props.y||e.selected!==this.props.selected||!0===e.ports.dirty},doCancel:function(e){e.stopPropagation(),e.stopImmediatePropagation()},onNodeSelection:function(e){e.stopPropagation(),e.stopImmediatePropagation();let t=n.metaKeyPressed||"touch"===e.pointerType;this.props.onNodeSelection(e,this.props.nodeID,this.props.node,t)},onTrackStart:function(e){e.stopPropagation();let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.export?this.props.graph.startTransaction("moveexport"):this.props.graph.startTransaction("movenode"),this.lastTrackX=e.pageX,this.lastTrackY=e.pageY,!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,n=e.pageY,o=t-this.lastTrackX,r=n-this.lastTrackY;this.lastTrackX=t,this.lastTrackY=n;let i=this.props.app.state.scale,a=Math.round(o/i),s=Math.round(r/i);this.props.graph.setNodeMetadata(this.props.nodeID,{x:this.props.node.metadata.x+a,y:this.props.node.metadata.y+s})},onTrackEnd:function(e){let t=document.getElementById("editor");t.removeEventListener("mousemove",this.onTrack),t.removeEventListener("mouseup",this.onTrackEnd);const{movementX:o,movementY:r}=e;if(0!==o&&0!==r){let e=!0,t=parseFloat(n.config.nodeHeight)/20;e&&this.props.graph.setNodeMetadata(this.props.nodeID,{x:Math.round(this.props.node.metadata.x/t)*t,y:Math.round(this.props.node.metadata.y/t)*t})}this.props.export?this.props.graph.endTransaction("moveexport"):this.props.graph.endTransaction("movenode")},showContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"node",x:t,y:n,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:this.props.nodeID,item:this.props.export?this.props.export:this.props.node})},renderLabel:function(){const{labelSize:e,nodeColor:t}=this.state,{label:o,width:r,height:i,size:a}=this.props,s=i-this.labelHeight[`${a}`],c=a>=1?t.text:"#fff";let l=Math.floor((r-10)/e*2);const p=a<2?e:Math.floor(1.4*e),d=a<1?this.gutter[`${a}`]/2+e:s+this.labelHeight[`${a}`]/2+e/3;let u=React.createElement("tspan",{x:10,y:d+2*p},o);if(a>=1&&n.factories.strlen(o)>l){n.factories.strlen(o)>o.length&&(l/=1.5);const t=n.factories.strsub(o,l*Math.ceil(i/e));u=[];let r=0,a=t.slice(r,r+l-1),s=1;for(;a;)u.push(React.createElement("tspan",{x:5,y:d+p*s},a)),s++,r+=l,a=t.slice(r,r+l-1)}let h=n.merge(n.config.node.labelText,{x:e,y:d+2*p,children:u,fill:c,style:{"font-size":e+"px"}}),f=n.factories.node.createNodeLabelText.call(this,h);return labelGroup=n.factories.node.createNodeLabelGroup.call(this,n.config.node.labelBackground,[f]),{label:o,labelGroup:labelGroup}},renderRects:function(){const{width:e,height:t,color:o,size:r}=this.props,i=n.merge(n.config.node.border,{width:e,height:t,fill:"rgba(255,255,255,.6)"});return{borderRectOptions:i,borderRect:n.factories.node.createNodeBorderRect.call(this,i)}},render:function(){this.props.ports.dirty&&(this.props.ports.dirty=!1);let e=this.props.x,t=this.props.y;const{borderRect:o}=this.renderRects(),{label:r,labelGroup:i}=this.renderLabel();let a=[o,i];const s=n.merge({},{id:this.props.nodeID,className:"node drag "+this.props.node.metadata.def.theme+" "+(this.props.selected?" selected":"")+(this.props.error?" error":""),name:this.props.nodeID,key:this.props.nodeID,title:r,transform:"translate("+e+","+t+")"});return n.factories.comment.createCommentGroup.call(this,s,a)}}))}},{}],30:[function(e,t,n){const o=["#55dcfa","#5579fa","#f15f33","#ec3be3","#33f1b5","#1e81b0","#e28743","#eab676","#76b5c5","#873e23","#063970"];function r(e,t,n={}){e&&e instanceof Array&&t&&(this.animate=this.animate.bind(this),this.edges=e,this.runningAnimation=null,this.currentAnimation=null,this.animationTimer=0,this.animationEndTime=Number.MAX_VALUE,this.animationQueue=this.prepareAnimationData(e,t),this.ballColor=o[Math.floor(10*Math.random()%o.length)],this.onStart=n.onStart||null,this.onEnd=n.onEnd||null)}r.prototype.animate=function(){if(this.animationTimer>this.endTime)return cancelAnimationFrame(this.runningAnimation),void(this.onEnd&&this.onEnd());this.animationQueue.forEach(e=>{const{startTime:t=0,messages:n=[],started:o=!1}=e;this.animationTimer>=t&&!o&&n.forEach(t=>{const{edge:n={},duration:o=0}=t,r=`edge-${n.from.node}-${n.from.port}-${n.to.port}-${n.to.node}`,i=document.getElementById(r);if(i){const t=i.querySelectorAll(".edge-flow"),n=t[0];if(n){const r=n.cloneNode(),i=n.parentNode,a=n.getAttribute("d");if(a){const t=`<animateMotion path="${a}" begin="0s" dur="${o}s" repeatCount="1"></animateMotion>`;r.insertAdjacentHTML("beforeend",t),r.setAttribute("fill",this.ballColor),i.appendChild(r),r.classList.remove("hide"),r.querySelector("animateMotion").beginElement(),e.started=!0}t.length>100&&t[1].remove()}}})}),this.animationTimer+=60,this.runningAnimation=requestAnimationFrame(this.animate)},r.prototype.destroy=function(){},r.prototype.prepareAnimationData=function(e,t){const n=[],o={};let r=+Date.now();return this.endTime=0,Object.keys(t).forEach(i=>{t[i].messages.forEach(t=>{const i=t.source,a=t.target,s=i.timestamp,c=parseFloat(a.timestamp)-parseFloat(i.timestamp),l=e.find(e=>e.from.node===i.node_id&&e.from.port===i.port&&e.to.node===a.node_id&&e.to.port===a.port);l&&(r=Math.min(s,r),this.endTime=Math.max(this.endTime,s+c),o[s]?o[s].messages.push({edge:l,duration:c}):n.push({startTime:s,messages:[{edge:l,duration:c}]}))})}),n.forEach(function(e){e.startTime=e.startTime-r}),n.sort(function(e,t){return e.startTime<=t.startTime?-1:1}),n},r.prototype.reset=function(){this.runningAnimation&&cancelAnimationFrame(this.runningAnimation),this.animationTimer=0,this.runningAnimation=null,this.animationQueue=[]},r.prototype.setAnimationData=function(e){this.reset(),this.ballColor=o[Math.floor(10*Math.random()%o.length)],this.animationQueue=this.prepareAnimationData(this.edges,e)},t.exports=r},{}],31:[function(e,t,n){const o=e("./constants").iconSvgD.alert,r=e("./constants").iconSvgD.code;t.exports.register=function(e){let t=e.TheGraph;t.config.edge={curve:t.config.nodeSize,container:{className:"edge"},defaultColor:"#a6a6a6",backgroundPath:{className:"edge-bg"},foregroundPath:{ref:"route",className:"edge-fg stroke route"},flowPath:{className:"edge-flow hide",fill:"#55dcfa",cx:"0",cy:"0",r:"4"},autoPath:{ref:"route",className:"edge-auto stroke route"},touchPath:{className:"edge-touch",ref:"touch"},alertIcon:{className:"edge-alert",d:o,fill:"#FF6161",r:8},codeIcon:{className:"edge-code",d:r,fill:"#0084FF",r:8},portStart:{className:"edge-port edge-port-start",r:3,ref:"edgePortStart"},portEnd:{className:"edge-port edge-port-end",ref:"edgePortEnd"},port:{className:"edge-port",r:3}},t.factories.edge={createEdgeGroup:t.factories.createGroup,createEdgeBackgroundPath:t.factories.createPath,createEdgeForegroundPath:t.factories.createPath,createEdgeTouchPath:t.factories.createPath,createArrow:t.factories.createPolygon,createCircle:t.factories.createCircle,createIconSvg:t.factories.createPath},t.Edge=React.createFactory(React.createClass({displayName:"TheGraphEdge",space:{source:t.config.edge.port.r+t.config.port.size,target:2*t.config.edge.port.r+t.config.port.size},distance:t.config.edgeDistance,getInitialState:function(){return{path:void 0,ports:void 0}},componentWillMount:function(){const{angle:e,sX:t,sY:n,tX:o,tY:r,path:i,isPreview:a,updating:s}=this.props;i?this.initEdgePorts():this.setEdgePath(e,t,n,o,r,a,s)},componentDidMount:function(){const e=$(ReactDOM.findDOMNode(this));let t=this;if(t.handleMouseMove=t.handleMouseMove.bind(t),t.handleMouseUp=t.handleMouseUp.bind(t),!this.props.isPreview){e.on("mouseenter.edge",function(t){e.addClass("over")}),e.on("mouseleave.edge",function(t){e.removeClass("over")}),e.on("mousedown.edge",function(e){if(e.stopPropagation(),"path"!==e.target.tagName||t.state.ports.length<6)return;const n=e.target.getAttribute("class"),o=("edge-alert"===n||"edge-code"===n?e.target.parentNode.parentNode.querySelector(".edge-bg"):e.target).getBoundingClientRect();t.moveStart={x:e.clientX,y:e.clientY,domRect:o,ports:t.state.ports}}),this.$graph=$(document.querySelector(".the-graph-app")),this.$graph.on("mousemove",t.handleMouseMove),this.$graph.on("mouseup",t.handleMouseUp),e.on("click.edge",function(e){e.stopPropagation(),e.stopImmediatePropagation(),t.props.onEdgeSelection&&t.props.onEdgeSelection(t.props.edgeID,t.props.edge)}),e.on("click",".scripts",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),t.props.onClickEdgeCode){const n=e.currentTarget.getAttribute("data-direction");t.props.onClickEdgeCode(t.props.edge.from,t.props.edge.to,t.props.edge.metadata,n)}}),e.on("mousedown.edge.edgePorts",this.edgeStart);const{angle:n,sX:o,sY:r,tX:i,tY:a,isPreview:s,updating:c}=t.props;t.setEdgePath(n,o,r,i,a,s,c)}},componentWillReceiveProps:function(e){const{angle:t,sX:n,sY:o,tX:r,tY:i,isPreview:a,updating:s}=e;a===this.props.isPreview&&this.props.tX===r&&this.props.tY===i&&this.props.sX===n&&this.props.sY===o||this.setEdgePath(t,n,o,r,i,a,s)},shouldComponentUpdate:function(e,t){return e.color!==this.props.color||e.size!==this.props.size||e.hidden!==this.props.hidden||e.selected!==this.props.selected||e.animated!==this.props.animated||e.route!==this.props.route||e.inScript!==this.props.inScript||e.outScript!==this.props.outScript||e.error!==this.props.error||t.path!==this.state.path},componentWillUnmount:function(){this.$graph&&this.$graph.off("mousemove",this.handleMouseMove),this.$graph&&this.$graph.off("mouseup",this.handleMouseUp)},handleMouseMove:function(e){this.moveStart&&(Math.abs(e.clientY-this.moveStart.y)>10||Math.abs(e.clientX-this.moveStart.x)>10)&&this.handleResetEdge({x:e.clientX,y:e.clientY})},handleMouseUp:function(e){if(this.moveStart){this.moveStart=null;const{from:e,to:t,metadata:n}=this.props.edge,{path:o}=this.state;this.props.onUpdatePath(e,t,Object.assign({},n,{path:o,custom:!0}))}},getPositons:function(e,t,n,o){let r=t,i=n;switch(e){case 0:r=(t+=o)+this.distance;break;case 90:i=(n-=o)-this.distance;break;case 180:r=(t-=o)-this.distance;break;case 270:i=(n+=o)+this.distance}return[{x:t,y:n},{x:r,y:i}]},updatePorts:function(e,t){const n=this.state.ports;let o="x";if((e[0].x===e[1].x&&Math.abs(t[1].y-e[0].y)<Math.abs(t[1].y-e[1].y)||e[0].y===e[1].y&&Math.abs(t[1].x-e[0].x)>=Math.abs(t[1].x-e[1].x))&&(o="y"),n[0].x!==e[0].x||n[0].y!==e[0].y)n[0]=e[0],n[1]=e[1],n[2][o]=e[1][o];else{const e=n.length-1;n[e-1]=t[1],n[e]=t[0],n[e-2][o]=t[1][o]}return n},getPorts:function(e,t){let n=[e[0],e[1]];if(e[0].x===e[1].x)if(t[1].y>=e[1].y)if(t[1].x==t[0].x){const o=e[1].y+.5*(t[1].y-e[1].y);n.push({x:e[0].x,y:o},{x:t[1].x,y:o})}else if(e[1].x>t[1].x){let o=e[0].y+.5*(t[1].y-e[0].y);o<e[1].y&&(o=e[1].y),n.push({x:e[0].x,y:o},{x:t[1].x,y:o})}else n.push({x:e[0].x,y:t[1].y});else if(t[1].x===t[0].x){const o=e[1].x+.5*(t[1].x-e[1].x);n.push({x:o,y:e[1].y},{x:o,y:t[1].y})}else if(e[1].x>=t[1].x)n.push({x:t[1].x,y:e[1].y});else{let o=e[1].x+.5*(t[0].x-e[1].x);o>t[1].x&&(o=t[1].x),n.push({x:o,y:e[1].y},{x:o,y:t[1].y})}else if(e[0].y===e[1].y)if(t[1].x>=e[1].x)if(t[1].y==t[0].y){const o=e[1].x+.5*(t[1].x-e[1].x);n.push({x:o,y:e[1].y},{x:o,y:t[1].y})}else if(e[1].y>t[1].y){let o=e[0].x+.5*(t[1].x-e[0].x);o<e[1].x&&(o=e[1].x),n.push({x:o,y:e[1].y},{x:o,y:t[1].y})}else n.push({x:t[1].x,y:e[1].y});else if(t[1].y==t[0].y){const o=e[1].y+.5*(t[1].y-e[1].y);n.push({x:e[1].x,y:o},{x:t[1].x,y:o})}else if(e[1].y>=t[1].y)n.push({x:e[1].x,y:t[1].y});else{let o=e[1].y+.5*(t[0].y-e[1].y);o>t[1].y&&(o=t[1].y),n.push({x:e[1].x,y:o},{x:t[1].x,y:o})}return n.push(t[1]),n.push(t[0]),n},getPath:function(e){let t=`M${e[0].x},${e[0].y}`;return e.slice(1).forEach(function({x:e,y:n}){t+=` L${e},${n}`}),t},getSpace:function(){const{isPreview:e,updating:n,isIn:o}=this.props,r={s:0,t:0};return e?n?o?r.t=this.space.target:(r.s=this.space.source,r.t=2*t.config.edge.port.r):(r.s=0,r.t=this.space.target):(r.s=this.space.source,r.t=this.space.target),r},getQuadrant:function(e,t){return e.x>t.x&&e.y>t.y?"4":e.x<t.x&&e.y<t.y?"2":e.x>t.x&&e.y<t.y?"1":e.x<t.x&&e.y>t.y?"3":void 0},setEdgePath:function(e,n,o,r,i,a,s){const c=this.getSpace();let{ports:l}=this.state;"dark"==appConfig.theme&&(o+=t.config.portSize/2,i+=t.config.portSize/2);const p=this.getPositons(e.source,n,o,c.s),d=this.getPositons(e.target,r,i,c.t);let u=this.props.custom;const h=this.getQuadrant(d[1],p[1]);let f;const g=this.state.angle;_.isEmpty(l)||(f=this.getQuadrant(l[l.length-1],l[0])),!u||u&&(f!==h||e.source!==g.source||e.target!==g.target)?(l=this.getPorts(p,d),u=!1):l=this.updatePorts(p,d,u);const m=this.getPath(l);this.setState({angle:e,ports:l,path:m},()=>{if(!a){const{from:e,to:t,metadata:n}=this.props.edge;this.props.onUpdatePath(e,t,Object.assign({},n,{path:m,custom:u}))}})},handlePathToPorts:function(e){return e.split(" ").map(function(e){const t=e.slice(1).split(",");return{x:_.toNumber(t[0]),y:_.toNumber(t[1])}})},initEdgePorts:function(){const{path:e,angle:t}=this.props,n=this.handlePathToPorts(e);this.setState({angle:t,ports:n,path:e})},showContext:function(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"edge",x:t,y:n,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:null,item:this.props.export?this.props.export:this.props.edge})},getContext:function(e,n,o){return t.Menu({menu:e,options:n,triggerHideContext:o,label:this.props.label,iconColor:this.props.route})},handleResetEdge:function(e){const{x:t,y:n}=this.moveStart;if(Math.abs(e.x-t)>10||Math.abs(e.y-n)>10){const t=_.get(this.props,"app.state.scale"),{angle:n}=this.state,o=_.cloneDeep(this.moveStart.ports),r=o.length-2;let i=o[2].y==o[3].y?"y":"x",a=o[2][i]+(e[i]-this.moveStart[i])/t;if(o[0].x===o[1].x&&Math.abs(o[r].y-o[0].y)>=Math.abs(o[r].y-o[1].y)||o[0].y===o[1].y&&Math.abs(o[r].x-o[0].x)>=Math.abs(o[r].x-o[1].x))if(180===Math.abs(n.target-n.source)){const e=Math.min(o[1][i],o[r][i]),t=Math.max(o[1][i],o[r][i]);a<e&&(a=e),a>t&&(a=t)}else a<o[1][i]&&(a=o[1][i]);else 90===Math.abs(n.target-n.source)&&a>o[r][i]&&(a=o[r][i]);o[2][i]=a,o[3][i]=a;const s=this.getPath(o);this.setState({path:s,ports:o})}},edgeStart:function(e){e.stopPropagation(),e.stopImmediatePropagation();const n=e.target.getAttribute("class"),o=n.indexOf("edge-port-start")>-1,r=n.indexOf("edge-port-end")>-1;if(o||r){const{graph:n,edge:r,edgeID:i}=this.props,a=o?r.to:r.from,s=n.getNode(a.node),c=s.metadata.def.ports.find(function(e){return e.display&&e.uuid==a.port}),{from:l,to:p,metadata:d}=r;d.turned=null;const u=o?-t.config.edge.port.r:t.config.edge.port.r,h=new CustomEvent("the-graph-edge-start",{detail:{node:s,port:{process:s.id,port:c.uuid,type:c.type,subType:c.subType,autoReceive:c.autoReceive},isIn:o,offsetX:e.offsetX+u,offsetY:e.offsetY,metadata:d,nodeType:s.metadata.def.type,updating:{from:l,to:p,edgeID:i},highlightVerified:!1},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(h)}return!1},getEndPoints:function(e){const{ports:n}=this.state,o=n.length-1,r=n[o].x,i=n[o].y;switch(e){case 0:return`${r},${i-t.config.edge.port.r} ${r},${i+t.config.edge.port.r} ${r-2*t.config.edge.port.r},${i}`;case 90:return`${r-t.config.edge.port.r},${i} ${r+t.config.edge.port.r},${i} ${r},${i+2*t.config.edge.port.r}`;case 180:return`${r},${i-t.config.edge.port.r} ${r},${i+t.config.edge.port.r} ${r+2*t.config.edge.port.r},${i}`;case 270:return`${r-t.config.edge.port.r},${i} ${r+t.config.edge.port.r},${i} ${r},${i-2*t.config.edge.port.r}`}},getScriptIconTransform:function(e,t,n,o){switch(e){case 0:return`translate(${t+o}, ${n-o})`;case 90:return`translate(${t-o}, ${n-3*o})`;case 180:return`translate(${t-3*o}, ${n-o})`;case 270:return`translate(${t-o}, ${n+o})`}},getErrorPosition:function(){const{ports:e}=this.state;let t;if(e.length%2==0){return{x:e[t=e.length/2-1].x+(e[t+1].x-e[t].x)/2,y:e[t].y+(e[t+1].y-e[t].y)/2}}return e[t=Math.floor(e.length/2)]},render:function(){let{edgeID:e,label:n,route:o,stroke:r,color:i,error:a,size:s,isPreview:c,updating:l,angle:p,selected:d,animated:u,hidden:h,isAuto:f,showScriptEditIcon:g,inScript:m,outScript:v}=this.props;const{ports:y,path:b}=this.state,w=y.length-1,x=y[0].x,C=y[0].y,S=y[w].x,I=y[w].y;let N,_={id:e,className:"edge"+(d?" selected":"")+(u?" animated":"")+(h?" hidden":""),title:n};if(_=t.merge(t.config.edge.container,_),b){let e=t.merge(t.config.edge.touchPath,{strokeWidth:s+4,d:b}),n=t.factories.edge.createEdgeTouchPath(e);if(f){let e=t.config.edge.autoPath.className+o,i=t.merge(t.config.edge.foregroundPath,{fill:"none",d:b,className:e,stroke:r||t.config.edge.defaultStroke});N=[t.factories.edge.createEdgeForegroundPath(i),n]}else{let e=t.merge(t.config.edge.backgroundPath,{fill:"none",strokeWidth:s+2,d:b}),r=t.factories.edge.createEdgeBackgroundPath(e),d=t.config.edge.foregroundPath.className+o,u=t.merge(t.config.edge.foregroundPath,{fill:"none",strokeWidth:s,d:b,className:d,stroke:i||t.config.edge.defaultColor});if(N=[r,t.factories.edge.createEdgeForegroundPath(u),t.factories.createCircle.call(this,t.merge(t.config.edge.flowPath,{d:b})),n],!c||l){const e=t.merge(t.config.edge.portStart,{cx:x,cy:C,fill:i||t.config.edge.defaultColor}),n=t.factories.edge.createCircle.call(this,e),o=t.merge(t.config.edge.portEnd,{points:this.getEndPoints(p.target),fill:i||t.config.edge.defaultColor}),r=[n,t.factories.edge.createArrow.call(this,o)],a=t.factories.edge.createEdgeGroup.call(this,{className:"edge-ports"},r);N.push(a)}if(!c){const e=t.config.edge.codeIcon.r,n=t.factories.createCircle.call(this,{className:"icon-bg",cx:e,cy:e,r:e,fill:"#fff"});if(a){const o=this.getErrorPosition(),r=t.factories.edge.createIconSvg.call(this,t.config.edge.alertIcon),i=t.factories.node.createNodeGroup.call(this,{className:"edge-icon edge-icon-alert",transform:`translate(${o.x-e}, ${o.y-e})`},[n,r]);N.push(i)}if(g){const o=t.factories.edge.createIconSvg.call(this,t.config.edge.codeIcon),r={className:`scripts edge-icon${v?" block":""}`,transform:this.getScriptIconTransform(p.source,x,C,e),"data-direction":"out"},i={className:`scripts edge-icon${m?" block":""}`,transform:this.getScriptIconTransform(p.target,S,I,e),"data-direction":"in"},a=[n,o],s=t.factories.node.createNodeGroup.call(this,r,a),c=t.factories.node.createNodeGroup.call(this,i,a);N.push(s,c)}}}}return t.factories.edge.createEdgeGroup(_,N)}}))}},{"./constants":22}],32:[function(e,t,n){e("./constants").nodeStyles;t.exports.register=function(e){let t=e.TheGraph;t.config.graph={container:{},groupsGroup:{className:"groups"},edgesGroup:{className:"edges"},iipsGroup:{className:"iips"},nodesGroup:{className:"nodes"},inportsGroup:{className:"ex-inports"},outportsGroup:{className:"ex-outports"},node:{},iip:{},inportEdge:{},inportNode:{},outportEdge:{},outportNode:{},nodeGroup:{},edgePreview:{key:"edge-preview",label:""}},t.factories.graph={createGraphContainerGroup:t.factories.createGroup,createGraphGroupsGroup:t.factories.createGroup,createGraphEdgesGroup:t.factories.createGroup,createGraphIIPGroup:t.factories.createGroup,createGraphNodesGroup:t.factories.createGroup,createGraphInportsGroup:t.factories.createGroup,createGraphOutportsGroup:t.factories.createGroup,createGraphNode:function(e){return(n(`${_.get(e,"node.metadata.type")}_${appConfig.theme}`)||n(`default_${appConfig.theme}`))(e)},createGraphEdge:o,createGraphIIP:function(e){return t.IIP(e)},createGraphGroup:function(e){return t.Group(e)},createGraphEdgePreview:o};const n=function(e){return{default_light:t.Node,comment_light:t.Comment,public_component_light:t.Node,my_component_light:t.Node,hufu_component_light:t.Node,device_component_light:t.Node,default_dark:t.Node2,comment_dark:t.Comment,public_component_dark:t.Node2,my_component_dark:t.Node2,hufu_component_dark:t.Node2,device_component_dark:t.Node2}[e]};function o(e){return t.Edge(e)}t.Graph=React.createFactory(React.createClass({displayName:"TheGraphGraph",mixins:[],getDefaultProps:function(){return{library:{},graph:null,app:null,showScriptEditIcon:!1,offsetX:0,offsetY:0,nodeIcons:{}}},getInitialState:function(){return{displaySelectionGroup:!0,edgePreview:null,edgePreviewX:0,edgePreviewY:0,forceSelection:!1,selectedNodes:[],errorNodes:[],selectedEdges:[],animatedEdges:[],offsetX:this.props.offsetX,offsetY:this.props.offsetY}},componentDidMount:function(){this._ismounted=!0,this.subscribeGraph(null,this.props.graph),this.editor=document.getElementById("editor"),ReactDOM.findDOMNode(this).addEventListener("the-graph-node-remove",this.removeNode),this.markDirty({id:_.get(window,"__graph__.currentNodeId",[]),allNodeDirty:_.get(window,"__graph__.allNodeDirty",!1)}),_.set(window,"__graph__.currentNodeId",[]),_.set(window,"__graph__.allNodeDirty",!1)},componentWillUnmount:function(){this._ismounted=!1},componentWillReceiveProps:function(e){if(e.scale!==this.props.scale||e.moved)return;this.subscribeGraph(this.props.graph,e.graph);const t=_.isEmpty(e.showPortDataNodes)?[]:Object.keys(e.showPortDataNodes).sort(),n=_.isEmpty(this.props.showPortDataNodes)?[]:Object.keys(this.props.showPortDataNodes).sort();if(!_.isEqual(t,n)){const e=t.length>n.length?_.difference(t,n):_.difference(n,t),o=this.portInfo;e.forEach(function(e){delete o[e]}),this.markDirty({id:e})}e.theme!==this.props.theme&&(this.portInfo={},this.markDirty({allNodeDirty:!0}))},subscribeGraph:function(e,t){e&&(e.removeListener("addEdge",this.resetPortRoute),e.removeListener("changeEdge",this.resetPortRoute),e.removeListener("removeEdge",this.resetPortRoute),e.removeListener("removeInitial",this.resetPortRoute),e.removeListener("changeNode",this.onChangeNode),e.removeListener("changeInport",this.onChangeInport),e.removeListener("changeOutport",this.onChangeOutport),e.removeListener("endTransaction",this.onEndTransaction)),t&&(t.on("addEdge",this.resetPortRoute),t.on("changeEdge",this.resetPortRoute),t.on("removeEdge",this.resetPortRoute),t.on("removeInitial",this.resetPortRoute),t.on("changeNode",this.onChangeNode),t.on("changeInport",this.onChangeInport),t.on("changeOutport",this.onChangeOutport),t.on("endTransaction",this.onEndTransaction))},onChangeNode:function(e,t){"movenode"!==_.get(this.props.graph,"transaction.id")&&delete this.portInfo[e.id];const n=[e.id].concat(this.getRelatedNodeIds(e.id));this.markDirty({id:[...n]},t)},onChangeInport:function(e,t,n,o){this.markDirty()},onChangeOutport:function(e,t,n,o){this.markDirty()},currentNodeId:[],onEndTransaction:function(e){delete this.currentNodeId,this.markDirty({allNodeDirty:!0})},edgePreview:null,edgeStart:function(e){const{port:t,highlightVerified:n}=e.detail;if(this.state.edgePreview){if(!n)return;this.currentNodeId.push(e.detail.node.id);let o=this.state.edgePreview;if(o.from&&o.from.process===t.process||o.to&&o.to.process===t.process)return;if(o.isIn===e.detail.isIn)return;const r=o.isIn?_.get(o,"updating.from"):_.get(o,"updating.to");return r&&r.node==t.process&&r.port==t.port?void this.cancelPreviewEdge():(e.detail.isIn?o.to=t:o.from=t,o.metadata={},this.currentNodeId.push(e.detail.node.id),this.addEdge(o),this.addNodeRalation([...this.currentNodeId]),void this.cancelPreviewEdge())}if(e.detail.isIn&&!e.detail.updating)return;let o;this.currentNodeId=[e.detail.node.id],(o=e.detail.isIn?{to:t}:{from:t}).isIn=e.detail.isIn,o.updating=e.detail.updating,o.metadata=e.detail.metadata||{route:e.detail.route},o.type=e.detail.port.type,o.subType=e.detail.port.subType,o.nodeType=e.detail.nodeType,this.renderPreviewEdge(e),this.editor.addEventListener("mousemove",this.renderPreviewEdge),this.editor.addEventListener("mouseup",this.cancelPreviewEdge),this.setState({edgePreview:o})},cancelPreviewEdge:function(e){this.editor.removeEventListener("mousemove",this.renderPreviewEdge),this.editor.removeEventListener("mouseup",this.cancelPreviewEdge),this.state.edgePreview&&(_.set(window,"__graph__.currentNodeId",[]),_.set(window,"__graph__.allNodeDirty",!0),this.setState({edgePreview:null}),this.markDirty({allNodeDirty:!0}))},renderPreviewEdge:function(e){let t=e.offsetX||e.detail.offsetX||0,n=e.offsetY||e.detail.offsetY||0,o=this.props.app.state.scale;this.setState({edgePreviewX:(t-this.props.app.state.x)/o,edgePreviewY:(n-this.props.app.state.y)/o}),this.markDirty({allNodeDirty:!0})},__nodeRelated__:{},addNodeRalation:function(e=[]){_.isEmpty(e)||(this.__nodeRelated__[e[0]]=this.__nodeRelated__[e[0]]||[],this.__nodeRelated__[e[0]].push(e[1]),this.__nodeRelated__[e[1]]=this.__nodeRelated__[e[1]]||[],this.__nodeRelated__[e[1]].push(e[0]))},getRelatedNodeIds:function(e){return _.get(this.__nodeRelated__,`${e}`,[])},addEdge:function(e){if(this.props.graph.addEdge(e.from.process,e.from.port,e.to.process,e.to.port,e.metadata),e.updating){const{from:t,to:n}=e.updating;this.props.graph.removeEdge(t.node,t.port,n.node,n.port)}},setEdgeMetadata:function(e,t,n){this.props.graph.setEdgeMetadata(e.node,e.port,t.node,t.port,n)},moveGroup:function(e,n,o){let r=this.props.graph,i=e.length;for(let a=0;a<i;a++){let i=r.getNode(e[a]);if(i)if(void 0!==n)r.setNodeMetadata(i.id,{x:i.metadata.x+n,y:i.metadata.y+o});else{let e=parseFloat(t.config.nodeHeight)/20;r.setNodeMetadata(i.id,{x:Math.round(i.metadata.x/e)*e,y:Math.round(i.metadata.y/e)*e})}}this.markDirty({id:e})},handlePortsMaxCount:function(e,n,o){const{autoSizeNode:r,nodeFootHeight:i,nodeFootSpace:a,nodeHeadHeight:s,nodeHeightIncrement:c,nodeSize2MinHeight:l}=t.config,p=e.def.ports,d=_.filter(p,function(e){return"in"==e.ioType&&e.display&&(0!==e.y||"dark"==appConfig.theme)}),u=_.filter(p,function(t){return"out"==t.ioType&&t.display&&(t.y!==e.height||"dark"==appConfig.theme)}),h=Math.max(d.length,u.length);if("dark"==appConfig.theme){let t=l[`${n}`];h>1&&(t=s[`${n}`]+o*h),n>=1&&(t+=i+2*a,2==n&&t<l[`${n}`]&&(t=l[`${n}`])),e.height=t}else{const o=t.config.maxPortCount*n,i=t.config.nodeHeight*n;if(r&&h>o){let t=h-o;e.height=i+t*c}else h<=o&&e.height>i&&(e.height=i)}},angles:{in:[180,90],out:[0,270]},getComponentInfo:function(e,n){let o={name:e.label,icon:"cube",inports:[],outports:[]};const r=t.config.portOffsetHeight,i=_.has(e,"size")?e.size:"1",a=i<1?8:14,s=this.props.showPortDataNodes&&!_.isEmpty(this.props.showPortDataNodes[n])?r:r-20;e.width="dark"==appConfig.theme?t.config.nodeSize2[i]:t.config.nodeSize1[i],e.height="dark"==appConfig.theme?t.config.nodeSize2[i]:t.config.nodeSize1[i],this.handlePortsMaxCount(e,_.toNumber(i),s);const{angles:c}=this,l=e.width,p=e.height;e.def.ports.forEach(function(e){e.angle=c[e.ioType][e.x&&e.x!==l?1:0]});const d=_.filter(e.def.ports,e=>"in"===e.ioType&&e.display),u=_.filter(e.def.ports,e=>"out"===e.ioType&&e.display);if("dark"==appConfig.theme){if(!_.isEmpty(d)){const e=d.length;d.forEach((n,r)=>{const c="dark"==appConfig.theme&&e>1?t.config.nodeHeadHeight[`${i}`]+a+s*r:p/(e+1)*(r+1);o.inports.push({name:n.uuid,description:n.description?n.description.zh_CN:n.uuid,type:n.type,subType:n.subType,autoReceive:n.autoReceive,x:0,y:c,angle:n.angle})})}if(!_.isEmpty(u)){const e=u.length;u.forEach((n,r)=>{const c=l,d="dark"==appConfig.theme&&e>1?t.config.nodeHeadHeight[`${i}`]+a+s*r:p/(e+1)*(r+1);o.outports.push({name:n.uuid,description:n.description?n.description.zh_CN:n.uuid,type:n.type,subType:n.subType,autoReceive:n.autoReceive,x:c,y:d,angle:n.angle})})}}else{const e=_.sortBy(_.remove(d,{angle:90}),e=>e.x),t=_.sortBy(_.remove(d,{angle:180}),e=>e.y).concat(d),n=_.sortBy(_.remove(u,{angle:270}),e=>e.x),r=_.sortBy(_.remove(u,{angle:0}),e=>e.y).concat(u);if(!_.isEmpty(e)){const t=e.length;e.forEach((e,n)=>{const r=l/(t+1)*(n+1);o.inports.push({name:e.uuid,description:e.description?e.description.zh_CN:e.uuid,type:e.type,subType:e.subType,autoReceive:e.autoReceive,x:r,y:0,angle:e.angle})})}if(!_.isEmpty(t)){const e=t.length;t.forEach((t,n)=>{const r=p/(e+1)*(n+1);o.inports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:0,y:r,angle:t.angle})})}if(!_.isEmpty(n)){const e=n.length;n.forEach((t,n)=>{const r=l/(e+1)*(n+1),i=p;o.outports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:r,y:i,angle:t.angle})})}if(!_.isEmpty(r)){const e=r.length;r.forEach((t,n)=>{const r=l,i=p/(e+1)*(n+1);o.outports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:r,y:i,angle:t.angle})})}}return o},portInfo:{},getPorts:function(e,t,n){let o=e.getNode(t),r=this.portInfo[t];if(!r){let e={},i={};if(n&&this.props.library){let t,n,r,a=this.getComponentInfo(o.metadata,o.id);if(!a)return{inports:e,outports:i};for(t=0,r=a.outports.length;t<r;t++)(n=a.outports[t]).name&&(i[n.name]={label:n.name,description:n.description,type:n.type,subType:n.subType,x:n.x,y:n.y,angle:n.angle});for(t=0,r=a.inports.length;t<r;t++)(n=a.inports[t]).name&&(e[n.name]={label:n.name,description:n.description,type:n.type,subType:n.subType,autoReceive:n.autoReceive,x:n.x,y:n.y,angle:n.angle})}r={inports:e,outports:i},this.portInfo[t]=r}return r},getNodeOutport:function(e,n,o,r,i){let a=this.getPorts(e,n,i);a.outports[o]||(a.outports[o]={label:o,x:t.config.nodeWidth/2,y:t.config.nodeHeight},this.dirty=!0);let s=a.outports[o];return void 0!==r&&(s.route=r),s},getNodeInport:function(e,n,o,r,i){let a=this.getPorts(e,n,i);a.inports[o]||(a.inports[o]={label:o,x:t.config.nodeWidth/2,y:0},this.dirty=!0);let s=a.inports[o];return void 0!==r&&(s.route=r),s},resetPortRoute:function(e){const t=[];if(e.from&&e.from.node){let n=this.portInfo[e.from.node];if(n){n.dirty=!0;let o=n.outports[e.from.port];o&&(o.route=null),t.push(e.from.node)}}if(e.to&&e.to.node){let n=this.portInfo[e.to.node];if(n){n.dirty=!0;let o=n.inports[e.to.port];o&&(o.route=null),t.push(e.to.node)}}this.currentNodeId=t,this.markDirty({id:t})},graphOutports:{},getGraphOutport:function(e){let n=this.graphOutports[e];return n||((n={inports:{},outports:{}}).inports[e]={label:e,type:"all",route:5,x:0,y:t.config.nodeHeight/2},this.graphOutports[e]=n),n},graphInports:{},getGraphInport:function(e){let n=this.graphInports[e];return n||((n={inports:{},outports:{}}).outports[e]={label:e,type:"all",route:2,x:t.config.nodeWidth,y:t.config.nodeHeight/2},this.graphInports[e]=n),n},getScripts:function(e,t,n,o){let r=e.properties.scripts;if(r){const e=[t,n,o];for(;null!=r&&e.length>0;)r=r[e.shift()];return r}return""},setSelectedNodes:function(e){this.setState({selectedNodes:e}),this.markDirty()},setErrorNodes:function(e){this.setState({errorNodes:e}),this.markDirty()},setSelectedEdges:function(e){this.setState({selectedEdges:e}),this.markDirty()},setAnimatedEdges:function(e){this.setState({animatedEdges:e}),this.markDirty()},updateIcon:function(e,t){console.error("DEPRECATED: updateIcon() will be removed in next version of the-graph. Pass nodeIcons through props instead"),this.props.nodeIcons[e]=t,this.markDirty()},dirty:!1,libraryDirty:!1,__currentNodeIds:[],__allNodeDirty:!0,markDirty:function(e){let t=_.get(e,"id",[]);this.__currentNodeIds=Array.isArray(t)?t:[t],this.__allNodeDirty=_.get(e,"allNodeDirty",!1),e&&e.libraryDirty&&(this.libraryDirty=!0),window.requestAnimationFrame(this.triggerRender)},triggerRender:function(e){this._ismounted&&(this.dirty||(this.dirty=!0,this.forceUpdate()))},shouldComponentUpdate:function(e){return this.dirty},render:function(){this.dirty=!1;const e=this,{graph:n}=this.props;let o=[],r=this.state.edgePreview;this.libraryDirty&&(this.libraryDirty=!1,this.portInfo={});let i=null;r&&r.type&&(i={type:r.type,subType:r.subType,isIn:!r.isIn,from:r.from,to:r.to,fromNodeType:r.nodeType,updating:r.updating});let a=n.nodes.map(function(o){let r=t.NodeOptions.getNodeOptions.call(e,n,o,i);return r=t.merge(t.config.graph.node,r),t.factories.graph.createGraphNode.call(e,r)}),s=n.edges.map(function(o){let i=n.getNode(o.from.node),a=n.getNode(o.to.node);if(!i||!a)return;let s=e.getNodeOutport(n,o.from.node,o.from.port,0,i.component),c=e.getNodeInport(n,o.to.node,o.to.port,0,a.component);s.type!=c.type?o.metadata.error={type:"type",from:s.type,to:c.type}:s.subType!=c.subType&&"all"!=s.subType&&"all"!=c.subType?o.metadata.error={type:"subType",from:s.subType,to:c.subType}:delete o.metadata.error;let l=i.metadata.label+"() "+o.from.port.toUpperCase()+(o.from.hasOwnProperty("index")?"["+o.from.index+"]":"")+" -> "+o.to.port.toUpperCase()+(o.to.hasOwnProperty("index")?"["+o.to.index+"]":"")+" "+a.metadata.label+"()",p="edge-"+o.from.node+"-"+o.from.port+(o.from.hasOwnProperty("index")?"["+o.from.index+"]":"")+"-"+o.to.port+(o.to.hasOwnProperty("index")?"["+o.to.index+"]":"")+"-"+o.to.node,d={key:p,edgeID:p,graph:n,edge:o,app:e.props.app,sX:i.metadata.x+s.x,sY:i.metadata.y+s.y,tX:a.metadata.x+c.x,tY:a.metadata.y+c.y,path:_.get(o,"metadata.path"),custom:_.get(o,"metadata.custom"),angle:{source:"dark"==appConfig.theme?0:s.angle,target:"dark"==appConfig.theme?180:c.angle},label:l,route:0,error:o.metadata.error,isAuto:o.metadata.auto,color:_.get(o,"metadata.color"),size:_.get(o,"metadata.size")||1,inScript:!_.isEmpty(e.getScripts(n,o.to.node,o.to.port,"beforeEnter")),outScript:!_.isEmpty(e.getScripts(n,o.from.node,o.from.port,"afterLeave")),hidden:r&&r.updating&&p==r.updating.edgeID,onEdgeSelection:e.props.onEdgeSelection,onClickEdgeCode:e.props.onClickEdgeCode,selected:-1!==e.state.selectedEdges.indexOf(o),animated:-1!==e.state.animatedEdges.indexOf(o),showScriptEditIcon:e.props.showScriptEditIcon,onUpdatePath:e.setEdgeMetadata};return d=t.merge(t.config.graph.edge,d),t.factories.graph.createGraphEdge.call(this,d)}),c=n.groups.map(function(o){if(o.nodes.length<1)return;let r=t.findMinMax(n,o.nodes);if(!r)return;let i={key:"group."+o.name,graph:n,item:o,app:e.props.app,minX:r.minX,minY:r.minY,maxX:r.maxX,maxY:r.maxY,scale:e.props.scale,label:o.metadata.name||"",nodes:o.nodes,groupId:o.name,triggerMoveGroup:e.moveGroup,showContext:e.props.showContext,onGroupSelection:e.props.onGroupSelection};return i=t.merge(t.config.graph.nodeGroup,i),t.factories.graph.createGraphGroup.call(this,i)});if(this.state.displaySelectionGroup&&o.length>=2){let r=t.findMinMax(n,o);if(r){let i={name:"selection",nodes:o,metadata:{color:1}},a={graph:n,app:e.props.app,item:i,minX:r.minX,minY:r.minY,maxX:r.maxX,maxY:r.maxY,scale:e.props.scale,color:i.metadata.color,triggerMoveGroup:e.moveGroup,showContext:e.props.showContext};a=t.merge(t.config.graph.selectionGroup,a);let s=t.factories.graph.createGraphGroup.call(this,a);c.push(s)}}if(r){let e;if(r.from){let t=n.getNode(r.from.process),o=this.getNodeOutport(n,r.from.process,r.from.port);e={sX:t.metadata.x+o.x,sY:t.metadata.y+o.y,tX:this.state.edgePreviewX,tY:this.state.edgePreviewY,angle:{source:"dark"==appConfig.theme?0:o.angle},route:r.metadata.route,updating:r.updating,isIn:r.isIn,isPreview:!0}}else{let t=n.getNode(r.to.process),o=this.getNodeInport(n,r.to.process,r.to.port);e={sX:this.state.edgePreviewX,sY:this.state.edgePreviewY,tX:t.metadata.x+o.x,tY:t.metadata.y+o.y,angle:{target:"dark"==appConfig.theme?180:o.angle},route:r.metadata.route,updating:r.updating,isIn:r.isIn,isPreview:!0}}e=t.merge(t.config.graph.edgePreview,e);let o=t.factories.graph.createGraphEdgePreview.call(this,e);s.push(o)}let l=t.merge(t.config.graph.groupsGroup,{children:c}),p=t.factories.graph.createGraphGroupsGroup.call(this,l),d=t.merge(t.config.graph.edgesGroup,{children:s}),u=t.factories.graph.createGraphEdgesGroup.call(this,d),h=t.merge(t.config.graph.nodesGroup,{children:a}),f=t.factories.graph.createGraphNodesGroup.call(this,h);let g=[t.factories.createAppDefs(),p,u,f],m=this.state.forceSelection||o.length>0?" selection":"",v=t.merge(t.config.graph.container,{className:"graph"+m});return t.factories.graph.createGraphContainerGroup.call(this,v,g)}}))}},{"./constants":22}],33:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph;t.config.group={container:{className:"group"},boxRect:{rx:t.config.nodeRadius,ry:t.config.nodeRadius},labelText:{className:"group-label"},descriptionText:{className:"group-description"}},t.factories.group={createGroupGroup:t.factories.createGroup,createGroupBoxRect:t.factories.createRect,createGroupLabelText:t.factories.createText,createGroupDescriptionText:t.factories.createText},t.Group=React.createFactory(React.createClass({displayName:"TheGraphGroup",getInitialState:function(){return{moving:!1,lastTrackX:null,lastTrackY:null}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.onTrackStart),this.props.onGroupSelection&&e.addEventListener("click",this.onGroupSelection)},onGroupSelection:function(e){e.stopPropagation(),this.props.onGroupSelection(this.props.groupId)},onTrackStart:function(e){e.stopPropagation(),this.setState({moving:!0}),this.setState({lastTrackX:e.pageX,lastTrackY:e.pageY});let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.graph.startTransaction("movegroup"),!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,n=e.pageY,o=t-this.state.lastTrackX,r=n-this.state.lastTrackY,i=Math.round(o/this.props.scale),a=Math.round(r/this.props.scale);this.setState({lastTrackX:t,lastTrackY:n}),this.props.triggerMoveGroup(this.props.item.nodes,i,a)},onTrackEnd:function(e){this.setState({moving:!1}),e.stopPropagation(),this.props.triggerMoveGroup(this.props.item.nodes);let t=document.getElementById("editor");t.removeEventListener("mousemove",this.onTrack),t.removeEventListener("mouseup",this.onTrackEnd),this.setState({lastTrackX:null,lastTrackY:null}),this.props.graph.endTransaction("movegroup")},render:function(){let e=this.props.minX-28,n=this.props.minY-28,o=this.props.color?this.props.color:0,r={x:e,y:n,width:this.props.maxX-e+14,height:this.props.maxY-n+14,className:"group-box color"+o};r=t.merge(t.config.group.boxRect,r);let i=t.factories.group.createGroupBoxRect.call(this,r),a={x:e+t.config.nodeRadius+3,y:n+14,children:this.props.label};a=t.merge(t.config.group.labelText,a);let s=[i,t.factories.group.createGroupLabelText.call(this,a)],c=t.merge(t.config.group.container,{id:this.props.groupId});return t.factories.group.createGroupGroup.call(this,c,s)}}))}},{}],34:[function(e,t,n){function o(e){let t=[];return e.nodes.forEach(function(n){let o={name:n.component,icon:"cog",description:"",inports:[],outports:[]};Object.keys(e.inports).forEach(function(t){let r=e.inports[t];if(r.process===n.id){for(let e=0;e<o.inports.length;e++)if(o.inports[e].name===r.port)return;o.inports.push({name:r.port,type:"all"})}}),Object.keys(e.outports).forEach(function(t){let r=e.outports[t];if(r.process===n.id){for(let e=0;e<o.outports.length;e++)if(o.outports[e].name===r.port)return;o.outports.push({name:r.port,type:"all"})}}),e.initializers.forEach(function(e){if(e.to.node===n.id){for(let t=0;t<o.inports.length;t++)if(o.inports[t].name===e.to.port)return;o.inports.push({name:e.to.port,type:"all"})}}),e.edges.forEach(function(e){let t;if(e.from.node===n.id){for(t=0;t<o.outports.length;t++)if(o.outports[t].name===e.from.port)return;o.outports.push({name:e.from.port,type:"all"})}if(e.to.node===n.id){for(t=0;t<o.inports.length;t++)if(o.inports[t].name===e.to.port)return;o.inports.push({name:e.to.port,type:"all"})}}),t.push(o)}),t}t.exports={mergeComponentDefinition:function(e,t){if(e===t)return t;let n,o,r,i,a,s=e.inports,c=t.inports;if(s!==c)for(n=0,r=s.length;n<r;n++){let e=s[n];for(a=!1,o=0,i=c.length;o<i;o++){let t=c[o];e.name===t.name&&(a=!0)}a||c.push(e)}let l=e.outports,p=t.outports;if(l!==p)for(n=0,r=l.length;n<r;n++){let e=l[n];for(a=!1,o=0,i=p.length;o<i;o++){let t=p[o];e.name===t.name&&(a=!0)}a||p.push(e)}return"cog"!==t.icon?e.icon=t.icon:t.icon=e.icon,t.iconsvg=e.iconsvg,t},componentsFromGraph:o,libraryFromGraph:function(e){let t={};return o(e).forEach(function(e){t[e.name]=e}),t}}},{}],35:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph;NODE_OPTIONS={getDefault:function(e,t,n){let o=t.id;const r=_.has(t.metadata,"size")?_.toNumber(t.metadata.size):1,i=this.getPorts(e,o,t.component);let a=t.metadata.icon||"cube",s="icon";!_.isEmpty(a)&&a.indexOf("studio")>-1&&(s="image");let c=!0===this.state.selectedNodes[o];c&&selectedIds.push(o);let l=t.metadata.nodeStyle?nodeStyles[t.metadata.nodeStyle].bg:"rgba(255,255,255,1)";const p=_.find(_.values(t.metadata.def.params),function(e){return!_.isEmpty(e.value)&&e.value.indexOf("studio/"+appConfig.userId)>-1}),{showPortDataNodes:d}=this.props;return{key:o,nodeID:o,x:t.metadata.x,y:t.metadata.y,dirty:this.__currentNodeIds.indexOf(o)>-1||this.__allNodeDirty,label:t.metadata.label,sublabel:t.metadata.sublabel,width:t.metadata.width,height:t.metadata.height,size:r,app:this.props.app,scale:this.props.scale,graphView:self,graph:e,node:t,icon:a,iconType:s,color:t.metadata.color||l,preview:_.get(p,"value"),screenshot_index:t.metadata.screenshot_index,receieveMsgType:_.get(t,"metadata.receieveMsgType"),ports:i,onNodeSelection:this.props.onNodeSelection,onNodeRectImgDblclick:this.props.onNodeRectImgDblclick,selected:c,error:!0===this.state.errorNodes[o],showContext:this.props.showContext,showPortData:!_.isEmpty(d)&&d[o],highlightPort:n,allowEdgeStart:this.props.allowEdgeStart,onExpandIconClicked:this.props.onExpandIconClicked}},comment:function(e,t,n){const o=t.id;return{key:o,nodeID:o,x:t.metadata.x,y:t.metadata.y,dirty:this.__currentNodeIds.indexOf(o)>-1||this.__allNodeDirty,label:t.metadata.label,width:t.metadata.width,height:t.metadata.height,node:t,icon:icon,color:t.metadata.color||defaultColor}}},t.NodeOptions={getNodeOptions:function(e,t,n){if(!t.metadata)throw new Error("Component "+t.component+" is not in library");return t.metadata||(t.metadata={}),void 0===t.metadata.x&&(t.metadata.x=0),void 0===t.metadata.y&&(t.metadata.y=0),(NODE_OPTIONS[t.type]||NODE_OPTIONS.getDefault).call(this,e,t,n)}}}},{}],36:[function(e,t,n){let o=e("./constants").iconSvgD;t.exports.register=function(e){let t=e.TheGraph;const n=function(e,t){const n={light:!0,text:"#555"};if(!e)return n;let o=null,r=1;var i;if(0==e.indexOf("#")&&(o=(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(function(e){var t=""+e,n=(t=0===t.indexOf("#")?t.slice(1,7):t.slice(0,6)).length;switch(n){case 3:t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`;break;case 5:t+=t[4];break;default:for(var o=0;o<6-n;o++)t+="0"}return"#"+t}(e)))?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null),e.indexOf("rgb")>-1){const t=e.indexOf("(")+1,n=e.indexOf(")");(o=e.slice(t,n).split(",").map(e=>Number(e.trim()))).length>3&&(r=o.pop(3))}return(o.findIndex(e=>e<160)>-1||r<.4)&&(t||(n.text="#fff"),n.light=!1),n};t.config.node={snap:t.config.nodeSize,container:{},background:{className:"node-bg"},border:{className:"node-border drag",rx:t.config.nodeRadius,ry:t.config.nodeRadius},innerRect:{className:"node-rect drag",rx:t.config.nodeRadius,ry:t.config.nodeRadius},icon:{ref:"icon",className:"icon node-icon drag the-graph-var-icon"},iconsvg:{className:"icon-svg node-icon drag"},runningIcon:{ref:"running-icon",className:"icon node-icon drag the-graph-spin"},successIcon:{ref:"success-icon",className:"icon node-icon drag the-graph-success-icon"},errorIcon:{ref:"error-icon",className:"icon node-icon drag the-graph-error-icon"},warnIcon:{ref:"warn-icon",className:"icon node-icon drag the-graph-warn-icon"},inports:{className:"inports"},outports:{className:"outports"},labelBackground:{className:"node-label-bg"},labelRect:{className:"text-bg-rect"},labelText:{className:"node-label"},sublabelBackground:{className:"node-sublabel-bg"},sublabelRect:{className:"text-bg-rect"},sublabelText:{className:"node-sublabel"}},t.factories.node={createNodeGroup:t.factories.createGroup,createNodeBackgroundRect:t.factories.createRect,createNodeBorderRect:t.factories.createRect,createNodeInnerRect:t.factories.createRect,createNodeInnerRectImg:t.factories.createRectImg,createNodeIconText:t.factories.createText,createNodeIconSVGGroup:t.factories.createGroup,createNodeIconSVG:t.factories.createPath,createNodeInportsGroup:t.factories.createGroup,createNodeOutportsGroup:t.factories.createGroup,createNodeLabelGroup:t.factories.createGroup,createNodeLabelRect:t.factories.createRect,createNodeLabelText:t.factories.createText,createNodeSublabelGroup:t.factories.createGroup,createNodeSublabelRect:t.factories.createRect,createNodeSublabelText:t.factories.createText,createNodePort:function(e){return t.Port(e)}},t.Node=React.createFactory(React.createClass({displayName:"TheGraphNode",gutter:{.5:6,1:8,2:12},labelHeight:{.5:6,1:30,2:45},fontSize:{.5:12,1:12,2:14},getInitialState:function(){const{color:e,size:t}=this.props,o=n(e,t<1);return{labelSize:this.fontSize[t],lastTrackX:null,lastTrackY:null,lastNodeData:{},nodeColor:o}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this),t=e.querySelector(".node-rect");e.addEventListener("mousedown",this.onTrackStart),this.props.onNodeSelection&&e.addEventListener("click",this.onNodeSelection),t&&this.props.onNodeRectImgDblclick&&t.addEventListener("dblclick",this.onNodeRectImgDblclick),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext)),"image"==this.props.iconType&&this.getIconImageUrl(this.props.icon),this.props.preview&&this.updatePreview(this.props.preview),this.isCheckingUrl=!1,this.screenShotKeyToCheck=[]},componentWillReceiveProps(e){if(e.screenshot_index!==this.state.lastNodeData.screenshot_index)if(this.state.lastNodeData.screenshot_index=e.screenshot_index,e.screenshot_index){let t="studio/"+window.appConfig.userId+"/logs/"+window.appConfig.appId+"/screenshots_thumbnail/"+this.props.nodeID+"/"+e.screenshot_index+".png";this.updateScreenShotUrl(t)}else this.screenshotSignedUrl=null;if("image"==e.iconType&&e.icon!=this.props.icon&&(this.iconUrl=null,this.getIconImageUrl(e.icon)),e.preview!==this.props.preview&&this.updatePreview(e.preview),e.scale!==this.props.scale||e.size!==this.props.size){let t=this.state.labelSize;t=e.scale>=1.5?this.fontSize[e.size]-2:this.fontSize[e.size],this.setState({labelSize:t})}if(e.color!==this.props.color){const t=n(e.color,this.props.size<1);this.setState({nodeColor:t})}},updatePreview:function(e){e?e.lastIndexOf("/")==e.length-1?window.appService.getContents(e).then(e=>{const t=_.find(e.catalog,e=>"png"==e.type||"jpg"==e.type||"jpeg"==e.type);t&&window.appDataStore.head(t.id).then(()=>{window.appDataStore.url(t.id).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})}):(e.indexOf(",")>0&&(e=e.split(",")[0]),window.appDataStore.head(e).then(t=>{0==t.ContentType.indexOf("image")&&window.appDataStore.url(e).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})):this.setState({preview:null})},updateScreenShotUrl:function(e){this.isCheckingUrl?this.screenShotKeyToCheck.push(e):window.appDataStore.head(e).then(()=>{window.appDataStore.url(e).then(e=>{_.isEmpty(this.screenShotKeyToCheck)?(this.isCheckingUrl=!1,e.success&&(this.screenshotSignedUrl=e.data,this.forceUpdate())):this.updateScreenShotUrl(this.screenShotKeyToCheck[this.screenShotKeyToCheck.length-1])})}).catch(()=>{})},getIconImageUrl:function(e){window.appDataStore.url(e).then(e=>{e.success&&(this.iconUrl=e.data,this.forceUpdate())})},doCancel:function(e){e.stopPropagation(),e.stopImmediatePropagation()},onNodeSelection:function(e){e.stopPropagation(),e.stopImmediatePropagation();let n=t.metaKeyPressed||"touch"===e.pointerType;this.props.onNodeSelection(e,this.props.nodeID,this.props.node,n)},onNodeRectImgDblclick:function(e){e.stopPropagation(),e.stopImmediatePropagation(),this.screenshotSignedUrl&&this.props.onNodeRectImgDblclick(e,this.props.nodeID,this.screenshotSignedUrl)},onTrackStart:function(e){e.stopPropagation();let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.export?this.props.graph.startTransaction("moveexport"):this.props.graph.startTransaction("movenode"),this.lastTrackX=e.pageX,this.lastTrackY=e.pageY,!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,n=e.pageY,o=t-this.lastTrackX,r=n-this.lastTrackY;this.lastTrackX=t,this.lastTrackY=n;let i=this.props.app.state.scale,a=Math.round(o/i),s=Math.round(r/i);if(this.props.export){let e={x:this.props.export.metadata.x+a,y:this.props.export.metadata.y+s};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:this.props.node.metadata.x+a,y:this.props.node.metadata.y+s})},onTrackEnd:function(e){let n=document.getElementById("editor");n.removeEventListener("mousemove",this.onTrack),n.removeEventListener("mouseup",this.onTrackEnd);const{movementX:o,movementY:r}=e;if(0!==o&&0!==r){let e=!0,n=parseFloat(t.config.nodeHeight)/20;if(e){if(this.props.export){let e={x:Math.round(this.props.export.metadata.x/n)*n,y:Math.round(this.props.export.metadata.y/n)*n};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:Math.round(this.props.node.metadata.x/n)*n,y:Math.round(this.props.node.metadata.y/n)*n})}}this.props.export?this.props.graph.endTransaction("moveexport"):this.props.graph.endTransaction("movenode")},showContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"node",x:t,y:n,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:this.props.nodeID,item:this.props.export?this.props.export:this.props.node})},getContext:function(e,n,o){if(this.props.export)return t.Menu({menu:e,options:n,triggerHideContext:o,label:this.props.exportKey});let r=n.x,i=n.y,a=this.props.app.state.scale,s=this.props.app.state.x,c=this.props.app.state.y,l=(this.props.x+this.props.width/2)*a+s-r,p=(this.props.y+this.props.height/2)*a+c-i,d=this.props.ports,u=this.props.nodeID,h=this.props.highlightPort;return this.props.graphView.state.edgePreview?this.props.graphView.state.edgePreview.isIn?t.NodeMenuPorts({ports:d.outports,triggerHideContext:o,isIn:!1,scale:a,processKey:u,deltaX:l,deltaY:p,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:h}):t.NodeMenuPorts({ports:d.inports,triggerHideContext:o,isIn:!0,scale:a,processKey:u,deltaX:l,deltaY:p,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:h}):t.NodeMenu({menu:e,options:n,triggerHideContext:o,label:this.props.label,graph:this.props.graph,graphView:this.props.graphView,node:this,icon:this.props.icon,ports:d,process:this.props.node,processKey:u,x:r,y:i,nodeWidth:this.props.width,nodeHeight:this.props.height,deltaX:l,deltaY:p,highlightPort:h})},shouldComponentUpdate:function(e,t){return e.dirty&&(e.x!==this.props.x||e.y!==this.props.y||e.icon!==this.props.icon||e.label!==this.props.label||e.ports!==this.props.ports||e.selected!==this.props.selected||e.error!==this.props.error||e.highlightPort!==this.props.highlightPort||t.preview!==this.state.preview||!0===e.ports.dirty)||t.nodeColor.text!==this.state.nodeColor.text||t.nodeColor.light!==this.state.nodeColor.light||t.labelSize!==this.state.labelSize},renderIcon:function(){const{lastNodeData:e={},preview:n}=this.state,{width:r,height:i,scale:a,size:s}=this.props;if("image"==this.props.iconType||n&&a>=2)e.iconContent=null,e.iconOptions=null;else if("icon"==this.props.iconType){let n=t.merge({},{d:o[this.props.icon],fill:"#7285a8"});const a=this.gutter[`${s}`],c=30;let l=(r-c*s)/2,p=a+(i-a-this.labelHeight[`${s}`]-c*s)/2,d=t.merge(t.config.node.iconsvg,{transform:"translate("+l+","+p+") scale("+s+")"});if(!e.iconContent||!_.isEqual(e.iconSVGOptions,n)||!_.isEqual(e.iconSvgGroupOptions,d)){let o=t.factories.node.createNodeIconSVG.call(this,n);e.iconContent=t.factories.node.createNodeIconSVGGroup.call(this,d,[o]),e.iconSVGOptions=n,e.iconSvgGroupOptions=d}}else if(!e.iconContent||!_.isEqual(e.iconOptions,iconOptions)){let n=t.FONT_ICON[this.props.icon];n||(n=t.FONT_ICON.cube);let o=t.merge(t.config.node.icon,{x:this.props.height/2,y:this.props.height/2,children:n});e.iconContent=t.factories.node.createNodeIconText.call(this,o),e.iconOptions=o}const c=r-this.gutter[`${s}`]-10,l=i-this.labelHeight[`${s}`]-10;if(e.statusIconX!==c||e.statusIconY!==l){const n=t.merge(t.config.node.runningIcon,{children:t.FONT_ICON.cog}),o=t.factories.node.createNodeIconText.call(this,n),r=t.merge(t.config.node.successIcon,{children:t.FONT_ICON.checked}),i=t.factories.node.createNodeIconText.call(this,r),a=t.merge(t.config.node.errorIcon,{children:t.FONT_ICON["close-circle"]}),s=t.factories.node.createNodeIconText.call(this,a),p=t.merge(t.config.node.warnIcon,{children:t.FONT_ICON["warning-circle"]}),d=t.factories.node.createNodeIconText.call(this,p);e.statusIconX=c,e.statusIconY=l,e.statusIconGroup=t.factories.createGroup.call(this,{className:"icon-status",transform:`translate(${c}, ${l})`,children:[o,i,s,d]})}return e},renderLabel:function(){const{lastNodeData:e={},labelSize:n,nodeColor:o}=this.state;let{labelGroup:r}=e;const{label:i,width:a,height:s,size:c}=this.props,l=s-this.labelHeight[`${c}`],p=c>=1?o.text:"#555";if(e.label!==i||e.labelSize!==n||e.labelY!==l||e.labelColor!==p){const o=Math.floor((a-10)/n*2),d=c<2?n:Math.floor(1.4*n),u=c<1?s+this.gutter[`${c}`]/2+n:l+this.labelHeight[`${c}`]/2+n/3;let h=i;c>=1&&t.factories.strlen(i)>o&&(h=t.factories.strsub(i,o-1).map(function(e,t){return React.createElement("tspan",{x:a/2,y:t?u+d/2:u-d/2},e)}));let f=t.merge(t.config.node.labelText,{x:a/2,y:u,children:h,fill:p,style:{"font-size":n+"px"}}),g=t.factories.node.createNodeLabelText.call(this,f);r=t.factories.node.createNodeLabelGroup.call(this,t.config.node.labelBackground,[g]),e.label=i,e.labelSize=n,e.labelY=l,e.labelColor=p,e.labelGroup=r}return{label:e.label,labelRect:e.labelRect,labelGroup:e.labelGroup}},renderRects:function(){const{lastNodeData:e={},preview:n}=this.state,{width:o,height:r,color:i,icon:a,scale:s,size:c}=this.props,l=this.gutter[`${c}`],p=o-2*l,d=r-l-this.labelHeight[`${c}`];if(!e.borderRect||e.width!==o||e.height!==r||e.color!==i){let n=t.merge(t.config.node.border,{width:o,height:r,fill:i||"#fff"});e.color=i,e.width=o,e.height=r,e.borderRect=t.factories.node.createNodeBorderRect.call(this,n)}if(e.innerWidth!==p||e.innerHeight!==d||e.icon!==a){let o="";this.screenshotSignedUrl?o=this.screenshotSignedUrl:n&&s>=2?o=n:"image"==this.props.iconType&&(o=this.iconUrl);let r=t.merge(t.config.node.innerRect,{x:l,y:l,width:p,height:d}),i={x:l,y:l,width:p,height:d,id:"raduisImage_"+this.props.nodeID,href:o};const c=t.merge(t.config.node.innerRect,{className:"node-rect-img",x:l,y:l,width:p,height:d,stroke:"none",fill:"url(#raduisImage_"+this.props.nodeID+")"});"icon"==this.props.iconType?(e.icon=a,e.innerImg=null,e.innerImgRect=null):(e.icon=n&&s>=2?"preview":a,e.innerImg=t.factories.node.createNodeInnerRectImg.call(this,i),e.innerImgRect=t.factories.node.createNodeInnerRect.call(this,c)),e.innerRect=t.factories.node.createNodeInnerRect.call(this,r)}return e},renderPorts:function(){const{lastNodeData:e={}}=this.state;let n,o,{x:r,y:i,width:a,height:s,app:c,graph:l,node:p,ports:d,nodeID:u,showContext:h,highlightPort:f}=this.props,g=u,m=void 0!==this.props.export,v=d.inports;o=(n=Object.keys(v)).length;let y=n.map(function(e){let n=v[e],o={app:c,graph:l,node:p,key:g+".in."+n.label,label:n.description,processKey:g,isIn:!0,isExport:m,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:n.x,y:n.y,siblings:v,port:{process:g,port:n.label,type:n.type,subType:n.subType,angle:n.angle,autoReceive:n.autoReceive},highlightPort:f,route:n.route,showContext:h,allowEdgeStart:this.props.allowEdgeStart};return l.edges.find(e=>e.metadata.error&&e.to.node==g&&e.to.port==n.label)&&(o.className="alert"),t.factories.node.createNodePort(o)}.bind(this)),b=t.merge(t.config.node.inports,{children:y});e.highlightPort=f,e.showContext=h,e.inports=v,e.inportsGroup=t.factories.node.createNodeInportsGroup.call(this,b);let w=this.props.ports.outports;o=(n=Object.keys(w)).length;let x=n.map(function(e){let n=w[e],o={app:c,graph:l,node:p,key:g+".out."+n.label,label:n.description,processKey:g,isIn:!1,isExport:m,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:n.x,y:n.y,siblings:w,port:{process:g,port:n.label,type:n.type,subType:n.subType,angle:n.angle},highlightPort:f,route:n.route,showContext:h,allowEdgeStart:this.props.allowEdgeStart};return t.factories.node.createNodePort(o)}.bind(this)),C=t.merge(t.config.node.outports,{children:x});return e.outports=w,e.outportsGroup=t.factories.node.createNodeOutportsGroup.call(this,C),e},render:function(){this.props.ports.dirty&&(this.props.ports.dirty=!1);let e=this.props.x,n=this.props.y,o=this.props.width,r=this.props.height;const{inportsGroup:i,outportsGroup:a}=this.renderPorts(),{iconContent:s,statusIconGroup:c}=this.renderIcon(),{borderRect:l,innerImgRect:p,innerRect:d,innerImg:u}=this.renderRects(),{label:h,labelGroup:f}=this.renderLabel();let g=[l,d,p,u,c,i,a,f];this.screenshotSignedUrl||g.push(s),this.state.lastNodeData.width=o,this.state.lastNodeData.height=r;let m={id:this.props.nodeID,className:"node drag "+this.props.node.metadata.def.theme+" "+(this.props.selected?" selected":"")+(this.props.error?" error":""),name:this.props.nodeID,key:this.props.nodeID,title:h,transform:"translate("+e+","+n+")"};return m=t.merge(t.config.node.container,m),t.factories.node.createNodeGroup.call(this,m,g)}}))}},{"./constants":22}],37:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph;t.Node2=React.createFactory(React.createClass({displayName:"TheGraphNode2",getInitialState:function(){return this.props.preview&&this.updatePreview(this.props.preview),{lastTrackX:null,lastTrackY:null,lastNodeData:{}}},size:{.5:"sm",1:"md",2:"lg"},receieveType:{sync:{icon:"tongbu",label:"同步接收",fill:"#0084FF"},async:{icon:"yibu",label:"异步接收",fill:"#EEC73F"}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.onTrackStart),this.props.onNodeSelection&&e.addEventListener("click",this.onNodeSelection),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext))},componentWillReceiveProps(e){2==e.size&&e.preview!==this.props.preview&&this.updatePreview(e.preview)},shouldComponentUpdate:function(e,t){return e.dirty&&(e.x!==this.props.x||e.y!==this.props.y||e.icon!==this.props.icon||e.label!==this.props.label||e.sublabel!==this.props.sublabel||e.ports!==this.props.ports||e.showPortData!==this.props.showPortData||e.error!==this.props.error||e.highlightPort!==this.props.highlightPort||t.preview!==this.state.preview||!0===e.ports.dirty)},updatePreview:function(e){e?e.lastIndexOf("/")==e.length-1?window.appService.getContents(e).then(e=>{const t=_.find(e.catalog,e=>"png"==e.type||"jpg"==e.type||"jpeg"==e.type);t&&window.appDataStore.head(t.id).then(()=>{window.appDataStore.url(t.id).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})}):(e.indexOf(",")>0&&(e=e.split(",")[0]),window.appDataStore.head(e).then(t=>{0==t.ContentType.indexOf("image")&&window.appDataStore.url(e).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})):this.setState({preview:null})},getIconImageUrl:function(e){window.appDataStore.url(e).then(e=>{e.success&&(this.iconUrl=e.data,this.forceUpdate())})},doCancel:function(e){e.stopPropagation(),e.stopImmediatePropagation()},onNodeSelection:function(e){e.stopPropagation(),e.stopImmediatePropagation();let n=t.metaKeyPressed||"touch"===e.pointerType;this.props.onNodeSelection(e,this.props.nodeID,this.props.node,n)},onTrackStart:function(e){e.stopPropagation();let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.export?this.props.graph.startTransaction("moveexport"):this.props.graph.startTransaction("movenode"),this.lastTrackX=e.pageX,this.lastTrackY=e.pageY,!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,n=e.pageY,o=t-this.lastTrackX,r=n-this.lastTrackY;this.lastTrackX=t,this.lastTrackY=n;let i=this.props.app.state.scale,a=Math.round(o/i),s=Math.round(r/i);if(this.props.export){let e={x:this.props.export.metadata.x+a,y:this.props.export.metadata.y+s};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:this.props.node.metadata.x+a,y:this.props.node.metadata.y+s})},onTrackEnd:function(e){let n=document.getElementById("editor");n.removeEventListener("mousemove",this.onTrack),n.removeEventListener("mouseup",this.onTrackEnd);const{movementX:o,movementY:r}=e;if(0!==o&&0!==r){let e=!0,n=parseFloat(t.config.nodeHeight)/20;if(e){if(this.props.export){let e={x:Math.round(this.props.export.metadata.x/n)*n,y:Math.round(this.props.export.metadata.y/n)*n};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:Math.round(this.props.node.metadata.x/n)*n,y:Math.round(this.props.node.metadata.y/n)*n})}}this.props.export?this.props.graph.endTransaction("moveexport"):this.props.graph.endTransaction("movenode")},showContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"node",x:t,y:n,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:this.props.nodeID,item:this.props.export?this.props.export:this.props.node})},getContext:function(e,n,o){if(this.props.export)return t.Menu({menu:e,options:n,triggerHideContext:o,label:this.props.exportKey});let r=n.x,i=n.y,a=this.props.app.state.scale,s=this.props.app.state.x,c=this.props.app.state.y,l=(this.props.x+this.props.width/2)*a+s-r,p=(this.props.y+this.props.height/2)*a+c-i,d=this.props.ports,u=this.props.nodeID,h=this.props.highlightPort;return this.props.graphView.state.edgePreview?this.props.graphView.state.edgePreview.isIn?t.NodeMenuPorts({ports:d.outports,triggerHideContext:o,isIn:!1,scale:a,processKey:u,deltaX:l,deltaY:p,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:h}):t.NodeMenuPorts({ports:d.inports,triggerHideContext:o,isIn:!0,scale:a,processKey:u,deltaX:l,deltaY:p,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:h}):t.NodeMenu({menu:e,options:n,triggerHideContext:o,label:this.props.label,graph:this.props.graph,graphView:this.props.graphView,node:this,icon:this.props.icon,ports:d,process:this.props.node,processKey:u,x:r,y:i,nodeWidth:this.props.width,nodeHeight:this.props.height,deltaX:l,deltaY:p,highlightPort:h})},renderPorts:function(){const{lastNodeData:e={}}=this.state;let n,o,{x:r,y:i,width:a,height:s,app:c,graph:l,size:p,node:d,ports:u,nodeID:h,color:f,highlightPort:g,showPortData:m}=this.props,v=h,y=void 0!==this.props.export,b=u.inports;o=(n=Object.keys(b)).length;let w=n.map(function(e){let n=b[e],o={app:c,graph:l,node:d,key:v+".in."+n.label,label:n.description,processKey:v,isIn:!0,isExport:y,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:n.x,y:n.y,size:_.toNumber(p),siblings:b,showPortData:!_.isEmpty(m)&&m.includes(n.label),port:{process:v,port:n.label,type:n.type,subType:n.subType,angle:n.angle,autoReceive:n.autoReceive},highlightPort:g,route:n.route,allowEdgeStart:this.props.allowEdgeStart};return l.edges.find(e=>e.metadata.error&&e.to.node==v&&e.to.port==n.label)&&(o.className="alert"),t.Port2(o)}.bind(this)),x=t.merge(t.config.node.inports,{children:w});e.highlightPort=g,e.inports=b,e.inportsGroup=t.factories.node.createNodeInportsGroup.call(this,x);let C=this.props.ports.outports;o=(n=Object.keys(C)).length;let S=n.map(function(e){let n=C[e],o={app:c,graph:l,node:d,key:v+".out."+n.label,label:n.description,processKey:v,isIn:!1,isExport:y,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:n.x,y:n.y,color:f,size:_.toNumber(p),siblings:C,showPortData:!_.isEmpty(m)&&m.includes(n.label),port:{process:v,port:n.label,type:n.type,subType:n.subType,angle:n.angle},highlightPort:g,route:n.route,allowEdgeStart:this.props.allowEdgeStart};return t.Port2(o)}.bind(this)),I=t.merge(t.config.node.outports,{children:S});return e.outports=C,e.outportsGroup=t.factories.node.createNodeOutportsGroup.call(this,I),e},renderDefs:function(){let{nodeID:e,width:n,color:o,size:r}=this.props;"rgba(255,255,255,1)"===o&&(o="rgba(255,255,255,.6)");const i=`\n        <linearGradient id="${e}-gradient">\n          <stop offset="0" style="stop-color:${o}; stop-opacity:1" />\n          <stop offset="1" style="stop-color:${o}; stop-opacity:0.39" />\n        </linearGradient>\n        <clipPath id="${e}-cutOff">\n          <rect x="0" y="0" width="${n}" height="${t.config.nodeHeadHeight[r]}" />\n        </clipPath>\n      `;return React.DOM.defs({dangerouslySetInnerHTML:{__html:i}})},renderFoot:function(){const{width:e,height:n,receieveMsgType:o}=this.props,{nodeFootHeight:r,nodeRadius:i,nodeFootSpace:a}=t.config,s=t.factories.createRect.call(this,{className:"sp-graph-node-footer",x:a,y:n-(r+a),width:e-2*a,height:r,rx:i,ry:i,fill:"rgba(255, 255, 255, 0.1)"}),c=React.createElement("tspan",null,"运行耗时 "),l=React.createElement("tspan",{className:"runtimes"},"0"),p=React.createElement("tspan",null,"s"),d=[s,t.factories.createText.call(this,{className:"sp-graph-node-footer-run",x:e-2*a,y:n-a-r/2,fill:"#fff",children:[c,l,p]})];if(o){const e=t.factories.createText.call(this,{className:"sp-graph-node-footer-receivetype",x:2*a,y:n-a-r/2,fill:"#fff",children:this.receieveType[o].label});d.push(e)}return d},renderCrown:function(){const{receieveMsgType:e,errorCount:n}=this.props,o={className:"sp-graph-node-crown-rect",width:24,height:24,rx:2,ry:2,fill:"rgba(25, 25, 28, 0.8)",stroke:"#454647",strokeWidth:1},r=t.factories.createRect.call(this,Object.assign({x:-12,y:-12},o)),i=t.factories.createRect.call(this,o),a=t.factories.createText.call(this,{className:"sp-graph-icon sp-graph-node-status-running the-graph-spin",fill:"#969696",children:t.FONT_ICON.cog}),s=t.factories.createText.call(this,{className:"sp-graph-icon sp-graph-node-status-success the-graph-success-icon",fill:"#64F490",children:t.FONT_ICON.yunhangchenggong}),c=t.factories.createText.call(this,{className:"sp-graph-icon sp-graph-node-status-error the-graph-error-icon",fill:"#E75959",children:t.FONT_ICON.yunhangshibai}),l=t.factories.createText.call(this,{className:"sp-graph-node-error-count",x:12,y:12,fill:"#E75959",children:n||"0"}),p=[t.factories.createGroup.call(this,{className:"sp-graph-node-status",transform:"translate(12,12)",children:[r,a,s,c]}),t.factories.createGroup.call(this,{className:"sp-graph-node-error",transform:`translate(${e?60:30}, 0)`,children:[i,l]})];if(e){const n=t.factories.createRect.call(this,o),r=t.factories.createText.call(this,{className:"sp-graph-icon",x:12,y:12,fill:this.receieveType[e].fill,children:t.FONT_ICON[this.receieveType[e].icon]}),i=t.factories.createGroup.call(this,{className:"sp-graph-node-receivetype noRun",transform:"translate(30, 0)",children:[n,r]});p.push(i)}return t.factories.createGroup.call(this,{className:"sp-graph-node-crown",transform:"translate(0, -30)",children:p})},renderBox:function(){const{nodeID:e,width:n,height:o,label:r,sublabel:i,color:a,icon:s,selected:c,size:l,receieveMsgType:p}=this.props,{nodeHeadHeight:d,nodeRadius:u,nodeLabelSize:h}=t.config;let f=r;if(t.factories.strlen(r)>h[l]){f=t.factories.strsub(r,h[l]-2)[0]+"…"}const g=t.factories.createRect.call(this,{className:"sp-graph-node-border",x:0,y:0,width:n,height:o,rx:t.config.nodeRadius,ry:t.config.nodeRadius,fill:"#19191C",stroke:a,strokeWidth:2}),m=this.renderDefs(),v=t.factories.createRect.call(this,{className:"sp-graph-node-header",x:0,y:0,width:n,height:d[l]+u,rx:u,ry:u,fill:`url(#${e}-gradient)`,clipPath:`url(#${e}-cutOff)`}),y=t.FONT_ICON[s]||t.FONT_ICON.cube,b=t.factories.createText.call(this,{className:"sp-graph-icon sp-graph-node-icon",x:d[l]/2,y:d[l]/2,fill:"url(#icon-gradient)",children:y}),w=i&&i!=r&&_.toNumber(l)>=1;let x=[m,g,v,b,t.factories.createText.call(this,{className:"sp-graph-node-label",x:d[l]-2,y:w?d[l]/4+3:d[l]/2,children:f,fill:"#fff"})];if(w){const e=t.factories.createText.call(this,{className:"sp-graph-node-sublabel",x:d[l]-2,y:3*d[l]/4+4,children:i,fill:"rgba(255, 255, 255, 0.7)"});x.push(e)}if(_.toNumber(l)>=1){const e=this.renderFoot();x=x.concat(e)}return t.factories.createGroup.call(this,{className:"sp-graph-node-rect "+this.size[l]+(c?" selected":""),children:x})},renderContent:function(){const{width:e,height:n,size:o,nodeID:r}=this.props,{preview:i}=this.state,{nodeContentSize:a,nodeFootHeight:s,nodeFootSpace:c,nodeHeadHeight:l}=t.config,p=a[0],d=n-l[o]-s-3*c,u=(e-p)/2,h=l[o]+c;if(this.props.preview){const e=t.factories.createRectImg.call(this,{x:0,y:0,width:p,height:d,id:"img_"+r,href:i}),n=t.factories.createRect.call(this,{x:0,y:0,width:p,height:d,fill:"url(#img_"+this.props.nodeID+")"});return t.factories.createGroup.call(this,{className:"sp-graph-node-content",transform:`translate(${u}, ${h})`},[e,n])}return t.factories.createGroup.call(this,{className:"sp-graph-node-chart",transform:`translate(${u}, ${h})`},[])},renderSelected:function(){const{width:e,height:n,color:o}=this.props;return t.factories.createRect.call(this,{className:"sp-graph-node-selected",x:-5,y:-5,width:e+10,height:n+10,rx:t.config.nodeRadius+3,ry:t.config.nodeRadius+3,fill:"none",stroke:o,strokeWidth:1})},render:function(){this.props.ports.dirty&&(this.props.ports.dirty=!1);const{x:e,y:n,size:o,label:r,nodeID:i,error:a}=this.props,s=this.renderBox(),c=this.renderCrown(),{inportsGroup:l,outportsGroup:p}=this.renderPorts();let d=[this.renderSelected(),s,c,l,p];2==o&&d.push(this.renderContent());let u={id:i,className:"node drag "+(a?" error":""),name:i,key:i,title:r,transform:"translate("+e+","+n+")"};return t.factories.createGroup.call(this,u,d)}}))}},{}],38:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph,n=function(){return(new Date).getTime()};t.config.port={container:{className:"port arrow"},backgroundCircle:{className:"port-circle-bg"},arc:{className:"port-arc"},line:{ref:"route",className:"port-line"},innerCircle:{ref:"circleSmall"},highlightCircle:{ref:"circleHighlight"},text:{ref:"label",className:"port-label drag"},diamond:{className:"port-diamond",points:"-4,0 0,-4 4,0, 0,4",fill:"#fff",strokeWidth:1},size:4},t.factories.port={createPortGroup:t.factories.createGroup,createPortBackgroundCircle:t.factories.createCircle,createPortArc:t.factories.createPath,createPortInnerCircle:t.factories.createCircle,createPortHighlightCircle:t.factories.createCircle,createPortLabelText:t.factories.createText,createArrow:t.factories.createPolygon},t.Port=React.createFactory(React.createClass({displayName:"TheGraphPort",defaultProps:{allowEdgeStart:!0},space:t.config.nodeRadius,threshold:t.config.edgeDistance,size:t.config.port.size,getInitialState:function(){const{x:e,y:t,isIn:n,port:o}=this.props;let r=o.angle;return r||(r=n?180:0),{moving:!1,startEvent:void 0,x:e,y:t,angle:r,highlightVerified:void 0,highlightVerifiedLastModified:void 0}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.edgeStart),e.addEventListener("mouseup",this.edgeStart),e.addEventListener("mouseenter",this.handleMouseEnter),e.addEventListener("mouseleave",this.handleMouseLeave),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.$graph=$(document.querySelector(".the-graph-app")),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext));const{x:t,y:n,angle:o}=this.state;this.handlePortChange(this.props.port.port,{x:t,y:n,angle:o})},componentWillReceiveProps:function(e){let{x:t,y:n,port:o}=e;t===this.props.x&&n===this.props.y||this.setState({x:t,y:n},()=>this.handlePortChange(o.port,{x:t,y:n}))},shouldComponentUpdate:function(e,t){return e.highlightPort!==this.props.highlightPort||t.highlightVerified!==this.state.highlightVerified||t.highlightVerifiedLastModified!==this.state.highlightVerifiedLastModified||t.x!==this.state.x||t.y!==this.state.y||t.angle!==this.state.angle||t.tooltip!==this.state.tooltip||t.active!==this.state.active},componentWillUnmount:function(){this.$graph&&this.$graph.off("mousemove",this.handleMouseMove),this.$graph&&this.$graph.off("mouseup",this.handleMouseUp)},handleMouseEnter:function(){if(_.get(this.props,"app.state.scale")<t.zbpBig&&!this.state.highlightVerified){const e=this;this.timer=setTimeout(function(){e.setState({tooltip:!0})},600)}},handleMouseLeave:function(){const{tooltip:e}=this.state;this.timer&&clearTimeout(this.timer),e&&this.setState({tooltip:!1})},showContext:function(e){if(this.props.isExport)return;if(e&&e.target===ReactDOM.findDOMNode(this.refs.label))return;e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.isIn?"nodeInport":"nodeOutport",x:t,y:n,graph:this.props.graph,itemKey:this.props.label,item:this.props.port})},getContext:function(e,n,o){return t.Menu({menu:e,options:n,label:this.props.label,triggerHideContext:o})},handleMouseMove:function(e){const{isIn:t,nodeWidth:n,nodeHeight:o,siblings:r,port:i}=this.props;let{active:a,drawing:s,x:c,y:l,startEvent:p,startPort:d}=this.state;const u=_.get(this.props,"app.state.scale"),h=(e.clientX-p.clientX)/u,f=(e.clientY-p.clientY)/u;if(!a)return void(s||t||!(Math.abs(h)>this.size||Math.abs(f)>this.size)||(this.isDown=!1,this.setState({drawing:!0},()=>this.onTriggerEdgeEvent(p)),this.$graph.off("mousemove",this.handleMouseMove)));const g=o-this.space,m=n-this.space;let v,y,b;if(0===c||c===n){const e=_.filter(r,{x:c});b=(v=o/((y=e.length)+1))*y,(l=d.y+f)<v&&this.handlePortChange(i.port,{y:v}),l>b&&this.handlePortChange(i.port,{y:b});const t=_.find(e,e=>Math.abs(l-e.y)<this.size&&e.label!==i.port);t&&((l=t.y)>this.state.y?t.y-=v:t.y+=v,this.handlePortChange(t.label,{y:t.y}),this.handlePortChange(i.port,{y:l})),l<0&&(l=1),l>o&&(l=o-1)}if(0===l||l===o){const e=_.filter(r,{y:l});b=(v=n/((y=e.length)+1))*y,(c=d.x+h)<v&&this.handlePortChange(i.port,{x:v}),c>b&&this.handlePortChange(i.port,{x:b});const t=_.find(e,e=>Math.abs(c-e.x)<this.size&&e.label!==i.port);t&&((c=t.x)>this.state.x?t.x-=v:t.x+=v,this.handlePortChange(t.label,{x:t.x}),this.handlePortChange(i.port,{x:c})),c<0&&(c=1),c>n&&(c=n-1)}t?l>0&&l<=this.space&&h>=0&&f<=0?this.handleUpdateAngle({key:"y",val:0,size:n,angle:90},{key:"x",val:0,size:o},"x"):c>0&&c<=this.space&&h<=0&&f>=0&&this.handleUpdateAngle({key:"x",val:0,size:o,angle:180},{key:"y",val:0,size:n},"y"):l<o&&l>=g&&h<=0&&f>=0?this.handleUpdateAngle({key:"y",val:o,size:n,angle:270},{key:"x",val:n,size:o},"x"):c<n&&c>=m&&h>=0&&f<=0&&this.handleUpdateAngle({key:"x",val:n,size:o,angle:0},{key:"y",val:o,size:n},"y"),this.setState({x:c,y:l})},handleUpdateAngle:function(e,t,n){const{siblings:o,port:r,isIn:i}=this.props,a=_.sortBy(_.filter(o,{[`${e.key}`]:e.val}),e=>e[`${t.key}`]),s=_.sortBy(_.filter(o,{[`${t.key}`]:t.val}),t=>t[`${e.key}`]),c=_.remove(s,{label:r.port})[0];c[`${e.key}`]=e.val,i?a.unshift(c):a.push(c);const l=e.size/(a.length+1),p=t.size/(s.length+1),d=this;!_.isEmpty(a)&&a.forEach(function(n,o){d.handlePortChange(n.label,{[`${e.key}`]:e.val,[`${t.key}`]:l*(o+1),angle:e.angle})}),!_.isEmpty(s)&&s.forEach(function(t,n){d.handlePortChange(t.label,{[`${e.key}`]:p*(n+1)})}),this.setState({[`${e.key}`]:e.val,[`${n}`]:l,angle:e.angle},()=>{this.handleMouseUp()})},handlePortChange:function(e,t){const{graph:n,node:o,processKey:r}=this.props,i=_.get(o,"metadata"),a=_.get(i,"def.ports").map(function(n){return n.uuid===e?{...n,...t}:n});n.setNodeMetadata(r,{def:{...i.def,ports:a}})},handleMouseUp:function(){const{x:e,y:t}=this.props;this.$graph.off("mousemove",this.handleMouseMove),this.$graph.off("mouseup",this.handleMouseUp),this.setState({x:e,y:t,active:!1,drawing:!1,startPort:void 0,startEvent:void 0})},onTriggerEdgeEvent:function(e){const{isExport:t,allowEdgeStart:n,node:o,isIn:r,port:i,route:a}=this.props,{highlightVerified:s}=this.state;if(t||!n)return;if(e&&e.target===ReactDOM.findDOMNode(this.refs.label))return;let c=new CustomEvent("the-graph-edge-start",{detail:{node:o,isIn:r,port:i,route:a,offsetX:e.offsetX,offsetY:e.offsetY,nodeType:o.metadata.def.type,highlightVerified:s},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(c)},handlePortActive:function(){clearTimeout(this.timerDown),this.isDown&&this.setState({active:!0,startPort:{x:this.state.x,y:this.state.y}},()=>{})},edgeStart:function(e){if("mousedown"!==e.type)return"mouseup"===e.type&&(this.state.active&&this.handleMouseUp(),this.state.highlightVerified&&this.onTriggerEdgeEvent(e),this.isDown&&(this.isDown=!1)),!1;{e.stopPropagation(),this.isDown=!0,this.setState({startEvent:{clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,target:e.target}}),this.$graph.on("mousemove",this.handleMouseMove),this.$graph.on("mouseup",this.handleMouseUp);const t=this;this.timerDown=setTimeout(function(){t.handlePortActive()},600)}},render:function(){let{label:e,isIn:o,highlightPort:r,port:i,node:a,graph:s,className:c}=this.props;const{x:l,y:p,tooltip:d,angle:u,active:h,highlightVerified:f}=this.state;let g,m;if(r&&!i.autoReceive){if(void 0===f||n()-this.state.highlightVerifiedLastModified>1e3){let e=!1,t=!1;r.from&&r.from.process!==a.id&&r.isIn===o&&(_.findIndex(s.edges,e=>e.from.node==r.from.process&&e.from.port==r.from.port&&e.to.node==i.process&&e.to.port==i.port)>-1&&(e=!0),(!e||_.get(r,"updating.to.node")==a.id&&_.get(r,"updating.to.port")==i.port)&&(t=!0)),!r.to||r.to.process===a.id||r.isIn||o||(!e||_.get(r,"updating.from.node")==a.id&&_.get(r,"updating.from.port")==i.port)&&(t=!0),this.setState({highlightVerified:t,highlightVerifiedLastModified:n()})}f&&(m={className:"port-circle-highlight-gray",r:6},!r||i.autoReceive||r.type!==i.type||r.subType&&i.subType&&r.subType!==i.subType&&"all"!==r.subType&&"all"!==i.subType||(m.className="port-circle-highlight"),m=t.merge(t.config.port.highlightCircle,m),g=t.factories.port.createPortHighlightCircle.call(this,m))}let v={};if(e&&e.length>7){let t=30/(4*e.length)*6;v.fontSize=t+"px"}let y={};180===u?(y.x=5,v.textAnchor="start",d&&e.length>0&&(v.transform="scale(2)",y.x=-5,v.textAnchor="end",v.visibility="visible")):0===u?(y.x=-5,v.textAnchor="end",d&&e.length>0&&(v.transform="scale(2)",y.x=5,v.textAnchor="start",v.visibility="visible")):90===u?(y.y=8,d&&e.length>0&&(v.transform="scale(2)",y.y=-5,v.visibility="visible")):270===u&&(y.y=-8,d&&e.length>0&&(v.transform="scale(2)",y.y=5,v.visibility="visible")),y=t.merge(t.config.port.text,Object.assign(y,{style:v,children:e}));let b=t.factories.port.createPortLabelText.call(this,y);const w=t.merge(t.config.port.diamond,{fill:o?"#fff":"#e0e0e0"});let x=[b,t.factories.edge.createArrow(w)];if(o&&i.autoReceive){let e=t.merge(t.config.port.line,{d:"M-10,0 H0,0"}),n=t.factories.port.createPortArc(e);x.unshift(n)}h&&(g=t.factories.port.createPortHighlightCircle.call(this,{className:"port-circle-highlight-active",r:6})),g&&x.unshift(g);let C=t.merge(t.config.port.container,{title:e,transform:"translate("+l+","+p+")",id:i.process+"-"+i.port});return c&&(C.className+=` ${c}`),t.factories.port.createPortGroup.call(this,C,x)}}))}},{}],39:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph,n=function(){return(new Date).getTime()};t.Port2=React.createFactory(React.createClass({displayName:"TheGraphPort2",defaultProps:{allowEdgeStart:!0},space:t.config.nodeRadius,threshold:t.config.edgeDistance,size:t.config.portSize,offsetX:5,points:{in:[[0,2],[0,6],[4,8],[8,6],[8,2],[4,0]],out:[[-8,2],[-8,6],[-4,8],[0,6],[0,2],[-4,0]]},getInitialState:function(){const{x:e,y:t,isIn:n,port:o}=this.props;let r=o.angle;return r||(r=n?180:0),{moving:!1,startEvent:void 0,x:e,y:t,angle:r,highlightVerified:void 0,highlightVerifiedLastModified:void 0}},componentWillReceiveProps:function(e){const{isIn:t,highlightPort:o,port:r,node:i,graph:a}=e,{highlightVerified:s,highlightVerifiedLastModified:c}=this.state;if(!_.isEqual(o,this.props.highlightPort))if(!o||r.autoReceive)this.setState({highlightVerified:!1});else if(!s||n()-c>1e3){let e=!1,s=!1;o.from&&o.from.process!==i.id&&o.isIn===t&&(_.findIndex(a.edges,e=>e.from.node==o.from.process&&e.from.port==o.from.port&&e.to.node==r.process&&e.to.port==r.port)>-1&&(e=!0),(!e||_.get(o,"updating.to.node")==i.id&&_.get(o,"updating.to.port")==r.port)&&(s=!0)),!o.to||o.to.process===i.id||o.isIn||t||(!e||_.get(o,"updating.from.node")==i.id&&_.get(o,"updating.from.port")==r.port)&&(s=!0),this.setState({highlightVerified:s,highlightVerifiedLastModified:n()})}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.edgeStart),e.addEventListener("mouseup",this.edgeStart),this.$graph=$(document.querySelector(".the-graph-app")),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext))},shouldComponentUpdate:function(e,t){return t.highlightVerified!==this.state.highlightVerified||t.highlightVerifiedLastModified!==this.state.highlightVerifiedLastModified||e.x!==this.props.x||e.y!==this.props.y||e.color!==this.props.color||e.showPortData!==this.props.showPortData},showContext:function(e){if(this.props.isExport)return;if(e&&e.target===ReactDOM.findDOMNode(this.refs.label))return;e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,n=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.isIn?"nodeInport":"nodeOutport",x:t,y:n,graph:this.props.graph,itemKey:this.props.label,item:this.props.port})},getContext:function(e,n,o){return t.Menu({menu:e,options:n,label:this.props.label,triggerHideContext:o})},onTriggerEdgeEvent:function(e){const{isExport:t,allowEdgeStart:n,node:o,isIn:r,port:i,route:a}=this.props,{highlightVerified:s}=this.state;if(t||!n)return;if(e&&e.target!==ReactDOM.findDOMNode(this.refs.polygon)&&e.target!==ReactDOM.findDOMNode(this.refs.highlightPort))return;let c=new CustomEvent("the-graph-edge-start",{detail:{node:o,isIn:r,port:i,route:a,offsetX:e.offsetX,offsetY:e.offsetY,nodeType:o.metadata.def.type,highlightVerified:s},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(c)},edgeStart:function(e){const{isIn:t}=this.props;return"mousedown"===e.type&&(e.stopPropagation(),!t&&this.onTriggerEdgeEvent(e)),"mouseup"===e.type&&this.state.highlightVerified&&this.onTriggerEdgeEvent(e),!1},renderDataRect:function(){const{x:e,y:n,nodeWidth:o,isIn:r,size:i}=this.props,a=2==i?70:(o-10)/2-this.offsetX-10,s=r?e+10:-a-10;return{dataRect:t.factories.createRect.call(this,{x:s,y:16,rx:2,ry:2,width:a,height:16,stroke:"#454647",strokeWidth:1}),dataText:t.factories.createText.call(this,{className:"sp-graph-port-data",x:r?s+4:-14,y:28,children:"",fill:"#fff"})}},render:function(){let{x:e,y:n,label:o,isIn:r,highlightPort:i,port:a,node:s,className:c,showPortData:l}=this.props;const{highlightVerified:p}=this.state;let d,u=_.get(s,"metadata.color")||"rgba(215, 221, 224, 0.7)";if("rgba(255,255,255,1)"===u&&(u="rgba(255,255,255,.6)"),i&&!a.autoReceive&&p){const e=this.size/2,n={className:"sp-graph-port-highlight-gray",ref:"highlightPort",r:7,cx:r?e:-e,cy:e};!i||a.autoReceive||i.type!==a.type||i.subType&&a.subType&&i.subType!==a.subType&&"all"!==i.subType&&"all"!==a.subType||(n.className="sp-graph-port-highlight"),d=t.factories.createCircle.call(this,n)}let h=[t.factories.createText.call(this,{className:"sp-graph-port-label",ref:"label",x:r?16:-16,y:9,fill:"#969696",children:o}),t.factories.createPolygon.call(this,{className:"sp-graph-port-polygon",ref:"polygon",points:this.points[r?"in":"out"],fill:r?"none":u,stroke:"rgba(255,255,255,.8)",strokeWidth:1})];if(r&&a.autoReceive){let e=t.merge(t.config.port.line,{d:"M-10,0 H0,0"}),n=t.factories.port.createPortArc(e);h.unshift(n)}if(d&&h.unshift(d),l){const{dataRect:e,dataText:t}=this.renderDataRect();h.push(e),h.push(t)}let f={className:c?"sp-graph-port "+(r?"in ":"out ")+c:"sp-graph-port "+(r?"in ":"out "),title:o,transform:"translate("+(r?e+this.offsetX:e-this.offsetX)+","+n+")",id:a.process+"-"+a.port};return t.factories.port.createPortGroup.call(this,f,h)}}))}},{}],40:[function(e,t,n){t.exports.register=function(e){let t=e.TheGraph,n={nodeSize:12,nodeRadius:5,nodeSide:56,contextPortSize:36,zbpBig:1.2,zbpNormal:.4,zbpSmall:.01,config:{nodeSize:12,nodeWidth:90,nodeHeight:90,nodeRadius:5,nodeSize1:{.5:45,1:90,2:180},nodeSize2:{.5:120,1:220,2:420},nodeSize2MinHeight:{.5:100,1:136,2:256},nodeFootHeight:20,nodeFootSpace:8,nodeHeadHeight:{.5:30,1:42,2:42},nodeLabelSize:{.5:12,1:24,2:52},nodeContentSize:[230,130],portSize:8,portOffsetHeight:46,autoSizeNode:!0,maxPortCount:6,edgeDistance:16,nodeHeightIncrement:12,focusAnimationDuration:1500}};for(let e in n)t[e]=n[e];"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame),t.findMinMax=function(e,t){let n,o;if(void 0===t&&(t=e.nodes.map(function(e){return e.id}),n=e.inports,o=e.outports),t.length<1)return;let r,a,s=1/0,c=1/0,l=-1/0,p=-1/0,d=t.length;for(let n=0;n<d;n++){let o=t[n],r=e.getNode(o);if(!r||!r.metadata)continue;r.metadata.x<s&&(s=r.metadata.x),r.metadata.y<c&&(c=r.metadata.y);let i=r.metadata.x+r.metadata.width,a=r.metadata.y+r.metadata.height;i>l&&(l=i),a>p&&(p=a)}if(n)for(d=(r=Object.keys(n)).length,i=0;i<d;i++)(a=n[r[i]]).metadata&&(a.metadata.x<s&&(s=a.metadata.x),a.metadata.y<c&&(c=a.metadata.y),a.metadata.x>l&&(l=a.metadata.x),a.metadata.y>p&&(p=a.metadata.y));if(o)for(d=(r=Object.keys(o)).length,i=0;i<d;i++)(a=o[r[i]]).metadata&&(a.metadata.x<s&&(s=a.metadata.x),a.metadata.y<c&&(c=a.metadata.y),a.metadata.x>l&&(l=a.metadata.x),a.metadata.y>p&&(p=a.metadata.y));return isFinite(s)&&isFinite(c)&&isFinite(l)&&isFinite(p)?{minX:s,minY:c,maxX:l,maxY:p}:null},t.findFit=function(e,t,n){return{x:0,y:0,scale:1}},t.findAreaFit=function(e,n,o,r){let i={minX:e.x<n.x?e.x:n.x,minY:e.y<n.y?e.y:n.y,maxX:e.x>n.x?e.x:n.x,maxY:e.y>n.y?e.y:n.y};i.minX-=t.config.nodeSize,i.minY-=t.config.nodeSize,i.maxX+=2*t.config.nodeSize,i.maxY+=2*t.config.nodeSize;let a,s,c,l=i.maxX-i.minX,p=i.maxY-i.minY,d=o/l,u=r/p;return d<u?(a=d,s=0-i.minX*a,c=0-i.minY*a+(r-p*a)/2):(a=u,s=0-i.minX*a+(o-l*a)/2,c=0-i.minY*a),{x:s,y:c,scale:a}},t.findNodeFit=function(e,n,o){let r,i,a,s=e.metadata.x-t.config.nodeSize,c=e.metadata.y-t.config.nodeSize,l=e.metadata.x+2*t.config.nodeSize-s,p=e.metadata.y+2*t.config.nodeSize-c,d=n/l,u=o/p;return d<u?(i=0-s*(r=d),a=0-c*r+(o-p*r)/2):(i=0-s*(r=u)+(n-l*r)/2,a=0-c*r),{x:i,y:a,scale:r}},t.SVGImage=React.createFactory(React.createClass({displayName:"TheGraphSVGImage",render:function(){let e="<image ";return e=(e=(e=(e=(e=e+'xlink:href="'+this.props.src+'"')+'x="'+this.props.x+'"')+'y="'+this.props.y+'"')+'width="'+this.props.width+'"')+'height="'+this.props.height+'"',e+="/>",React.DOM.g({className:this.props.className,dangerouslySetInnerHTML:{__html:e}})}})),t.TextBG=React.createFactory(React.createClass({displayName:"TheGraphTextBG",render:function(){let e=this.props.text;e||(e="");let t=this.props.height,n=e.length*this.props.height*2/3,o=this.props.height/2,r="start",i=this.props.x,a=this.props.y-t/2;return"center"===this.props.halign&&(i-=n/2,r="middle"),"right"===this.props.halign&&(i-=n,r="end"),React.DOM.g({className:this.props.className?this.props.className:"text-bg"},React.DOM.rect({className:"text-bg-rect",x:i,y:a,rx:o,ry:o,height:1.1*t,width:n}),React.DOM.text({className:this.props.textClassName?this.props.textClassName:"text-bg-text",x:this.props.x,y:this.props.y,children:e}))}})),t.getOffset=function(e){let t=function(e){let n,o={top:0,left:0};return e?(o.top+=e.offsetTop||0,o.left+=e.offsetLeft||0,n=t(e.offsetParent),o.top+=n.top,o.left+=n.left,o):o};try{return t(e)}catch(e){return t()}}}},{}]},{},[1])(1)}),"suanpan"===window.appConfig.ossType&&(window.appConfig.signature=ALY.util.crypto.hmac(window.appConfig.oss.ossAccessSecret,window.appConfig.userId,"base64","sha1"),window.appConfig.signVersion="v1"),(app=angular.module("app",["angularBootstrapNavTree","ngAnimate","ngMessages","ngSanitize","ui.bootstrap","ui.select","ui.router","ui.bootstrap.contextMenu","ui.codemirror","ui.colorpicker","toaster","as.sortable","app.tpls","ngCookies"])).constant("APPMENU",{predict:{name:"工业程序",icon:"icongongyechengxu",route:"app.predict",description:"数据 + 算法 + 硬件 + 可视化，全混合流计算技术",userConfig:"predictDirs",componentType:"service, dashboard",visible:!0},algo:{name:"AI开发",icon:"iconAIkaifa",route:"app.exp",description:"为机器学习和深度学习提供从数据处理、模型训练到服务部署的一站式服务",userConfig:"appDirs",componentType:"algo,model",visible:!0},processMining:{name:"流程挖掘",icon:"iconliuchengwajue",route:"app.predict",description:"通过从事件日志中提取出知识，从而去发现、监控和改进实际业务过程",userConfig:"pmDirs",componentType:"pm",visible:!1},edge:{name:"边缘计算",icon:"iconbianyuanjisuan",route:"predict",description:"基于容易编排，采用网络、计算、存储、应用核心能力为一体的开放平台",subMenu:[{id:"project",name:"项目"},{id:"hardware",name:"接入设备"}],userConfig:"edgeDirs",componentType:"edge",visible:!0},mechanism:{name:"机理开发",icon:"iconjilikaifa",route:"app.predict",description:"将专家经验沉淀为决策模型，接入实时数据，构建决策引擎",componentType:"mechanism",visible:!0},rpa:{name:"RPA开发",icon:"iconRPAkaifa",route:"app.exp",description:"将重复性劳动进行自动化出来，在业务流程上实现自动化智能升级",userConfig:"rpaDirs",componentType:"rpa",visible:!0}}),app.constant("COMPONENT_TYPES",[{name:"算法组件",type:"algo",icon:"iconfont iconAIkaifa"},{name:"服务组件",type:"service",icon:"iconfont icongongyechengxu"},{name:"前面板组件",type:"dashboard",icon:"iconfont iconchart-area"},{name:"RPA组件",type:"rpa",icon:"iconfont iconRPAkaifa"},{name:"离散事件仿真组件",type:"des",icon:"iconfont iconluansheng"}]),app.constant("USER_CONFIG",{publicDirId:1,myDirId:2,appDirs:[{id:1,label:"分享给我的项目",folder:!0,children:[]},{id:2,label:"我的项目",folder:!0,children:[]}],componentDirs:[{id:1,label:"分享给我的组件",folder:!0,children:[]},{id:2,label:"我的组件",folder:!0,children:[]}]}),app.constant("nodeTabIcon",{overview:"icongailan",params:"iconshezhi-copy",fields:"iconziduan",tune:"iconzhihangtiaoyou",test:"iconziduan",debug:"iconziduan"}),app.constant("showPortDataTypes",["number","bool","string","json"]),app.constant("pageSizeOption",[{name:"12 条/页",value:12},{name:"24 条/页",value:24},{name:"48 条/页",value:48},{name:"72 条/页",value:72},{name:"96 条/页",value:96},{name:"120 条/页",value:120}]),app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$urlRouterProvider","$uiRouterProvider","$locationProvider",function(e,t,n,o,r,i,a){app.controller=e.register,app.directive=t.directive,app.filter=n.register,app.factory=o.factory,app.service=o.service,app.constant=o.constant,app.value=o.value,r.otherwise("/web"),i.plugin(window["@uirouter/dsr"].DSRPlugin),i.plugin(window["@uirouter/sticky-states"].StickyStatesPlugin),a.html5Mode({enabled:!0,requireBase:!0}),moment.locale("zh-cn",{relativeTime:{s:"%d 秒"}}),moment.relativeTimeThreshold("s",50),moment.relativeTimeThreshold("ss",51),window.spInstance=window.sp&&window.sp({dashboardPlugins:!0})}]).run(["$rootScope","$timeout","$state","$stateParams","applyFn","APPMENU","$window","nodeService","statisticsService","$location",function(e,t,n,o,r,i,a,s,c,l){e.pageLoading=!0,e.sidebarCollapsed=!0,e.$state=n,e.$stateParams=o,e.applyFn=r,e.global={},e.appConfig=window.appConfig,e.removedNodes=[],e.appMenu=i,e.appConfig._context,window.appConfig.env,e.appConfig.theme="dark",e.landingCollapsed=!1;const p=_.split(l.path(),"/");(p.indexOf("app")>0||p.indexOf("service")>0||p.indexOf("component")>0)&&(e.landingCollapsed=!0);const d=document.getElementById("container");let u;function h(e,t,n){e.removeEventListener(t,n),e.addEventListener(t,n)}window.goto=function(r,i,a){if(u=t(function(){e.landingCollapsed=!a,a?d.style.zIndex=1001:r||i||(d.style.zIndex=1),t.cancel(u)}),"customize"==r)n.go("app."+r,{componentId:i});else if(r){const e=_.get(appConfig.appMenu,`${r}.route`);n.go("app."+e,{type:r,id:i||"",refresh:o.refresh+1})}},e.log=function(){switch(arguments.length){case 0:return;case 1:arguments[0];break;case 2:arguments[0],arguments[1];break;case 3:arguments[0],arguments[1],arguments[2]}},e.copyNode=function(e,t){let n=o.type;a.localStorage.copiedNode=JSON.stringify({metadata:angular.copy(e),componentId:t,type:n})},e.pasteNode=function(){if(a.localStorage.copiedNode){let e=JSON.parse(a.localStorage.copiedNode);e.type===o.type&&s.pasteNode(e.metadata,e.componentId)}},h(window,"load",c.trackLoginEvent.bind(c)),h(window,"unload",c.trackLogoutEvent.bind(c)),h(window,"error",c.trackErrorEvent.bind(c))}]),app.factory("applyFn",["$rootScope",function(e){return function(t,n){t=angular.isFunction(t)?t:angular.noop,n=n&&n.$apply?n:e,t(),n.$$phase||n.$apply()}}]),app.directive("spInput",["$timeout",function(e){return{restrict:"AE",require:"?ngModel",scope:{setFocus:"="},link:function(t,n,o,r){t.setFocus&&(n.bind("focus",function(){let t=this;e(function(){t.select()})}),e(function(){n[0].focus()})),void 0!==o.type&&"number"===o.type&&r&&(r.$formatters.push(function(e){return _.isNull(e)?null:Number(e)}),r.$parsers.push(function(e){return _.isNull(e)?null:Number(e)}))}}}]).directive("indeterminate",function(){return{restrict:"A",link:function(e,t,n){let o=e.$watch(n.indeterminate,function(e){t[0].indeterminate=e});e.$on("$destroy",function(){o()})}}}),app.constant("APP_STATUS",{AppRunning:"1",AppStopped:"2",AppSuccess:"3",AppFailed:"4",AppStarting:"5",AppStopping:"6",AppDead:"7",AppCron:"8",AppWaiting:"9",AppUnknown:"0"}),app.constant("PARAM_TYPES",{string:{label:"单行文本框"},password:{label:"密码输入框"},storage_path:{label:"文件"},multi_string:{label:"多行文本框"},float:{label:"标签"},checkbox:{label:"复选框"},table_select:{label:"表选择"},file_select:{label:"文件选择"},formula_editor:{label:"编辑公式"},key_value:{label:"输入键值对"},partition_select:{label:"分区选择"},select:{label:"单选下拉"},multiselect:{label:"多选下拉"},colselect:{label:"字段选择",placeholder:"输入或者选择字段"},upload_file:{label:"上传文件"}}),app.constant("layoutPaths",{images:{root:"./images/",logo:"./images/logo/",profile:"./images/profile/",type:"./images/types/"}}),app.run(["componentService",function(e){}]),app.run(["toaster",function(e){window.navigator.onLine||e.pop("error","网络异常，请查看网络后重新打开"),window.addEventListener("online",function(){e.pop("success","网络已连接")}),window.addEventListener("offline",function(){e.pop("error","网络异常，请查看网络后重新打开")})}]),app.factory("redirectInterceptor",[function(){return{response:function(e){return"string"==typeof e.data&&e.data.indexOf("<title>登录</title>")>0&&location.reload(),e}}}]),app.config(["$httpProvider",function(e){e.interceptors.push("redirectInterceptor")}]),function(){let e,t=[].indexOf||function(e){for(let t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};(e=angular.module("angularBootstrapNavTree",[])).directive("abnTree",["$timeout","nodeService","$state","toaster","$rootScope","componentService","$stateParams","common",function(e,n,o,r,i,a,s,c){return{restrict:"E",templateUrl:"/tpl/blocks/nav_tree.html",replace:!0,scope:{treeData:"=",isCard:"=",contextType:"@",onSelect:"&",initialSelection:"@",expandedKeys:"=",treeControl:"="},link:function(l,p,d){let u,h,f,g,m,v,y,b,w,x,C;if(l.searched_rows=[],u=function(e){},null==d.iconExpand&&(d.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==d.iconCollapse&&(d.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==d.iconLeaf&&(d.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),null==d.expandLevel&&(d.expandLevel="3"),f=parseInt(d.expandLevel,10),!l.treeData)return;if(null==l.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");l.treeData=[treeData]}m=function(e){let t,n,o,r,i,a;for(t=function(n,o){let r,i,a,s,c;if(e(n,o),null!=n.children){for(c=[],i=0,a=(s=n.children).length;i<a;i++)r=s[i],c.push(t(r,o+1));return c}},a=[],o=0,r=(i=l.treeData).length;o<r;o++)n=i[o],a.push(t(n,1));return a},x=null,w=function(t){if(!t)return null!=x&&(x.selected=!1),void(x=null);if(t!==x){if(null!=x&&(x.selected=!1),t.selected=!0,x=t,h(t),null!=t.onSelect)return e(function(){return t.onSelect(t)});if(null!=l.onSelect)return e(function(){return l.onSelect({branch:t})})}},l.user_clicks_branch=function(e){if(e.folder){if(e.expanded=!e.expanded,l.expandedKeys){const t=_.findIndex(l.expandedKeys,e.id);e.expanded&&-1==t?l.expandedKeys.push(e.id):!e.expanded&&t>-1&&l.expandedKeys.splice(t,1)}if("components"==l.contextType)return}if(e!==x)return w(e)},v=function(e){let t;return t=void 0,e.parent_uid&&m(function(n){if(n.uid===e.parent_uid)return t=n}),t},g=function(e,t){let n;if(null!=(n=v(e)))return t(n),g(n,t)},h=function(e){return g(e,function(e){return e.expanded=!0})},l.tree_rows=[],l.isApp=o.includes("app.exp")||o.includes("app.predict"),b=function(){let e,n,o,r,i,a,s=[];for(m(function(e,t){if(!e.uid)return e.uid=""+Math.random()}),m(function(e){let t,n,o,r,i;if(angular.isArray(e.children)){for(i=[],n=0,o=(r=e.children).length;n<o;n++)t=r[n],i.push(t.parent_uid=e.uid);return i}}),l.tree_rows=[],m(function(e){let t,n;return e.children?e.children.length>0?(n=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){let o,r,i,a;for(a=[],o=0,r=(i=e.children).length;o<r;o++)t=i[o],a.push(n(t));return a}()):void 0:e.children=[]}),e=function(n,o,r){let i,a,c,p,u,h,f,g="components"===l.contextType&&!o.folder&&"my_component"!==o.type&&!o.usable;if(null==o.expanded&&(o.expanded=!1),null==o.classes&&(o.classes=[]),o.folder||o.children&&0!==o.children.length?o.expanded?(c=d.iconCollapse,s.push(o.id)):c=d.iconExpand:(c=o.icon||d.iconLeaf,t.call(o.classes,"leaf")<0&&o.classes.push("leaf")),o.selected&&(x=o),l.tree_rows.push({level:n,branch:o,id:o.id,label:o.label,classes:o.classes,tree_icon:c,folder:o.folder||!1,menuOptions:o.menu||null,disabled:g,selected:o.selected,visible:!1!==r&&(!o.folder||!1!==o.visible)}),null!=o.children){for(f=[],p=0,u=(h=o.children).length;p<u;p++)i=h[p],a=!1!==r&&o.expanded,f.push(e(n+1,i,a));return f}},a=[],o=0,r=(i=l.treeData).length;o<r;o++)n=i[o],a.push(e(1,n,n.visible));return a},l.$watch("treeData",b,!0),null!=d.initialSelection&&m(function(t){if(t.id==d.initialSelection)return e(function(){return w(t)})}),y=l.treeData.length,m(function(e,t){return e.level=t,e.expanded=e.level<f});const S="components"==l.contextType?angular.element("#app"):angular.element(".sp-app-dirs"),I=S.find("#simulator"),N=angular.element(".sp-app-aside"),T=S.find("#dragger");let E;return l.onmousedown=function(t,p){if(3==t.which||p.disabled||p.folder&&-1===p.classes.indexOf("droppable"))return;let d="components"==l.contextType&&N.offset().left+N.width();const u=angular.element(t.currentTarget);let h=(new Date).getTime(),f=p.type,g=p.folder,m=p.id,v=p.icon,y=p.componentId,b=p.componentType,w=p.label;if(p.branch&&(f=p.branch.type,w=p.branch.label,m=p.branch.id,y=p.branch.componentId,v=p.branch.icon,b=p.branch.componentType),"my_component"===f||"public_component"===f||"hufu_component"===f||"device_component"===f||g){if(!o.includes("app.customize")&&i.readOnly)return angular.element(".sp-app-actions .sp-alert").addClass("flash"),void e(function(){angular.element(".sp-app-actions .sp-alert").removeClass("flash")},3e3);let l=t.pageX,v=t.pageY;const x=angular.element(".navi");let C=136,N=x.height(),k=C+N;S.on("mousemove.abn.drag",function(e){if(!p.disabled&&(!E&&(e.pageX-l>=8||Math.abs(e.pageY-v)>=8)&&(E=g?T:I),E&&E.is(":hidden")&&(E.find(".tree-node-label").text(w),E.show()),E&&(g?E.offset({top:e.pageY-15,left:e.pageX<d?e.pageX-80:d-80}):o.includes("app.customize")?E.offset({top:e.pageY-45,left:e.pageX<d?e.pageX-45:d-90}):E.offset({top:e.pageY-45,left:e.pageX-45}),o.includes("app.customize")||e.pageX<d))){const t=x.scrollTop();e.pageY<C&&e.pageX<d?x.scrollTop(t-10):e.pageY>k&&e.pageX<d&&x.scrollTop(t+10)}}),S.find(".abn-tree .droppable").on("mouseenter.abn.drag",function(e){const t=angular.element(e.currentTarget),n=_.toNumber(u.attr("the-id")),o=_.toNumber(t.attr("the-id"));E&&(!g||g&&n!==o)&&t.addClass("row-highlight")}).on("mouseleave.abn.drag",function(e){E&&angular.element(e.currentTarget).removeClass("row-highlight")}).on("mouseup.abn.drag",function(e){if(!E)return;const t=angular.element(e.currentTarget);t.removeClass("row-highlight");const n=_.toNumber(u.attr("the-id")),o=_.toNumber(t.attr("the-id"));if(n&&o)if(g&&o!=n&&o!==p.branch.parentId){const e=c.getDirMap(i.userConfig.componentDirs),t=e[e[m].parentId],n=e[o],a=_.remove(t.children,function(e){return e.id==m})[0];a.parentId=o,n.children.push(a),i.saveConfig().then(function(e){i.$broadcast("node.list.reload"),r.pop("success","移动文件夹成功")},function(e){r.pop("error","移动文件夹失败, 网络错误")})}else g||a.changeDir(n,o).then(function(e){i.$broadcast("node.list.reload"),r.pop("success","移动组件成功")},function(e){r.pop("error","移动组件失败: "+e.msg)});else r.pop("error","移动组件失败")}),S.on("mouseup.abn.drag",function(e){if(e.stopPropagation(),S.off(".abn.drag"),S.find(".abn-tree .droppable").off(".abn.drag"),E&&(E.hide(),E=null),o.includes("app.customize")||e.pageX<d){if(o.includes("app.customize")&&!g){if(s.componentId==m)return;(new Date).getTime()-h<=500&&o.go("app.customize",{componentId:m})}}else e.pageX>d&&("public_component"===f?n.addPublicRemoteNode(y,e.pageX,e.pageY,f):"my_component"===f?"dashboard"===b?n.addRemoteDashboardNode(y,e.pageX,e.pageY,f):n.addRemoteNode(y,e.pageX,e.pageY,f):"hufu_component"!==f&&"device_component"!==f||n.addExternalNode(p.branch,e.pageX,e.pageY,f))})}},null!=l.treeControl&&angular.isObject(l.treeControl)?((C=l.treeControl).expand_all=function(){return m(function(e,t){return e.expanded=!0})},C.collapse_all=function(){return m(function(e,t){return e.expanded=!1})},C.get_first_branch=function(){if((y=l.treeData.length)>0)return l.treeData[0]},C.select_first_branch=function(){let e;return e=C.get_first_branch(),C.select_branch(e)},C.get_selected_branch=function(){return x},C.get_parent_branch=function(e){return v(e)},C.select_branch=function(e){return w(e),e},C.get_children=function(e){return e.children},C.select_parent_branch=function(e){let t;if(null==e&&(e=C.get_selected_branch()),null!=e&&null!=(t=C.get_parent_branch(e)))return C.select_branch(t),t},C.add_branch=function(e,t){return null!=e?(e.children.push(t),e.expanded=!0):l.treeData.push(t),t},C.add_root_branch=function(e){return C.add_branch(null,e),e},C.expand_branch=function(e){if(null==e&&(e=C.get_selected_branch()),null!=e)return e.expanded=!0,e},C.collapse_branch=function(e){if(null==e&&(e=x),null!=e)return e.expanded=!1,e},C.get_siblings=function(e){let t,n;if(null==e&&(e=x),null!=e)return n=(t=C.get_parent_branch(e))?t.children:l.treeData},C.get_next_sibling=function(e){let t,n;if(null==e&&(e=x),null!=e&&(n=C.get_siblings(e),y=n.length,(t=n.indexOf(e))<y))return n[t+1]},C.get_prev_sibling=function(e){let t,n;if(null==e&&(e=x),n=C.get_siblings(e),y=n.length,(t=n.indexOf(e))>0)return n[t-1]},C.select_next_sibling=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=C.get_next_sibling(e)))return C.select_branch(t)},C.select_prev_sibling=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=C.get_prev_sibling(e)))return C.select_branch(t)},C.get_first_child=function(e){let t;if(null==e&&(e=x),null!=e&&(null!=(t=e.children)?t.length:void 0)>0)return e.children[0]},C.get_closest_ancestor_next_sibling=function(e){let t,n;return null!=(t=C.get_next_sibling(e))?t:(n=C.get_parent_branch(e),C.get_closest_ancestor_next_sibling(n))},C.get_next_branch=function(e){let t;if(null==e&&(e=x),null!=e)return null!=(t=C.get_first_child(e))?t:t=C.get_closest_ancestor_next_sibling(e)},C.select_next_branch=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=C.get_next_branch(e)))return C.select_branch(t),t},C.last_descendant=function(e){let t;return 0===(y=e.children.length)?e:(t=e.children[y-1],C.last_descendant(t))},C.get_prev_branch=function(e){let t,n;if(null==e&&(e=x),null!=e)return null!=(n=C.get_prev_sibling(e))?C.last_descendant(n):t=C.get_parent_branch(e)},C.select_prev_branch=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=C.get_prev_branch(e)))return C.select_branch(t),t}):void 0}}}])}.call(this),angular.module("app").directive("logview",["$state","$parse","logService",function(e,t,n){return{restrict:"EA",templateUrl:"/tpl/blocks/logview.html",scope:{logNodeId:"@"},link:function(o,r,i){let a=t(i.logId)(o.$parent),s=0,c=r.find(".logview-content"),l=!1,p=0,d=0,u=function(){l||(0===p||e.includes("app.exp.run")||e.includes("app.exp.history")||e.includes("app.predict.run"))&&n.getLog(a,s).then(function(e){if(!l){if(p++,"reload"===e)return 0,s=0,d=0,c.html(""),void setTimeout(function(){u()},1e3);if(e){"minio"===window.appConfig.ossType&&e.text&&(e.text=e.text.substr(d),d+=e.text.length);let t=!0;c.scrollTop()+c.height()+10<c.get(0).scrollHeight&&(t=!1),s=e.nextLogPosition;let n=e.text.split("\n"),o="",r=0;for(let e=0;e<n.length;e++)o+=n[e]+"\n",(++r>=5||e===n.length-1)&&(c.append("<div>"+o.substr(0,o.length-1)+"</div>"),o="",r=0,c.children().length>=200&&c.find(":first-child").remove());t&&c.animate({scrollTop:c.get(0).scrollHeight},500)}setTimeout(function(){u()},1e3)}})};u(),o.$on("$destroy",function(){l=!0})}}}]),angular.module("app").directive("controllist",["$stateParams","$state","nodeService","$rootScope","common",function(e,t,n,o,r){return{restrict:"EA",templateUrl:"/tpl/blocks/controlsList.html",replace:!0,link:function(i,a,s){i.currentTab.type=t.current.data.type,i.tabInfo=null;const c=_.findIndex(t.current.data.tabs,{type:t.current.data.type});if(c>-1){let e=angular.copy(t.current.data.tabs[c]),n={};"params"===e.type||"tune"===e.type?(Object.assign(n,{controls:[]}),i.nodeTabInfo&&i.nodeTabInfo[t.current.data.type]?Object.assign(n,{...i.nodeTabInfo[t.current.data.type],tabName:i.nodeTabInfo[t.current.data.type].tabName}):Object.assign(n,{tabName:e.name}),i.tabInfo={...n}):i.nodeTabInfo&&i.nodeTabInfo[t.current.data.type]&&(i.tabInfo={...i.nodeTabInfo[t.current.data.type]})}if(i.currentTab.title=_.get(i.tabInfo,"tabName.zh_CN",""),i.nodeId=e.nodeId,i.tabInfo||t.go("app.predict.edit.node.setting",{nodeId:e.nodeId}),i.controlListScope={},i.model={},i.globalVarModel={},"group"===o.nodeCompType||[998,999].includes(o.nodeCompType)){let e;$(".edit_tools").on("mouseenter.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideDown().end().siblings().children(".btn-collapse-list").slideUp()}).on("mouseleave.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideUp()}),"group"===o.nodeCompType?(i.group.metadata.params||(i.group.metadata.params=[]),e=i.group.metadata.params):998!==o.nodeCompType&&999!==o.nodeCompType||(i.node.metadata.def.compositeParams||(i.node.metadata.def.compositeParams=[]),e=i.node.metadata.def.compositeParams);const t=function(t,n){const o={id:n,label:t.metadata.label,controls:[]};i.groupNodes.push(o),Object.keys(t.metadata.ui.tabs).forEach(function(e){t.metadata.ui.tabs[e].controls.forEach(function(e){o.controls.push(e)})});for(let o=0;o<e.length;o++){let r=e[o];if(r.nodeId===n){for(let e in t.metadata.def.params){let n=t.metadata.def.params[e];if(n.controlInstUuid===r.controlId){i.model[r.controlId]={meta:n};break}}break}}},r=function(){if(i.groupNodes=[],"group"===o.nodeCompType&&i.tabInfo)i.tabInfo.controls=n.genGroupTabInfo(e),i.group.nodes.forEach(function(e){const o=n.getNode(e);t(o,e)});else if(998===o.nodeCompType||999===o.nodeCompType){if(!i.node.metadata.def.composite)return;if(998===o.nodeCompType&&i.node.metadata.def.composite.properties.globalVars){let e={id:"global",label:"全局变量",controls:[]};i.node.metadata.def.composite.properties.globalVars.forEach(function(t){i.globalVarModel[t.id]=t,e.controls.push(t)}),i.groupNodes.push(e)}i.tabInfo.controls=n.genCompositeTabInfo(e,i.node.metadata.def.composite.processes,i.node.metadata.def.composite.properties.globalVars),Object.keys(i.node.metadata.def.composite.processes).forEach(function(e){const n=i.node.metadata.def.composite.processes[e];t(n,e)})}};i.addGroupGlobalVar=function(t){for(let n=0;n<e.length;n++){if(e[n].id===t.id)return}e.push({type:"global",id:t.id}),r(),i.save()},i.removeGroupGlobalVar=function(t){for(let n=0;n<e.length;n++){if(e[n].id===t){e.splice(n,1);break}}r(),i.save()},i.addGroupControl=function(t,n){for(let o=0;o<e.length;o++){let r=e[o];if(r.nodeId===t&&r.controlId===n)return}e.push({nodeId:t,controlId:n}),r(),i.save()},i.removeGroupControl=function(t){for(let n=0;n<e.length;n++){if(e[n].controlId===t){e.splice(n,1);break}}r(),i.save()},r()}else if(i.tabInfo)for(let e=0;e<i.tabInfo.controls.length;e++){let t=i.tabInfo.controls[e],n=!1;for(let e in i.node.metadata.def.params){let o=i.node.metadata.def.params[e];if(o.controlInstUuid===t.uuid){i.model[t.uuid]={meta:o},n=!0;break}}n||t.uuid}i.checkExists=function(e){try{if(e.relations&&e.relations.hide&&e.relations.hide.enabled){let e=e.relations.hide,t=i.node.metadata.def.params[e.key].value;switch(e.operator){case"==":return t===e.value;case"!=":return t!==e.value;case">":return t>e.value;case"<":return t<e.value;case">=":return t>=e.value;case"<=":return t<=e.value}}}catch(e){}return!0},i.arrayToString=function(e){return e&&e.length?e.join(","):""},i.a={},i.a.openMenu=!1,$(document).on("click.toggle.controlList.menu",function(e){i.a.openMenu=!1,o.$$phase||o.$apply()}),i.appId=e.id,i.nodeId=e.nodeId,i.fileUploadPath=function(e){return r.getUploadDataPath(e)},i.onAllFileUploadFinish=function(e,t){const n=_.find(i.node.metadata.def.params,{controlInstUuid:t}),o=_.find(i.node.metadata.def.params,{propertyName:"dataName",defOutPortUuid:n.outPortUuid});n.value=e,o.value=e},i.onCheckedFileChange=function(){n.changeNode(i.nodeId)},i.$on("$destroy",function(){$(document).off("click.toggle.controlList.menu"),$(".edit_tools").off("mouseenter.toggle.groupControl").off("mouseleave.toggle.groupControl")})}}}]),angular.module("app").directive("numberOnly",[function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){return e+""})}}}]).directive("onFinishRender",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),angular.module("app").directive("labelEditor",["$timeout","$parse",function(e,t){return{restrict:"AE",templateUrl:"/tpl/blocks/label_editor.html",replace:!0,scope:{required:"=",title:"="},link:function(t,n,o){t.editing=!1,t.onClick=function(){t.editing=!0,e(function(){n.find("input")[0].focus()})},t.onKeyup=function(e){13==e.keyCode&&(t.editing=!1)}}}}]).directive("inputKeyValue",["$timeout","$parse",function(e,t){return{restrict:"AE",template:'<div class="sp-keyvalue"><button type="button" class="btn btn-xs btn-primary" ng-disabled="readOnly" ng-click="addKeyValue()"><i class="iconfont iconadd"></i></button><div><div class="input-group" ng-if="list" ng-repeat="item in list"><input type="text" class="form-control" ng-model="item.key" placeholder="键" ng-disabled="readOnly" ng-change="handleChange()" /><input type="text" class="form-control" ng-model="item.value" placeholder="值" ng-disabled="readOnly" ng-change="handleChange()" /><button type="button" class="btn-dashed danger input-group-addon" ng-disabled="readOnly" ng-click="removeKeyValue($index)"><i class="iconfont iconminus"></i></button></div></div></div>',replace:!0,scope:{data:"="},link:function(e,t,n){let o=_.isEmpty(e.data)?{"":""}:JSON.parse(e.data);e.list=_.keys(o).map(function(e){return{key:e,value:o[e]}}),e.removeKeyValue=function(t){e.list.splice(t,1)},e.addKeyValue=function(){e.list.push({key:"",value:""})},e.handleChange=function(){let t={};_.forEach(e.list,function(e){t[e.key]=e.value}),e.data=JSON.stringify(t)}}}}]).directive("startingHtml",[function(){return{template:"<div class='toaster-starting'>{{directiveData.title}}{{dynamicDirectiveData}}<span class='dotting'></span></div>"}}]).directive("whenScrolled",function(){return function(e,t,n){let o=t[0];t.bind("scroll",function(){o.scrollTop+o.offsetHeight>=o.scrollHeight&&e.$apply(n.whenScrolled)})}}).directive("proportion",function(){return{restrict:"E",replace:!0,template:'<div class="proportion-chart"><span ng-repeat="(key, val) in data" style="width: {{ val > 0 ? val * 100 : 0 }}%">{{w}}</span></div>',scope:{data:"="}}}).directive("selectLine",function(){return function(e,t){t.bind("focus",function(){this.select()})}}).directive("echartBar",function(){return{restrict:"E",replace:!0,template:'<div class="proportion-bar" id="proportion-bar"></div>',scope:!0,link:function(e,t,n){let o=document.getElementById("proportion-bar"),r=echarts.init(o),i=_.keys(e.barData),a=_.values(e.barData);r.setOption({xAxis:{type:"category",data:i},yAxis:{type:"value"},grid:{top:20,right:10,bottom:10,left:10,containLabel:!0},series:{type:"bar",barWidth:"40%",itemStyle:{color:"rgba(0,0,0,0)",borderColor:"#8800ff",borderWidth:"2px",barBorderRadius:[6,6,0,0]},data:a}})}}}).directive("abnTreeTooltip",["$timeout",function(e){return{restrict:"AE",template:'<div class="abn-tree-row-tooltip" ng-style="tooltipStyle">{{tooltipContent}}</div>',replace:!0,scope:{name:"=",disabled:"=",size:"@",onChange:"&"},link:function(t,n,o){let r;t.tooltipStyle={};angular.element(".navi").on("mouseenter",".abn-tree .leaf a",function(n){n.stopPropagation();const o=n.currentTarget.querySelector(".tree-label").innerText;if(function(e){for(var t,n=0,o=0;o<e.length;o++)(t=e.charCodeAt(o))<127?n++:n+=128<=t&&t<=2047?2:2048<=t&&t<=65535?3:4;return n}(o)>18){var i=n.clientX,a=n.clientY-50-40;t.tooltipContent=o,r||(r=e(function(){t.tooltipStyle.top=a,t.tooltipStyle.left=i,t.tooltipStyle.opacity=1},1e3))}}),angular.element(".navi").on("mouseleave",".abn-tree .leaf a",function(n){n.stopPropagation(),r&&(e.cancel(r),r=null,t.tooltipStyle.opacity=0,t.$apply())})}}}]).directive("spSwitch",["$timeout","$parse",function(e,t){return{restrict:"AE",templateUrl:"/tpl/blocks/sp_switch.html",replace:!0,scope:{disabled:"=",checked:"=",size:"@",onClick:"&",onChange:"&"},link:function(e,t,n){e.className=e.size?"sp-switch-"+e.size:"",t.on("click","input",function(t){e.checked=t.target.checked,e.onClick&&e.onClick()}),t.on("change","input",function(){e.onChange&&e.onChange()})}}}]).directive("spAlert",["$timeout",function(e){return{restrict:"AE",template:'<div class="sp-alert" ng-hide="!alertData || !alertData.message" ng-class="getClass()"><i class="iconfont iconjingshi"></i>{{alertData.message}}</div>',replace:!0,scope:{size:"@",alertData:"=",fadeOut:"=",delaySeconds:"="},link:function(t,n,o){t.$watch("alertData",function(n){n&&t.fadeOut&&e(function(){t.alertData.message=null},1e3*(t.delaySeconds||1))}),t.getClass=function(){let e=[];const n=_.get(t.alertData,"type");return n?e.push("sp-alert-"+n):e.push("sp-alert-info"),t.size&&e.push("sp-alert-"+t.size),e.join(" ")}}}}]).directive("spChecked",[function(){return{restrict:"AE",template:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg"> <circle fill="none" stroke-linecap="round" ></circle> <polyline fill="none" stroke-linejoin="round" stroke-linecap="round" /></svg>',scope:{size:"=",r:"=",stroke:"=",strokeWidth:"=",loading:"="},link:function(e,t,n){let o=.8;const r=e.size/2,i=e.size/2;e.circum=2*e.r*Math.PI,e.dasharray=e.circum+" "+e.circum;const a=t.children("svg"),s=angular.element(a.find("circle")[0]),c=angular.element(a.find("polyline")[0]);a.attr("width",e.size),a.attr("height",e.size),s.attr("cx",r),s.attr("cy",i),s.attr("r",e.r),s.attr("stroke-width",e.strokeWidth),s.attr("stroke-dasharray",e.dasharray),s.attr("stroke-dashoffset",e.circum-o*e.circum),c.attr("stroke-width",e.strokeWidth);let l=1;const p=[[r-e.r/3,i-e.r/6],[r,i+e.r/4],[r+4*e.r/5,i-2*e.r/3]];c.attr("points",p.map(e=>e.join(",")).join(" "));const d=Math.sqrt(Math.pow(p[1][0]-p[0][0],2)+Math.pow(p[1][1]-p[0][1],2))+Math.sqrt(Math.pow(p[2][0]-p[1][0],2)+Math.pow(p[2][1]-p[1][1],2));let u;function h(){u=requestAnimationFrame(function(){s.attr("stroke-dashoffset",e.circum-o*e.circum),window.cancelAnimationFrame(u),u=null,o<.8?(o+=.02,h()):(o=0,function e(){u=requestAnimationFrame(function(){c.attr("stroke-dashoffset",d-l*d),window.cancelAnimationFrame(u),u=null,l<1?(l+=.05,e()):l=0})}())})}c.attr("stroke-dasharray",d+" "+d),c.attr("stroke-dashoffset",d-l*d),e.$watch("loading",function(t){t&&(o=0,l=0,s.attr("stroke-dashoffset",e.circum-o*e.circum),c.attr("stroke-dashoffset",d-l*d),h())})}}}]).directive("scrolledBottom",function(){return function(e,t,n){var o=t[0];t.bind("scroll",function(){o.scrollTop+o.offsetHeight>=o.scrollHeight&&e.$apply(n.scrolledBottom)})}}).directive("spIconpicker",["toaster","appDataStoreService","$stateParams","format","$timeout",function(e,t,n,o,r){return{restrict:"AE",template:'<div class="sp-iconpicker-wrapper"><div class="sp-iconpicker" uib-dropdown> <button type="button" ng-disabled="disabled" class="sp-iconpicker-toggle" uib-dropdown-toggle><i ng-if="!iconUrl" class="iconfont" ng-class="getIcon()"></i><span ng-if="iconUrl" class="sp-iconpicker-image-wrapper"><img class="sp-iconpicker-image" ng-src="{{::iconUrl}}" /></span></button><ul class="dropdown-menu" uib-dropdown-menu><li class="dropdown-item" ng-repeat="item in builtIn"><a ng-click="onChange(item);"><i class="iconfont icon{{::item}}"></i></a></li><li class="dropdown-item" ng-repeat="item in iconImages"><a ng-if="item" ng-click="onChange(item.key);"><img class="sp-iconpicker-image" ng-src="{{::item.url}}" /></a></li></ul></div><span class="sp-iconpicker-custom" ng-class="{disabled: disabled}" ng-click="onClickCustom()"><input class="sp-iconpicker-input" type="file" multiple="multiple" ng-disabled="disabled" />自定义</span></div>',replace:!0,scope:{selectedIcon:"=",builtIn:"=",iconImages:"=",disabled:"=",onChange:"=",onUploadSuccess:"="},link:function(r,i,a){const s=i.find(".sp-iconpicker-input"),c=n.componentId?"studio/{{userId}}/component/{{componentId}}/icons/":"studio/{{userId}}/{{appId}}/icons/",l=o(c);r.getIcon=function(){return"icon"+r.selectedIcon},r.$watch("selectedIcon",function(e){r.iconUrl=null,_.isString(e)&&e.indexOf("studio/")>-1&&t.url(e).then(function(e){r.iconUrl=e.data})}),r.onClickCustom=function(){s[0].click()},s.on("change",function(n){const o=_.values(n.target.files),i=o.length;let a=0;const s=function(e){a<i?c(o[a]):(i==a&&e&&r.onChange(l+e),r.onUploadSuccess())},c=function(n){a++,-1==n.type.indexOf("image/")?(e.pop("error",n.name+"不是图片！"),a<i&&c(o[a])):n.size>81920?e.pop("error",n.name+" 上传失败，图片大于80K"):t.upload(l+n.name,n,function(e){},function(t){e.pop("error",n.name+" 上传失败"),s()},function(t){e.pop("success",n.name+" 上传成功"),s(n.name)})};c(o[a])})}}}]),angular.module("app").directive("spUploader",["appDataStoreService","format","$stateParams","common",function(e,t,n,o){return{restrict:"EA",templateUrl:"/tpl/blocks/spuploader.html",scope:{title:"=",controlInstUuid:"=",type:"=",out:"=",fileName:"=",nodeType:"=",separator:"=",btnDisabled:"=",fileUploading:"=",fileUploadFailed:"=",allFileUploadFinish:"=",fileUploadSuccess:"=",fileUploadPath:"=",readOnly:"=",singleFile:"=",uuidFile:"="},link:function(r,i,a){const s=_.cloneDeep({title:r.title,type:r.type,controlInstUuid:r.controlInstUuid,out:r.out,separator:r.separator,fileName:r.fileName});let c=null,l=null,p=0,d=10;const u={"{{userId}}":window.appConfig.userId,"{{appId}}":n.id,"{{nodeId}}":n.nodeId};function h(){r.files=[],r.title=s.title,r.type=s.type,r.controlInstUuid=s.controlInstUuid,r.out=s.out,r.separator=s.separator,r.fileName=s.fileName,p=0,l=t(r.fileUploadPath,u)}function f(e){if(c=_.values(e.target.files),r.total=c.length,r.total){for(r.$apply(function(){r.files=_.values(c).map(function(e){return{name:e.name,size:e.size,type:e.type}})}),p=0;p<Math.min(d,r.total);p++)m(c[p],p);p--}e.target.value=""}r.files=[],r.total=0,r.accept=a.accept||"*",angular.element(".btn-uploader").on("click",".input-upload",h),angular.element(".btn-uploader").on("change",".input-upload",f);const g=function(){++p<r.total?m(c[p],p):r.allFileUploadFinish&&r.allFileUploadFinish(r.fileUploadPath,r.controlInstUuid)};let m=function(t,n){let i=t.name.lastIndexOf("."),a="";i>0&&(a=t.name.slice(i+1).toLowerCase());let s=t.name;if(_.isEmpty(t.webkitRelativePath)||(s=t.webkitRelativePath),function(e,t){switch(r.type){case"txt":case"csv":return e==r.type;case"excel":return e.indexOf("xls")>-1;case"images":case"image":return 0===t.indexOf("image/");default:return!0}}(a,t.type)){let c=s;"21"==r.nodeType&&("csv"==r.type||"txt"==r.type?c="data."+r.type:"excel"==r.type&&(c="data."+a)),r.uuidFile&&(c=a?c.slice(0,i)+"-"+o.uuid()+"."+a:c+"-"+o.uuid()),r.fileName&&(c=r.fileName);let p=l+c;e.upload(p,t,function(e){let t=Math.round(e.loaded/e.total*100)+"%";r.$apply(function(){r.files[n].msg=t})},function(e){r.$apply(function(){r.files[n].status="failed",r.files[n].msg="上传失败"}),r.fileUploadFailed&&r.fileUploadFailed(s),g()},function(e){r.$apply(function(){r.files[n].status="success",r.files[n].msg="上传成功"}),r.fileUploadSuccess&&r.fileUploadSuccess(p),g()}).then(function(e){},function(e){r.$apply(function(){r.files[n].status="error",r.files[n].msg=_.get(e,"msg")}),g()})}else r.$apply(function(){r.files[n].msg="类型不匹配",r.files[n].status="error"}),g()};r.$on("$destroy",function(){angular.element(".btn-uploader").off("click",".input-upload",h),angular.element(".btn-uploader").off("change",".input-upload",f)})}}}]),angular.module("app").directive("spResizeTrigger",[function(){return{restrict:"EA",template:'<span class="sp-resize-trigger" ng-class="className"></span>',replace:!0,scope:{className:"@",dragArrow:"@",disabled:"="},link:function(e,t,n){const o=n.dragArrow;"top"===o&&t.css({left:0,right:0,top:0,height:"4px",width:"100%",cursor:"n-resize"});let r=!1,i=null,a=null;const s=angular.element("#edit"),c=angular.element(t).parents(".sp-resizable");let l,p,d,u,h,f,g,m,v,y,b,w,x;e.getClass=function(){return n.className},t.on("mousedown",function(e){return r=!0,"top"===o?(i=e.clientY,d=angular.element(".sp-app-aside"),u=angular.element(".sp-app-right"),h=angular.element(".sp-app-bottom"),f=angular.element(".sp-toggle")):"vertical"!=o?(i=e.clientX,l=s.width(),p=s.offset().left,f=angular.element(".sp-toggle"),d=angular.element(".sp-app-aside"),u=angular.element(".sp-app-right"),h=angular.element(".sp-app-bottom")):(i=e.clientY,v=angular.element(e.target),g=v.prev(),m=v.next(),y=g.height(),b=m.height(),x=c.height()),!1}),s.on("mouseup",function(e){r=!1,"vertical"!=o?(i=e.clientX,f=null):i=e.clientY}),s.on("mousemove",function(t){var n;if(r)if(a=t.clientX,"left"==o)(n=l+p-a)>=250&&a>d.width()+d.offset().left+320&&(f.css({right:n+16+"px"}),c.width(n),h.css({right:n+"px"}));else if("right"==o)(n=a-p)>=250&&a<u.offset().left-320&&(c.width(n),h.css({left:n+"px"}));else if("top"!==o||e.disabled){if("vertical"==o&&(w=t.clientY-i,y+w>84&&b-w>40)){const e=((y+w)/x*100).toFixed(2)+"%",t=((b-w)/x*100).toFixed(2)+"%";g.css("height",e),m.css("height",t),v.css("top",e)}}else{let e=h.height()+i-t.clientY;i=t.clientY,e>.5*window.innerHeight&&(e=.5*window.innerHeight),e<100&&(e=100),h.css({height:e+"px"}),f.css({bottom:e+16+"px"})}})}}}]),angular.module("app").component("spComponentLog",{template:'\n    <div class="height-100">\n      <ul class="sp-log-wrap head">\n        <li class="sp-log clearfix head">\n          <span class="status">状态</span>\n          <span class="id">节点ID</span>\n          <span class="name">\n            <sp-node-selector node-id="currentNode.id" on-change="onNodeChange(node)"></sp-node-selector>\n          </span>\n          <span class="cid">组件ID</span>\n          <span class="time">时间</span>\n          <span class="content">内容</span>\n          <span class="detail">详情</span>\n        </li>\n      </ul>\n      <ul class="sp-log-wrap">\n        <li \n          class="sp-log clearfix"\n          ng-repeat="log in getLogs(currentNode) track by log.key"\n        >\n          <span class="status" ng-switch="log.status.code">\n            <i ng-switch-when="0" class="iconfont iconspinner" title="运行中"></i>\n            <i ng-switch-when="1" class="iconfont iconyunhangchenggong run-success" title="运行成功"></i>\n            <i ng-switch-when="2" class="iconfont iconyunhangshibai run-error" title="运行失败"></i>\n          </span>\n          <span class="id" \n            title={{log.node.id}} \n            uib-tooltip="节点 ID 复制成功"\n            tooltip-is-open="copyIsOpen[log.key]"\n            tooltip-trigger="\'click\'"\n            ng-click="copyNodeId(log)"\n          >\n            {{ log.node.id.substring(0, 8) }}\n          </span>\n          <span class="name">{{ log.node.metadata.label }}</span>\n          <span class="cid">{{ log.node.component }}</span>\n          <span class="time">{{ log.date }}</span>\n          <span class="content">{{ log.status.description }}</span>\n          <span class="detail">\n          <a class="form-control-static"\n              href="{{ !appConfig._board ? \'/run/log/\' + appId + \'/\' + log.node.id : \'/hardware/\' + appConfig._board.id + \'/app/\' + appId + \'/node/\' + log.node.id + \'/logs\'}}"\n              target="_blank">新窗口打开</a>\n          </span>\n        </li>\n      </ul>\n    </div>\n  ',bindings:{nodeId:"<"},controller:["$scope","$state","logService","$stateParams","nodeService","copyToClipboard","uuidService","$interval","$timeout",function(e,t,n,o,r,i,a,s,c){let l=!1;e.appId=o.id;let p=void 0,d={},u={},h=function(){const e=r.getGraph();return nodes=_.get(e,"nodes")||[],nodes},f=h(),g=r.getGraph(),m=function(){f=h()};g.addListener("endTransaction",m);let v=this,y=function(t){l||t&&t.id&&n.getLog(n.getLogId(window.appConfig.userId,e.appId,t.id),d[t.id]||0).then(function(n){if(!l)return"reload"===n?(d[t.id]=0,void(u[t.id]=0)):void(n&&("minio"===window.appConfig.ossType&&n.text&&(n.text=n.text.substr(u[t.id]||0),u[t.id]=(u[t.id]||0)+n.text.length),d[t.id]=n.nextLogPosition,e.parseLog(t,n.text)))})},b=function(){if(!l&&(t.includes("app.predict.run")||t.includes("app.exp.run")))for(let e=0;e<f.length;e++)y(f[e])};e.currentNode={id:""},e.logs={},e.getLogs=function(t){let n=[];if(t.id)n=e.logs[t.id]||[];else{let t=Object.keys(e.logs);for(let o=0;o<t.length;o++){let r=e.logs[t[o]]||[];n=n.concat(r)}}return n.sort((e,t)=>e.key-t.key)},e.copyIsOpen={},e.copyNodeId=function(t){i.copy(t.node.id),e.copyIsOpen[t.key]=!0,c(()=>{e.copyIsOpen[t.key]=!1},1e3)},e.onNodeChange=function(t){t&&t.id||(t={id:""}),angular.isDefined(p)&&(s.cancel(p),p=void 0),e.currentNode=t,angular.isDefined(p)||(b(),p=s(()=>{b()},2e3))};const w={NotFound:"节点等待资源中",PullingImage:"拉取镜像中",Pending:"节点调度中",ContainerCreating:"正在启动节点",Terminating:"节点结束运行中",CrashLoopBackOff:"正在重启节点"},x={ErrImagePull:"拉取镜像失败",Error:"节点运行错误",OOMKilled:"节点运行触发OOMKilled",InsufficientCpu:"CPU资源不足",InsufficientMemory:"内存资源不足",InsufficientCpuAndMemory:"CPU,内存资源不足",Unknown:"节点状态未知"},C={Running:"节点正常运行中",Succeeded:"节点正常结束"},S=["运行中","运行成功","运行失败"];let I="2021-05-21T11:25:44.866000+08:00".length;e.parseLog=function(t,n){let o=/当前状态: |开始运行/g;for(;result=o.exec(n);){let o=n.substring(result.index-1-I,result.index-1),r=new Date(o);if(isNaN(r.getFullYear()))continue;let i={status:{code:0,label:S[0],description:""},date:moment(r).format("YYYY-MM-DD hh:mm:ss"),node:t};if("开始运行"==result[0])i.status.code,i.status.label=S[i.status.code],i.status.description="开始运行";else{let e=n.substring(result.index+6,result.index+6+50),t=!1;for(let n in w)0===e.indexOf(w[n])&&(i.status.code,i.status.description=w[n],t=!0);if(!t)for(let n in C)0===e.indexOf(C[n])&&(i.status.code,i.status.description=C[n],t=!0);if(!t)for(let n in x)0===e.indexOf(x[n])&&(i.status.code,i.status.description=x[n],t=!0);i.status.label=S[i.status.code]}e.logs[t.id]||(e.logs[t.id]=[]),e.logs[t.id].length>100&&e.logs[t.id].shift(),i.key=a.v4(),e.logs[t.id].push(i)}},this.$onChanges=function(t){e.onNodeChange(r.getNode(t.nodeId.currentValue))},this.$onInit=function(){e.onNodeChange(r.getNode(v.nodeId))},this.$onDestroy=function(){g.removeListener("endTransaction",m),l=!0,angular.isDefined(p)&&(s.cancel(p),p=void 0)}}]}),angular.module("app").component("spInstantData",{template:'\n    <div class="height-100">\n      <ul class="sp-log-wrap head">\n        <li class="sp-log clearfix head">\n          <span class="instant-id">节点ID</span>\n          <span class="instant-name">\n            <sp-node-selector node-id="currentNode.id" on-change="onNodeChange(node)"></sp-node-selector>\n          </span>\n          <span class="instant-cid">组件ID</span>\n          <span class="instant-time">时间</span>\n          <span class="instant-port">端口</span>\n          <span class="instant-name">端口</span>\n          <span class="instant-content">内容</span>\n        </li>\n      </ul>\n      <ul class="sp-log-wrap">\n        <li \n          class="sp-log clearfix"\n          ng-repeat="log in logs track by log.key"\n        >\n          <span \n            class="instant-id" \n            title={{log.node_id}}\n            uib-tooltip="节点 ID 复制成功"\n            tooltip-is-open="copyIsOpen[log.key]"\n            tooltip-trigger="\'click\'"\n            ng-click="copyNodeId(log)"\n          >\n            {{ log.node_id.substring(0, 8) }}\n          </span>\n          <span class="instant-name">{{ log.node.metadata.label }}</span>\n          <span class="instant-cid">{{ log.node.component }}</span>\n          <span class="instant-time">{{ log.timestamp }}</span>\n          <span class="instant-port">{{ log.port }}</span>\n          <span class="instant-name">{{ log.port_name }}</span>\n          <span class="instant-content" title={{log.data}}>{{ log.data }}</span>\n        </li>\n      </ul>\n    </div>\n  ',bindings:{nodeId:"<"},controller:["$scope","$state","nodeService","instantNodeLogService","$interval","copyToClipboard","$timeout",function(e,t,n,o,r,i,a){let s=this,c=void 0;e.currentNode={id:""},e.logs=[],e.copyIsOpen={},e.copyNodeId=function(t){i.copy(t.node.id),e.copyIsOpen[t.key]=!0,a(()=>{e.copyIsOpen[t.key]=!1},1e3)};const l=function(e){let t=n.getNode(e.node_id);return{...e,node:t,port_name:function(e,t){let n=t,o=[];e.metadata&&e.metadata.def&&e.metadata.def.ports&&(o=e.metadata.def.ports);let r=o.find(e=>e.uuid==t);return r&&r.description&&(n=r.description.zh_CN||r.description),n}(t,e.port)}},p=function(n){(t.includes("app.predict.run")||t.includes("app.exp.run"))&&function(t,n){let o=[];if(n.id)o=(t[n.id]||[]).map(e=>l(e));else{let e=Object.keys(t);for(let n=0;n<e.length;n++){let r=t[e[n]]||[];r=r.map(e=>l(e)),o=o.concat(r)}}o.sort((e,t)=>e.htime-t.htime),e.logs=o}(o.nodeLogs,n)};e.onNodeChange=function(t){t&&t.id||(t={id:""}),angular.isDefined(c)&&(r.cancel(c),c=void 0),e.currentNode=t,e.logs=[],function(e){angular.isDefined(c)||(p(e),c=r(()=>{p(e)},2e3))}(t)},this.$onChanges=function(t){e.onNodeChange(n.getNode(t.nodeId.currentValue))},this.$onInit=function(){e.onNodeChange(n.getNode(s.nodeId))},this.$onDestroy=function(){angular.isDefined(c)&&(r.cancel(c),c=void 0)}}]}),angular.module("app").component("spRunAnalysis",{template:'\n    <div class="height-100">\n      <div class="sp-analysis-wrap height-100">\n        <div class="sp-analysis-head">\n          <sp-node-selector node-id="currentNode.id" on-change="onNodeChange(node)"></sp-node-selector>\n          <ul class="analysis-btns clearfix">\n            <li \n              class="analysis-btn"\n              ng-class="{ active: mode.id ==  selAnalysisMode}"\n              ng-repeat="mode in analysisModes"\n              ng-click="analysisModeOnChange(mode)"  \n            >\n            {{ mode.label }}\n            </li>\n          </ul>\n        </div>\n        <div id="analysis-chart-wrap" class="sp-analysis-content">\n          <canvas id="analysis-chart"></canvas>\n        </div>\n      </div>\n    </div>\n  ',bindings:{nodeId:"<"},controller:["$scope","$state","$interval","nodeService",function(e,t,n,o){let r=this,i=void 0,a=null,s=null;e.currentNode={id:""};let c={labels:[],data:[]};const l=function(){(t.includes("app.predict.run")||t.includes("app.exp.run"))&&function(){let e={labels:c.labels,datasets:[{borderColor:"rgb(0, 132, 255)",backgroundColor:"rgba(0, 132, 255, 0.5)",data:c.data,fill:"start",pointRadius:0,borderWidth:2}]};a?(a.data=e,a.update()):(s={type:"line",data:e,options:{maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e,t){return`时间: ${e[0].parsed.x}s\n流量: ${e[0].parsed.y}kb`},label:function(){return""}}}},scales:{y:{title:{display:!0,text:"流量kb",align:"end"},grid:{display:!1},ticks:{count:6}},x:{title:{display:!0,text:"时间s",align:"end"},grid:{color:"rgba(255,255,255,0.2)",borderDash:[2,2]},ticks:{}}},layout:{padding:{top:20}}}},a=new window.Chart(document.getElementById("analysis-chart"),s))}()};e.analysisModes=[{id:"throughput",label:"吞吐量"},{id:"flowRate",label:"流量速度"},{id:"processSpeed",label:"处理速度"}],e.selAnalysisMode="throughput",e.analysisModeOnChange=function(t){e.selAnalysisMode=t.id,e.onNodeChange(e.currentNode)},e.onNodeChange=function(t){t&&t.id||(t={id:""}),angular.isDefined(i)&&(n.cancel(i),i=void 0),e.currentNode=t,function(){let e=Math.floor(10*Math.random())+10,t=[],n=[];for(let o=0;o<e;o++)t.push(o+""),n.push(Math.floor(40*Math.random()));c.labels=t,c.data=n}(),angular.isDefined(i)||(l(),i=n(()=>{l()},2e3))},this.$onChanges=function(t){e.onNodeChange(o.getNode(t.nodeId.currentValue))},this.$onInit=function(){e.onNodeChange(o.getNode(r.nodeId))},this.$onDestroy=function(){angular.isDefined(i)&&(n.cancel(i),i=void 0),a&&(a.destroy(),a=null)}}]}),angular.module("app").component("spNodeSelector",{template:'\n        <select class="nodes-selector" ng-model="selNodeId" ng-change="nodeChange()">\n          <option value="">组件名称</option>\n          <option value="{{node.id}}" ng-repeat="node in nodes track by node.id">{{ node.metadata.label }}</option>\n        </select>\n        ',bindings:{nodeId:"<",onChange:"&"},controller:["$scope","nodeService","$rootScope",function(e,t,n){let o=this;e.selNodeId="";let r=function(){const e=t.getGraph();return nodes=_.get(e,"nodes"),nodes};e.nodes=r();let i=t.getGraph(),a=function(){e.nodes=r()};i.addListener("endTransaction",a),e.nodeChange=function(){o.onChange({node:e.nodes.find(function(t){return t.id==e.selNodeId})})},this.$onChanges=function(t){e.selNodeId=t.nodeId.currentValue||""},this.$onDestroy=function(){i.removeListener("endTransaction",a)}}]}),(app=angular.module("app")).constant("app",{version:"0.6.0"}).constant("NODEICONS",["cube","microchip","flask","globe","chart-area","strikethrough","shekel-sign","random","signature","adjust","atlas","blanket","bong","burn","chart-line","clone","cloud-upload-alt","code-branch","code-commit","cog","coins","compass","conveyor-belt","database","exchange","fingerprint","fire","gem","link","retweet","server","shield-check","vial","vials"]).config(["$stateProvider",function(e){let t="app.exp";const n=_.find(appConfig.appMenu,function(e){return _.has(e,"route")&&e.visible});n&&(t="app."+n.route),e.state("app",{url:"/web",deepStateRedirect:{default:{state:t,params:{type:null,id:null}},params:!0},resolve:{userConfig:["userService","$q",function(e,t){const n=t.defer();return e.getConfig().then(function(e){n.resolve(e)}),n.promise}]},views:{"comps@app":{templateUrl:"/tpl/app/sp_app_comps.html",controller:"compsController"},"nodes@app":{templateUrl:"/tpl/app/sp_app_nodes.html",controller:"nodesController"},"":{templateUrl:"/tpl/sp_app.html",controller:["$scope","$state","$stateParams","$timeout","appDataStoreService","$rootScope","userService","$q","common","$transitions","userConfig","componentService","nodeService","enabledUser","scriptService","hardwareService","remoteService","toaster","loopService","$uibModal","NODEICONS","format","uiService",function(e,t,n,o,r,i,a,s,c,l,p,d,u,h,f,g,m,v,y,b,w,x,C){window.uiService=C,window.userConfig=i.userConfig=p,window.logout=i.logout=function(){m.post("/logout").then(function(e){if(e.success){var t=encodeURIComponent(location.protocol+"//"+location.host);switch(window.appConfig.getUserIdMethod){case"xuelang":var n=window.appConfig.loginHost+"/login?callback="+t;location.href=n;break;case"xuelangUserCenterV2":n=window.appConfig.loginHost+"/logout?callback="+t;location.href=n;break;case"xuelangUserCenterV3":n=window.appConfig.loginHost+"/api/logout";location.href=n;break;default:location.href="/"}}else err.msg},function(e){e.msg})},window.reactInit(),i.pageLoading=!1,i.sidebarCollapsed=!0,i.tagModel={},i.fullScreenImage={isFullScreen:!1,onShowScreenImage:function(e,t){e.stopPropagation(),_.isEmpty(t)||(i.fullScreenImage.isFullScreen=!0,i.fullScreenImage.src=t,o(function(){angular.element(".fullScreen").css("z-index",2e3)}))},onFullScreenExit:function(e){e.stopPropagation(),i.fullScreenImage.isFullScreen=!1}},e.onChangeLang=function(){if("en"===e.langConfig.code){e.langConfig={code:"zh-CN",text:"English Edition"};let t=document.getElementById(":1.container");if(t){let n=t.contentDocument.getElementById(":1.restore");n&&(n.click(),$cookies.put("sp_langCode",e.langConfig.code),$cookies.put("sp_langText",e.langConfig.text))}}else{e.langConfig={code:"en",text:"切换至中文版"};let t=document.getElementById(":0.targetLanguage");if(t){let n=t.childNodes[0];n&&(n.value="en",n.dispatchEvent(new CustomEvent("change")),$cookies.put("sp_langCode",e.langConfig.code),$cookies.put("sp_langText",e.langConfig.text))}}},e.componentAble="0"==window.appConfig.disableComponent,e.resetTabInfo=function(e,t){let n=_.filter(_.values(e),function(e){return e.isRequired&&!e.hidden}),o=_.filter(_.keys(t),function(e){return t[e].required});if(_.isEmpty(o)&&!_.isEmpty(n)||!_.isEmpty(o)&&_.isEmpty(n)){let e=_.map(n,"controlInstUuid");for(let n in t){let o=t[n].controls;if(!_.isEmpty(o)){let r=_.findIndex(o,function(t){return _.indexOf(e,t.uuid)>-1});t[n].required=r>-1}}}},e._dropdown={open:!1,menu:[],fetching:!1,handleGetList:function(){let e=this;g.post("list",{hwtype:"board"}).then(function(t){t.success?(e.fetching=!1,e.menu=_.map(t.data,function(e){return{id:e.id,name:(e.name||e.id)+"("+e.ip+")",ip:e.ip,state:e.state}})):e.fetching=!1},function(t){e.fetching=!1})}};let S=function(e,t){let n=0,o=e.length,r=function(i){n++;let a=i.getAttribute("xlink:href"),s=i.getAttribute("width"),c=i.getAttribute("height"),l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){let a=function(e,t,n){let o=document.createElement("canvas");return o.width=t,o.height=n,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),o.toDataURL("image/png")}(l,s,c);i.setAttribute("xlink:href",a),n<o?r(e[n]):t()},l.src=a+"&timeout="+(new Date).getTime()};o?r(e[n]):t()};let I;i.screenshots=function(e,n,o){let a=$("#editor").html();$("#editor").append(a).children(".the-graph-app:last").attr("id","screenShot");let s=$("#screenShot .app-svg .view"),c="dark"==i.appConfig.theme?"#252626":"#f1f1f1";s.parent().attr("style","background-color: "+c),s.find(".node-rect").attr("fill","#f6f6f6"),s.find(".node-label").attr("text-anchor","middle"),s.find(".port-label").attr("display","none"),s.find(".group-box").attr({fill:"rgba(255, 239, 138, 0.2)",stroke:"rgba(228, 215, 59, 0.8)"}),s.find(".node-icon.icon").attr({fill:"none",display:"none"}),s.find(".edge-icon:not(.block)").attr({display:"none"}),s.find(".edge").each(function(e,t){$(t).children().attr("fill","none").end().find(".stroke").attr("stroke","#a6a6a6")}),s.siblings(".tooltip").find(".tooltip-bg").attr("fill","none");let l=s.find("image");S(l,function(e,n,o){let i="studio/"+window.appConfig.userId+"/"+t.params.id+(e?"/"+e:"/screen_shot.png"),a=document.getElementById("screenShot"),s=a.offsetWidth,c=a.offsetHeight,l=a.querySelector(".view"),p=l.getBBox(),d=p.width,u=p.height,h=p.x,f=p.y,g=l.getAttribute("transform"),m=g.indexOf("(")+1,v=g.indexOf(","),y=Number(g.slice(m,v));if(d>s||u>c){let e=y,t=y;d>s&&(e=s/d),u>c&&(t=c/u),y=e<t?e:t}let b="matrix("+y+",0,0,"+y+","+-h*y+","+-f*y+")";l.setAttribute("transform",b);const w=function(e){Math.round(e.loaded/e.total*100)},x=function(e){},C=function(e){o&&o()};let S=Math.ceil(d*y),I=Math.ceil(u*y),N=a.querySelector(".app-svg"),_=new XMLSerializer,T="data:image/svg+xml,"+encodeURIComponent(_.serializeToString(N)),E=new Image;E.src=T,E.crossOrigin="anonymous",E.width=S,E.height=I,E.onload=function(){let e=document.createElement("canvas");e.width=S,e.height=I,e.getContext("2d").drawImage(E,0,0),a.remove(),e.toBlob(function(e){r.upload(i,e,w,x,C)})},n&&n(),$("#screenShot").remove()}.bind(this,e,n,o))},e.enable=h,e.doCreateComponent=function(e,n){n.stopPropagation(),d.create("未命名组件",void 0,e).then(function(e){d.setPermission(e.id).then(function(n){t.go("app.customize",{componentId:e.id})},function(n){t.go("app.customize",{componentId:e.id})}),t.includes("app.customize")&&i.$broadcast("node.list.reload")})},i.saveConfig=function(){let t=s.defer(),n=c.getDirList(e.userConfig.appDirs);angular.forEach(n,function(e){angular.forEach(e,function(t,n){["id","label","folder","children"].indexOf(n)<0&&delete e[n]})});let o=c.getDirList(e.userConfig.componentDirs);angular.forEach(o,function(e){angular.forEach(e,function(t,n){["id","label","folder","children"].indexOf(n)<0&&delete e[n]})});let r=angular.copy(e.userConfig);return a.saveConfig(r).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},i.addFolder=function(e,t){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/addFolder.html",controller:["$scope","$rootScope","toaster","common",function(n,o,r,i){n.title="新增文件夹",n.name="新文件夹",n.ok=function(){if(n.loading)return;let a;if(n.loading=!0,"app"===t?a=i.getDirMap(n.userConfig.appDirs):"component"===t?a=i.getDirMap(n.userConfig.componentDirs):"predict"===t?a=i.getDirMap(n.userConfig.predictDirs):"rpa"===t&&(a=i.getDirMap(n.userConfig.rpaDirs)),!a)return n.loading=!1,void r.pop("error","新增文件夹失败");let s=3;for(let e in a)s<parseInt(e,10)&&(s=parseInt(e,10));let c=s+1,l=a[e];l.children||(l.children=[]),l.children.push({id:c,label:n.name,folder:!0,children:[]}),n.saveConfig().then(function(e){"app"===t?o.$broadcast("app.list.reload",{}):"component"===t?o.$broadcast("node.list.reload"):"predict"===t?o.$broadcast("predict.list.reload",{}):"rpa"===t&&o.$broadcast("rpa.list.reload",{}),I.close(),r.pop("success","新增文件夹成功")},function(e){r.pop("error","新增文件夹失败, 网络错误")}).finally(function(){n.loading=!1})},n.cancel=function(){I.close()},n.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.removeFolder=function(e,n,o,r,i){I=b.open({templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$rootScope","common","componentService","toaster",function(a,s,c,l,p){a.alertTitle=i?"删除文件夹":"批量删除",a.alertIcon="iconfont iconjinggao text-danger";const d=c.getDirMap(a.userConfig[n+"Dirs"]),u=_.get(d[e],"parentId"),h=d[u],f=c.getDirMap(r),g=f[e];if(_.isEmpty(g))return void p.pop("error","该文件夹不存在");const m=_.filter(g.children,function(e){return!e.folder}),v=_.filter(g.children,function(e){return e.folder}),y=_.isEmpty(v)||-1==_.findIndex(v,function(e){return e.children.length});a.alertBody=i?y?"删除文件夹 ‘"+o+"’ 吗?":"文件夹 ‘"+o+"’ 中有非空目录，请先删除！":"文件夹 ‘"+o+"’ 中没有可删除的组件。",m.length&&(a.alertBody=i?"文件夹 ‘"+o+"’ 不为空，请先删除其中的组件！":"批量删除文件夹 ‘"+o+"’ 中的组件",a.moreLabel="全部组件：",a.more={hide:!1,toggle:!1},a.selected={all:!1},a.siblings=g&&_.filter(g.children,function(e){return!e.folder}),a.onChangeAll=function(){_.forEach(a.siblings,function(e){e.selected=a.selected.all})});const b=function(){angular.forEach(h.children,function(t,n){t.id===e&&h.children.splice(n,1)}),a.saveConfig().then(function(e){s.$broadcast("node.list.reload"),I&&I.close(),p.pop("success","文件夹 ‘"+o+"’ 已被删除")},function(e){p.pop("error","文件夹 ‘"+o+"’ 删除失败, 网络错误"),I&&I.close()}).finally(function(){a.loading=!1})};a.ok=function(){const e=a.siblings&&_.filter(a.siblings,{selected:!0});if(_.isEmpty(e))_.isEmpty(m)&&y&&i?b():y||I.close();else{if(a.loading)return;a.loading=!0,l.removeList(e).then(function(e){const n=_.filter(e,{removed:!1}),r=_.filter(e,{removed:!0}),c=_.findIndex(r,{id:t.params.componentId})>-1;if(c){let e=_.find(a.siblings,function(e){return!e.selected});e||(e=u&&f[u]&&_.find(f[u].children,function(e){return!e.folder})),t.go("app.customize",{componentId:e.id})}p.pop("success","组件 "+_.map(r,"label").join("、")+" 已被删除"),_.isEmpty(n)?y&&i?b():(i&&p.pop("warning","文件夹 ‘"+o+"’ 中有非空目录，请先删除！"),!c&&s.$broadcast("node.list.reload")):p.pop("error","组件 "+_.map(n,"label").join("、")+" 删除失败"),I.close()}).finally(function(){a.loading=!1})}},a.cancel=function(){I.close()},a.$on("modal.closing",function(e,t){I=void 0})}],size:"sm",appendTo:""})},i.renameFolder=function(e,t,n){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/rename.html",controller:["$scope","toaster",function(o,r){o.renameTitle="重命名文件夹",o.renameNameTitle="名称",o.renameName=n,o.ok=function(){if(o.renameLoading)return;let n;return o.renameLoading=!0,"app"===t?n=c.getDirMap(o.userConfig.appDirs):"component"===t?n=c.getDirMap(o.userConfig.componentDirs):"predict"===t?n=c.getDirMap(o.userConfig.predictDirs):"rpa"===t&&(n=c.getDirMap(o.userConfig.rpaDirs)),o.renameName?n&&n[e]?(n[e].label=o.renameName,void o.saveConfig().then(function(e){"app"===t?i.$broadcast("app.list.reload",{}):"component"===t?i.$broadcast("node.list.reload"):"predict"===t?i.$broadcast("predict.list.reload",{}):"rpa"===t&&i.$broadcast("rpa.list.reload",{}),I.close(),r.pop("success","重命名文件夹成功")},function(e){r.pop("error","重命名文件夹失败, 网络错误")}).finally(function(){o.renameLoading=!1})):(o.renameLoading=!1,void r.pop("error","重命名文件夹失败")):(o.renameLoading=!1,void r.pop("error","重命名文件夹失败: 名称不能为空"))},o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.renameNode=function(e){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/rename.html",controller:["$scope","toaster",function(t,n){t.renameTitle="重命名",t.renameNameTitle="名称",t.renameName=_.get(e,"metadata.label"),t.ok=function(){_.isEmpty(t.renameName)?n.pop("warning","组件名称不能为空"):(e.metadata.label=t.renameName,u.changeNode(e.id),I.close(),n.pop("success","重命名成功"))},t.cancel=function(){I.close()},t.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.removeMultiNodes=function(e,t){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(n,o,r,a){n.alertTitle="删除节点",n.alertIcon="iconfont iconjinggao text-danger";const s=_.map(e,"metadata.label");n.alertBody='确定删除节点 "'+s.join("；")+'" 吗?',n.ok=function(){n.loading||(n.loading=!0,n.alertBody="正在删除",_.forEach(e,function(e){r.removeNode(e.id),i.removedNodes.push(angular.copy(e))}),I.close(),o.go(t))},n.cancel=function(){I.close()},n.$on("modal.closing",function(){I=void 0})}],size:"sm",appendTo:""})},i.removeNode=function(e,t){const n=f.idNodeDeletable(e.id);I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(o,r,a,s){o.alertTitle="删除节点",o.alertIcon="iconfont iconjinggao text-danger",o.alertBody=n?'确定删除节点 "'+e.metadata.label+'" 吗?':'节点 "'+e.metadata.label+'" 的连线有自定义脚本，确定删除吗?',o.ok=function(){!n&&f.removeScriptByNode(e.id),a.removeNode(e.id),i.removedNodes.push(angular.copy(e)),t&&r.go(t),I.close()},o.cancel=function(){I.close()},o.$on("modal.closing",function(){I=void 0})}],size:"sm",appendTo:""})},i.removeGroup=function(e,t){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(n,o,r,i){n.alertTitle="删除组合",n.alertIcon="iconfont iconjinggao text-danger",n.alertBody="确定删除组合 “"+e.metadata.name+"” 及其中的所有节点和连线吗？删除后不可恢复！",n.ok=function(){r.removeGroup(e.name),_.forEach(e.nodes,function(e){r.removeNode(e)}),t&&o.go(t),I.close()},n.cancel=function(){I.close()},n.$on("modal.closing",function(){I=void 0})}],size:"sm",appendTo:""})},i.removeEdge=function(e,n){f.isEdgeDeletable(e)?I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService",function(t,o,r){t.alertTitle="删除连线",t.alertIcon="iconfont iconjinggao text-danger",t.alertBody="该连线包含自定义脚本，确定删除吗?",t.ok=function(){t.loading||(t.loading=!0,f.removeScriptByEdge(e),r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),n&&o.go(n))},t.cancel=function(){I.close()},t.$on("modal.closing",function(){I=void 0})}],size:"sm",appendTo:""}):(f.removeScriptByEdge(e),u.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),n&&t.go(n))},i.handleResetContext=function(e,n,o){if(!o&&i.appConfig._context==appConfig.env||_.get(i.appConfig,"_board.id")==_.get(o,"id"))return;const r="app."+_.split(e,".")[1];if(o){if(e.indexOf("app.predict.run")>-1)return void v.pop("info","请先释放再切换到边缘端");i.appConfig._context="hardware"}else i.appConfig._context=appConfig.env;i.appConfig._board=o,t.go(r,{type:n.type,id:n.id,refresh:n.refresh+1})},i.showRunHistory=function(t){e.alert="",I=b.open({animation:!0,windowClass:"modal-bottom-sheet",templateUrl:"/tpl/custom/popup/runHistory.html",controller:["$scope","appService",function(e,n){e.data=[];let o=40;e.loadMore=function(){o<40||n.listCron(t,40,e.data.length).then(function(t){if(t&&t.list){if(0===(o=t.list.length))return;for(let e=0;e<t.list.length;e++)t.list[e].cron_config=JSON.parse(t.list[e].cron_config);e.data=e.data.concat(t.list)}})},e.loadMore(),e.cancel=function(){I.close()}}]})},i.runSchedule=function(e,t){let o=u.getNode(t).metadata.label;I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/schedule.html",controller:["$scope","$state","$rootScope","nodeService","appService","toaster",function(r,i,a,s,c,l){const p=function(e){switch(e){case"day":return{startHour:0,startMinute:0};case"week":case"month":return{startHour:0,startMinute:0,targetDays:""};case"minute":return{startHour:0,startMinute:0,endHour:23,endMinute:59,intervalMinute:5};case"hour":return{startHour:0,startMinute:0,endHour:23,endMinute:59,intervalHour:1}}};let d=function(){return moment().toISOString()};r.updateStartEffectTime=function(){moment(r.cronConfig.startEffectTime).unix()<moment().unix()&&(r.startEffectTime=new Date(d())),r.minDate=new Date(d())},r.format="yyyy/MM/dd",r.altInputFormats=["yyyy/MM/dd"],r.startOpend=!1,r.cronConfig=s.getCronConfig()||{period:"day",runType:"runStart",startEffectTime:d(),endEffectTime:moment().add(1,"year").toISOString(),config:p("day")},r.startEffectTime=new Date(r.cronConfig.startEffectTime),r.endEffectTime=new Date(r.cronConfig.endEffectTime),r.cronConfig.nodeId=t,r.updateStartEffectTime(),r.dateOptions={minDate:r.minDate},r.$watch("cronConfig.period",function(e,t){e!==t&&(r.cronConfig.config=p(e))}),r.a={},r.a.nodeLabel=o,r.a.monthDayList=[{name:"1号",value:1},{name:"2号",value:2},{name:"3号",value:3},{name:"4号",value:4},{name:"5号",value:5},{name:"6号",value:6},{name:"7号",value:7},{name:"8号",value:8},{name:"9号",value:9},{name:"10号",value:10},{name:"11号",value:11},{name:"12号",value:12},{name:"13号",value:13},{name:"14号",value:14},{name:"15号",value:15},{name:"16号",value:16},{name:"17号",value:17},{name:"18号",value:18},{name:"19号",value:19},{name:"20号",value:20},{name:"21号",value:21},{name:"22号",value:22},{name:"23号",value:23},{name:"24号",value:24},{name:"25号",value:25},{name:"26号",value:26},{name:"27号",value:27},{name:"28号",value:28},{name:"29号",value:29},{name:"30号",value:30},{name:"31号",value:31}],r.a.weekDayList=[{name:"星期一",value:1},{name:"星期二",value:2},{name:"星期三",value:3},{name:"星期四",value:4},{name:"星期五",value:5},{name:"星期六",value:6},{name:"星期日",value:7}],r.a.minuteList=[{name:"5分钟",value:5},{name:"10分钟",value:10},{name:"15分钟",value:15},{name:"20分钟",value:20},{name:"25分钟",value:25},{name:"30分钟",value:30},{name:"35分钟",value:35},{name:"40分钟",value:40},{name:"45分钟",value:45},{name:"50分钟",value:50},{name:"55分钟",value:55}],r.a.hourList=[{name:"1小时",value:1},{name:"2小时",value:2},{name:"3小时",value:3},{name:"4小时",value:4},{name:"5小时",value:5},{name:"6小时",value:6},{name:"7小时",value:7},{name:"8小时",value:8},{name:"9小时",value:9},{name:"10小时",value:10},{name:"11小时",value:11},{name:"12小时",value:12},{name:"13小时",value:13},{name:"14小时",value:14},{name:"15小时",value:15},{name:"16小时",value:16},{name:"17小时",value:17},{name:"18小时",value:18},{name:"19小时",value:19},{name:"20小时",value:20},{name:"21小时",value:21},{name:"22小时",value:22},{name:"23小时",value:23}],r.a.startHourList=[{name:"00",value:0},{name:"01",value:1},{name:"02",value:2},{name:"03",value:3},{name:"04",value:4},{name:"05",value:5},{name:"06",value:6},{name:"07",value:7},{name:"08",value:8},{name:"09",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12},{name:"13",value:13},{name:"14",value:14},{name:"15",value:15},{name:"16",value:16},{name:"17",value:17},{name:"18",value:18},{name:"19",value:19},{name:"20",value:20},{name:"21",value:21},{name:"22",value:22},{name:"23",value:23}],r.a.startMinuteList=[{name:"00",value:0},{name:"01",value:1},{name:"02",value:2},{name:"03",value:3},{name:"04",value:4},{name:"05",value:5},{name:"06",value:6},{name:"07",value:7},{name:"08",value:8},{name:"09",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12},{name:"13",value:13},{name:"14",value:14},{name:"15",value:15},{name:"16",value:16},{name:"17",value:17},{name:"18",value:18},{name:"19",value:19},{name:"20",value:20},{name:"21",value:21},{name:"22",value:22},{name:"23",value:23},{name:"24",value:24},{name:"25",value:25},{name:"26",value:26},{name:"27",value:27},{name:"28",value:28},{name:"29",value:29},{name:"30",value:30},{name:"31",value:31},{name:"32",value:32},{name:"33",value:33},{name:"34",value:34},{name:"35",value:35},{name:"36",value:36},{name:"37",value:37},{name:"38",value:38},{name:"39",value:39},{name:"40",value:40},{name:"41",value:41},{name:"42",value:42},{name:"43",value:43},{name:"44",value:44},{name:"45",value:45},{name:"46",value:46},{name:"47",value:47},{name:"48",value:48},{name:"49",value:49},{name:"50",value:50},{name:"51",value:51},{name:"52",value:52},{name:"53",value:53},{name:"54",value:54},{name:"55",value:55},{name:"56",value:56},{name:"57",value:57},{name:"58",value:58},{name:"59",value:59}],r.ok=function(){r.loading||(r.loading=!0,r.updateStartEffectTime(),r.cronConfig.startEffectTime=moment(r.cronConfig.startEffectTime).toISOString(),r.cronConfig.endEffectTime=moment(r.cronConfig.endEffectTime).toISOString(),r.cronConfig,s.setCronConfig(r.cronConfig),a.doSave(n,"app.exp.read","v1").then(function(t){c.startCron(e,angular.copy(r.cronConfig)).then(function(e){I.close(),l.pop("success","定时任务提交成功"),i.go("app.exp.cron")},function(e){l.pop("error","定时任务提交失败, "+e.msg)})},function(e){l.pop("error","定时任务提交失败, 网络错误")}).finally(function(){r.loading=!1}))},r.cancel=function(){I.close()},r.$on("modal.closing",function(e,t){I=void 0})}],size:"md"})},i.exportComponent=function(e,t){const n=function(e){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","appDataStoreService",function(n,o){n.alertTitle="导出组件",n.alertIcon="iconfont iconxunwen text-primary",n.alertBody='组件 "'+t+'"已导出至云端，是否需要下载到本地?',n.confirmTitle="下载",o.url(e).then(function(e){n.download=e.data}),n.cancel=function(){I.close()},n.$on("modal.closing",function(e,t){I=void 0})}],size:"sm",appendTo:""})};d.export(e).then(function(e){y.fetchJob({title:"正在导出",type:"export"},e.job.id,d.getJob,n)},function(e){v.pop("error","导出失败")})},i.importComponent=function(e,t,n){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/import.html",controller:["$scope","$rootScope","common","toaster","componentService","$stateParams","$state",function(o,r,i,a,s,c,l){o.importTitle="导入组件",o.importNameLabel="组件名称",o.importPath=i.getImportPath(appConfig.userId),o.imported={name:t||"未命名组件",componentId:e||"",dataPath:""},e&&(o.warn={message:"导入后将覆盖现有组件"}),o.onFileUpload=function(e){o.imported.dataPath=e};o.ok=function(){o.imported.loading||(o.imported.loading=!0,s.import(o.imported.name,o.imported.componentId,n,o.imported.dataPath).then(function(t){y.fetchJob({title:"正在导入",type:"import",asyncable:!0},t.job.id,s.getJob).then(function(t){!function(t){s.switch(t.compId,t.importFolderName).then(function(t){t.success&&(a.pop("success","导入组件成功"),y.fetchJob({title:"切换数据",type:"switch"},t.job.id,s.getJob,function(){e?e==c.componentId&&l.go("app.customize",{componentId:e,refresh:c.refresh+1}):r.$broadcast("node.list.reload")}),I.close())})}(t)},function(e){a.pop("error","导入失败：",e.msg)})},function(e){a.pop("error","导入组件失败")}).finally(function(){o.imported.loading=!1}))},o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.createComponent=function(e,t){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/create.html",controller:["$scope","$state","$rootScope","toaster","componentService","USER_CONFIG","COMPONENT_TYPES",function(n,o,r,i,a,s,c){n.createTitle="创建组件",n.createNameTitle="组件名称",n.created={name:"未命名组件",dir:e||s.myDirId,type:t},n.componentTypes=c,"customize"==t&&(n.created.type=_.get(r.currentApp,"appType")||"algo"),"predict"==n.created.type&&(n.created.type="service"),n.ok=function(){n.createLoading||(n.createLoading=!0,a.create(n.created.name,n.created.dir,n.created.type).then(function(e){i.pop("success","组件 “"+n.created.name+"” 创建成功"),a.setPermission(e.id).then(function(t){o.go("app.customize",{componentId:e.id},{reload:!0})},function(t){o.go("app.customize",{componentId:e.id},{reload:!0})}),o.includes("app.customize")&&r.$broadcast("node.list.reload"),I.close()},function(e){i.pop("error","创建失败: "+e.msg)}).finally(function(){n.createLoading=!1}))},n.cancel=function(){I.close()},n.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.exportModel=function(e,t,n,o){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/export.html",controller:["$scope","$state","ossService","$rootScope","toaster","componentService","ccc",function(r,i,a,s,c,l,p){r.loading=!0,r.componentName="",r.componentNameDisabled=!1;let d="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+n+"/metadata";a.getObject(window.appConfig.oss.bucket,d,null,!0).then(function(e){let t=JSON.parse(p.d(e));l.get(parseInt(t.exportComponentId)).then(function(e){if(r.loading=!1,e.success){let n=e.componentInfo;r.componentName=n.name,r.componentNameDisabled=!0,r.componentModelVersion=t.exportModelVersion}},function(e){r.loading=!1,r.componentName=o+"_导出模型_"+moment().format("L")})},function(e){r.loading=!1,r.componentName=o+"_导出模型_"+moment().format("L")}),r.ok=function(){if(r.loading)return;r.loading=!0;let o=!_.isNumber(r.componentModelVersion);l.exportModel(e,t,n,r.componentName,o).then(function(e){r.loading=!1,c.pop("success","模型导出成功"),I.close(),s.$broadcast("node.list.reload")},function(e){r.loading=!1;const t=e.msg||e.message;c.pop("error","模型导出失败: "+t)})},r.cancel=function(){I.close()},r.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})};let N=null;i.openAppScriptEditor=function(e){N&&(N.close(),N=null),N=b.open({templateUrl:"/tpl/custom/popup/appScriptEditor.html",controller:["$scope","$stateParams","nodeService","toaster","scriptService",function(t,n,o,r,i){const a=o.getGraph();t.editorOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript"};let s=null;t.codeEditors={},t.$watch(function(){return i.getAppLogs(n.id)},function(e){t.scriptLog=e}),t.readOnly=e,t.handleSelectPort=function(e){const{id:n,nodeId:o,direction:r}=e,a=i.getScriptsByNode({node:o,port:n.split("-")[1]},r);s&&(t.currentNode=e,s.getDoc().setValue(a))},t.nodeTree=a.nodes.filter(({metadata:e})=>e.def.ports&&e.def.ports.length).map(({id:e,metadata:n})=>({id:e,label:n.label,expanded:!0,visible:!0,usable:!0,children:n.def.ports.map(({uuid:n,description:o,ioType:r})=>({id:`${e}-${n}`,label:`${n}(${_.get(o,"zh_CN","")})`,onSelect:t.handleSelectPort,nodeId:e,direction:r,usable:!0,visible:!0}))})),t.nodeTree.unshift({id:i.APP_GLOBAL_SCRIPT_NODEID,label:"全局",expanded:!0,visible:!0,children:[{id:`${i.APP_GLOBAL_SCRIPT_NODEID}-${i.APP_GLOBAL_SCRIPT_PORTID}`,label:"全局脚本",onSelect:t.handleSelectPort,nodeId:i.APP_GLOBAL_SCRIPT_NODEID,direction:i.APP_GLOBAL_SCRIPT_KEYWORD,visible:!0,usable:!0}]}),t.codemirrorLoaded=function(e){s=e,e.on("change",function(e){i.setScript(t.currentNode.nodeId,t.currentNode.id.split("-")[1],t.currentNode.direction,e.getValue())})},t.toggleScriptBlock=function(e){$(e.currentTarget).toggleClass("collasped")};const c=function(e){27===e.keyCode&&(t.scriptFullScreen=!1,$(document).off("keydown",c))};t.previewerOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript",readOnly:!0},t.packedScript="",t.codePreviewerLoaded=function(e){t.codePreviewer=e},t.handleToggleFullscreen=function(){t.scriptFullScreen=!t.scriptFullScreen,t.scriptFullScreen?(r.pop("info","按 Esc 键退出全屏编辑"),$(document).on("keydown",c)):$(document).off("keydown",c)},t.handlePreviewScripts=function(e){e.stopPropagation(),t.showCodePreviewer=!t.showCodePreviewer,setTimeout(function(){t.codePreviewer&&(t.packedScript=i.packScripts(a),t.codePreviewer.getDoc().setValue(t.packedScript),t.codePreviewer.execCommand("selectAll"),t.codePreviewer.execCommand("indentAuto"),t.codePreviewer.setCursor(0))},500)},t.handleSaveScripts=function(e){e.stopPropagation(),i.saveAppScripts()},t.handleShowLog=function(e){e.stopPropagation(),t.showLog=!t.showLog},t.cancel=function(){N.close()},t.$on("modal.closing",function(e,t){N=void 0})}],size:"lg",appendTo:"",backdrop:!1,keyboard:!1})},i.openEdgeScriptEditor=function({from:e,to:t,metadata:n,direction:o},r){I&&I.close(),(I=b.open({templateUrl:"/tpl/custom/popup/edgeScriptEditor.html",controller:["$scope","toaster","scriptService","$uibModalInstance","$stateParams",function(r,i,a,s,c){let l=null;r.editorOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript",autofocus:!r.readOnly};const p=o===a.DIRECTION.IN?t:e,d=u.getNode(p.node);r.editorTitle=`<${d.metadata.label}>-<${p.port}>-<${a.getKeyword(o)}>`,r.script=a.getOldEdgeScripts(n.script)||a.getScriptsByNode(p,o),r.scriptFullScreen=!1,r.funcNames=a.getSupportedFunctions(),o===a.DIRECTION.IN?r.funcNames=r.funcNames.filter(e=>"afterLeave"!==e):r.funcNames=r.funcNames.filter(e=>"beforeEnter"!==e),r.$watch(function(){return a.getLogsByEdge(c.id,{from:e,to:t})},function(e){r.scriptLog=e}),r.codemirrorLoaded=function(e){l=e;const t=e.getDoc();setTimeout(function(){t.setValue(r.script)},500)};let h=null;const f=function(e){27===e.keyCode&&(r.scriptFullScreen=!1,$(document).off("keydown",f),h&&(h.appendChild(document.querySelector("ui-draggable-modal")),h=null))};r.handleToggleFullscreen=function(){r.scriptFullScreen=!r.scriptFullScreen;const e=document.querySelector("ui-draggable-modal");r.scriptFullScreen?(i.pop("info","按 Esc 键退出全屏编辑"),$(document).on("keydown",f),e&&(h=e.parentNode,document.body.appendChild(e))):($(document).off("keydown",f),h&&(h.appendChild(e),h=null))},r.handleAddFunction=function(e,t){e.preventDefault(),e.stopPropagation(),r.dropdownOpen=!1,r.script+=a.getFunctionBlock(t)},r.handleSaveScripts=function(e){a.saveEdgeScripts(p,o,l.getValue())},r.cancel=function(){s.close(!0)},r.$on("modal.closing",function(e,t){if($(".full-screen").remove(),!t)return e.preventDefault(),!1;I=void 0})}],size:"md",appendTo:"",backdrop:!1,windowClass:"edge-script-editor-modal-window",keyboard:!1})).rendered.then(function(){setTimeout(function(){const e=$(".edge-script-editor-log-content");e&&e[0].lastChild&&e.scrollTop(e[0].lastChild.offsetTop)},500)})},i.removeComponent=function(e,n,o){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","componentService",function(r,a){r.alertTitle="删除组件",r.alertIcon="iconfont iconjinggao text-danger",r.alertBody="删除组件 ‘"+e.label+"’ 吗？",r.moreLabel="删除同级目录的其他组件",r.selected={all:!1},r.siblings=_.filter(n,function(t){return t.id!=e.id&&!t.folder}),e.selected=!0,r.onChangeAll=function(){_.forEach(r.siblings,function(e){e.selected=r.selected.all})},r.ok=function(){if(!r.loading)if(r.loading=!0,_.isEmpty(n))a.del(e.id).then(function(t){v.pop("success","组件 "+e.label+" 已删除"),i.$broadcast("node.list.reload"),I.close()},function(t){v.pop("error","组件 "+e.label+" 删除失败")}).finally(function(){r.loading=!1});else{const n=_.filter(r.siblings,{selected:!0});n.unshift(e),a.removeList(n).then(function(n){const a=_.filter(n,{removed:!1}),s=_.filter(n,{removed:!0});if(v.pop("success","组件 "+_.map(s,"label").join("、")+" 已被删除"),_.isEmpty(a)||v.pop("error","组件 "+_.map(a,"label").join("、")+" 删除失败"),t.params.componentId==e.id){let e=_.filter(r.siblings,function(e){return!e.selected});_.isEmpty(e)||(o=e[0]),t.go("app.customize",{componentId:o.id},{reload:!0})}i.$broadcast("node.list.reload"),I.close()}).finally(function(){r.loading=!1})}},r.cancel=function(){e.selected=!1,I.close()},r.$on("modal.closing",function(e,t){I=void 0})}],size:"sm",appendTo:""})},i.shareComponent=function(e,t){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/share.html",controller:["$scope","toaster","componentService","$http",function(n,o,r,i){n.shareTitle="组件分享",n.shareNameTitle="组件名称",n.shareDescriptionTitle="组件描述",n.shareName=t,n.targetUser={id:"",username:""},n.userList=[],n.dropdownToggle=!1,n.activeType={name:"用户ID",value:"id"},n.userTypes=[{name:"用户ID",value:"id"},{name:"用户名",value:"username"}];const a=window.appConfig.loginHost+"/api/user/findByUsernameLike";let s,c;n.onClickUserListItem=function(e){n.targetUser=e,n.userList=[]},n.onClickType=function(e){n.dropdownToggle=!n.dropdownToggle,n.activeType=e},n.onChangeTargetUser=function(e){s=e.target.value.trim(),"username"==n.activeType.value?(c&&(clearTimeout(c),c=null),c=setTimeout(function(){i({method:"GET",url:a,params:{username:s}}).then(function(e){200===e.status&&(n.userList=_.get(e,"data.data"))},function(e){o.pop("warning",_.get(e,"data.message")+" 请选择“用户ID”输入"),n.activeType={name:"用户ID",value:"id"},n.targetUser={id:"",username:""}})},400)):n.targetUser.id=s},n.ok=function(){n.shareLoading||(n.shareLoading=!0,r.share(e,n.shareName,n.targetUser.id).then(function(e){I.close(),o.pop("success","分享成功")},function(e){o.pop("error","分享失败: "+e.msg)}).finally(function(){n.shareLoading=!1}))},n.cancel=function(){I.close()},n.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.node2component=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/node2component.html",controller:["$scope","$state","$stateParams","toaster","componentService",function(o,r,a,s,c){o.title="从节点创建组件",o.nameTitle="组件名称",o.name=t,o.editable=!1,o.ok=function(){if(o.loading)return;o.loading=!0;let t=a.type;"predict"===t&&(t="service"),c.create(o.name,void 0,t,n,e,!o.editable).then(function(e){I.close(),s.pop("success","创建成功"),i.$broadcast("node.list.reload"),c.setPermission(e.id).then(function(t){r.go("app.customize",{componentId:e.id},{reload:!0})},function(t){r.go("app.customize",{componentId:e.id},{reload:!0})})},function(e){s.pop("error","创建失败: "+e.msg)}).finally(function(){o.loading=!1})},o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.duplicateComponent=function(e){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/duplicate.html",controller:["$scope","$rootScope","toaster","componentService","appDataStoreService","statisticsService",function(t,n,o,r,i,a){t.duplicateTitle="复制组件",t.duplicateNameTitle="组件名称",t.duplicateName=e.label,t.ok=function(){if(t.duplicateLoading)return;t.duplicateLoading=!0;let a=["studio",window.appConfig.userId,"component",e.id].join("/");i.sync(a,"upload").then(function(n){return r.duplicate(e.id,t.duplicateName)}).then(function(e){let t=["studio",window.appConfig.userId,"component",e.id].join("/");return i.sync(t,"download")}).then(function(e){I.close(),o.pop("success","复制成功"),n.$broadcast("node.list.reload")},function(e){o.pop("error","复制失败: "+e.msg)}).finally(function(){t.duplicateLoading=!1})},t.cancel=function(){I.close()},t.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.duplicateAppFromTemplate=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/duplateAppFromTemplate.html",controller:["$scope","$rootScope","toaster","appService","statisticsService",function(o,i,a,s,c){o.duplicateTitle="从模板创建项目",o.duplicateNameTitle="项目名称",o.duplicateName=t,o.duplicateDescriptionTitle="项目描述",o.duplicateDescription=n,o.ok=function(){o.duplicateLoading||(o.duplicateLoading=!0,s.duplicatePublic(e,o.duplicateName,o.duplicateDescription,"algo").then(function(e){let t=["studio",window.appConfig.userId,e.id].join("/");return r.sync(t,"download")}).then(function(e){I.close(),a.pop("success","创建成功"),i.$broadcast("app.list.reload",{})}).catch(function(e){a.pop("error","创建失败: "+e.msg)}).finally(function(){o.duplicateLoading=!1}))},o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0})}],size:"md",appendTo:""})},i.changeParentDir=function(e){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/edit_dirs.html",controller:["$scope","$rootScope","componentService","common","toaster",function(t,n,o,r,i){t.modalTitle=(e.folder?"移动文件夹 ":"移动组件 ")+e.label+" 至";let a=e.folder?e.id:e.dir||2;t.my_treedata=n.userConfig.componentDirs;const s=r.getDirMap(t.userConfig.componentDirs),c=s[a];t.parentId=e.folder?c.parentId:e.dir||2,t.targetDir=null,t.onSelect=function(e){t.targetDir=e},t.ok=function(){if(e.folder){const o=_.remove(s[c.parentId].children,function(t){return t.id==e.id})[0];o.parentId=t.targetDir.id,s[t.targetDir.id].children.push(o),n.saveConfig().then(function(e){n.$broadcast("node.list.reload"),i.pop("success","移动文件夹成功")},function(e){i.pop("error","移动文件夹失败, 网络错误")}).finally(function(){I.close()})}else o.changeDir(e.id,t.targetDir.id).then(function(e){n.$broadcast("node.list.reload"),i.pop("success","移动组件成功")},function(e){i.pop("error","移动组件失败: "+e.msg)}).finally(function(){I.close()})},t.cancel=function(){I.close()},t.$on("modal.closing",function(e,t){I=void 0})}]})},i.showChart=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/chart.html",controller:["$scope","appDataStoreService",function(o,r){o.popupTitle="分析报告",o.popupLoading=!1;let i=["studio",window.appConfig.userId,e,t,n,"visual","part-00000"].join("/");r.url(i).then(function(e){e.success&&(o.chartUrl="/visual_iframe?data="+encodeURIComponent(e.data))}),o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0}),o.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showColumn=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/column.html",controller:["$scope","tableService","nodeService",function(o,r,i){o.popupTitle="字段选择",o.popupHasFooter=!0,o.popupLoading=!0;let a,s,c=function(e){o.popupLoading=!1,o.popupNotice=e},l=i.getNode(t);for(let e in l.metadata.def.params){let t=l.metadata.def.params[e];if(t.controlInstUuid===n){a=t;break}}_.isEmpty(a.value)||(s=_.map(a.value.split(","),function(e){return e})),r.getUpstreamTableName(e,t,n).then(function(e){let t=e.propertyName,n=e.value;t&&n?r.getTableMeta(n,t).then(function(e){o.popupLoading=!1;let n=e,r=0;if(n){if("tableName"==t&&(n=e.data.tableColumns,!_.isEmpty(s)))for(let e=0;e<n.length;e++){let t=_.indexOf(s,n[e].name)>-1;t&&r++,n[e].selected=t}if("dataName"==t&&(n=_.map(n,function(e){let t=_.indexOf(s,e)>-1;return t&&r++,{name:e,selected:t}})),o.tableColumnArr=n,o.totalSelectedNum=r,o.tableColumnObj={},o.tableColumnNumObj={},"dataName"==t&&(o.tableColumnObj.string=o.tableColumnArr,o.tableColumnNumObj.string=r),"tableName"==t)for(let e=0;e<n.length;e++){let t=n[e],r=t.type.toLowerCase();o.tableColumnObj[r]||(o.tableColumnObj[r]=[],o.tableColumnNumObj[r]=0),o.tableColumnObj[r].push(t),t.selected&&(o.tableColumnNumObj[r]+=1)}o.toggleColType=function(e,t){let n=o.tableColumnObj[t];if(e){for(let e=0;e<n.length;e++)n[e].selected=!1;o.tableColumnNumObj[t]=0,o.totalSelectedNum-=n.length}else{for(let e=0;e<n.length;e++)n[e].selected=!0;o.tableColumnNumObj[t]=n.length,o.totalSelectedNum+=n.length}},o.toggleSelectAll=function(e){if(e){for(let e in o.tableColumnObj)_.forEach(o.tableColumnObj[e],function(e){e.selected=!1}),o.tableColumnNumObj[e]=0;o.totalSelectedNum=0}else{for(let e in o.tableColumnObj)_.forEach(o.tableColumnObj[e],function(e){e.selected=!0}),o.tableColumnNumObj[e]=o.tableColumnObj[e].length;o.totalSelectedNum=n.length}},o.popupConfirm=function(){let e=[];for(let t=0;t<n.length;t++)n[t].selected&&e.push(n[t].name);a.value=e.join(","),o.ok()}}else c("未获取到数据")},function(e){console.error(e),c("未获取到数据")}):c("未获取到数据")},function(e){_.isString(e)?c(e):c("未获取到数据")}),o.ok=function(){I.close()},o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0}),o.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showTable=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/table.html",controller:["$scope","tableService",function(o,r){o.popupTitle="数据探查",o.popupLoading=!0,o.popupHasFooter=!0,o.isTable=!0,o.tableColumnWidth=68,o.widthUp=function(){o.tableColumnWidth>=200||(o.tableColumnWidth+=5)},o.widthDown=function(){o.tableColumnWidth<=68||(o.tableColumnWidth-=5)},o.tableDownload=function(){let r="";o.tableSchema.forEach(function(e){r+=e.name+","}),r+="\n";for(let e=0;e<o.tableData.length;e++){for(let t in o.tableData[e])if(t>0){let n=o.tableData[e][t].toString(),i=_.replace(n,/\"/g,'""');r+=(i='"'+i+'"')+"\t,"}r+="\n"}let i="data:text/csv;charset=utf-8,"+encodeURIComponent(r),a=document.createElement("a");a.href=i,a.download=e+"-"+t+"-"+n+".csv",document.body.appendChild(a),a.click(),document.body.removeChild(a)},r.getNodeTableName(e,t,n).then(function(e){r.getTableMeta(e.value,e.propertyName).then(function(e){o.popupLoading=!1,o.tableData=e.data.table_data.data,o.tableSchema=e.data.table_data.schema.map(function(e){return{name:e,exp_w:0}}),o.exp_w=0;for(let e=0;e<o.tableData.length;e++)o.tableData[e].unshift(e);o.order=function(e,t){o.sortIndex=e,o.sortType=t,"asc"===t?o.tableData.sort(function(t,n){return parseFloat(t[e])-parseFloat(n[e])}):o.tableData.sort(function(t,n){return parseFloat(n[e])-parseFloat(t[e])})};let t=!1,n={};o.changeWidthStart=function(e,r){t=!0,n.index=r,n.start=e.pageX-o.tableSchema[n.index].exp_w},o.changeWidth=function(e){if(t){let t=e.pageX-n.start;t>=0&&(o.tableSchema[n.index].exp_w=t,o.exp_w=o.tableSchema.map(function(e){return e.exp_w}).reduce(function(e,t,n,o){return e+t}))}},o.changeWidthEnd=function(e){t=!1,n={}}},function(e){o.popupLoading=!1,o.popupNotice="未获取到数据"})},function(e){o.popupLoading=!1,o.popupNotice="未获取到数据表"}),o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0}),o.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showRapidminer=function(e,t,n){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/rapidminer.html",controller:["$scope","$q",function(o,i){let a;o.popupTitle="数据质量分析",o.popupLoading=!0,o.popupHasFooter=!0,o.isTable=!0,o.tableColumnWidth=150;let s="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+n+"/data/data.json",c="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+n+"/data/data.csv";i.all([r.get(c),r.get(s)]).then(function(e){o.popupLoading=!1,o.exp_w=0;let t=_.compact(e[0].split("\n")),n=t.length,r=e[1];try{r=JSON.parse(e[1])}catch(e){}o.csv_title=n?t[0].split(",").map(function(e){let t=e.trim(),n=r.columnDetail[t];if(n){let e=n.valueCounts;delete n.valueCounts;let o=r.numericSummary[t];return{name:t,detail:n,menuOption:[{text:"详情",click:function(r){!function(e,t,n,o){a=b.open({animation:!0,templateUrl:"/tpl/custom/popup/rapidminer_detail.html",controller:["$scope",function(r){r.popupTitle=e,r.popupLoading=!1,r.popupHasFooter=!0,r.columnDetail=t,r.barData=n,r.numericSummary=o,r.cancel=function(){a.close()},r.$on("modal.closing",function(e,t){a=void 0}),r.$on("$destroy",function(){})}],size:"md",appendTo:""})}(t,n,e,o)}}]}}return{name:t,detail:n}}):[],o.csv_data=n?t.slice(1).map(function(e){return e.split(",")}):[],o.csv_len=o.csv_title.length},function(e){o.popupLoading=!1,o.popupNotice="未获取到数据表"}),o.cancel=function(){I.close()},o.$on("modal.closing",function(e,t){I=void 0}),o.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showFormulaEidtor=function(e){I=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/formulaEditor.html",controller:["$scope","$stateParams","nodeService",function(t,n,o){t.popupTitle="编辑公式",t.inputAttr="输出1",t.popupHasFooter=!0,t.popupLoading=!1;let r=o.getNode(n.nodeId);const i=function(e){let t=_.cloneDeep(e);switch(t.typeLabel=t.type,t.labelClass="",e.type.toUpperCase()){case"STRING":t.typeLabel="文本",t.labelClass="string-label";break;case"ARRAY":t.typeLabel="数组",t.labelClass="array-label";break;case"NUMBER":t.typeLabel="数字",t.labelClass="number-label";break;case"DATE":t.typeLabel="时间戳",t.labelClass="time-label";break;case"JSON":t.typeLabel="JSON",t.labelClass="json-label"}return t};let a=_.get(r,"metadata.def.ports"),s=[];a.forEach(e=>{if("in"===e.ioType){let t=_.get(e,"description.zh_CN","");const n={id:e.uuid,name:t,type:e.subType||""},o=i(n);s.push(o)}}),t.currFieldList=s,t.editorOptions={placeholder:"请在此输入公式...",matchBrackets:!0,autoCloseBrackets:!0,indentUnit:0,smartIndent:!1,lineWrapping:!0,autofocus:!0};let c=function(e){const t=_.get(r,"metadata.def.params"),n=Object.keys(t);let o="";return n.forEach(n=>{t[n].controlInstUuid&&t[n].controlInstUuid===e&&(o=t[n])}),o}(e);c&&(c=i(c)),t.initFormular=c,t.codemirrorLoaded=function(e){t._editor=e;let n=e.getDoc();setTimeout(()=>{const e=t.initFormular.value;e&&""!==e&&n.replaceRange(e,{line:0,char:0},void 0,"setInitValue")},0);e.setOption("hintOptions",{hint:function(){const t=e,n=e.constructor,o=t.getCursor(),r=t.getLine(o.line),i=o.ch,a=i,s=["AND","IF","OR"],c=r.split("");let l=i;for(let e=i-1;e>=0&&/\w/.test(c[e]);e-=1)l=e;let p="";l<i&&(p=r.slice(l,i));const d=[];""!==p&&function(e,t){e.forEach(e=>{t&&0===e.lastIndexOf(t.toUpperCase(),0)&&d.push(e)})}(s,p);const u=p.split("").length;return{list:d,from:n.Pos(o.line,a-u),to:n.Pos(o.line,i)}},completeSingle:!1});e.on("change",function(t,o){if(t.closeHint(),o.origin)if("setInitValue"===o.origin){e.focus(),o.text.forEach((e,n)=>{s.forEach(o=>{(function(e,t){let n=[],o=e.indexOf(t);for(;o>-1;)n.push(o),o=e.indexOf(t,o+1);return n})(e,o.id).forEach(e=>{const r={line:n,ch:e},i=o.id.length,a={line:n,ch:e+i},s=document.createElement("span");s.innerHTML=o.name,s.className="cm-field-name",t.markText(r,a,{selectRight:!0,atomic:!0,replacedWith:s})})})})}else if(/custom_add-field-/.test(o.origin)){const e=o.origin.replace("custom_add-field-",""),n={line:o.from.line,ch:o.from.ch},r=o.text[0].split("").length,i={line:o.from.line,ch:o.from.ch+r},a=document.createElement("span");a.innerHTML=e,a.className="cm-field-name",t.markText(n,i,{selectRight:!0,atomic:!0,replacedWith:a})}else if("complete"===o.origin){let e=n.getCursor();n.replaceRange("()",e,void 0,"custom_add-formular");const t={line:e.line,ch:e.ch+1};n.setCursor(t)}else/custom_add-formular/.test(o.origin)||t.showHint()}),e.constructor.defineSimpleMode("simplemode",{start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/IF|AND|OR/,token:"keyword"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\/(?:[^\\]|\\.)*?\//,token:"variable-3"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/[a-zA-Z$][\w$]*/,token:"variable"}]}),e.setOption("mode","simplemode")},t.operatorList=[{name:"函数分隔符",label:"."},{name:"参数引号",label:'""'},{name:"加",label:"+"},{name:"减",label:"-"},{name:"乘",label:"*"},{name:"除",label:"/"},{name:"大于",label:">"},{name:"小于",label:"<"},{name:"等于",label:"=="},{name:"不等于",label:"!="},{name:"大于等于",label:">="},{name:"小于等于",label:"<="}],t.handleClickAddOperator=function(e){if(t._editor){let n=t._editor.getDoc(),o=n.getCursor();n.replaceRange(e.label,o,void 0,"custom_add-operator");let r=e.label.split("").length;"参数引号"===e.name&&(r=1);const i={line:o.line,ch:o.ch+r};t._editor.focus(),n.setCursor(i)}},t.formularList=[{label:"常用函数",expand:!0,children:[{label:"IF",format:"IF(A,B,C)",description:"表示如果满足条件A，那么返回B，否则返回C"},{label:"SWITCH",format:"SWITCH(逻辑表达式1, A, 逻辑表达式2, B, ..., OTHERS, N)",description:"表示如果满足逻辑表达式1，那么返回A；如果满足逻辑表达式2, 那么返回B；...同上；否则返回N。"},{label:"ARRAY",format:"ARRAY(A,B,C)",description:"返回[A,B,C]"},{label:"DICT",format:"DICT(A)",description:"返回[A,B,C]"},{label:"JSON",format:"JSON(A,B,C)",description:""},{label:"DF",format:"DF(A,B,C)",description:""},{label:"JSON2DF",format:"JSON2DF(A)",description:""},{label:"DF2ECHARTS",format:"DF2ECHARTS(A)",description:""},{label:"CHAIN",format:"CHAIN(A,B,C)",description:""},{label:"ZIP",format:"ZIP(A,B,C)",description:""}]},{label:"逻辑函数",expand:!0,children:[{label:"AND",format:"AND(逻辑表达式1,逻辑表达式2,...)",description:"如果所有参数都为真，AND函数返回布尔值true，否则返回布尔值 false"},{label:"OR",format:"OR(逻辑表达式1,逻辑表达式2,...)",description:"如果任意参数为真，OR 函数返回布尔值true；如果所有参数为假，返回布尔值false。"}]},{label:"数学函数",expand:!0,children:[{label:"MAX",format:"MAX(变量1,变量2,...)",description:"如果所有参数都为数字，MAX 函数返回最大值。"},{label:"MIN",format:"MIN(变量1,变量2,...)",description:"如果任意参数为数字，MIN 函数返回最小值。"},{label:"SUM",format:"SUM(变量1,变量2,...)",description:"SUM 函数返回所有值的和。"},{label:"LEN",format:"LEN(变量)",description:"LEN 函数返回变量的长度。"}]}],t.handleClickTreeLabel=function(e){t.formularList[e].expand=!t.formularList[e].expand},t.selecFormular={format:"",description:""},t.handleTreeSelect=function(e){if(t._editor){let n=t._editor.getDoc(),o=n.getCursor(),r=`${e.label}()`,i={line:o.line,ch:o.ch+e.label.split("").length+1};n.replaceRange(r,o,void 0,"custom_add-formular"),t._editor.focus(),n.setCursor(i)}},t.handleTreeHover=function(e){t.selecFormular=e},t.handleClickAddField=function(e){if(t._editor){let n=t._editor.getDoc(),o=n.getCursor();n.replaceRange(e.id,o,void 0,`custom_add-field-${e.name}`);const r={line:o.line,ch:o.ch+e.id.split("").length};t._editor.focus(),n.setCursor(r)}},t.ok=function(){let n=t._editor.getValue();!function(e,t){const n=_.cloneDeep(r.metadata.def.params);Object.keys(n).forEach(o=>{n[o].controlInstUuid&&n[o].controlInstUuid===e&&(r.metadata.def.params[o].value=t)})}(e,n),I.close()},t.cancel=function(){I.close()},t.$on("modal.closing",function(e,t){I=void 0}),t.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showFiles=function(e,t,n,o){I=b.open({animation:!0,templateUrl:"/tpl/custom/popup/files.html",controller:["$scope","$rootScope","$stateParams","downloadFile","appService","appDataStoreService","common","format",function(r,i,a,s,c,l,p,d){let h,f;r.popupTitle=t?"选择文件":o?"查看 VS Code":"查看文件",r.popupLoading=!0,r.popupHasFooter=!0,r.NextMarker=void 0,r.maxKeys=40,r.checkAll=!1,r.filesRemovable=!1,r.removing=!1,r.fileSelect=!_.isEmpty(t)||!o,r.vscode=o;const g={},m={"{{userId}}":i.appConfig.userId,"{{appId}}":a.id,"{{nodeId}}":a.nodeId},v=function(e){return new Promise(function(t,n){if(f=e,!_.isEmpty(g[f]))return r.filesRemovable=!1,r.data=_.forEach(g[f].prefixes.concat(g[f].catalog),function(e){e.checked=!1}),r.total=r.data.length,r.popupLoading=!1,void t(null);r.popupLoading=!0,c.getContents(e).then(function(e){if(r.popupLoading=!1,r.data=[],r.total=0,_.isEmpty(e.catalog)&&_.isEmpty(e.prefixes))r.popupNotice="暂无数据";else{let t=e.prefixes.concat(e.catalog);r.total=t.length}t(e)},function(e){r.popupLoading=!1,r.popupNotice="未获取到数据表"})})};let y,w,x;if(t){const e=u.getNode(a.nodeId);_.forEach(e.metadata.def.params,function(e){_.get(e,"controlInstUuid")===t&&(y=e),_.has(e,"fileType")&&(w=e)}),x=y.value&&_.map(y.value.split(","),function(e){return d(e,m)})}if(h=e||(w?_.get(w,"value"):p.getUploadNodeDataPath(n||"out1")),f=d(h,m),_.isEmpty(f))r.popupLoading=!1,r.popupNotice="未获取到数据";else{let e=f;r.loaded=!1,r.loading=!1,r.data=[],r.fetchMore=function(){r.loading||r.loaded||(r.loading=!0,c.getContents(f,r.NextMarker,r.maxKeys,r.checkAll).then(function(e){e.NextMarker||(r.loaded=!0),_.isEmpty(x)||_.forEach(e.catalog,function(e){e.checked=x.indexOf(e.id)>-1});let t=e.prefixes.concat(e.catalog);_.isEmpty(g[f])&&(g[f]={prefixes:[],catalog:[]});let n=g[f];g[f]={prefixes:n.prefixes.concat(e.prefixes),catalog:n.catalog.concat(e.catalog)},r.data=r.data.concat(t),r.NextMarker=e.NextMarker}).finally(function(){r.loading=!1}))},v(f).then(function(t){r.filesBreadcrumbs[0].id=e,r.filesBreadcrumbs[0].prefixes=_.get(t,"prefixes.length",0),r.filesBreadcrumbs[0].catalog=_.get(t,"catalog.length",0),r.fetchMore()})}r.filesBreadcrumbs=[{id:0,label:"全部文件夹"}],r.getFileIcon=function(e){switch(e){case"png":case"gif":case"jpg":case"jpeg":case"bmp":return"icon-file-image";case"folder":return"icon-folder";case"txt":return"icon-file-text";case"json":return"icon-code";case"pdf":return"icon-file-pdf";case"xls":case"xlsx":return"icon-file-excel";default:return"icon-file"}};r.onFileItem=function(e){let t=function(e){let t;return r.data.forEach(function(n){e===n.id&&(t=n)}),t}(e);if(t.isFolder)r.checkAll=!1,r.filesRemovable=!1,r.active=null,r.fileChecked=!1,_.isEmpty(g[e])?v(e).then(function(e){r.filesBreadcrumbs.push({id:t.id,label:t.label,prefixes:e.prefixes.length,catalog:e.catalog.length}),r.loaded=!1,r.fetchMore()}):(r.data=_.forEach(g[e].prefixes.concat(g[e].catalog),function(e){e.checked=!1}),r.total=r.data.length,r.filesBreadcrumbs.push({id:t.id,label:t.label,prefixes:g[e].prefixes.length,catalog:g[e].catalog.length}));else{r.isFetching=!0,r.active=e,r.fileChecked=!0,r.fileActive={alt:t.label},l.url(e).then(function(e){e.success&&(r.fileActive.src=e.data)});let n=["png","gif","jpg","jpeg","bmp"];l.head(e).then(function(o){0==o.ContentType.indexOf("image")||n.indexOf(t.type)>-1?(r.fileActive.type="image",r.isFetching=!1):0==o.ContentType.indexOf("text")||"application/octet-stream"==o.ContentType&&"py"==t.type||"application/x-sh"==o.ContentType&&"sh"==t.type||"application/json"==o.ContentType||"json"==t.type||"csv"==t.type?(r.fileActive.type=t.type,0==o.ContentLength?(r.isFetching=!1,r.fileActive.info="该文件为空"):!o.ContentLength||_.toNumber(o.ContentLength)<=5242880?l.get(e).then(function(e){if(r.isFetching=!1,"application/json"==o.ContentType||"json"==r.fileActive.type){let t=e;try{t=JSON.parse(e)}catch(e){}r.fileActive.body=JSON.stringify(t,null,2)}else if("csv"==t.type){let t=",";-1==e.indexOf(",")&&(t=" ");const n=_.map(_.slice(_.compact(e.split(/\r\n|\n/)),0,101),function(e){return _.split(e,t)});r.fileActive.body=n}else r.fileActive.body=e},function(e){r.isFetching=!1}):(r.isFetching=!1,r.fileActive.info="文件超过5M不支持预览")):(r.isFetching=!1,r.fileActive.info="暂不支持该文件查看")},function(e){})}},r.onFileCheckAll=function(e){r.checkAll=e.target.checked,r.filesRemovable=r.checkAll,_.forEach(r.data,function(e){e.checked=r.checkAll})},r.onFileChecked=function(e,t){e.stopPropagation();let n=_.find(r.data,{id:t});n.checked=!n.checked,r.filesRemovable=_.findIndex(r.data,{checked:!0})>-1};let C=!1;r.onCancelRemoveHandler=function(){C=!0};let S=function(e,t){let n=_.slice(r.filesBreadcrumbs,-1)[0],o=e.length,i=0,a=function(s){let c=s.id,p=s.isFolder;l.remove(c).then(function(s){if(i++,_.remove(r.data,{id:c}),r.total-=1,g[c]&&delete g[c],p?(n.prefixes-=1,_.has(g[n.id],"prefixes")&&_.remove(g[n.id].prefixes,{id:c})):(n.catalog-=1,_.has(g[n.id],"catalog")&&_.remove(g[n.id].catalog,{id:c})),C)return r.removing=!1,void(r.filesRemovable=!0);if(i<o)a(e[i]);else{let e=t?null:_.filter(r.data,"checked");if(r.checkAll&&!_.isEmpty(e))S(e);else if(t||(r.checkAll=!1,r.removing=!1),!r.total&&r.filesBreadcrumbs.length>1){let e=r.filesBreadcrumbs.slice(-2),t=e[1].id,n=e[0].id;"local"==window.appConfig.appDataStoreType&&l.remove(t.slice(0,-1)),r.filesBreadcrumbs[r.filesBreadcrumbs.length-2].prefixes-=1,delete g[t],_.remove(g[n].prefixes,{id:t}),r.onFilesBreadcrumbsBack()}}})};a(e[i])};r.onRemoveFiles=function(e,t,n){e.stopPropagation(),b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$uibModalInstance",function(e,o){e.alertTitle="删除",e.alertIcon="iconfont iconjinggao text-danger",e.alertBody=t&&n?'是否删除文件 "'+n+'"？':"是否删除已选中的文件或文件夹？",e.ok=function(){o.close(!0)},e.cancel=function(){o.dismiss("cancel")}}],size:"sm"}).result.then(function(e){let n=null;t?n=_.filter(r.data,{id:t}):(r.filesRemovable=!1,r.removing=!0,C=!1,n=_.filter(r.data,"checked")),S(n,t)},function(e){})},r.onFilesDownload=function(e,t,n){e.stopPropagation(),t&&n&&s.download(t,n)},r.onFilesBreadcrumbs=function(e){if(r.checkAll=!1,r.active=null,r.fileChecked=!1,null!=e){let t=_.findIndex(r.filesBreadcrumbs,{id:e});r.filesBreadcrumbs=r.filesBreadcrumbs.slice(0,t+1),r.data=_.forEach(g[e].prefixes.concat(g[e].catalog),function(e){e.checked=!1}),r.total=r.data.length}},r.onFilesBreadcrumbsBack=function(){r.checkAll=!1,r.active=null,r.fileChecked=!1,r.filesBreadcrumbs.pop();let e=r.filesBreadcrumbs.slice(-1)[0].id;r.data=_.forEach(g[e].prefixes.concat(g[e].catalog),function(e){e.checked=!1}),r.total=r.data.length},r.onClickImage=function(e){i.fullScreenImage.onShowScreenImage(e,r.fileActive.src)};r.onFileNext=function(e,t){if(!(e===(r.data[0].id&&"38"===t)||e===r.data[r.data.length-1].id&&"40"===t||"40"!=t&&"38"!=t)){let n=function(e,t){let n;for(let o=0;o<r.data.length;o++)r.data[o].id==e&&(38==t&&(n=r.data[o-1].id),40==t&&(n=r.data[o+1].id));return n}(e,t);r.onFileItem(n)}},r.ok=function(){let e=_.filter(r.data,function(e){return!e.isFolder&&e.checked});e=_.map(e,function(e){return e.id}).join(","),y.value=e,u.changeNode(a.nodeId),I.close()},r.cancel=function(){I.close()},r.$on("modal.closing",function(e,t){I=void 0}),r.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.onAsideToggle=function(e){let t;if("predict"===i.currentApp.type&&i.currentApp.dashboard){if(t=angular.element(".front-panel"),"right"==e){const e=angular.element(".sp-toggle");e.hasClass("right-hidden")?e.removeClass("right-hidden"):e.addClass("right-hidden")}o(function(){i.$broadcast("canvasresizer.update")},300)}else t=angular.element("#edit");if(t.hasClass(e+"-hidden")?t.removeClass(e+"-hidden"):t.addClass(e+"-hidden"),"left"==e){let n,o=angular.element(".sp-app-bottom");if(t.hasClass(e+"-hidden"))n=0;else{n=angular.element(".sp-app-aside").width()}o.css({left:n})}else if("right"==e){let n,o=angular.element(".sp-app-bottom");if(t.hasClass(e+"-hidden"))n=0;else{n=angular.element(".sp-app-right").width()}o.css({right:n})}u.resetCanvas()},e.togglePredictDashboard=function(t){e.currentApp.screenshot.loading||(t?i.$broadcast("predict.predict",t):i.$broadcast("predict.dashboard",t))},e.toggleDashboardUrl=function(){const e=("hardware"==i.appConfig._context?"http://"+i.appConfig._board.ip:location.origin)+"/dashboard/"+window.appConfig.userId+"/"+n.id;window.open(e)};const T=function(t){if("Digit1"===t.code&&t.altKey&&"predict"===i.currentApp.type)e.togglePredictDashboard(!i.currentApp.dashboard);else if(("Digit2"===t.code||"Digit3"===t.code)&&t.altKey){var n="";"Digit2"===t.code&&(n="left"),"Digit3"===t.code&&(n="right"),n&&i.onAsideToggle(n)}e.$apply()};e.toggleDashboardUrl=function(){const e=("hardware"==i.appConfig._context?"http://"+i.appConfig._board.ip:location.origin)+"/dashboard/"+window.appConfig.userId+"/"+n.id;window.open(e)},document.addEventListener("keyup",T,!1);const E={lastSaved:"上次修改是在",saved:"最近保存 ",success:"保存成功"},k=function(e,t){const n=moment();let o;switch(e){case"lastSaved":return o=moment(t).diff(n,"days")<-30?moment(t).format("YYYY年MM月DD日"):moment(t).diff(n,"hours")+n.hours()<0?moment(t).format("MM月DD日"):moment(t).fromNow(),E[e]+o+"进行的";case"saved":return o=moment(t).format("HH:mm"),E[e]+o;default:return E[e]}};let P;i.$on("app-saved",function(e,t){i.saveStatus=t,t&&(i.saveStatus.msg=k(t.status,t.timestamp),P&&(o.cancel(P),P=null),"success"==t.status&&(P=o(function(){i.saveStatus.status="saved",i.saveStatus.msg=k(t.status,t.timestamp)},2e3)))}),i.iconList={icons:w,images:null},i.getImages=function(){const t=n.componentId?"studio/{{userId}}/component/{{componentId}}/icons/":"studio/{{userId}}/{{appId}}/icons/",o=x(t);appService.getContents(o).then(function(t){const n=[],o=t.catalog.length;let i=0;const a=function(s){r.url(s.id).then(function(e){n.push({key:s.id,url:e.data})}).finally(function(){++i<o?a(t.catalog[i]):e.iconList.images=n})};o&&a(t.catalog[i])})},i.getImages(),l.onStart({},function(e){I&&(I.close(),I=void 0)}),t.defaultErrorHandler(function(e,t,n){});const O=new Worker("/assets/web/js/LZString.js"),A={type:"c"};i.doSave=function(e,n,o,r){const a=s.defer(),c=u.getGraphJson(),l=(new Date).getTime();return c.timestamp=l,A.data=JSON.stringify(c),A.version=o,O.postMessage(A),O.onmessage=function(o){const{type:s,data:c}=o.data;"c"===s&&appService.save(e.id,c).then(function(){r?v.pop("success","保存成功"):i.$broadcast("app-saved",{status:"success",timestamp:l}),a.resolve()},function(o){v.pop("error","保存项目失败: "+o.msg),"正在被其他客户端编辑"===o.msg&&t.go(n,{type:e.type,id:e.id,refresh:e.refresh+1}),a.reject(o)})},O.onerror=function(e){id,a.reject(e.message)},a.promise},i.onAppImageUploaded=function(e,t,n){(t||u.getGraph()).properties.preview=e,n&&i.doSave(n.stateParams,n.nextRoute,n.version)},i.onRevoke=function(){if(i.removedNodes.length){let e=i.removedNodes.pop(),t=e.metadata,n=u.getNodeOriginalPosision(t.x,t.y);switch(t.type){case"public_component":u.addPublicRemoteNode(e.component,n.x,n.y,t.type);break;case"my_component":u.addRemoteNode(e.component,n.x,n.y,t.type);break;case"hufu_component":u.addHufuNode(e.component,t.label,t.icon,n.x,n.y,t.type)}}},i.initNodeChart=function(e,t){i.nodesChart||(i.nodesChart={}),i.nodesChart[t]=new frappe.Chart(e,{data:{labels:["1","2","3","4","5","6"],datasets:[{name:"in1",type:"line",values:[0,0,0,0,0,0]}]},type:"axis-mixed",width:230,height:130,lineOptions:{dotSize:2,hideDots:!0},colors:["#6ea8e5","#ff962e","#ff5c5f","#70cc62","#86d1ca"]}),i.nodesChart[t].showTooltip=!1},i.destroyNodeChart=function(e){i.nodesChart[e].parent.removeChild(i.nodesChart[e].container),i.nodesChart[e].destroy(),delete i.nodesChart[e]},i.onChangeTheme=function(e){i.appConfig.theme=e,u.handleNodesCalculated(e),u.setAppState("theme",e)},e.$on("$destroy",function(){i.fullScreenImage=void 0,P&&(o.cancel(P),P=void 0),document.removeEventListener("keyup",T,!1),i.doSave=void 0,i.onAppImageUploaded=void 0,O.terminate()})}]}}})}]).run(["$rootScope","toaster","app","$transitions",function(e,t,n,o){n.toaster=t,window.onbeforeunload=function(){},o.onSuccess({},function(t){e.previousState=t.from().name,e.currentState=t.to().name})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize",{url:"/component/:componentId",params:{refresh:0},resolve:{compInfo:["componentService","$stateParams","pageLoading","$q","$state","toaster",function(e,t,n,o,r,i){let a=o.defer();return t.componentId?e.getPermission(t.componentId).then(function(o){!o||"read"!==o.result||r.transition.to().$$state().includes["app.customize.read"]?!o||"write"!==o.result||r.transition.to().$$state().includes["app.customize.edit"]?e.get(t.componentId).then(function(e){a.resolve(e.componentInfo),n.show()},function(e){i.pop("warning","获取组件信息失败: "+e.msg),r.go("app.customize",{componentId:"",refresh:t.refresh+1})}):r.go("app.customize.edit",{componentId:t.componentId,refresh:t.refresh+1}):r.go("app.customize.read",{componentId:t.componentId,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg),r.go("app.customize",{componentId:"",refresh:t.refresh+1})}):e.list(null,1).then(function(n){n.list&&n.list.length>0?r.go("app.customize",{componentId:n.list[0].id,refresh:t.refresh+1}):e.create("未命名组件",void 0).then(function(e){r.go("app.customize",{componentId:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}),a.promise}]},deepStateRedirect:{default:"app.customize.read",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","pageLoading","nodeService","compInfo","$rootScope","$timeout","common",function(e,t,n,o,r,i,a,s,c){a.getImages();let l=$("#editor");r.init(l,null,function(){a.pageLoading=!1,a.landingCollapsed&&(document.getElementById("container").style.zIndex=1),o.hide()}),i.data||console.error("no data"),"string"==typeof i.data&&(i.data=JSON.parse(i.data)),a.$broadcast("toggle.customize",{id:i.id,dir:i.dir}),a.nodeId=r.addCustomNode(i.name,i.data),a.compInfo=angular.copy(i),delete a.compInfo.data,a.node=r.getNode(a.nodeId),a.controlList=[],a.paramsModel=r.getParamsModel(i.data.def.params);const p=a.$on("ngRepeatFinished",function(){const e=document.getElementById(i.id.toString());if(!e)return;const t=angular.element(e).offset().top,n=angular.element(".navi");(t<n.offset().top||t>n.height()+n.offset().top)&&n.scrollTop(e.offsetTop-n.height()/2)});a.change=function(t){e.controlList=[];let n={},o=function(){for(let t in e.paramsModel.port){let o=e.paramsModel.port[t];for(let e in o)n[o[e]]?(o.error_duplicate||(o.error_duplicate={}),o.error_duplicate[e]=!0):(o.error_duplicate&&o.error_duplicate[e]&&delete o.error_duplicate[e],o.error_duplicate&&c.isEmpty(o.error_duplicate)&&delete o.error_duplicate),n[o[e]]={type:"port",id:t,sub:e}}},r=function(){for(let t in e.paramsModel.control)e.paramsModel.control[t].value&&(e.controlList.push(e.paramsModel.control[t].value),n[e.paramsModel.control[t].value]?e.paramsModel.control[t].error_duplicate=!0:delete e.paramsModel.control[t].error_duplicate,n[e.paramsModel.control[t].value]={type:"control",id:t})};"control"===t&&(o(),r()),"port"===t&&(r(),o())},s(function(){e.change("control")}),r.setExpandIconClickedHandler(function(e,o){t.go("app.composite",{componentId:n.componentId})}),e.$on("$destroy",function(){a.nodeId=void 0,a.node=void 0,a.paramsModel=void 0,a.controlList=void 0,a.change=void 0,a.compInfo=void 0,r.setExpandIconClickedHandler(null),p()})}]},"page-panel@app.customize":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","componentService","toaster",function(e,t,n,o,r,i,a,s,c){n.componentId=n.node.component,n.nodeTabInfo=n.node.metadata.ui.tabs}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.edit",{url:"/edit",deepStateRedirect:{default:"app.customize.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","nodeService","toaster","componentService",function(e,t,n,o,r,i){let a,s=n.save=function(){a&&(clearTimeout(a),a=void 0),a=setTimeout(function(){let a=o.getCustomizeNodeMetadata(n.nodeId,n.paramsModel);i.save(t.componentId,a).then(function(){},function(t){t&&"未授权"===t.msg&&e.reload(),r.pop("error","保存组件失败: "+t.msg)})},500)};n.$watch("node",function(){s()},!0),n.$watch("paramsModel",function(){s()},!0),o.setGraphChangeHandler(function(){s()}),n.$on("$destroy",function(){o.setGraphChangeHandler(null),a&&(clearTimeout(a),a=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html",controller:["$scope","$rootScope","$state",function(e,t,n){e.onFinish=function(){if(_.isEmpty(t.currentApp)){const n=_.find(Object.keys(e.appConfig.appMenu),function(n){return _.has(e.appConfig.appMenu[n],"componentType")&&_.get(e.appConfig.appMenu[n],"componentType").indexOf(t.compInfo.type)>-1});n&&window.onExpandList("/"+n)}else n.go("app."+t.currentApp.type,{type:t.currentApp.appType,id:t.currentApp.id})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.edit.setting",{deepStateRedirect:{default:"app.customize.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.customize":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.customize.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.customize.edit.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.edit.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.edit.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.read",{deepStateRedirect:{default:"app.customize.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope",function(e,t,n,o){o.readOnly=!0,n.$on("$destroy",function(){o.readOnly=void 0})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.read.middle.html",controller:["$scope","$rootScope","componentService","toaster","$stateParams","$state",function(e,t,n,o,r,i){e.requireEdit=function(){n.setPermission(r.componentId).then(function(e){i.reload("app.customize")},function(e){o.pop("error","请求失败: "+e.msg)})},o.pop("warning","当前状态仅支持查看，请在“编辑”状态下进行编辑"),e.onFinish=function(){if(_.isEmpty(t.currentApp)){const n=_.find(Object.keys(e.appConfig.appMenu),function(n){return _.has(e.appConfig.appMenu[n],"componentType")&&_.get(e.appConfig.appMenu[n],"componentType").indexOf(t.compInfo.type)>-1});n&&window.onExpandList("/"+n)}else i.go("app."+t.currentApp.type,{type:t.currentApp.appType,id:t.currentApp.id})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.read.setting",{deepStateRedirect:{default:"app.customize.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.customize":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.customize.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.customize.read.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.read.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.read.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite",{url:"/composite/:componentId",params:{refresh:0},resolve:{compInfo:["componentService","$stateParams","pageLoading","$q","$state","toaster",function(e,t,n,o,r,i){let a=o.defer();return t.componentId?e.getPermission(t.componentId).then(function(o){!o||"read"!==o.result||r.transition.to().$$state().includes["app.composite.read"]?!o||"write"!==o.result||r.transition.to().$$state().includes["app.composite.edit"]?e.get(t.componentId).then(function(e){a.resolve(e.componentInfo),n.show()},function(e){i.pop("warning","获取组件信息失败: "+e.msg),r.go("app.composite",{componentId:"",refresh:t.refresh+1})}):r.go("app.composite.edit",{componentId:t.componentId,refresh:t.refresh+1}):r.go("app.composite.read",{componentId:t.componentId,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}):e.list(null,1).then(function(n){n.list&&n.list.length>0?r.go("app.composite",{componentId:n.list[0].id,refresh:t.refresh+1}):e.create("未命名组件",void 0).then(function(e){r.go("app.composite",{componentId:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}),a.promise}]},deepStateRedirect:{default:"app.composite.read",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","pageLoading","nodeService","compInfo","$rootScope","$timeout","common",function(e,t,n,o,r,i,a,s,c){i.data||console.error("no data"),"string"==typeof i.data&&(i.data=JSON.parse(i.data));let l=$("#editor");r.init(l,i.data.def.composite,function(){o.hide(),a.landingCollapsed&&(document.getElementById("container").style.zIndex=1),a.$broadcast("editor.ready")}),a.compInfo=angular.copy(i),delete a.compInfo.data,a.compMetadata=angular.copy(i.data),delete a.compMetadata.def.composite,a.$$phase||a.$digest(),e.$on("$destroy",function(){a.compInfo=void 0,a.compMetadata=void 0})}]},"page-panel@app.composite":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","componentService","toaster",function(e,t,n,o,r,i,a,s,c){}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit",{url:"/edit",deepStateRedirect:{default:"app.composite.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","componentService","toaster","$q",function(e,t,n,o,r,i,a,s){let c,l=o.save=function(){let n=s.defer();return c&&(clearTimeout(c),c=void 0),c=setTimeout(function(){c=void 0;let n=angular.copy(o.compMetadata);n.def.composite=r.getGraphJson(),i.save(t.componentId,n).then(function(e,t){},function(t){t&&"未授权"===t.msg&&e.reload(),a.pop("error","保存组件失败: "+t.msg)})},500),n.promise};n.$watch("compMetadata",function(){l()},!0),r.setGraphChangeHandler(function(){l()}),r.setNodeSelectionHandler(function(t,n,o,r){n?e.go("app.composite.edit.node",{nodeId:n}):e.go("app.composite.edit")}),r.setEdgeSelectionHandler(function(t,n){t?e.go("app.composite.edit.edge",{edgeId:t}):e.go("app.composite.edit.setting")}),n.$on("$destroy",function(){r.setNodeSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),o.save=void 0,c&&(clearTimeout(c),c=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html",controller:["$scope","$rootScope",function(e,t){}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.node",{url:"/:nodeId",params:{},deepStateRedirect:{default:"app.composite.edit.node.setting",params:!0},views:{"page-panel@app.composite":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService",function(e,t,n,o,r,i,a,s){let c=$("#editor #"+t.nodeId);c&&0!==c.length?(n.nodeId=t.nodeId,n.node=a.getNode(n.nodeId),n.nodeTabInfo=n.node.metadata.ui?n.node.metadata.ui.tabs:{},n.componentId=n.node.component,n.logId=s.getLogId(window.appConfig.userId,t.id,t.nodeId),n.$watch("node",function(e,t){e!==t&&n.save()},!0),$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),o.removeNode(n.node,"app.composite.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copiedNode=angular.copy(n.node));break;case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copiedNode&&a.pasteNode(o.copiedNode))}}),c.addClass("selected"),n.$on("$destroy",function(){c.removeClass("selected"),$(document).off("keydown.node.edit")})):e.go("app.composite.edit")}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.node.setting",{deepStateRedirect:{default:"app.composite.edit.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:"./fields"}]},views:{"panel@app.composite.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.composite.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.composite.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.composite.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.setting",{deepStateRedirect:{default:"app.composite.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.composite":{templateUrl:"/tpl/custom/panels/index.html",controller:"compositeSettingController"}}}).state("app.composite.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.composite.edit.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.edit.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.edit.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.read",{deepStateRedirect:{default:"app.composite.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window",function(e,t,n,o,r,i,a){e.requireEdit=function(){o.setPermission(r.id).then(function(e){i.reload("app.composite")},function(e){n.pop("error","请求失败: "+e.msg)})},n.pop("warning","当前状态仅支持查看，请在“编辑”状态下进行编辑")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.read.setting",{deepStateRedirect:{default:"app.composite.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.composite":{templateUrl:"/tpl/custom/panels/index.html",controller:"compositeSettingController"}}}).state("app.composite.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.composite.read.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.read.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.read.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp",{url:"/app/:type/:id",params:{refresh:0},resolve:{appInfo:["appService","$stateParams","rpaService","$q","$state","toaster","pageLoading",function(e,t,n,o,r,i,a){const s=o.defer(),c=t.type||"algo",l=function(n){e.get(n).then(function(e){s.resolve(e.appInfo)},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})},p=function(e){t.nodeId?r.go(e+".node",{type:c,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):r.go(e,{type:c,id:t.id,refresh:t.refresh+1})};if(a.show(),t.id)if(r.transition.to().$$state().includes["app.exp.history"])l(t.id);else{let o=e;"rpa"===c&&(o=n),o.getNetworkStatus(t.id).then(function(n){if(n&&n.map){if("1"===n.map.status||"5"===n.map.status||"6"===n.map.status||"9"===n.map.status)return r.transition.to().$$state().includes["app.exp.run"]?void l(t.id):void p("app.exp.run");if("8"===n.map.status)return r.transition.to().$$state().includes["app.exp.cron"]?void l(t.id):void p("app.exp.cron")}e.getPermission(t.id).then(function(n){if(!n||"write"!==n.result||r.transition.to().$$state().includes["app.exp.edit"]){if(n&&"read"===n.result){if(r.transition.to().$$state().includes["app.exp.edit"])return void e.setPermission(t.id).then(function(e){l(t.id)},function(e){p("app.exp.read")});if(!r.transition.to().$$state().includes["app.exp.read"])return void p("app.exp.read")}l(t.id)}else p("app.exp.edit")},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})}else{const n=function(){e.create("未命名项目",null,c).then(function(e){r.go("app.exp",{type:c,id:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取项目信息失败: "+e.msg)})};e.list(30,c).then(function(o){if(o&&o.list&&o.list.length>0){let i=0;const a=function(s){i++,e.head(s.id).then(function(e){r.go("app.exp",{type:c,id:s.id,refresh:t.refresh+1})},function(e){i<o.list.length?a(o.list[i]):n()})};a(o.list[i])}else n()},function(e){i.pop("error","获取项目信息失败: "+e.msg)})}return s.promise}]},deepStateRedirect:{default:"app.exp.edit",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","appInfo","pageLoading","nodeService","$rootScope","logService","toaster",function(e,t,n,o,r,i,a,s,c){window.appConfig.appId=n.id;const l=_.get(a.appConfig,"appMenu");if(a.currentApp={type:_.split(t.$current.name,".")[1],appType:n.type,id:n.id,icon:l[n.type].icon,name:l[n.type].name,showNodePortData:{}},a.$broadcast("toggle.app",n.type),!_.isEmpty(o.data)){const e=_.get(JSON.parse(o.data),"timestamp"),t=e?{status:"lastSaved",timestamp:e}:null;a.$broadcast("app-saved",t)}a.getImages();const p=$("#editor");i.init(p,o.data,function(){r.hide(),a.landingCollapsed&&(document.getElementById("container").style.zIndex=1),a.$broadcast("editor.ready")}),a.appInfo=angular.copy(o),a.appLogId=s.getAppLogId(window.appConfig.userId,n.id),delete a.appInfo.data,a.$$phase||a.$digest(),a.runStartStop=function(){a.doSave(n,"app.exp.read","v1").then(function(){const e=i.onValidated();e&&"error"===e.status?c.pop("error",e.message):t.go("app.exp.prepare",{type:n.type,runType:"runStartStop"})},function(e){"网络错误"===e.msg&&c.pop("warning","请检查网络，稍后重试")})},e.$on("$destroy",function(){a.appInfo=void 0,a.appLogId=void 0,window.appConfig.appId=void 0,a.runStartStop=void 0})}]},"page-panel@app.exp":{template:"<div ui-view='panel'></div>"},"statusbar-panel@app.exp":{templateUrl:"/tpl/custom/status/exp_index.html",controller:"statusbarController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit",{deepStateRedirect:{default:"app.exp.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","rpaService","appService","toaster","$q",function(e,t,n,o,r,i,a,s,c){let l,p=$("#editor");n.$on("editor.ready",function(){p=$("#editor")});let d=t.type||"algo",u=a;"rpa"===d&&(u=i);let h,f=0,g=function(){p&&p.length?(r.showAllScreenshots(),u.getNetworkStatus(t.id).then(function(e){if(!e||!e.map)return;let t=e.map;for(let e in t){if(!e.startsWith("node.status."))continue;let n=e.replace("node.status.",""),o=t[e],r=$("#"+n);switch(o){case"4":r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").show();break;case"3":r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").show(),r.find(".the-graph-error-icon").hide();break;case"1":break;default:r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").hide()}}e.msg&&e.msg[f]&&(s.pop("info",e.msg[f]),f+=1)})):l=window.setTimeout(g,1e3)};g();let m,v=o.save=function(){h||(h=setTimeout(function(){o.doSave(t,"app.exp.read","v1"),clearTimeout(h),h=void 0},1e3))};r.setGraphChangeHandler(function(){v();const e=r.getGraph();_.isEmpty(e.properties.preview)?m||(m=window.setTimeout(function(){o.screenshots("screen_shot.png"),window.clearTimeout(m),m=void 0},1e4)):m&&(window.clearTimeout(m),m=void 0)}),r.setEdgeSelectionHandler(function(t,n){t?e.go("app.exp.edit.edge",{edgeId:t}):e.go("app.exp.edit.setting")}),r.setGroupSelectionHandler(function(t){t&&e.go("app.exp.edit.group",{groupId:t})}),r.setNodeSelectionHandler(function(t,n,r,i){if(t.ctrlKey||t.metaKey)if(n)if(e.includes("app.exp.edit.multi")){let t=e.params.nodes.indexOf(n);-1===t?(e.params.nodes.push(n),o.$broadcast("multi.nodes.add",{nodeId:n})):1===e.params.nodes.length?e.go("app.exp.edit"):(e.params.nodes.splice(t,1),o.$broadcast("multi.nodes.remove",{nodeId:n}))}else e.includes("app.exp.edit.node")?e.params.nodeId!==n?e.go("app.exp.edit.multi",{nodes:[e.params.nodeId,n]}):e.go("app.exp.edit.node",{nodeId:n}):n?e.go("app.exp.edit.node",{nodeId:n}):e.go("app.exp.edit");else e.go("app.exp.edit");else n?e.go("app.exp.edit.node",{nodeId:n}):e.go("app.exp.edit")}),r.setNodeRectImgDblclickHandler.call(this,function(e,n,r){if("dblclick"==e.type&&n&&r){let e="studio/"+window.appConfig.userId+"/logs/"+t.id+"/screenshots/"+n+"/";o.showFiles(e)}}),$(document).on("keydown.edit",function(e){let t=$(e.target);if(!(t.is("input")||t.is("textarea")||t.is(".form-control")))switch(e.keyCode){case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copiedNode&&r.pasteNode(o.copiedNode));break;case 90:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.onRevoke())}}),n.$on("$destroy",function(){window.clearTimeout(l),window.clearTimeout(m),r.setNodeSelectionHandler(null),r.setGroupSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),r.setNodeRectImgDblclickHandler(null),$(document).off("keydown.edit"),o.removedNodes=[],o.save=void 0,h&&(clearTimeout(h),h=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.middle.html"},"context-menu@app":{templateUrl:"/tpl/blocks/sp-context-menu.html",controller:"expNodeContextMenuController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.setting",{deepStateRedirect:{default:"app.exp.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.node",{url:"/:nodeId",params:{portId:null},deepStateRedirect:{default:"app.exp.edit.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService","logService","appService","toaster",function(e,t,n,o,r,i,a,s){let c=null;if(_.isEmpty(t.nodeId)||(c=$("#editor #"+t.nodeId)),!c||0===c.length)return void e.go("app.exp.edit");n.nodeId=t.nodeId,n.node=r.getNode(n.nodeId),n.nodeTabInfo=n.node.metadata.ui?n.node.metadata.ui.tabs:{},n.componentId=n.node.component,n.logId=i.getLogId(window.appConfig.userId,t.id,t.nodeId),o.nodeCompType=n.node.metadata.def.type,o.$broadcast("toggle.node",n.node),n.resetTabInfo(n.node.metadata.def.params,n.nodeTabInfo),998===o.nodeCompType&&(n.appList=[],a.list(9999,"algo").then(function(e){e&&e.list&&(n.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){s.pop("error","获取项目列表失败: "+e.msg)})),n.updateCompositeAppId=function(e){n.node.metadata.def.compositeParams=[],n.node.metadata.def.ports=[],n.node.metadata.def.compositeApp=_.find(n.appList,{id:e}),a.get(e).then(function(e){n.node.metadata.def.ports=[],n.node.metadata.def.composite=JSON.parse(e.appInfo.data),r.collectCompositePorts(n.node.metadata.def.composite,n.node.metadata.def.ports),r.changeNode(t.nodeId),n.save()},function(e){s.pop("error","获取项目信息失败: "+e.msg)})},n.node,n.$watch("node",function(e,t){e!==t&&n.save()},!0),$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),o.removeNode(n.node,"app.exp.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copiedNode=angular.copy(n.node),n.node.metadata.def.compositeAppId&&(delete o.copiedNode.metadata.initCoord,delete o.copiedNode.metadata.def.composite,delete o.copiedNode.metadata.def.compositeAppId,delete o.copiedNode.metadata.def.compositeParams));break;case 37:n.node.metadata.x-=1,r.changeNode(n.nodeId);break;case 38:n.node.metadata.y-=1,r.changeNode(n.nodeId);break;case 39:n.node.metadata.x+=1,r.changeNode(n.nodeId);break;case 40:n.node.metadata.y+=1,r.changeNode(n.nodeId)}}),c.addClass("selected");let l=r.hightEdges(t.nodeId);n.$on("$destroy",function(){o.nodeCompType=void 0,c.removeClass("selected"),$(l).removeClass("active"),$(document).off("keydown.node.edit"),o.$broadcast("toggle.node",null)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.node.middle.html",controller:["$scope","$stateParams","$rootScope","appService","nodeService","$state","toaster",function(e,t,n,o,r,i,a){e.a={},e.doRun=function(e,o){const s="runStartStop"==e&&o;n.doSave(t,"app.exp.read","v1").then(function(){const t=r.onValidated(s);t&&"error"===t.status?a.pop("error",t.message):i.go("app.exp.prepare.node",{nodeId:o,runType:e,targetNodeId:o})},function(e){"网络错误"===e.msg&&a.pop("warning","请检查网络，稍后重试")})},e.doExpand=function(){const e=r.getNode(t.nodeId);if("composite"!==e.component){const n=_.get(e,"metadata.def.compositeAppId");if(!n)return void a.pop("warning","该组件缺少运行的项目");o.get(n).then(function(n){e.metadata.def.composite=JSON.parse(n.appInfo.data),r.collectCompositePorts(e.metadata.def.composite,e.metadata.def.ports),r.changeNode(t.nodeId)},function(e){a.pop("error","获取项目信息失败: "+e.msg)}).finally(function(){r.expandGroup(e),requestAnimationFrame(function(){i.go("app.exp.edit.group",{groupId:t.nodeId})})})}else r.expandGroup(e),i.go("app.exp.edit.group",{groupId:t.nodeId})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.node.setting",{deepStateRedirect:{default:"app.exp.edit.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.multi",{url:"/nodes",params:{nodes:null},deepStateRedirect:{default:"app.exp.edit.multi.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService",function(e,t,n,o,r,i,a){if(!t.nodes||!t.nodes.length)return void e.go("app.exp.edit");n.getMultiNodes=function(){return _.map(t.nodes,function(e){return a.getNode(e)})};$(document).on("keydown.node.edit",function(e){let t=$(e.target);var r;if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation();const t=n.getMultiNodes();o.removeMultiNodes(t,"app.exp.edit");break;case 67:(e.ctrlKey||e.metaKey)&&e.stopPropagation();break;case 37:case 38:case 39:case 40:r=e.keyCode,_.forEach(n.nodes,function(e){switch(r){case 37:e.metadata.x-=10,a.changeNode(e.id);break;case 38:e.metadata.y-=10,a.changeNode(e.id);break;case 39:e.metadata.x+=10,a.changeNode(e.id);break;case 40:e.metadata.y+=10,a.changeNode(e.id)}})}});for(let e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).addClass("selected")}n.$on("multi.nodes.add",function(e,t){$("#editor #"+t.nodeId).addClass("selected")}),n.$on("multi.nodes.remove",function(e,t){$("#editor #"+t.nodeId).removeClass("selected")}),n.$on("$destroy",function(){for(let e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).removeClass("selected")}$(document).off("keydown.node.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.multi.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,n,o,r,i,a){e.a={},e.a.doGroup=function(){let e=a.uuid();r.addGroup(e,n.nodes,{name:"未命名组合",component:"composite",data:{}}),i.go("app.exp.edit.group",{groupId:e})};let s=function(){if(n.nodes){for(let o=0;o<n.nodes.length;o++){if(r.whichGroup(n.nodes[o]).length)return e.a.canotGroup=!0,void(t.$$phase||t.$apply())}e.a.canotGroup=!1,t.$$phase||t.$apply()}};s(),e.$on("multi.nodes.add",function(e,t){s()}),e.$on("multi.nodes.remove",function(e,t){s()}),e.$on("$destroy",function(){})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.multi.setting",{deepStateRedirect:{default:"app.exp.edit.multi.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.edit.multi":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.multi.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_multi_edit.html",controller:"expMultiSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.edge",{params:{edgeId:null},deepStateRedirect:{default:"app.exp.edit.edge.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","nodeService",function(e,t,n,o){let r=$("#"+t.edgeId);if(!r||0===r.length)return void e.go("app.exp.edit");r.addClass("selected"),r.parent().append(r);let i=t.edgeId.split("-");n.edge=o.getEdge(i[1],i[2],i[4],i[3]),_.get(n.edge,"metadata.color")||_.set(n.edge,"metadata.color","#a6a6a6"),_.get(n.edge,"metadata.size")||_.set(n.edge,"metadata.size",1);const{from:a,to:s,metadata:c}=n.edge;n.$watch("edge.metadata.color",function(e){o.setEdgeMetadata(a.node,a.port,s.node,s.port,c)}),n.onChangeSize=function(){o.setEdgeMetadata(a.node,a.port,s.node,s.port,c)},$(document).on("keydown.edge.edit",function(t){let o=$(t.target);if(!o.is("input")&&!o.is("textarea"))switch(t.keyCode){case 46:case 8:t.stopPropagation(),n.removeEdge(n.edge,_.get(e,"current.name").split(".edge")[0])}}),n.$on("$destroy",function(){r.removeClass("selected"),$(document).off("keydown.edge.edit")})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.edge.setting",{deepStateRedirect:{default:"app.exp.edit.edge.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.edit.edge":{templateUrl:"/tpl/custom/panels/index.html",controller:["$state","$stateParams","$scope","$timeout","$rootScope","common","nodeService",function(e,t,n,o,r,i,a){n.tabs=angular.copy(e.current.data.tabs),n.currentTab={},n.$on("$destroy",function(){})}]}}}).state("app.exp.edit.edge.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_edge.html",controller:["$state","$scope",function(e,t){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN"),t.goPort=function(t){e.go("app.exp.edit.node",{nodeId:t.node,portId:t.port})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.group",{url:"/group/:groupId",params:{nodes:null},deepStateRedirect:{default:"app.exp.edit.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService",function(e,t,n,o,r){o.group=r.getGroup(t.groupId);let i=$("#editor #"+t.groupId);n.nodeTabInfo={params:{controls:[],tabName:{en_US:"Parameters Setting",zh:"参数设置",zh_CN:"参数设置"}}},o.nodeCompType="group",i.addClass("selection");let a=r.getGroupConnections(r.getGraph().toJSON(),n.group);r.collectGroupInport(a.inConnections,[]),r.collectGroupOutport(a.outConnections,[]),$(document).on("keydown.group.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),o.removeGroup(o.group,"app.exp")}}),n.$on("$destroy",function(){o.nodeCompType=void 0,o.group=void 0,i.removeClass("selection"),$(document).off("keydown.group.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.group.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,n,o,r,i,a){e.unGroup=function(){r.removeGroup(n.groupId),i.go("app.exp")};let s=function(){e.a={},r.getChildGroup(n.groupId).length&&(e.a.canotFold=!0)};r.getGraph()?s():e.$on("editor.ready",function(){s()}),e.doFold=function(){r.foldGroup(n.groupId),requestAnimationFrame(function(){i.go("app.exp.edit.node",{nodeId:n.groupId})})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.group.setting",{deepStateRedirect:{default:"app.exp.edit.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"}]},views:{"panel@app.exp.edit.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.edit.group.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.cron",{deepStateRedirect:{default:"app.exp.cron.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","nodeService","$state",function(e,t,n,o,r,i,a){e.stop=function(){o.stopCron(r.id,i.getCronConfig()).then(function(e){n.pop("success","停止定时运行成功"),a.reload()},function(e){n.pop("error","停止定时运行失败: "+e.msg)})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.cron.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.cron.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.cron.setting",{deepStateRedirect:{default:"app.exp.cron.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.cron.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.cron.node.setting",{deepStateRedirect:{default:"app.exp.cron.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.cron.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.cron.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.cron.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.cron.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.history",{url:"/history",deepStateRedirect:{default:"app.exp.history.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.history.middle.html",controller:["$scope","$rootScope","$state",function(e,t,n){e.backToApp=function(e){let t=e.split("_");n.go("app.exp.edit",{id:t[0]},{reload:!0})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.history.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.history.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.history.setting",{deepStateRedirect:{default:"app.exp.history.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.history.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.history.node.setting",{deepStateRedirect:{default:"app.exp.history.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.history.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.history.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.history.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.history.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.run",{deepStateRedirect:{default:"app.exp.run.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","rpaService",function(e,t,n,o,r,i){let a="algo"===r.type?o:i;e.stop=function(){a.stop(r.id).then(function(e){},function(e){n.pop("error","停止运行失败: "+e.msg)})},n.pop("error","项目运行期间请勿编辑")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.run.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.run.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.run.group",{url:"/:groupId",params:{groupId:null},deepStateRedirect:{default:"app.exp.run.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readGroupController"}}}).state("app.exp.run.setting",{deepStateRedirect:{default:"app.exp.run.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.run.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.run.node.setting",{deepStateRedirect:{default:"app.exp.run.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.run.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.run.group.setting",{deepStateRedirect:{default:"app.exp.run.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.run.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.run.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.run.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.run.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.run.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.prepare",{params:{runType:"",targetNodeId:""},deepStateRedirect:{default:"app.exp.prepare.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:"prepareController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.prepare.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.prepare.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.prepare.setting",{deepStateRedirect:{default:"app.exp.prepare.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.prepare.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.prepare.node.setting",{deepStateRedirect:{default:"app.exp.prepare.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.prepare.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.prepare.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.prepare.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.prepare.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.read",{deepStateRedirect:{default:"app.exp.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window",function(e,t,n,o,r,i,a){e.requireEdit=function(){o.setPermission(r.id).then(function(e){i.reload("app.exp")},function(e){n.pop("error","请求失败: "+e.msg)})},n.pop("warning","当前状态仅支持查看，请在“编辑”状态下进行编辑")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.read.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.read.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.read.group",{url:"/group/:groupId",params:{groupId:null},deepStateRedirect:{default:"app.exp.read.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readGroupController"}}}).state("app.exp.read.setting",{deepStateRedirect:{default:"app.exp.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.read.node.setting",{deepStateRedirect:{default:"app.exp.read.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.exp.read.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.read.group.setting",{deepStateRedirect:{default:"app.exp.read.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.read.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.read.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.read.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.read.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.read.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").constant("frontPanelI18n",{zh_CN:{styleManager:{properties:{width:"宽度",height:"高度",left:"X",top:"Y",background:"背景","background-color":"背景颜色",border:"边框","font-size":"字号","font-weight":"加粗",color:"字体颜色","text-align":"对齐方式"}}}}).config(["$stateProvider",function(e){e.state("app.predict",{url:"/service/:type/:id",params:{refresh:0},resolve:{appInfo:["appService","$stateParams","hardwareService","$q","$state","toaster","$rootScope","predictService","pageLoading","APP_STATUS",function(e,t,n,o,r,i,a,s,c,l){const p=o.defer(),d=t.type||"predict",u=function(n){e.get(n).then(function(e){p.resolve(e.appInfo)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})})},h=function(e){t.nodeId?r.go(e+".node",{type:d,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):r.go(e,{type:d,id:t.id,refresh:t.refresh+1})},f=function(n){if(n&&n.map&&(n.map.status===l.AppRunning||n.map.status===l.AppStarting||n.map.status===l.AppStopping||n.map.status===l.AppWaiting))return r.transition.to().$$state().includes["app.predict.run"]?void u(t.id):void h("app.predict.run",t.id,t.nodeId);e.getPermission(t.id).then(function(n){if(n&&"write"===n.result){if(!r.transition.to().$$state().includes["app.predict.edit"])return void h("app.predict.edit")}else if(n&&"read"===n.result){if(r.transition.to().$$state().includes["app.predict.edit"])return void e.setPermission(t.id).then(function(e){u(t.id)},function(e){h("app.predict.read")});if(!r.transition.to().$$state().includes["app.predict.read"])return void h("app.predict.read")}u(t.id)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})})};if(c.show(),t.id)a.appConfig._board?n.post("status",{id:t.id,boardId:a.appConfig._board.id}).then(function(e){f(e)},function(e){i.pop("error","获取服务信息失败: "+e.msg),a.appConfig._board=null,r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})}):s.getNetworkStatus(t.id).then(function(e){f(e)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})});else{const n=function(){e.create("未命名项目",null,d).then(function(e){r.go("app.predict",{type:d,id:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取项目信息失败: "+e.msg)})};e.list(30,d).then(function(o){if(o&&o.list&&o.list.length>0){let i=0;const a=function(s){i++,e.head(s.id).then(function(e){r.go("app.predict",{type:d,id:s.id,refresh:t.refresh+1})},function(e){i<o.list.length?a(o.list[i]):n()})};a(o.list[i])}else n()},function(e){i.pop("error","获取项目信息失败: "+e.msg)})}return p.promise}]},deepStateRedirect:{default:"app.predict.edit",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","APPMENU","$state","$stateParams","appInfo","pageLoading","nodeService","$rootScope","logService","appDataStoreService","dashboardAssetService","appService","$timeout",function(e,t,n,o,r,i,a,s,c,l,p,d,u){_.get(s.currentApp,"id")!==o.id&&"predict"===o.type&&s.appConfig._board&&(s.appConfig._context=appConfig.env,s.appConfig._board=null);const h=_.get(s.appConfig,"appMenu")||t;if(window.appConfig.appId=o.id,s.currentApp={type:_.split(n.$current.name,".")[1],appType:o.type,id:o.id,icon:h[o.type].icon,name:h[o.type].name,screenshot:{loading:!1},showNodePortData:{}},s.getImages(),s.$broadcast("toggle.app",o.type),!_.isEmpty(r.data)){const e=_.get(JSON.parse(r.data),"timestamp"),t=e?{status:"lastSaved",timestamp:e}:null;s.$broadcast("app-saved",t)}function f(e){let t="screen_shot.png";const n=a.getGraph(),r=_.get(n.properties,"preview");if("graph"!=e||"preview"!=r&&"dashboard"!=r){if("dashboard"==e&&"preview"==r)t="screen_shot_dashboard.png";else if("dashboard"==e&&"graph"==r)return s.currentApp.screenshot[e]=null,void(s.currentApp.screenshot.loading=!1)}else t="screen_shot_graph.png";const i="studio/"+window.appConfig.userId+"/"+o.id+"/"+t;s.currentApp.screenshot.loading=!0,d.getImgUrl(i).then(function(t){s.currentApp.screenshot[e]=t},function(t){s.currentApp.screenshot[e]=null}).finally(function(){s.currentApp.screenshot.loading=!1})}e.selectedNodeId=o.nodeId;let g=$("#editor"),m=null;a.init(g,r.data,function(){i.hide(),s.landingCollapsed&&(document.getElementById("container").style.zIndex=1),s.$broadcast("editor.ready"),a.setEdgeIconClickHandler(function(t,n,o,r="in"){e.openEdgeScriptEditor({from:t,to:n,metadata:o,direction:r})})}),s.appInfo=angular.copy(r);const v=s.appConfig._board?s.appConfig._board.id:null;let y;if(s.appLogId=c.getAppLogId(window.appConfig.userId,o.id,null,v),delete s.appInfo.data,s.$$phase||s.$digest(),window.spFPanelWrapper){const t=window.spFPanelWrapper.grapesjs;let o=Object.keys(t.plugins.getAll()).reverse();t.plugins.add("plugin-asset-oss",(t,n)=>{const o=t.AssetManager,r=function(e){const t=(e.dataTransfer?e.dataTransfer.files:e.target.files)[0],n=this,r={key:"loading",src:"./images/loading.gif",name:`${t.name}(上传中...)`};t&&(this.onUploadStart(),o.add(r),p.uploadImage(t).then(e=>{o.remove(r.src),e&&e.src?n.onUploadResponse({data:e}):n.onUploadError("上传失败")},e=>{o.remove(r.src),n.onUploadError(e)}))};e.imageList=[];const i=function(){p.listImages().then(function(t){e.imageList=e.imageList.concat(t),o.getAll().reset(e.imageList),o.render()},function(e){})},a=function(e){const t=e.attributes;t.key&&"loading"===t.key||p.deleteImage(e.attributes).then(function(){},function(e){console.warn("remote asset remove failed",e)})};!function(){const n=o.getConfig();let s=_.assign(n,{uploadFile:r,stylePrefix:"am-"});o.init(s),o.AssetsView().template=function(t){const n=t.pfx,r=(t.ppfx,$(`\n                      <div class="${n}assets-cont">\n                        <div class="imagelist-search-group" style="display: table;">\n                          <div class="imagelist-search-group-addon" style="display: table-row; padding-left: 5px; padding-right: 5px;">\n                            <div style="display: table-cell; width: 220px; padding-right: 10px;">\n                              <input type="text" placeholder="按资源名称搜索" class="imagelist-search-input" style="width: 100%; height: 28px; border:none; outline: none; background-color: rgba(0,0,0,0.2); padding-left: 5px;"/>\n                            </div>\n                            <div style="display: table-cell; width: 60px; padding-left: 5px; padding-right: 5px;">\n                              <button class="gjs-btn-prim gjs-btn--full imagelist-search-clear">清空</button>\n                            </div>\n                            <div style="display: table-cell; width: 60px; padding-left: 5px; padding-right: 5px;">\n                              <button class="gjs-btn-prim gjs-btn--full imagelist-search-confirm">搜索</button>\n                            </div>\n                          </div>\n                        </div>\n                        <div class="${n}assets" data-el="assets"></div>\n                        <div style="clear:both"></div>\n                      </div>\n                    `)),a=r.find(`.${n}assets`)[0];let s="";return r.find(`.${n}assets`).on("scroll",function(e){a.scrollHeight===a.clientHeight+a.scrollTop&&(s||i())}),r.find(".imagelist-search-clear").on("click",function(){r.find(".imagelist-search-input").val(""),p.reset(),s="",e.imageList=[],i()}),r.find(".imagelist-search-confirm").on("click",function(){s=r.find(".imagelist-search-input").val(),p.search(s).then(function(t){e.imageList=t,o.getAll().reset(e.imageList),o.render()},function(e){})}),r[0]},t.on("asset:remove",a),i()}()}),o.push("plugin-asset-oss"),-1==o.indexOf("grapesjs-custom-code")&&o.push("grapesjs-custom-code");const r=function(){(m=window.spFPanelWrapper.init({container:"#gjs",colorPicker:{appendTo:"body"},plugins:window.spFPanelWrapper.plugins.concat(o),layerManager:{appendTo:"#layers"},blockManager:{appendTo:"#blocks"},styleManager:{appendTo:"#styles",clearProperties:1},storageManager:{type:"sp-storage",autosave:1,autoload:0},traitManager:{appendTo:"#traits"},canvas:{styles:["/common_static/css/fontawesome.5.1.0.css","/common_static/fontFamily/index.css",window.appConfig.suanpanSdkAllCSSPath],scripts:[window.appConfig.suanpanSdkAllPath]},panels:{defaults:[{id:"layers",el:"#layers-container",resizable:{tc:0,cr:1,bc:0,keyWidth:"flex-basis"}},{id:"styles",el:"#style-container",resizable:{tc:0,cr:0,cl:1,bc:0,keyWidth:"flex-basis"}}]}})).Panels.removeButton("options","sw-visibility"),m.Panels.removeButton("views","open-tm"),m.stopCommand("sw-visibility"),m.Panels.addButton("options",{id:"canvas-clear",className:"iconfont icontrash",command:function(e){s.readOnly?m.Modal.open({title:"提示",content:"请在编辑状态下进行操作！"}):confirm("清空画布后，画布中的所有前面板组件将全部被清除。")&&e.runCommand("core:canvas-clear")},attributes:{title:"清空画布","data-tooltip-pos":"bottom"}}),m.on("block:drag:start",function(e){s.readOnly&&m.Modal.open({title:"提示",content:"请在编辑状态下进行操作！"})}),m.StorageManager.add("sp-storage",{load(e,t,n){t(a.getDashboardConfig())},store(t,n,o){if(a.setDashboardConfig(t),e.save){if(t["gjs-components"]){let e=JSON.parse(t["gjs-components"]),n={};a.getGraph().nodes.forEach(function(e){22===e.metadata.def.type&&(n[e.metadata.def.dashboardId]=e.id)});let o=function(e){e.forEach(function(e){if(e.attributes){let t=e.attributes.id;if(e.attributes.sp){let o=e.attributes.sp;if(!n[t]){const e=o.metadata;e.def.dashboardId=t,a.addDashboardNode(e)}delete n[t]}else n[t]&&(a.removeNode(n[t],!0),delete n[t])}e.components&&e.components.length&&o(e.components)})};o(e),Object.keys(n).forEach(function(e){let t=n[e];a.removeNode(t)})}e.save&&e.save()}n()}});a.setGraphAddNodeHandler(function(e,t){!function(e,t,n){if(e){let o=t.BlockManager.get(e).attributes.content;!_.isString(o)&&o.content&&(o=o.content);const r=t.addComponents(o);n&&r[0].set(n)}}(e,m,t)}),a.setGraphDeleteNodeHandler(function(e){!function(e,t){let n=t.DomComponents.componentsById[e];n=_.isArray(n)?n:[n],t.select(null),n.forEach(e=>{if(e&&e.get("removable")){if(e){const t=e.collection;e.trigger("component:destroy"),t&&t.remove(e)}}else console.warn("The element is not removable",e)})}(e,m)}),e.$on("toggle.node",function(t,n){n&&(e.selectedNodeId=n.id)}),m.on("component:selected",function(t){const n=t.ccid,o=a.getDashboardNode(n);e.selectedNodeId=o?o.id:null}),m.load(),e.onDashboardSelectedComponent=function(e){if(!_.isEmpty(e)){const t=a.getNode(e),n=_.get(t,"metadata.def.dashboardId"),o=m.getSelected();if(n){const e=m.getComponents(),t=function(e){for(let r=0;r<e.length;r++){if(e[r].ccid===n){m.selectAdd(e[r]);break}{o&&o.ccid==n&&m.selectRemove(e[r]);const i=e[r].components();i.length&&t(i.models)}}};e.length&&t(e.models)}}},f("dashboard")};s.appConfig.pluginLoaded?r():(s.currentApp.screenshot.loading=!0,async_load(s.appConfig.dashboardPluginPath,function(){s.appConfig.pluginLoaded=!0,r()})),e.$on("predict.dashboard",function(t,o){s.currentApp.dashboard=o,m.getSelectedAll().forEach(function(e){m.selectRemove(e)}),f("dashboard"),e.selectedNodeId&&(n.includes("app.predict.edit")?n.go("app.predict.edit.node",{nodeId:e.selectedNodeId}):n.includes("app.predict.run")?n.go("app.predict.run.node",{nodeId:e.selectedNodeId}):n.includes("app.predict.read")&&n.go("app.predict.read.node",{nodeId:e.selectedNodeId}))}),s.$on("canvasresizer.update",function(){const e=_.find(m.getModel().get("modules"),{name:"CanvasResizer"});e&&(e.rendered?e.setCanvasTransform():y=u(function(){e&&e.render(),u.cancel(y),y=void 0},300))}),e.$on("predict.predict",function(t,o){f("graph"),s.currentApp.dashboard=o,s.$broadcast("canvasresizer.update"),e.selectedNodeId&&(e.onDashboardSelectedComponent(e.selectedNodeId),e.selectedNodeId=null,n.includes("app.predict.edit.node")?n.go("app.predict.edit.setting"):n.includes("app.predict.run.node")?n.go("app.predict.run.setting"):n.includes("app.predict.read.node")&&n.go("app.predict.read.setting"))})}e.$on("$destroy",function(){window.appConfig.appId=void 0,s.appInfo=void 0,s.appLogId=void 0,y&&(u.cancel(y),y=void 0),m&&m.destroy()})}]},"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","toaster","hardwareService",function(e,t,n,o,r,i){let a=o.appConfig._board,s=null,c=null;if("predict"===t.type&&a){let n=function(n,i){i||(r.clear(s),s=null,c&&(clearTimeout(c),c=null),o.handleResetContext(e.current.name,t,null))},l=function(){c&&(clearTimeout(c),c=null),i.post("get",{hwtype:"board",boardId:a.id}).then(function(e){e.success&&("online"!==_.get(e,"data.state")?_.isEmpty(s)&&(s=r.pop({type:"error",title:"板子已掉线",body:"点击回到 "+o.appConfig.env+"。",showCloseButton:!1,tapToDismiss:!0,timeout:0,clickHandler:n})):s&&(r.pop("success","板子已连线！"),r.clear(s),s=null)),c=setTimeout(l,3e3)},function(e){c=setTimeout(l,3e3)})};l()}n.$on("$destroy",function(){a=void 0,c&&(clearTimeout(c),c=void 0)})}]},"statusbar-panel@app.predict":{templateUrl:"/tpl/custom/status/index.html",controller:"statusbarController"},"context-menu@app":{templateUrl:"/tpl/blocks/sp-context-menu.html",controller:"expNodeContextMenuController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit",{deepStateRedirect:{default:"app.predict.edit.setting",params:!0},resolve:{},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","appDataStoreService",function(e,t,n,o,r,i){let a,s=$("#editor");n.$on("editor.ready",function(){s=$("#editor")});let c;const l=o.save=function(){c||(c=setTimeout(function(){o.doSave(t,"app.predict.read","v2"),clearTimeout(c),c=void 0},1e3)),a||(a=window.setTimeout(function(){let e="studio/"+window.appConfig.userId+"/"+t.id+"/",n="screen_shot.png";const s=r.getGraph(),c=_.get(s.properties,"preview");o.currentApp.dashboard?("preview"===c&&(n="screen_shot_dashboard.png"),window.spFPanelWrapper.getScreenshot({allowTaint:!1,useCORS:!0,scale:.5}).then(function(r){if("toBlob"in r)try{r.toBlob(function(r){r&&i.upload(e+n,r,function(e){},function(e){},function(){"graph"==c&&o.onAppImageUploaded("dashboard",s,{stateParams:t,nextRoute:"app.predict.read",version:"v2"})})})}catch(e){}})):("preview"===c||"dashboard"===c?n="screen_shot_graph.png":_.isEmpty(c)&&o.onAppImageUploaded("graph",s,{stateParams:t,nextRoute:"app.predict.read",version:"v2"}),o.screenshots(n)),window.clearTimeout(a),a=null},1e4))};r.setGraphChangeHandler(function(){l()}),r.setNodeSelectionHandler(function(t,n,r,i){if(t.ctrlKey||t.metaKey)if(n)if(e.includes("app.predict.edit.multi")){const t=e.params.nodes.indexOf(n);-1===t?(e.params.nodes.push(n),o.$broadcast("multi.nodes.add",{nodeId:n})):1===e.params.nodes.length?e.go("app.predict.edit"):(e.params.nodes.splice(t,1),o.$broadcast("multi.nodes.remove",{nodeId:n}))}else e.includes("app.predict.edit.node")?e.params.nodeId!==n?e.go("app.predict.edit.multi",{nodes:[e.params.nodeId,n]}):e.go("app.predict.edit.node",{nodeId:n}):n?e.go("app.predict.edit.node",{nodeId:n}):e.go("app.predict.edit");else e.go("app.predict.edit");else n?e.go("app.predict.edit.node",{nodeId:n}):e.go("app.predict.edit")}),r.setEdgeSelectionHandler(function(t,n){t?e.go("app.predict.edit.edge",{edgeId:t}):e.go("app.predict.edit.setting")}),r.setGroupSelectionHandler(function(t){t&&e.go("app.predict.edit.group",{groupId:t})}),$(document).on("keydown.edit",function(e){let t=$(e.target);if(!(t.is("input")||t.is("textarea")||t.is(".form-control")))switch(e.keyCode){case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copiedNode&&r.pasteNode(o.copiedNode));break;case 90:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.onRevoke())}}),n.$on("$destroy",function(){window.clearTimeout(c),window.clearTimeout(a),r.setNodeSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),o.removedNodes=[],o.save=void 0,$(document).off("keydown.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.middle.html",controller:["$scope","$state","$stateParams","toaster","appService","nodeService","$rootScope",function(e,t,n,o,r,i,a){e.deploy=function(){a.doSave(n,"app.predict.read","v2").then(function(e){const n=i.onValidated();n&&"error"===n.status?o.pop("error",n.message):t.params.nodeId?t.go("app.predict.prepare.node",{nodeId:t.params.nodeId}):t.go("app.predict.prepare")},function(e){"网络错误"===e.msg&&o.pop("warning","请检查网络，稍后重试")})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.setting",{deepStateRedirect:{default:"app.predict.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.node",{url:"/:nodeId",params:{nodeId:null,portId:null},deepStateRedirect:{default:"app.predict.edit.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService","logService","toaster",function(e,t,n,o,r,i,a){let s=$("#editor .nodes #"+t.nodeId);if(!s||0===s.length)return void e.go("app.predict.edit");n.nodeId=t.nodeId,n.node=r.getNode(n.nodeId),o.$broadcast("toggle.node",n.node),n.nodeTabInfo=n.node.metadata.ui.tabs,n.componentId=n.node.component,o.nodeCompType=n.node.metadata.def.type;let c=o.appConfig._board?o.appConfig._board.id:null;n.logId=i.getLogId(window.appConfig.userId,t.id,t.nodeId,c),n.resetTabInfo(n.node.metadata.def.params,n.nodeTabInfo),998===o.nodeCompType&&(n.appList=[],appService.list(9999,"predict").then(function(e){e&&e.list&&(n.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){a.pop("error","获取项目列表失败: "+e.msg)})),n.updateCompositeAppId=function(e){n.node.metadata.def.compositeParams=[],n.node.metadata.def.ports=[],n.node.metadata.def.compositeApp=_.find(n.appList,{id:e}),appService.get(e).then(function(e){n.node.metadata.def.ports=[],n.node.metadata.def.composite=JSON.parse(e.appInfo.data),r.collectCompositePorts(n.node.metadata.def.composite,n.node.metadata.def.ports),r.changeNode(t.nodeId),n.save()},function(e){a.pop("error","获取项目信息失败: "+e.msg)})},n.updateCompositeAppData=function(){const e=_.get(n.node,"metadata.def.compositeAppId");e?appService.get(e).then(function(e){n.node.metadata.def.composite=JSON.parse(e.appInfo.data),r.collectCompositePorts(n.node.metadata.def.composite,n.node.metadata.def.ports),r.changeNode(n.nodeId),a.pop("success","更新成功")},function(e){a.pop("error","获取项目信息失败: "+e.msg)}):a.pop("warning","该组件缺少运行的项目")},n.$watch("node",function(e,t){e!==t&&n.save()},!0),n.node,$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),o.removeNode(n.node,"app.predict.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),"dashboard"==n.node.component?o.copiedNode=null:(o.copiedNode=angular.copy(n.node),_.has(o.copiedNode,"metadata.apiName")&&delete o.copiedNode.metadata.apiName));break;case 37:n.node.metadata.x-=1,r.changeNode(n.nodeId);break;case 38:n.node.metadata.y-=1,r.changeNode(n.nodeId);break;case 39:n.node.metadata.x+=1,r.changeNode(n.nodeId);break;case 40:n.node.metadata.y+=1,r.changeNode(n.nodeId)}}),s.addClass("selected");let l=r.hightEdges(t.nodeId);n.$on("$destroy",function(){s.removeClass("selected"),$(document).off("keydown.node.edit"),$(l).removeClass("active"),o.nodeCompType=void 0,o.$broadcast("toggle.node",null)})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.node.setting",{deepStateRedirect:{default:"app.predict.edit.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.predict.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.multi",{url:"/nodes",params:{nodes:null},deepStateRedirect:{default:"app.predict.edit.multi.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService",function(e,t,n,o,r){if(!t.nodes||!t.nodes.length)return void e.go("app.predict.edit");n.getMultiNodes=function(){return _.map(t.nodes,function(e){return r.getNode(e)})};$(document).on("keydown.node.edit",function(e){var t,i=$(e.target);if(!i.is("input")&&!i.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation();const i=n.getMultiNodes();o.removeMultiNodes(i,"app.predict.edit");break;case 67:(e.ctrlKey||e.metaKey)&&e.stopPropagation();break;case 37:case 38:case 39:case 40:t=e.keyCode,_.forEach(n.nodes,function(e){switch(t){case 37:e.metadata.x-=10,r.changeNode(e.id);break;case 38:e.metadata.y-=10,r.changeNode(e.id);break;case 39:e.metadata.x+=10,r.changeNode(e.id);break;case 40:e.metadata.y+=10,r.changeNode(e.id)}})}});for(var i=0;i<t.nodes.length;i++){$("#editor #"+t.nodes[i]).addClass("selected")}n.$on("multi.nodes.add",function(e,t){$("#editor #"+t.nodeId).addClass("selected")}),n.$on("multi.nodes.remove",function(e,t){$("#editor #"+t.nodeId).removeClass("selected")}),n.$on("$destroy",function(){for(var e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).removeClass("selected")}$(document).off("keydown.node.edit")})}]},"footer-middle@app":{template:""}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.multi.setting",{deepStateRedirect:{default:"app.predict.edit.multi.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.predict.edit.multi":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.multi.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_multi_edit.html",controller:"expMultiSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.edge",{params:{edgeId:null},deepStateRedirect:{default:"app.predict.edit.edge.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","nodeService",function(e,t,n,o){let r=$("#"+t.edgeId);if(!r||0===r.length)return void e.go("app.predict.edit");r.addClass("selected"),r.parent().append(r);let i=t.edgeId.split("-");n.edge=o.getEdge(i[1],i[2],i[4],i[3]),_.get(n.edge,"metadata.color")||_.set(n.edge,"metadata.color","#a6a6a6"),_.get(n.edge,"metadata.size")||_.set(n.edge,"metadata.size",1);const{from:a,to:s,metadata:c}=n.edge;n.$watch("edge.metadata.color",function(e){o.setEdgeMetadata(a.node,a.port,s.node,s.port,c)}),n.onChangeSize=function(){o.setEdgeMetadata(a.node,a.port,s.node,s.port,c)},n.fromPort=o.getPort(i[1],i[2]),n.toPort=o.getPort(i[4],i[3]),n.subTypeMismatch=n.fromPort.subType!=n.toPort.subType,$(document).on("keydown.edge.edit",function(t){let o=$(t.target);if(!o.is("input")&&!o.is("textarea"))switch(t.keyCode){case 46:case 8:t.stopPropagation(),n.removeEdge(n.edge,_.get(e,"current.name").split(".edge")[0])}}),n.$on("$destroy",function(){r.removeClass("selected"),$(document).off("keydown.edge.edit")})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.edge.setting",{deepStateRedirect:{default:"app.predict.edit.edge.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.predict.edit.edge":{templateUrl:"/tpl/custom/panels/index.html",controller:["$state","$scope",function(e,t){t.tabs=angular.copy(e.current.data.tabs),t.currentTab={},t.$on("$destroy",function(){})}]}}}).state("app.predict.edit.edge.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_edge.html",controller:["$state","$scope",function(e,t){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN"),t.goPort=function(t){e.go("app.predict.edit.node",{nodeId:t.node,portId:t.port})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.prepare",{deepStateRedirect:{default:"app.predict.prepare.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.middle.html",controller:"prepareController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.prepare.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.prepare.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.prepare.setting",{deepStateRedirect:{default:"app.predict.prepare.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.prepare.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.prepare.node.setting",{deepStateRedirect:{default:"app.predict.prepare.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"},{name:{zh_CN:"测试"},type:"test",url:".test"}]},views:{"panel@app.predict.prepare.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.prepare.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.prepare.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.prepare.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.prepare.node.setting.test",{url:"/test",data:{type:"test"},views:{tab:{templateUrl:"/tpl/custom/tabs/tab_test.html",controller:"predictNodeSettingTestController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.group",{url:"/group/:groupId",params:{nodes:null},deepStateRedirect:{default:"app.predict.edit.group.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService",function(e,t,n,o,r,i,a){o.group=a.getGroup(t.groupId),o.group;let s=$("#editor #"+t.groupId);n.nodeTabInfo={params:{controls:[],tabName:{en_US:"Parameters Setting",zh:"参数设置",zh_CN:"参数设置"}}},o.nodeCompType="group",s.addClass("selection");let c=a.getGroupConnections(a.getGraph().toJSON(),n.group);a.collectGroupInport(c.inConnections,[]),a.collectGroupOutport(c.outConnections,[]),$(document).on("keydown.group.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),o.removeGroup(o.group,"app.predict")}}),n.$on("$destroy",function(){o.nodeCompType=void 0,s.removeClass("selection"),$(document).off("keydown.group.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.group.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,n,o,r,i,a){let s=function(){e.a={},r.getChildGroup(n.groupId).length&&(e.a.canotFold=!0)};r.getGraph()?s():e.$on("editor.ready",function(){s()}),e.doFold=function(){r.foldGroup(n.groupId),requestAnimationFrame(function(){i.go("app.predict.edit.node",{nodeId:n.groupId})})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.group.setting",{deepStateRedirect:{default:"app.predict.edit.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"}]},views:{"panel@app.predict.edit.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.predict.edit.group.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.read",{deepStateRedirect:{default:"app.predict.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window","enabledUser",function(e,t,n,o,r,i,a){e.requireEdit=function(){o.setPermission(r.id).then(function(e){r.nodeId?i.go("app.predict.edit.node",{nodeId:r.nodeId}):i.go("app.predict.edit")},function(e){n.pop("error","请求失败: "+e.msg)})},n.pop("warning","当前状态仅支持查看，请在“编辑”状态下进行编辑")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.read.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.read.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.read.setting",{deepStateRedirect:{default:"app.predict.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.read.node.setting",{deepStateRedirect:{default:"app.predict.read.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"}]},views:{"panel@app.predict.read.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.read.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.read.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.read.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.run",{deepStateRedirect:{default:"app.predict.run.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.run.middle.html",controller:["$scope","$rootScope","toaster","$stateParams","$timeout","predictService","nodeService","APP_STATUS","instantNodeLogService",function(e,t,n,o,r,i,a,s,c){const l=o.id,p=function(){t.sockets&&t.sockets[l]&&(t.sockets[l].disconnect(),t.sockets[l]=null)};let d=function(){let e=n.pop({type:"info",title:"正在删除临时文件",timeout:0});hardwareService.post("storage.remove",{boardId:t.appConfig._board.id,appId:l,keys:["tmp"]}).then(function(t){n.clear(e),e=void 0,n.pop("success","删除完成")})};t.release=function(){return t.appConfig._board?hardwareService.post("app/release",{boardId:t.appConfig._board.id,appId:l}).then(function(e){r(d,8e3)}):(p(),i.release(l))},t.showFlowAnimation=!1,t.toggleDataFlowAnimation=function(){t.showFlowAnimation=!t.showFlowAnimation,c.toggleAnimation(t.showFlowAnimation)},e.$on("$destroy",function(){p(),delete t.release,delete t.toggleDataFlowAnimation,delete t.showFlowAnimation})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.run.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.run.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.run.setting",{deepStateRedirect:{default:"app.predict.run.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.run.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.run.node.setting",{deepStateRedirect:{default:"app.predict.run.node.setting.params",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"参数设置"},type:"params",url:".params"},{name:{zh_CN:"高级配置"},type:"tune",url:".tune"},{type:"fields",url:".fields"},{name:{zh_CN:"调试日志"},type:"debug",url:".debug",icon:"iconziduan"},{name:{zh_CN:"测试"},type:"test",url:".test"}]},views:{"panel@app.predict.run.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.run.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_params.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.run.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_tune.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.run.node.setting.debug",{data:{type:"debug"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.test",{url:"/test",data:{type:"test"},views:{tab:{templateUrl:"/tpl/custom/tabs/tab_test.html",controller:"predictNodeSettingTestController"}}})}]),(app=angular.module("app")).filter("moment",function(){return function(e,t){return moment(e).isValid()?moment(e).format(t):"-"}}),app.filter("duration",function(){return function(e,t){return t?moment.duration(moment(t).valueOf()-moment(e).valueOf(),"milliseconds").format("h小时mm分钟ss秒"):"-"}}),app.filter("portState",function(){return function(e,t){return e.filter(function(e){return"all"===e.state||e.state===t})}}),app.filter("runStatusColor",function(){return function(e){switch(e){case"running":return"#1976d2";case"success":return"#388e3c";case"failed":case"stopped":return"#d32f2f";case"outdated":return"#512da8";case"userResourceLimit":case"systemResourceLimit":return"#d32f2f";default:return"#000"}}}),app.filter("runStatus",function(){return function(e){switch(e){case"running":return"运行中";case"success":return"成功";case"failed":return"失败";case"stopped":return"停止";case"outdated":return"已过期";case"userResourceLimit":return"用户资源不足";case"systemResourceLimit":return"系统资源不足";default:return"-"}}}),app.filter("runType",function(){return function(e){switch(e){case"runStart":return"从此处开始运行";case"runStop":return"运行到此处";case"runStartStop":return"运行该节点";default:return e}}}),app.filter("limitLength",function(){return function(e,t){return e&&"string"==typeof e?(t=t||12,e.length>t?e.substr(0,t)+"...":e):e}}),app.filter("sortByNum",function(){return function(e){return e.sort(function(e,t){return e.index>t.index})}}),app.filter("sortByZindex",function(){return function(e){return e.sort(function(e,t){return parseInt(e.css.zIndex)>parseInt(t.css.zIndex)})}}),app.filter("parseRotate",function(){return function(e){if(!(e=parseInt(e)))return 0;if(e<0){let t=function(e){return(e+=360)<0?t(e):e};e=t(e)}return Math.round(e%360)}}),app.filter("xss",function(){return function(e){if(!(e=parseInt(e)))return 0;if(e<0){let t=function(e){return(e+=360)<0?t(e):e};e=t(e)}return Math.round(e%360)}}),app.filter("page",function(){return function(e,t,n){if(!e||!t)return;let o=(t-1)*n,r=o+n;return e.slice(o,r)}}),app.filter("tag",function(){return function(e,t){return e&&t?"all"==t?e:e.filter(function(e){return e.tags&&-1!=e.tags.indexOf(t)}):e}}),app.filter("size",function(){return function(e,t){if(!e)return;if(0===(e=parseInt(e)))return"0 B";let n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,n)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}}),app.filter("cut",function(){return function(e,t,n,o){if(!e)return"";if(!(n=parseInt(n,10)))return e;if(e.length<=n)return e;let r=0,i=0;for(;i<e.length&&!(r>n);i++){let t=e.charCodeAt(i);t>=1&&t<=126||65376<=t&&t<=65439?r++:r+=2}if(e=e.substr(0,i-1),t){let t=e.lastIndexOf(" ");-1!==t&&("."!==e.charAt(t-1)&&","!==e.charAt(t-1)||(t-=1),e=e.substr(0,t))}return e+(o||" …")}}),app.filter("trustAsResourceUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),app.filter("profilePicture",["layoutPaths",function(e){return function(t,n,o){return n=n||"profile",o=o||"png",e.images[n]+t+"."+o}}]),app.filter("searchFilter",function(){return function(e,t,...n){if(_.isEmpty(t))return e;const o=_.toLower(t);return _.filter(e,function(e){return _.findIndex(n,function(t){return _.toLower(_.get(e,t)).indexOf(o)>-1})>-1})}}),angular.module("app").constant("SUBTYPES",[{name:"所有类型",value:"all"},{name:"数字",value:"number"},{name:"布尔值",value:"bool"},{name:"字符串",value:"string"},{name:"JSON",value:"json"},{name:"文件",value:"file"},{name:"文件夹",value:"folder"},{name:"Npy文件",value:"npy"},{name:"模型",value:"model"},{name:"图片",value:"image"},{name:"Csv文件",value:"csv"},{name:"数据库表",value:"table"},{name:"h5文件",value:"hdf5"},{name:"Parquet文件",value:"parquet"},{name:"Sqlite数据文件",value:"sqlite"}]).constant("COMPTYPE_LIST",{algo:[{name:{zh_CN:"Spark Java"},value:7},{name:{zh_CN:"Spark Python"},value:2},{name:{zh_CN:"ODPS Python"},value:3},{name:{zh_CN:"ODPS MR"},value:4},{name:{zh_CN:"Python"},value:5},{name:{zh_CN:"Java"},value:6},{name:{zh_CN:"Runtime"},value:12},{name:{zh_CN:"SupRuntime"},value:13},{name:{zh_CN:"VS Code"},value:14},{name:{zh_CN:"Data File"},value:21},{name:{zh_CN:"Composite"},value:999},{name:{zh_CN:"Composite App"},value:998},{name:{zh_CN:"Spark Java (deprecated)"},value:1}],service:[{name:{zh_CN:"Runtime"},value:12},{name:{zh_CN:"SupRuntime"},value:13},{name:{zh_CN:"VS Code"},value:14},{name:{zh_CN:"DashboardPage"},value:23},{name:{zh_CN:"Send File"},value:31},{name:{zh_CN:"Web Input"},value:10002},{name:{zh_CN:"Web Output"},value:10003},{name:{zh_CN:"Hardware"},value:50},{name:{zh_CN:"Hardware Network"},value:51},{name:{zh_CN:"Composite App"},value:998}],model:[{name:{zh_CN:"model"},value:10001}],dashboard:[{name:{zh_CN:"dashboard"},value:22}],rpa:[{name:{zh_CN:"通用"},value:501},{name:{zh_CN:"Office Excel"},value:502},{name:{zh_CN:"浏览器"},value:503},{name:{zh_CN:"流程控制"},value:504},{name:{zh_CN:"系统"},value:505},{name:{zh_CN:"文件处理"},value:506}],rto:[{name:{zh_CN:"RTO"},value:601}],des:[{name:{zh_CN:"Des"},value:701}]}).controller("controlListController",["$scope","$stateParams","$state","toaster","nodeService","$parse","$rootScope","common","$timeout","$q","tableService","PARAM_TYPES",function(e,t,n,o,r,i,a,s,c,l,p,d){e.currentTab.type=n.current.data.type,e.tabInfo=e.nodeTabInfo[n.current.data.type],e.currentTab.title=_.get(e.nodeTabInfo[e.currentTab.type],"tabName.zh_CN"),e.nodeId=t.nodeId,e.tabInfo||n.go("app.predict.edit.node.setting",{nodeId:t.nodeId});let u=n.current.data.type;if(n.current.name.indexOf("customize")>-1&&("fields"==u||"params"==u||"tune"==u)&&(a.secondEditor=!0),e.controlListScope={},e.model={},e.globalVarModel={},n.includes("app.customize"))for(let t=0;t<e.tabInfo.controls.length;t++){let n=e.tabInfo.controls[t];e.model[n.uuid]=a.paramsModel.control[n.uuid]}else if("group"===a.nodeCompType||[998,999].includes(a.nodeCompType)){let t;$(".edit_tools").on("mouseenter.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideDown().end().siblings().children(".btn-collapse-list").slideUp()}).on("mouseleave.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideUp()}),"group"===a.nodeCompType?(e.group.metadata.params||(e.group.metadata.params=[]),t=e.group.metadata.params):998!==a.nodeCompType&&999!==a.nodeCompType||(e.node.metadata.def.compositeParams||(e.node.metadata.def.compositeParams=[]),t=e.node.metadata.def.compositeParams);const n=function(n,o){const r={id:o,label:n.metadata.label,controls:[]};e.groupNodes.push(r),Object.keys(n.metadata.ui.tabs).forEach(function(e){n.metadata.ui.tabs[e].controls.forEach(function(e){r.controls.push(e)})});for(let r=0;r<t.length;r++){let i=t[r];if(i.nodeId===o){for(let t in n.metadata.def.params){let o=n.metadata.def.params[t];if(o.controlInstUuid===i.controlId){e.model[i.controlId]={meta:o};break}}break}}},o=function(){if(e.groupNodes=[],"group"===a.nodeCompType)e.tabInfo.controls=r.genGroupTabInfo(t),e.group.nodes.forEach(function(e){const t=r.getNode(e);n(t,e)});else if(998===a.nodeCompType||999===a.nodeCompType){if(!e.node.metadata.def.composite)return;if(998===a.nodeCompType&&e.node.metadata.def.composite.properties.globalVars){let t={id:"global",label:"全局变量",controls:[]};e.node.metadata.def.composite.properties.globalVars.forEach(function(n){e.globalVarModel[n.id]=n,t.controls.push(n)}),e.groupNodes.push(t)}e.tabInfo.controls=r.genCompositeTabInfo(t,e.node.metadata.def.composite.processes,e.node.metadata.def.composite.properties.globalVars),Object.keys(e.node.metadata.def.composite.processes).forEach(function(t){const o=e.node.metadata.def.composite.processes[t];n(o,t)})}};e.addGroupGlobalVar=function(n){for(let e=0;e<t.length;e++){if(t[e].id===n.id)return}t.push({type:"global",id:n.id}),o(),e.save()},e.removeGroupGlobalVar=function(n){for(let e=0;e<t.length;e++){if(t[e].id===n){t.splice(e,1);break}}o(),e.save()},e.addGroupControl=function(n,r){for(let e=0;e<t.length;e++){let o=t[e];if(o.nodeId===n&&o.controlId===r)return}t.push({nodeId:n,controlId:r}),o(),e.save()},e.removeGroupControl=function(n){for(let e=0;e<t.length;e++){if(t[e].controlId===n){t.splice(e,1);break}}o(),e.save()},o()}else for(let t=0;t<e.tabInfo.controls.length;t++){let n=e.tabInfo.controls[t],o=!1;for(let t in e.node.metadata.def.params){let r=e.node.metadata.def.params[t];if(r.controlInstUuid===n.uuid){e.model[n.uuid]={meta:r},o=!0;break}}o||n.uuid}e.checkExists=function(t){if(n.includes("app.customize"))return!0;try{if(t.relations&&t.relations.hide&&t.relations.hide.enabled){let t=t.relations.hide,n=e.node.metadata.def.params[t.key].value;switch(t.operator){case"==":return n===t.value;case"!=":return n!==t.value;case">":return n>t.value;case"<":return n<t.value;case">=":return n>=t.value;case"<=":return n<=t.value}}}catch(e){}return!0},e.removeControl=function(o){for(let t=0;t<e.tabInfo.controls.length;t++)e.tabInfo.controls[t].uuid===o&&e.tabInfo.controls.splice(t,1);delete a.paramsModel.control[o],delete e.model[o],t.controlId===o&&n.go("app.customize.setting",{controlId:null})},e.arrayToString=function(e){return e&&e.length?e.join(","):""},e.addControl=function(t){if("upload_file"==t&&_.findIndex(_.values(e.tabInfo.controls),{type:"upload_file"})>-1)return o.pop("warning","每个组件中只能有一个文件上传参数"),null;let r=s.uuid(),i={uuid:r,type:t,label:{zh_CN:d[t]&&d[t].label||"标签"},placeholder:{zh_CN:d[t]&&d[t].placeholder||"占位提示文本"},tooltip:{zh_CN:d[t]&&d[t].tooltip||""},relations:{}};"select"!=t&&"multiselect"!=t||(i.options=[]),e.tabInfo.controls.push(i);const c={};"upload_file"==t&&(c.outPortUuid="out1",c.fileType="files"),a.paramsModel.control[r]={meta:c},n.go(".",{controlId:r})},e.a={},e.a.openMenu=!1,$(document).on("click.toggle.controlList.menu",function(t){e.a.openMenu=!1,a.$$phase||a.$apply()}),e.appId=t.id,e.nodeId=t.nodeId,e.fileUploadPath=function(e){return s.getUploadDataPath(e)},e.onAllFileUploadFinish=function(t,n){const o=_.find(e.node.metadata.def.params,{controlInstUuid:n}),r=_.find(e.node.metadata.def.params,{propertyName:"dataName",defOutPortUuid:o.outPortUuid});o.value=t,r.value=t},e.onCheckedFileChange=function(){r.changeNode(e.nodeId)},e.$on("$destroy",function(){$(document).off("click.toggle.controlList.menu"),$(".edit_tools").off("mouseenter.toggle.groupControl").off("mouseleave.toggle.groupControl")})}]).controller("editControlController",["$scope","$stateParams","$state","xssList","nodeService","$rootScope",function(e,t,n,o,r,i){if(e.tabInfo=e.nodeTabInfo[n.current.data.type],e.outportPropertyList=["tableName","partitionName","modelName","visualName","dataName"],e.inportList=_.filter(_.keys(e.paramsModel.port),function(e){return 0==e.indexOf("in")}),e.outportList=_.filter(_.keys(e.paramsModel.port),function(e){return 0==e.indexOf("out")}),t.controlId){for(let n=0;n<e.tabInfo.controls.length;n++){let o=e.tabInfo.controls[n];o.uuid===t.controlId&&(e.control=o)}let n=e.paramsModel.control[t.controlId];n&&"colselect"==e.control.type?_.hasIn(n,"inport")||_.isEmpty(e.inportList)||(n.inport=e.inportList[0]):!n||"table_select"!=e.control.type&&"partition_select"!=e.control.type&&"upload_file"!=e.control.type&&"file_select"!=e.control.type||(_.hasIn(n,"outport")||_.isEmpty(e.outportList)||(n.outport=e.outportList[0]),_.hasIn(n,"meta.defOutPortUuid")||_.isEmpty(e.outportList)||"upload_file"!=e.control.type&&"file_select"!=e.control.type||(n.meta.outPortUuid=e.outportList[0]))}else e.tabInfo.controls.length>0&&n.go(".",{controlId:e.tabInfo.controls[0].uuid});e.addOption=function(e){e.options.push({name:{zh_CN:""},value:""})},e.removeOption=function(e,t){e.options.splice(t,1)},e.a={},e.a.chooseControl=!1,e.a.chooseOperator=!1,$(document).on("click.toggle.choose",function(t){e.a.chooseControl=!1,e.a.chooseOperator=!1,i.$$phase||i.$apply()}),e.$on("$destroy",function(){$(document).off("click.toggle.choose")})}]).controller("editComponentController",["$scope","$stateParams","$state","SUBTYPES","nodeService","$sce","$rootScope","common","ossService","componentService","toaster","COMPTYPE_LIST",function(e,t,n,o,r,i,a,s,c,l,p,d){if(e.currentTab.type=n.current.data.type,e.currentTab.title=_.get(_.find(e.tabs,{type:e.currentTab.type}),"name.zh_CN"),_.forEach(e.node.metadata.def.actionList,function(e){_.isEmpty(e.url)&&(e.port||e.absolute)&&(e.url="{{protocol}}//"+(appConfig.proxyHost?"{{proxyHost}}":"{{host}}")+"/"+(e.absolute?"proxy":"proxr")+"/{{userId}}/{{appId}}/{{nodeId}}/"+e.port+"/")}),e.componentInfo=e.node.metadata,_.has(e.componentInfo,"icon")||(e.componentInfo.icon="cube"),_.has(e.componentInfo,"def.description.zh_CN")){const t=s.handleLinkInDesc(e.componentInfo.def.description.zh_CN);e.componentDescription=i.trustAsHtml(t)}else e.componentDescription=i.trustAsHtml("");_.has(e.node,"metadata")&&!_.has(e.node,"metadata.color")&&(e.node.metadata.color=s.getInitedNodeColor(_.get(e.node.metadata,"nodeStyle"))),e.$watch("node.metadata.color",function(t){r.changeNode(e.nodeId)});const u={in:"输入数据",out:"输出数据"};let h;_.forEach(e.componentInfo.def.ports,function(e){_.isEmpty(e.subType)&&(e.subType="all"),_.isEmpty(e.type)&&(e.type="data"),_.get(e,"description.zh_CN")===u[e.ioType]&&(e.description.zh_CN=e.uuid)}),e.dataTypes=[{type:"",title:"无",state:"all"},{type:"table",title:"数据表",state:"all"},{type:"model",title:"模型",state:"all"},{type:"visual",title:"可视化数据",state:"out"},{type:"data",title:"非结构化数据",state:"all"},{type:"system",title:"系统事件",state:"in"}],e.subTypes=o,e.changeNodeName=function(n){_.isEmpty(n)?p.pop("warning","组件名称不能为空"):(e.node.metadata.label=n,r.changeNode(e.nodeId),l.changeName(t.componentId,n).then(function(e){a.$broadcast("node.list.reload")},function(e){p.pop("error","修改组件名称失败: "+e.msg)}))},e.stringToArray=function(e){return e?JSON.parse(e):[]},e.nodeTagsValid={validated:!0,tags:[]},e.tags=e.stringToArray(e.compInfo.tags),e.changeNodeTags=function(n){n||(n=[]);let o={},r=[];e.nodeTagsValid.validated=!0,e.nodeTagsValid.tags=[],n.forEach(function(t){let n=(t+"").trim();if(_.isEmpty(n)||!/^[a-z][A-Za-z0-9\:\.\_\-]+$/.test(n))return e.nodeTagsValid.validated=!1,void e.nodeTagsValid.tags.push(t);o[n]=1});for(let e in o)r.push(e);e.compInfo.tags=JSON.stringify(r),_.isEqual(e.tags,r)||(e.tags=r),a.$broadcast("node.tags.changed",{nodeId:t.componentId,tags:e.compInfo.tags}),h&&(clearTimeout(h),h=void 0),h=setTimeout(function(){h=void 0,l.changeTags(t.componentId,e.compInfo.tags).then(function(){},function(e){p.pop("error","更新组件标签失败: "+e.msg)})},500)},a.secondEditor=!1,e.changeNodeIcon=function(t){e.node.metadata.icon=t,r.changeNode(e.nodeId)},e.changePortSubType=function(t,n){let o=e.compInfo.tags,r=[],i=[],a={};o&&(r=JSON.parse(o)),r.forEach(function(e){0!==e.indexOf("in:")&&0!==e.indexOf("out:")&&i.push(e)}),e.componentInfo.def.ports.forEach(function(e){_.isEmpty(e.type)||_.isEmpty(e.subType)?delete e.autoReceive:e.display&&(a[e.ioType+":"+e.type+"."+e.subType]=1)});for(let e in a)i.push(e);e.changeNodeTags(i)},e.changeVisibility=function(t){n.includes("app.customize")&&(a.change(t),e.changePortSubType())},e.addPort=function(t){let n=0;e.componentInfo.def.ports.forEach(function(e){e.ioType===t&&n++});let o=t+(n+1);e.componentInfo.def.ports.push({uuid:o,description:{en_US:"input data",zh_CN:o},display:!0,ioType:t,type:"data",subType:"all"}),e.paramsModel.port[o]={data:t+"putData"+(n+1)},a.change("port")},e.deletePort=function(t){let n=t.ioType;if(1==_.filter(e.componentInfo.def.ports,{ioType:n}).length)return;let o=s.getIndexFromPortUuid(t.uuid);e.componentInfo.def.ports.forEach(function(t,r){if(t.ioType===n){s.getIndexFromPortUuid(t.uuid)===o&&e.componentInfo.def.ports.splice(r,1)}}),e.componentInfo.def.ports.forEach(function(e,t){if(e.ioType===n){let t=s.getIndexFromPortUuid(e.uuid);t>o&&(e.uuid=n+(t-1))}})},e.changePortType=function(e,t,n,o,r,i){switch("system"===i.type&&(i.display=!1,i.subType=void 0,i.autoReceive=void 0),e){case"":case"system":n[o]={};break;case"table":n[o]={table:t+"Table"+(r+1),partition:t+"Partition"+(r+1)};break;case"model":n[o]={model:t+"Model"+(r+1)};break;case"visual":n[o]={visual:t+"Visual"+(r+1)};break;case"data":n[o]={data:t+"Data"+(r+1)}}},e.port_errors={},e.changeTargetPort=function(t,n,o){e.port_errors[t+"_"+o]=void 0;const i=r.getPort(n.targetNode,n.targetPort);i?(n.type=i.type,n.description=angular.copy(i.description),e.compMetadata.def.params={},r.genParamsFromPorts(e.compMetadata.def.ports,e.compMetadata.def.params)):e.port_errors[t+"_"+o]="节点或端口未找到"},e.componentTypeList=[{name:{zh_CN:"算法组件"},value:"algo"},{name:{zh_CN:"服务组件"},value:"service"},{name:{zh_CN:"模型组件"},value:"model"},{name:{zh_CN:"RPA组件"},value:"rpa"},{name:{zh_CN:"前面板组件"},value:"dashboard"},{name:{zh_CN:"RTO组件"},value:"rto"},{name:{zh_CN:"离线事件仿真组件"},value:"des"}];const f=function(t){e.typeList=d[t];let n=!1;for(let t=0;t<e.typeList.length;t++)e.typeList[t].value==e.componentInfo.def.type&&(n=!0);n||(e.componentInfo.def.type=e.typeList[0].value)};e.$watch("compInfo.type",function(e,t){e!==t&&f(e)}),e.changeCodeType=function(){r.changeNode(e.nodeId)},f(e.compInfo.type),e.$watch("componentInfo.def.ports",function(t,n){r.changeNode(e.nodeId)},!0),e.uploadCode=function(){let n,o=e.codeFile;e.codeFile=void 0,e.b.uploadingStatus="正在上传",n=1===e.b.uploadMode?s.getUploadPath(window.appConfig.userId,t.componentId,e.componentInfo.def.type):e.componentInfo.def.codePath||s.getUploadPath(window.appConfig.userId,t.componentId,e.componentInfo.def.type),c.upload(n,o,function(t){e.b.uploadingStatus="正在上传 "+Math.round(t.loaded/t.total*100)+"%",a.$$phase||e.$digest()},function(t){e.b.uploadingStatus="上传失败",e.target.value="",a.$$phase||e.$digest()},function(t){e.componentInfo.def.codePath=n,e.b.uploadingStatus="已上传",e.target.value="",a.$$phase||a.$apply()}).then(function(){},function(){e.b.uploadingStatus="上传失败",a.$$phase||e.$digest()})},$("#upload_code").on("change",function(t){e.codeFile=t.target.files[0],e.target=t.target,a.$$phase||e.$digest()});const g=s.getUploadPyLibPath(window.appConfig.userId,t.componentId);$("#upload_py_lib").on("change",function(t){let n=t.target.files[0];e.uploadingPyLibStatus="正在上传";c.upload(g,n,function(t){e.uploadingPyLibStatus="正在上传 "+Math.round(t.loaded/t.total*100)+"%",a.$$phase||e.$digest()},function(t){e.uploadingPyLibStatus="上传失败",a.$$phase||e.$digest()},function(t){e.componentInfo.def.pyLibPath=g,e.uploadingPyLibStatus="已上传",a.$$phase||a.$apply()}).then(function(){},function(){e.uploadingPyLibStatus="上传失败",a.$$phase||e.$digest()})})}]).controller("publishController",["$scope","$stateParams","$state",function(e,t,n){e.$on("$destroy",function(){})}]).controller("nodeSettingController",["$state","$stateParams","$scope","nodeTabIcon",function(e,t,n,o){n.tabs=[];for(let t=0;t<e.current.data.tabs.length;t++){let r=angular.copy(e.current.data.tabs[t]);if(r.icon=_.get(o,r.type),n.nodeTabInfo&&n.nodeTabInfo[r.type]){if(e.includes("app.customize")||"group"===n.nodeCompType||998===n.nodeCompType||999===n.nodeCompType){"params"!==r.type&&"tune"!==r.type&&(r.name=n.nodeTabInfo[r.type].tabName),n.tabs.push(r);continue}{const e=_.map(n.nodeTabInfo[r.type].controls,"uuid"),t=!_.isEmpty(e)&&_.filter(n.node.metadata.def.params,function(t){return _.indexOf(e,t.controlInstUuid)>-1&&!t.hidden});if(n.nodeTabInfo[r.type].controls&&!_.isEmpty(t)){"params"!==r.type&&"tune"!==r.type&&(r.name=n.nodeTabInfo[r.type].tabName),n.nodeTabInfo[r.type].required&&(r.required=!0),n.tabs.push(r);continue}}}"test"===r.type&&10002===n.nodeCompType&&e.includes("app.predict.run")?n.tabs.push(r):"overview"!==r.type&&"debug"!==r.type&&"params"!==r.type&&"tune"!==r.type||n.tabs.push(r)}n.currentTab={},n.$on("$destroy",function(){})}]).controller("compositeSettingController",["$state","$stateParams","$scope","$timeout","$rootScope","common","nodeService",function(e,t,n,o,r,i,a){n.tabs=[];for(let t=0;t<e.current.data.tabs.length;t++){let o=angular.copy(e.current.data.tabs[t]);"overview"===o.type&&n.tabs.push(o)}n.currentTab={},n.node={metadata:n.compMetadata},n.$on("$destroy",function(){})}]).controller("expSettingController",["$state","$scope","$rootScope","common","nodeTabIcon",function(e,t,n,o,r){t.tabs=_.map(e.current.data.tabs,function(e){return Object.assign({},e,{icon:_.get(r,e.type)})}),t.currentTab={},n.secondEditor=!1}]).controller("expSettingOverviewController",["$scope","$stateParams","$state","appService","$rootScope","toaster","nodeService","$sce","common",function(e,t,n,o,r,i,a,s,c){if(e.currentTab.type=n.current.data.type,e.currentTab.title=_.get(_.find(e.tabs,{type:e.currentTab.type}),"name.zh_CN"),e.appInfo.description){const t=c.handleLinkInDesc(e.appInfo.description);e.appDescription=s.trustAsHtml(t)}else e.appDescription=s.trustAsHtml("");const l=a.getGraph();let p;n.includes("app.predict")&&(l.properties.predictConfig||(l.properties.predictConfig={isolationMode:"v2"}),l.properties.predictConfig.isolationMode||(l.properties.predictConfig.isolationMode="v1"),e.predictConfig=l.properties.predictConfig),l.properties.globalVars||(l.properties.globalVars=[{id:c.uuid()},{id:c.uuid()},{id:c.uuid()}]),e.globalVars=l.properties.globalVars,e.onUpdateName=function(e){_.isEmpty(e)?i.pop("warning","项目名称不能为空"):o.changeName(t.id,e).then(function(){window.updateAppName(t.type,t.id,e)},function(e){i.pop("error","修改名称失败: "+e.msg)})},e.changeDescription=function(){p&&(clearTimeout(p),p=void 0),p=setTimeout(function(){p=void 0,o.changeDescription(t.id,e.appInfo.description).then(function(){},function(e){i.pop("error","修改描述失败: "+e.msg)})},500)},e.getPreviewImgUrl=function(){const n="studio/"+window.appConfig.userId+"/"+t.id+"/screen_shot.png";e.previewImgLoading=!0,o.getImgUrl(n).then(function(t){e.previewImgUrl=t},function(t){e.previewImgUrl=null}).finally(function(){e.previewImgLoading=!1})},e.getPreviewImgUrl(),e.deployTargetList=[{name:"在线部署",value:"web"},{name:"边缘部署",value:"edge"}];const d="hardware"==r.appConfig._context?"http://"+r.appConfig._board.ip:location.origin;e.dashboard_url=d+"/dashboard/"+window.appConfig.userId+"/"+t.id,e.onPreviewUploaded=function(){const o=n.includes("app.exp")?"app.exp.read":"app.predict.read",i=n.includes("app.exp")?"v1":"v2";r.onAppImageUploaded("preview",l,{stateParams:t,nextRoute:o,version:i}),e.getPreviewImgUrl()}}]).controller("expGroupSettingOverviewController",["$state","$stateParams","$scope","nodeService",function(e,t,n,o){n.currentTab.type=e.current.data.type,n.currentTab.title=_.get(_.find(n.tabs,{type:n.currentTab.type}),"name.zh_CN"),n.$watch("group.metadata.name",function(e,n){o.changeGraph(t.groupId)})}]).controller("expNodeSettingOverviewController",["$state","$stateParams","$scope","common","nodeService","SUBTYPES","$sce","$rootScope","format","$uibModal","$timeout",function(e,t,n,o,r,i,a,s,c,l,p){n.currentTab.type=e.current.data.type,n.currentTab.title=_.get(_.find(n.tabs,{type:n.currentTab.type}),"name.zh_CN"),n.portId=t.portId,n.showInports=!1,n.showOutports=!1,n.highlightPorts={},n.$on("$viewContentLoaded",function(){if(n.portId){let e=null;0===n.portId.indexOf("in")?(n.showInports=!0,e="port-"+n.portId):0===n.portId.indexOf("out")&&(n.showOutports=!0,e="port-"+n.portId),e&&p(()=>{let t=angular.element(`#${e}`);t[0]&&t[0].scrollIntoView&&(t[0].scrollIntoView(),n.highlightPorts[n.portId]=!0,p(()=>{n.highlightPorts[n.portId]=!1},3e3))},0)}}),n.receieveMsgTooltip=a.trustAsHtml("当组件有多个输入时, <br/>异步接收：单个输入到达即触发计算 <br/>同步接收：所有输入到达才触发计算"),n.changeNodeIcon=function(e){n.node.metadata.icon=e,r.changeNode(n.nodeId)},!_.has(n.node,"metadata.icon")&&_.set(n.node,"metadata.icon","cube");const d=r.getGraph();if(n.showImageConfig="false"!=localStorage.showImageConfig,n.showTuneConfig="false"!=localStorage.showTuneConfig,n.onClickDetailToggle=function(e){n[e]=!n[e],localStorage[e]=n[e]},n.node&&n.node.metadata&&n.node.metadata.def.description){const e=o.handleLinkInDesc(n.node.metadata.def.description.zh_CN);n.nodeDescription=a.trustAsHtml(e)}else n.nodeDescription=a.trustAsHtml("");_.has(n.node,"metadata")&&!_.has(n.node,"metadata.color")&&(n.node.metadata.color=o.getInitedNodeColor(_.get(n.node.metadata,"nodeStyle"))),_.has(n.node,"metadata")&&!_.has(n.node,"metadata.size")&&(n.node.metadata.size="1"),998===s.nodeCompType&&(n.appList=[],appService.list(9999,t.type).then(function(e){e&&e.list&&(n.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){toaster.pop("error","获取项目列表失败: "+e.msg)}));const u={in:"输入数据",out:"输出数据"};if(_.forEach(_.get(n.node,"metadata.def.ports"),function(e){_.isEmpty(e.subType)&&(e.subType="all"),_.isEmpty(e.type)&&(e.type="data"),_.get(e,"description.zh_CN")===u[e.ioType]&&(e.description.zh_CN=e.uuid)}),n.webInputOrigin="hardware"==s.appConfig._context?location.protocol+"//"+s.appConfig._board.ip:location.protocol+"//"+n.appConfig.predictHost,n.subTypes=i,n.outputTypeArr=r.getNodeOutputTypeArr(t.nodeId),n.node&&21===n.node.metadata.def.type){n.localDataSeparator=[{name:{zh_CN:"英文逗号"},value:","},{name:{zh_CN:"空格"},value:" "}];const e=function(){let e=_.find(n.outputTypeArr,function(e){return"dataName"==e.propertyName});if(e){if(e.subType){const t=_.split(e.subType,".")[1];return"image"==t||"images"==t?"images":t}return"files"}};n.localData={meta:{type:e(),separator:",",file:""},files:[]},n.appId=t.id,n.nodeId=t.nodeId,n.fileUploadPath=o.getUploadNodeDataPath("out1"),n.onAllFileUploadFinish=function(e){n.node.metadata.def.params.outputData1.value=e}}n.$watch("node.metadata.label",function(e,t){e!==t&&r.changeNode(n.nodeId)}),n.$watch("node.metadata.color",function(e,t){e!==t&&r.changeNode(n.nodeId)}),n.$watch("node.metadata.size",function(e,t){e!==t&&r.changeNode(n.nodeId)}),n.$watch("node.metadata.receiveMsgType",function(e,t){e!==t&&r.changeNode(n.nodeId)}),n.goResult=function(t,n){switch(t){case"visualName":e.go("app.exp.edit.node.popup.chart",{portId:n})}},n.dataTypes=[{type:"",title:"无",state:"all"},{type:"table",title:"数据表",state:"all"},{type:"model",title:"模型",state:"all"},{type:"visual",title:"可视化数据",state:"out"},{type:"data",title:"非结构化数据",state:"all"},{type:"system",title:"系统事件",state:"in"}],n.addNotebookPort=function(e,t){let o=0;n.node.metadata.def.ports.forEach(function(t){t.ioType===e&&o++});let r=e+(o+1);n.node.metadata.def.ports.push({uuid:r,description:{en_US:"input data",zh_CN:r},display:!0,ioType:e,type:"data",subType:"all"}),n.changeNotebookPortType(t)};const h=function(e,t){const i="def"+_.capitalize(e.ioType)+"PortUuid";let a=o.getIndexFromPortUuid(e.uuid);const s=_.get(n.node,"metadata.def.params"),c=_.get(n.node,"metadata.def.ports");c.forEach(function(t,n){t.ioType===e.ioType&&(o.getIndexFromPortUuid(t.uuid)===a&&(c.splice(n,1),_.forEach(_.keys(s),function(e){s[e].propertyName&&s[e][i]==t.uuid&&delete s[e]})))}),c.forEach(function(n,c){if(n.ioType===e.ioType){let c=o.getIndexFromPortUuid(n.uuid);if(c>a){const o=e.ioType+(c-1);_.forEach(_.keys(s),function(e){s[e].propertyName&&s[e][i]==n.uuid&&(s[e][i]=o)}),n.uuid=o,r.updateEdges(e.ioType,t,c,n.uuid)}}}),n.node.metadata.def.params=s,n.node.metadata.def.ports=c,n.changeNotebookPortType(t)},f=function(e,t){let n=l.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","nodeService",function(o,r){o.alertTitle=t.title,o.alertIcon="iconfont iconjinggao text-danger",o.alertBody=t.body,o.ok=function(){_.forEach(e,function(e){r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)}),t.onOk(),n.close()},o.cancel=function(){"onCancel"in t&&t.onCancel(),n.close()},o.$on("modal.closing",function(){n=void 0})}],size:"sm",appendTo:""})},g=function(e,t){let n;if("out"===e.ioType){const o=r.getDownstreamNodeByPort(t,e.uuid);n=_.map(o,function(n){return r.getEdge(t,e.uuid,n.node,n.port)})}else if("in"===e.ioType){const o=r.getUpstreamNodeByPort(t,e.uuid);_.isEmpty(o)||(n=[r.getEdge(o.node,o.port,t,e.uuid)])}return n};n.deleteNotebookPort=function(e,t){const n=g(e,t);_.isEmpty(n)?h(e,t):f(n,{title:"删除端口",body:"端口"+e.uuid+"上有 "+n.length+" 条连线，确定全部删除吗?",onOk:function(){h(e,t)}})},n.changeNotebookPortType=function(e){const t=function(e){return e.replace("in","").replace("out","")},o=n.node.metadata.def.params,i=n.node.metadata.def.ports,a=[];for(let e in o)_.has(o[e],"propertyName")&&a.push({key:e,propertyName:_.get(o[e],"propertyName"),portUuid:o[e].defInPortUuid||o[e].defOutPortUuid});i.forEach(function(n){if("system"===n.type){const t=g(n,e);_.isEmpty(t)||_.forEach(t,function(e){r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)})}if("system"===n.type)return n.display=!1,n.subType=void 0,void(n.autoReceive=void 0);if(_.isEmpty(n.type)||_.isEmpty(n.subType))return void delete n.autoReceive;if(_.isEmpty(n.type))return;let i="def"+_.capitalize(n.ioType)+"PortUuid";const s=_.findIndex(a,{portUuid:n.uuid});if(-1==s){let e={type:"string",propertyName:n.type+"Name"};if(e[i]=n.uuid,o[n.ioType+"put"+_.capitalize(n.type)+t(n.uuid)]=e,"table"===n.type){let r=_.clone(e);r.propertyName="partitionName",o[n.ioType+"putPartition"+t(n.uuid)]=r}}else{if("tableName"==a[s].propertyName&&"table"!=n.type){const e=_.findIndex(a,{portUuid:n.uuid,propertyName:"partitionName"});e>-1&&delete o[a[e].key]}if("tableName"!=a[s].propertyName&&"table"==n.type){const e=n.ioType+"putPartition"+t(n.uuid);o[e]={type:"string",propertyName:"partitionName"},o[e][i]=n.uuid}o[a[s].key].propertyName=n.type+"Name"}}),r.changeNode(e),r.analyzeGraph(),setTimeout(function(){r.hightEdges(e)},100)};const m=function(e,t){"in"==e.ioType&&e.display&&(e.autoReceive=!1),n.changeNotebookPortType(t)};n.onClickPortDisplay=function(e,t){const n=g(e,t);_.isEmpty(n)||e.display?m(e,t):f(n,{title:"端口隐藏",body:"端口"+e.uuid+"上有 "+n.length+" 条连线，隐藏端口将会删除连线。确定要隐藏吗?",onOk:function(){m(e,t)},onCancel:function(){e.display=!e.display}})},n.changeApiName=function(){if(n.node.metadata.apiName)if(/^[a-zA-Z0-9]{1}[a-zA-Z0-9\-\_]*[a-zA-Z0-9]$/.test(n.node.metadata.apiName))if(n.node.metadata.apiName.length>40)n.apiNameError="长度不能大于40";else{for(let e=0;e<d.nodes.length;e++){let t=d.nodes[e];if(t.id!==n.node.id&&t.metadata.apiName===n.node.metadata.apiName)return void(n.apiNameError="项目中 api 名称冲突")}n.apiNameError="",n.save&&n.save()}else n.apiNameError="只能为字符、数字、连字符和下划线, 长度大于1";else n.apiNameError="不能为空"},n.getProxyUrl=function(e,t,n,o){const r=o?o.ip:"",i=_.isEmpty(appConfig.proxyHost)?location.host:appConfig.proxyHost,a=_.isEmpty(r)?i:r,s=o?"http:":location.protocol;if(!_.isEmpty(e.url)){const o={"{{protocol}}":s,"{{proxyHost}}":a,"{{host}}":a,"{{userId}}":appConfig.userId,"{{appId}}":t,"{{nodeId}}":n};return c(e.url,o)}return e.url="{{protocol}}//"+(appConfig.proxyHost?"{{proxyHost}}":"{{host}}")+"/"+(e.absolute?"proxy":"proxr")+"/{{userId}}/{{appId}}/{{nodeId}}/"+e.port+"/",location.protocol+"//"+(appConfig.proxyHost||location.host)+"/"+(e.absolute?"proxy":"proxr")+"/"+appConfig.userId+"/"+t+"/"+n+"/"+e.port+"/"};const v={0:"未知状态",1:"正在运行中",2:"已停止",3:"已成功",4:"已失败",5:"启动中",6:"停止中",7:"已失败",8:"定时运行",9:"等待资源中"};n.openLink=function(o,r,i,a,c){o.preventDefault();const p=_.get(s.currentApp,"node.status."+t.nodeId);if(!e.includes("app.predict.run")&&!e.includes("app.exp.run")){if(14==_.get(a.metadata,"def.type")&&!_.get(a.metadata,"def.params.__mode.uneditable"))return void s.showFiles("studio/{{userId}}/{{appId}}/{{nodeId}}/code/",null,null,!0);const t=e.includes("app.predict")?"请先部署项目！":"请先运行该节点！";return void(n.actionAlert={type:"danger",message:t})}if(e.includes("app.predict.run")&&"3"!==p)return void(n.actionAlert={type:"danger",message:"该节点"+v[p]||"未知状态"});if(e.includes("app.exp.run")&&"1"!==p)return void(n.actionAlert={type:"danger",message:"该节点"+v[p]||"未知状态"});const d=n.getProxyUrl(r,i,a.id,c),u=d.split("//")[0];if(601===a.metadata.def.type);else{if(r.isModal&&u===location.protocol){let e=l.open({animation:!0,windowClass:"iframe-modal",template:'<div class="sp-modal-iframe"><div class="sp-modal-header"><div class="sp-modal-title">{{title}}</div><div class="sp-modal-actions"><i class="iconfont" ng-class="fullscreen ? \'icon-fullscreen-exit\' : \'icon-fullscreen\'" title="{{fullscreen ? \'还原\' : \'最大化\'}}" ng-click="maximize(!fullscreen)"></i><i class="iconfont icon-close" title="关闭" ng-click="cancel()"></i></div></div><iframe style="width: 100%; height: calc(100% - 30px); border: none; outline: none;" src="'+d+'"></iframe></div>',size:"lg",controller:["$scope",function(t){t.fullscreen=!1,t.title=a.metadata.label,t.maximize=function(e){const n=$(".iframe-modal");t.fullscreen=e,e?n.addClass("iframe-modal-fullscreen"):n.removeClass("iframe-modal-fullscreen")},t.cancel=function(){e.close()},t.$on("modal.closing",function(t,n){e=void 0})}]});return}window.open(d)}}}]).controller("tableSelectController",["$state","$stateParams","$scope","$timeout","$rootScope","common","tableService","$q",function(e,t,n,o,r,i,a,s){let c;n.onTableSelect=function(e){e&&(n.refreshingMeta=!0,a.getTableMeta(e).then(function(e){n.controlListScope.selectedTableDef=e.data,n.controlListScope.selectedTableDef}).finally(function(){n.refreshingMeta=!1}))},n.listTable=function(e){n.controlListScope.selectedTableDef=void 0,!e||e.length<2||(c&&o.cancel(c),c=o(function(){n.refreshing=!0,a.listTable(e).then(function(e){n.tableList=e.data}).finally(function(){n.refreshing=!1,c=void 0})},500))},$(document).on("click.close.tableSelction.menu",function(e){n.openTableList=!1,r.$$phase||r.$apply()}),n.$on("$destroy",function(){$(document).off("click.close.tableSelction.menu")})}]).controller("partitionSelectController",["$scope","$rootScope",function(e,t){$(document).on("click.close.partitionSelction.menu",function(n){e.openPartitionList=!1,t.$$phase||t.$apply()}),e.$on("$destroy",function(){$(document).off("click.close.partitionSelction.menu")})}]).controller("expMultiSettingOverviewController",["$state","$stateParams","$scope",function(e,t,n){n.currentTab.type=e.current.data.type,n.currentTab.title=_.get(_.find(n.tabs,{type:n.currentTab.type}),"name.zh_CN")}]).controller("expNodeContextMenuController",["$state","$stateParams","$rootScope","$scope","nodeService","toaster","$window","showPortDataTypes",function(e,t,n,o,r,i,a,s){const c=document.querySelector(".sp-context-mask");c.addEventListener("click",p,!1);const l={main:[{id:"revoke",label:"撤销"},{id:"paste",label:"粘贴",spliter:!0},{id:"createNote",label:"创建注释"},{id:"showNotes",label:"显示所有注释"},{id:"hideNotes",label:"隐藏所有注释",spliter:!0},{id:"showPortData",label:"实时数据",sub:!0}],node:[{id:"rename",label:"重命名"},{id:"copy",label:"复制"},{id:"remove",label:"删除",spliter:!0},{id:"size",label:"组件大小",sub:!0},{id:"color",label:"组件颜色",sub:!0},{id:"params",label:"参数设置"},{id:"tune",label:"高级配置",spliter:!0},{id:"showNodePortData",label:"实时数据",sub:!0}]};function p(){o.$apply(function(){o.context.open=!1})}o.changeNodePortData=function(){const e={id:o.nodeId};if(n.currentApp.showNodePortData[o.nodeId])e.checked=!1,o.context.showNodePortData[o.nodeId]=!1,delete n.currentApp.showNodePortData[o.nodeId];else{const t=_.filter(_.get(o.node,"metadata.def.ports"),function(e){return e.display&&s.includes(e.subType)});_.isEmpty(t)?i.pop("info","节点 "+o.node.metadata.label+" 的输入/出桩具体类型不符合显示条件"):(e.ports=_.map(t,"uuid"),e.checked=!0,n.currentApp.showNodePortData[o.nodeId]=e.ports,o.context.showNodePortData[o.nodeId]=!0)}r.setAppState("showPortDataNodes",n.currentApp.showNodePortData)},o.changePortData=function(){const e=r.getGraph();o.context.showPortData?_.forEach(e.nodes,function(e){const t=_.filter(_.get(e,"metadata.def.ports"),function(e){return e.display&&s.includes(e.subType)});_.isEmpty(t)||(n.currentApp.showNodePortData[e.id]=_.map(t,"uuid"),o.context.showNodePortData[e.id]=!0)}):(n.currentApp.showNodePortData={},o.context.showNodePortData={}),r.setAppState("showPortDataNodes",n.currentApp.showNodePortData)},r.showContext(function(e){const{x:n,y:r,type:i}=e;"node"==i?(o.node=e.item,o.nodeId=e.itemKey):"main"==i&&(o.appId=t.id);const s=_.get(o.node,"metadata.def.docUrl");_.isEmpty(s)?o.menu=l[i]:o.menu=l[i].concat([{id:"helpDoc",label:"帮助文档",url:s}]);const c=_.filter(o.menu,{splitor:!0}),p=26*o.menu.length+12+9*c.length;o.context.type=i,o.context.open=!0,o.context.translate="translate("+n+"px, "+(r+p>a.innerHeight?r-p:r)+"px)"}),o.context={open:!1,translate:"translate(0, 0)",showPortData:!1},o.handleClick=function(t,s){switch(t.stopPropagation(),s.id){case"rename":n.renameNode(o.node);break;case"copy":"dashboard"==o.node.component?(n.copiedNode=null,i.pop("warn","前面板节点请在前面板复制")):(n.copiedNode=angular.copy(o.node),_.has(n.copiedNode,"metadata.apiName")&&delete n.copiedNode.metadata.apiName,i.pop("succss","已复制"));break;case"paste":n.copiedNode?(r.pasteNode(n.copiedNode),i.pop("succss","已粘贴")):i.pop("warn","请先复制要粘贴的节点");break;case"remove":n.removeNode(o.node);break;case"revoke":n.onRevoke();break;case"color":break;case"params":case"tune":e.go("app.predict.edit.node.setting."+s.id,{nodeId:o.nodeId});break;case"createNote":const c=r.getPositionInGraph(t.pageX,t.pageY);r.addNode(common.uuid(),"comment",{type:"comment",label:"输入注释内容",x:c.x,y:c.y,def:{ports:[],description:{zh_CN:"输入注释内容"}},ui:{}});break;case"showNotes":case"hideNotes":break;case"helpDoc":a.open(s.url,"_blank");break;default:s.id}t.target.className.indexOf("sp-context-menu-item")>-1&&(o.context.open=!1)},o.menu=[],o.$watch("node.metadata.size",function(e,t){if(e!==t&&t)if(r.changeNode(o.nodeId),o.context.open=!1,2!=e||n.nodesChart&&n.nodesChart[o.nodeId])2==t&&n.nodesChart&&n.nodesChart[o.nodeId]&&n.destroyNodeChart(o.nodeId);else{let e;const t=function(){e=requestAnimationFrame(function(){const r=document.getElementById(o.nodeId).querySelector(".sp-graph-node-chart");r?n.initNodeChart(r,o.nodeId):(cancelAnimationFrame(e),e=null,t())})};t()}}),o.$watch("node.metadata.color",function(e,t){e!==t&&t&&r.changeNode(o.nodeId)});const d=r.getGraph();_.forEach(d.nodes,function(e){const t=document.getElementById(e.id).querySelector(".sp-graph-node-chart");2!=_.get(e,"metadata.size")||!t||n.nodesChart&&n.nodesChart[e.id]||n.initNodeChart(t,e.id)}),o.$on("$destroy",function(){c.removeEventListener("click",p,!1),n.initNodeChart=void 0,n.destroyNodeChart=void 0})}]),angular.module("app").constant("compTabs",[{id:"shared",name:"分享的组件",dir:1,icon:"iconfenxiang1",service:"list",componentType:"my_component",editable:!0,enable:!0},{id:"public",name:"内置组件",icon:"iconneizhizujian",service:"public",componentType:"public_component",enable:!0},{id:"my",name:"我的组件",dir:2,icon:"iconzujian",service:"list",componentType:"my_component",editable:!0,enable:!0},{id:"hufu",name:"数据",icon:"iconyunshujuku",enable:appConfig.services.hufu,path:"/proxy/hufu-web/datatag/suanpan/module/group",algoComponentId:1876,predictComponentId:1874},{id:"device",name:"设备",icon:"iconshebei",enable:appConfig.services.device,path:"/changqing/device/listDevicePonitMxg",params:{pageNumber:1,pageSize:30},algoComponentId:null,predictComponentId:11330},{id:"recommend",name:"推荐",icon:"iconshoucang",enable:!0}]).controller("compsController",["$state","$stateParams","$scope","$rootScope","USER_CONFIG","componentService","toaster","compTabs","$q","enabledUser","APPMENU","common","COMPONENT_TYPES",function(e,t,n,o,r,i,a,s,c,l,p,d,u){const h=_.get(o.appConfig,"appMenu")||p,f="card"==localStorage.navTreeStyle;n.tabs=s,n.current={tab:_.find(s,{id:e.includes("app.customize")?"my":"public"}),type:t.type,node:null,isCard:f,expandedDir:[]},e.includes("app.customize")&&(n.current.component={id:t.componentId},n.current.type="customize"),n.onToggleStyle=function(e){localStorage.navTreeStyle=e&&"card",n.current.isCard=e},n.search={keyword:""},n.treeControls={};let g=o.tagModel,m={};g.list=[];let v=_.get(h[_.get(n.current,"type")],"componentType");const y={};_.keys(h,function(e){y[e]=null});const b={list:_.clone(y),public:_.clone(y)};let w=null;const x={shared:_.get(r,"publicDirId"),my:_.get(r,"myDirId"),sharedAllDir:[]},C={shared:_.find(n.userConfig.componentDirs,{id:x.shared}).children,my:_.find(n.userConfig.componentDirs,{id:x.my}).children,public:null},S=function(){const e=d.getDirList(C.shared,x.shared);x.sharedAllDir=_.map(e,"id"),x.sharedAllDir.unshift(x.shared)};S();const I={list:function(){n.loading=!0,i.list(v).then(function(e){if(e.success){b.list[n.current.type]=e.list,w=_.cloneDeep(e.list);var t=O(C[n.current.tab.id]),o=_.get(n.current,"tab.id"),r=A(o);t=_.concat(t,r),n.search.keyword&&(n.search.emptyResult=-1==_.findIndex(t,{visible:!0})),n.my_treedata=t,n.loading=!1}},function(e){a.pop("error","加载组件列表失败: "+e.msg),n.my_treedata=[]})},public:function(){n.loading=!0,i.listPublic(v).then(function(e){if(e.success){b.public[n.current.type]=e.list,w=_.cloneDeep(e.list),C.public=e.dirs;var t=O(e.dirs);n.search.keyword&&(n.search.emptyResult=-1==_.findIndex(t,{visible:!0})),n.my_treedata=t,n.loading=!1}},function(e){a.pop("error","加载组件列表失败: "+e.msg),n.my_treedata=[]})}},N={pageNumber:1,list:[]},T=3,E={model:"iconfont icongem"};_.forEach(u,function(e){E[e.type]||(E[e.type]=e.icon+" "+e.type)});let k="predict"===n.current.type?"service":n.current.type;function $(e,t){let n=[];return e%T==0&&n.push("mg-l-xs"),e<T&&n.push("first-row"),e===t-1&&(n.push("last"),n.push("mg-r-"+(T-1-e%T))),n}function P(e,t){const o=e.length,r=_.map(e,function(e,r){const i=$(r,o),a={id:e.id,label:e.name,componentId:e.id,tags:e.tags,icon:E[e.type],type:t||_.get(n.current,"tab.componentType"),componentType:e.type,dir:e.dir,classes:i,visible:!0,selected:"customize"==n.current.type&&n.current.component.id==e.id,usable:!0};let s;if(!_.isEmpty(e.tags)){try{s=JSON.parse(e.tags)}catch(e){}_.forEach(s,function(e){const t=0===e.indexOf("in:"),n=0===e.indexOf("out:");if(t||n){const n=t?3:4;var o=e.substr(n).split(".");if(!_.isEmpty(o)){const e=o.slice(1).join(".");_.isEmpty(e)||(m[e]=1)}}else m[e]=1})}return n.current.tab.editable&&B(a,"component",k),a});return g.list=_.keys(m),r}function O(e){return _.map(e,function(e){let t=_.indexOf(n.current.expandedDir,e.id)>-1,o=!0,r=[];_.isEmpty(e.children)||(r=O(e.children));const i=_.remove(w,function(t){return n.search.keyword?t.dir==e.id&&(_.toLower(t.name).indexOf(_.toLower(n.search.keyword))>-1||t.id==n.search.keyword):t.dir==e.id}),a=P(i);let s;!_.isEmpty(r)&&-1!=_.findIndex(r,{visible:!0})||!_.isEmpty(i)||"customize"===n.current.type&&_.isEmpty(n.search.keyword)||(o=!1),r=_.concat(r,a),(!_.isEmpty(n.search.keyword)&&!_.isEmpty(i)||_.findIndex(r,{expanded:!0})>-1||_.findIndex(r,{selected:!0})>-1)&&(t=!0),"my_component"===_.get(n.current,"tab.componentType")&&(s=["droppable"]);const c=_.assign({},e,{children:r,classes:s,expanded:t,visible:o});return n.current.tab.editable&&B(c,"component",k),c})}function A(e){return P(_.remove(w,function(t){return"shared"===e?n.search.keyword?t.dir==x[e]&&(t.name.indexOf(n.search.keyword)>-1||t.id==n.search.keyword):t.dir==x[e]:"my"===e?n.search.keyword?(t.dir==x[e]||-1==_.indexOf(x.sharedAllDir,t.dir))&&(t.name.indexOf(n.search.keyword)>-1||t.id==n.search.keyword):t.dir==x[e]||-1==_.indexOf(x.sharedAllDir,t.dir):void 0}))}function M(e,t,o){return _.filter(b[o][n.current.type],function(n){let o;try{o=JSON.parse(n.tags)}catch(e){}const r=_.filter(o,function(e){return 0===e.indexOf(t+":")});if(_.isEmpty(r))return!1;const i=t.length+1;return _.findIndex(r,function(t){const n=t.slice(i).split("."),o=n[0],r=n.slice(1).join(".");return _.findIndex(e,function({type:e,subType:t}){return e==o&&(t==r||"all"==t||"all"==r)})>-1})>-1})}const D=12;let L=D;const R={inport:[],outport:[]},U=function(e){return{id:e+"-show-more",label:"加载更多",icon:"iconfont iconxiala",classes:["show-more"],usable:!0,showMore:!0,visible:!0}};function z(e){const t=_.findIndex(n.my_treedata,{id:e}),o=R[e].slice(0,L);if(R[e].length>L){const t=U(e);o.push(t)}n.my_treedata[t].children=o,n.loading=!1}function j(){L=D,n.my_treedata=[{id:"inport",label:"输入推荐",folder:!0,expanded:!0,visible:!0,children:[],prefetch:!0},{id:"outport",label:"输出推荐",folder:!0,expanded:!0,visible:!0,children:[],prefetch:!0}];const e=_.filter(_.get(n.current,"node.metadata.def.ports"),{display:!0});if(R.inport=[],R.outport=[],!_.isEmpty(e)){const t=function(e){return{type:e.type,subType:e.subType}},o=_.map(_.filter(e,{ioType:"in"}),t),r=_.map(_.filter(e,{ioType:"out"}),t);if(!_.isEmpty(o)){const e=P(M(o,"out","public"),"public_component"),t=P(M(o,"out","list"),"my_component");let r=_.concat(e,t);n.search.keyword&&(r=_.filter(r,function(e){return _.toLower(e.label).indexOf(_.toLower(n.search.keyword))>-1||e.id==n.search.keyword}),n.search.emptyResult=0==r.length),R.inport=r}if(!_.isEmpty(r)){const e=P(M(r,"in","public"),"public_component"),t=P(M(r,"in","list"),"my_component");let o=_.concat(e,t);n.search.keyword&&(o=_.filter(o,function(e){return _.toLower(e.label).indexOf(_.toLower(n.search.keyword))>-1||e.id==n.search.keyword}),n.search.emptyResult=0==o.length),R.outport=o}z("inport"),z("outport")}n.loading=!1}function G(){n.loading=!0;const e=n.current.type,t=!_.isEmpty(b.list[e]),o=!_.isEmpty(b.public[e]);if(t||o){const n=[];t&&n.push(i.list(v)),o&&n.push(i.listPublic(v)),c.all(n).then(function(n){n.length>1?(b.list[e]=n[0].list,b.public[e]=n[1].list,C.public=n[1].dirs):t?b.list[e]=n[0].list:o&&(b.public[e]=n[0].list,C.public=n[0].dirs),j()},function(e){a.pop("error","加载组件列表失败: "+e.msg)})}else j()}function F(e,t){const o=_.get(n.appConfig,"services."+e+".url"),r=_.get(n.appConfig,"services."+e+".path")||_.get(n.current.tab,"path"),s=_.clone(_.get(n.current.tab,"params"));"device"===e&&s&&(s.pageNumber=N.pageNumber,n.search.keyword&&(s.pageNumber=1,isNaN(Number(n.search.keyword))?s.deviceName=n.search.keyword:s.deviceId=n.search.keyword)),o&&r&&i.getExternal(o+r,s).then(function(o){let r=function(e,t){const o=_.get(n.current.tab,n.current.type+"ComponentId");let r,i,a=_.get(window.appConfig.services,t+"."+n.current.type+"ComponentId");a=a||o;const s=function(e){return r=0,i=_.filter(e,function(e){return!e.folder}).length,_.map(e,function(e){if(e.folder){let o=e.children,r=!0;return n.search.keyword&&(o=_.filter(o,function(e){return _.toLower(e.label).indexOf(_.toLower(n.search.keyword))>-1||e.id==n.search.keyword})),_.isEmpty(o)?r=!1:o=s(e.children),_.assign({},e,{id:t+"-"+e.id,expanded:!0,visible:r,children:o})}{const n=$(r,i);return r++,_.assign({},e,{icon:"iconfont iconcube",componentId:a||t+"-"+e.id,type:t+"_component",label:"device"==t?e.deviceName:e.label,classes:n,usable:!0,visible:!0})}})};let c=s(e);return"device"!=t&&n.search.keyword&&(c=_.filter(c,function(e){return e.folder||_.toLower(e.label).indexOf(_.toLower(n.search.keyword))>-1||e.id==n.search.keyword})),c}("device"===e?o.data.result:o.data,e);n.search.keyword&&(N.searchKey=n.search.keyword,n.search.emptyResult=0==_.filter(r,{visible:!0}).length),"device"===e&&(N.pageNumber=o.data.pageNumber+1,N.list=t?_.concat(N.list,r):r,(r=_.clone(N.list)).length>=s.pageSize&&r.push(U("device"))),n.my_treedata=r,n.loading=!1},function(e){a.pop("error","加载数据失败: "+e.msg),n.my_treedata=[],n.loading=!1})}n.onAbnTreeRowSelected=function(e){if(e.showMore){n.loading=!0;const t=e.id.split("-")[0];if("device"===t)F(_.get(n.current,"tab.id"),!0);else L+=D,z(t)}};var B=function(t,o,r){t.folder?1===t.id?t.menu=[]:2===t.id&&n.componentAble?t.menu=[{text:"新建文件夹",enabled:l,click:function(e){n.addFolder(e.row.id,o)}}]:(t.menu=[{text:"重命名",enabled:l,click:function(e){n.renameFolder(e.row.id,o,e.row.label)}},{text:"customize"==n.current.type?"删除":"批量删除",enabled:l,click:function(e){n.removeFolder(e.row.id,o,e.row.label,n.my_treedata,"customize"==n.current.type)}}],n.componentAble&&("customize"==n.current.type&&(t.menu.push(null),t.menu.push({text:"新建文件夹",enabled:l,click:function(e){n.addFolder(e.row.id,o)}}),t.menu.push({text:"移动",enabled:l,click:function(e){n.changeParentDir(e.row.branch)}})),t.menu.push(null),t.menu.push({text:"新建组件",enabled:l,click:function(e){n.createComponent(e.row.id,r)}}),t.menu.push({text:"导入组件",enabled:l,click:function(e){n.importComponent(null,null,e.row.id)}}))):(t.menu=[{text:"复制",enabled:l,click:function(e){n.duplicateComponent(e.row.branch)}},{text:"删除",enabled:l,click:function(t){let o=null,r=null;if("customize"===n.current.type){o=n.treeControls.get_siblings(t.row.branch);const s=_.findIndex(o,{id:_.toNumber(e.params.componentId)});if(e.params.componentId==t.row.id){var i=_.filter(o,{folder:!0}),a=!_.isEmpty(i)&&_.filter(n.treeControls.get_children(i[0]),function(e){return!e.folder});r=_.isEmpty(a)?n.treeControls.get_first_branch():a[0]}else s>-1&&(o[s].selected=!1)}n.removeComponent(t.row.branch,o,r)}},{text:"分享",enabled:l,click:function(e){n.shareComponent(e.row.id,e.row.label)}}],t.menu.push(null),t.menu.push({text:"导出",enabled:l,click:function(e){n.exportComponent(e.row.id,e.row.label)}}),t.menu.push({text:"导入",enabled:l,click:function(e){n.importComponent(e.row.id,e.row.label)}}),n.componentAble&&t.menu.unshift({text:"编辑",enabled:l,click:function(t){n.treeControls.select_branch(t.row.branch),i.setPermission(t.row.id).then(function(n){e.go("app.customize",{componentId:t.row.id})},function(e){a.pop("error","请求失败: "+e.msg)})}}),"customize"==n.current.type&&(t.menu.push(null),t.menu.push({text:"移动",enabled:l,click:function(e){n.changeParentDir(e.row.branch)}})))};function H(e){n.loading=!0;const t=_.get(n.current,"tab.service");var o=_.get(n.current,"tab.id");if("recommend"==o)G();else if("hufu"==o||"device"==o)F(o);else if(w=_.cloneDeep(_.get(b[t],n.current.type)),(e||_.isEmpty(w))&&t)I[t]();else if(t){var r=O(C[o]);if("list"===t){var i=A(o);r=_.concat(r,i)}n.search.keyword&&(n.search.emptyResult=-1==_.findIndex(r,{visible:!0})),n.my_treedata=r,n.loading=!1}}n.my_treedata=[],n.handleChangeTab=function(e){n.current.tab=e,H()},n.handleSearchKeyup=function(e){13!=e.keyCode&&"click"!=e.type||(n.search.emptyResult=!1,H())},n.$watch("current.type",function(e,t){k="predict"===e?"service":e,v=_.get(h[e],"componentType"),H(!0)}),n.$on("toggle.app",function(e,t){t!==n.current.type&&("customize"!=n.current.type&&"customize"!=t&&(n.current.expandedDir=[]),n.current.type=t)}),n.$on("toggle.node",function(e,t){n.current.node=t,"recommend"==_.get(n.current,"tab.id")&&G()}),n.$on("toggle.customize",function(e,t){"customize"!=n.current.type&&(n.current.type="customize",n.current.tab=_.find(s,{id:"my"})),n.current.component=t}),n.$on("node.list.reload",function(e,t){C.shared=_.find(n.userConfig.componentDirs,{id:x.shared}).children,C.my=_.find(n.userConfig.componentDirs,{id:x.my}).children,S(),H(!0)}),n.$on("$destroy",function(){})}]),angular.module("app").component("spStatusTabs",{transclude:!0,bindings:{active:"<",expand:"<",onExpand:"&"},controller:["$scope",function(e){let t=e.panes=[],n={};e.select=function(e,n=!0){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0,o.onExpand({expand:n})};let o=this;e.onStatusbarExpand=function(){o.onExpand({expand:!0})},e.onStatusbarFold=function(){o.onExpand({expand:!1})},this.addPane=function(r){t.push(r),n[r.key]=r,o.active==r.key&&e.select(r,!1)},this.$onChanges=function(t){if(t.active&&t.active.currentValue!=t.active.previousValue){let o=n[t.active.currentValue];o&&e.select(o)}}}],template:'\n      <div class="sp-status-wrap">\n        <div class="sp-status-header">\n          <ul class="clearfix">\n            <li\n              class="sp-status-tab"\n              ng-repeat="pane in panes"\n              ng-class="{ selected: pane.selected }"\n              ng-click="select(pane)"\n            >\n              {{ pane.label }}\n            </li>\n          </ul>\n          <div class="sp-status-expand">\n            <i ng-show="!$ctrl.expand" ng-click="onStatusbarExpand()" class="iconfont iconshouqi2"></i>\n            <i ng-show="$ctrl.expand" ng-click="onStatusbarFold()" class="iconfont iconzhankai2"></i>\n          </div>\n        </div>\n        <div ng-show="$ctrl.expand" class="sp-status-content" ng-transclude></div>\n      </div>\n    '}).component("spStatusTab",{transclude:!0,require:{tabsCtrl:"^spStatusTabs"},bindings:{label:"@",key:"@"},controller:["$scope",function(e){this.$onInit=function(){this.tabsCtrl.addPane(this)}}],template:'\n    <div class="sp-status-pane height-100" ng-show="$ctrl.selected" ng-transclude></div>\n    '}).controller("statusbarController",["$scope","$rootScope","$transitions","$stateParams",function(e,t,n,o){e.expand=!1,e.nodeId=o.nodeId||"",e.activeTab="log",e.onExpand=function(t){if(t==e.expand)return;e.expand=t;let n=angular.element(".sp-toggle");t?n.css({bottom:"256px"}):n.css({bottom:"56px"})},e.toggleTab=function(t="",n="log"){e.nodeId=t||"",e.onExpand(!e.expand),e.activeTab=n};let r=n.onSuccess({},function(t){let n=t.params();e.nodeId=n.nodeId});e.$on("$destroy",()=>{r(),r=null})}]),angular.module("app").controller("nodesController",["$state","$scope","nodeService",function(e,t,n){t.searchKey="",t.$on("editor.ready",function(){const e=n.getGraph();t.nodes=_.map(_.get(e,"nodes"),function(e){return{id:e.id,name:e.metadata.label,metadata:{x:e.metadata.x,y:e.metadata.y,width:e.metadata.width,height:e.metadata.height}}})}),t.$on("toggle.node",function(e,n){_.forEach(t.nodes,function(e){e.active=e.id==_.get(n,"id")})}),t.handleClick=function(t){const o=_.slice(_.get(e,"current.name").split("."),0,3).join(".");e.go(o+".node",{nodeId:t.id}),function(e){var t,o,r=n.getPosition(),i=document.querySelector(".app-svg"),a=i.clientWidth,s=i.clientHeight,c=r.x,l=r.y,p=r.scale,d=e.metadata.x,u=e.metadata.y,h=e.metadata.width,f=e.metadata.height;o=l+u*p<0||l+u*p>s-f?s/2-u-f/2:l,c===(t=c+d*p<0||c+d*p>a-h?a/2-d-h/2:c)&&l===o||n.setPosition(t,o)}(t)}}]),angular.module("app").controller("readController",["$state","$stateParams","$scope","$rootScope","nodeService","hardwareService","APP_STATUS","common","appService","predictService","rpaService","toaster","$window","scriptService","instantNodeLogService",function(e,t,n,o,r,i,a,s,c,l,p,d,u,h,f){o.readOnly=!0,o.sockets=o.sockets||{},o.scriptLogs=o.scriptLogs||{};let g=!1;const m=function(){o.sockets[t.id]||(o.sockets[t.id]=h.connect(t.id)),o.instantNodeLogSocket?g||_.isEmpty(o.currentApp.showNodePortData)||(g=!0,o.instantNodeLogSocket.on("data.replay",function(e){for(const t in e)if(e.hasOwnProperty(t)){const{messages:r=[]}=e[t];r.forEach(({source:e,target:t})=>{o.currentApp.showNodePortData[e.node_id]&&o.currentApp.showNodePortData[e.node_id].includes(e.port)&&n.renderPortData(e.node_id,e.port,e.data),o.currentApp.showNodePortData[t.node_id]&&o.currentApp.showNodePortData[t.node_id].includes(t.port)&&(n.renderPortData(t.node_id,t.port,t.data),o.nodesChart[t.node_id]&&n.updateNodeChart(t.node_id,t.port))})}})):(o.instantNodeLogSocket=f.connect(),o.instantNodeLogSocket.on("cost.nodes",function(e){}),o.instantNodeLogSocket.on("error",function(e){o.instantNodeLogSocket=null,console.error("socket connection failed: /pstream",e)}))};f.nodeDataLogSocket||f.connect(),n.renderPortData=function(e,t,n){const o=$("#"+e+"-"+t).children(".sp-graph-port-data");o.text()!=(n=Math.floor(10*Math.random()+10))&&o.text(n)},n.updateNodeChart=function(e,t){const n=s.getIndexFromPortUuid(t)-1,r=[];for(let e=0;e<5;e++)r.push(Math.floor(10*Math.random()));o.nodesChart[e].updateDataset(r,n)},r.setGroupSelectionHandler(function(t){t&&(e.includes("app.exp.read")?e.go("app.exp.read.group",{groupId:t}):e.includes("app.exp.run")&&e.go("app.exp.run.group",{groupId:t}))}),r.setNodeSelectionHandler(function(t,n,o,r){n?e.includes("app.exp.read")?e.go("app.exp.read.node",{nodeId:n}):e.includes("app.exp.run")?e.go("app.exp.run.node",{nodeId:n}):e.includes("app.exp.prepare")?e.go("app.exp.prepare.node",{nodeId:n}):e.includes("app.exp.history")?e.go("app.exp.history.node",{nodeId:n}):e.includes("app.exp.cron")?e.go("app.exp.cron.node",{nodeId:n}):e.includes("app.predict.read")?e.go("app.predict.read.node",{nodeId:n}):e.includes("app.predict.run")?e.go("app.predict.run.node",{nodeId:n}):e.includes("app.predict.prepare")&&e.go("app.predict.prepare.node",{nodeId:n}):e.includes("app.exp.read")?e.go("app.exp.read.setting.overview",{nodeId:n}):e.includes("app.exp.run")?e.go("app.exp.run.setting.overview",{nodeId:n}):e.includes("app.exp.prepare")?e.go("app.exp.prepare.setting.overview",{nodeId:n}):e.includes("app.exp.history")?e.go("app.exp.history.setting.overview",{nodeId:n}):e.includes("app.exp.cron")?e.go("app.exp.cron.setting.overview",{nodeId:n}):e.includes("app.predict.read")?e.go("app.predict.read.setting.overview",{nodeId:n}):e.includes("app.predict.run")?e.go("app.predict.run.setting.overview",{nodeId:n}):e.includes("app.predict.prepare")&&e.go("app.predict.prepare.setting.overview",{nodeId:n})}),r.setNodeRectImgDblclickHandler.call(this,function(e,n,r){if("dblclick"==e.type&&n&&r){let e="studio/"+window.appConfig.userId+"/logs/"+t.id+"/screenshots/"+n+"/";o.showFiles(e)}});let v,y,b,w,x=$("#editor");n.$on("editor.ready",function(){x=$("#editor")});let C=!1;const S=window.appConfig.statusTimeout||2e3,I=function(n){t.nodeId?e.go(n+".node",{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):e.go(n,{type:t.type,id:t.id,refresh:t.refresh+1})};let N=c;"predict"===t.type?N=l:"rpa"===t.type&&(N=p);let T=0,E=function(n){if(!n||!n.map){if(e.includes("app.exp.run")||e.includes("app.predict.run")){const t=e.includes("app.exp.run")?"运行失败":"部署失败";d.pop("error",t),e.reload()}return}n.msg&&n.msg[T]&&(d.pop("info",n.msg[T]),T+=1);let r=n.map;!_.isEmpty(r)&&function(e){for(let t in e){if(!t.startsWith("node.status.")||t===_.get(o.currentApp,t))continue;t.startsWith("node.status.")&&t!==_.get(o.currentApp,t)&&_.set(o.currentApp,t,e[t]);let n=t;t=t.replace("node.status.","");let r=$("#"+t);const i=r.find(".sp-graph-node-status"),a=i&&i.siblings(".noRun");switch(e[n]){case"5":case"6":i&&i.show(),a&&a.removeClass("noRun"),r.find(".the-graph-spin").show(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").hide();break;case"1":let t=document.querySelector(".edges");document.querySelectorAll(".edge-fg.dashing").forEach(function(e,n){n>0&&t.appendChild(e.parentNode)}),i&&i.show(),a&&a.removeClass("noRun"),r.find(".the-graph-spin").show(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").hide();break;case"4":i&&i.show(),a&&a.removeClass("noRun"),r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").show();break;case"3":i&&i.show(),a&&a.removeClass("noRun"),r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").show(),r.find(".the-graph-error-icon").hide();break;default:i&&i.hide(),a&&a.addClass("noRun"),r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").hide()}}}(r),y&&"5"!=r.status&&(d.clear(y),y=null),w&&"9"!=r.status&&(d.clear(w),w=null),b&&"6"!=r.status&&(d.clear(w),w=null);let i=S;if(e.includes("app.exp.run")||e.includes("app.predict.run"))switch(r.status){case"5":y||(y=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"启动中"},timeout:0}),x.find(".edge .edge-fg").addClass("dashing"));break;case"9":w||(w=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"等待资源"},timeout:0}));break;case"1":"predict"===o.currentApp.type&&m();const e=x.find(".edge .edge-fg");e&&!e.hasClass("dashing")&&e.addClass("dashing");break;case"2":return d.pop("success","已停止"),void I("app."+o.currentApp.type+".edit");case"3":if("predict"===o.currentApp.type)return m(),d.pop("success","部署成功"),void I("app.predict.run");if("algo"===t.type)d.pop("success","运行成功, 将释放资源"),i=5e3;else if("rpa"===t.type)return d.pop("success","运行成功"),void I("app.exp.run");break;case"4":if("algo"!==t.type)return d.pop("error",`${"predict"===o.currentApp.type?"部署":"运行"}失败`),void I("app."+o.currentApp.type+".edit");d.pop("error","运行失败, 将释放资源"),i=5e3;break;case"6":b||(b=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"停止中"},timeout:0}));break;case"7":return d.pop("error",`${"predict"===o.currentApp.type?"部署":"运行"}失败`),void I("app."+o.currentApp.type+".edit")}else if(e.includes("app.exp.history"))switch(r.status){case"1":case"5":break;default:return}v=window.setTimeout(k,i)},k=function(){x&&x.length?(e.includes("app.exp")&&(C||(C=!0,r.showAllScreenshots())),"predict"===t.type&&o.appConfig._board?i.post("status",{id:t.id,boardId:o.appConfig._board.id}).then(function(e){E(e)},function(e){v=window.setTimeout(k,S)}):N.getNetworkStatus(t.id).then(function(e){E(e)},function(e){v=window.setTimeout(k,S)})):v=window.setTimeout(k,S)};k(),n.$on("$destroy",function(){x.find(".edge").find(".edge-fg").removeClass("dashing"),x.find(".the-graph-spin").hide(),v&&window.clearTimeout(v),r.setNodeRectImgDblclickHandler(null),r.setNodeSelectionHandler(null),r.setGroupSelectionHandler(null),o.readOnly=void 0,h.disconnect(t.id),delete o.sockets[t.id],o.appSocket&&(o.appSocket.disconnect(),o.appSocket=null),f.nodeDataLogSocket&&f.nodeDataLogSocket.disconnect(),y&&d.clear(y),w&&d.clear(w),b&&d.clear(w)})}]).controller("readNodeController",["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService","appService",function(e,t,n,o,r,i,a,s,c){let l=$("#editor #"+t.nodeId);if(!l||0===l.length)return void e.go("^");var p;n.nodeId=t.nodeId,n.node=a.getNode(n.nodeId),n.nodeTabInfo=((p=_.get(n.node.metadata,"ui.tabs",{}))||(p={}),Object.assign({},p,{debug:{tabName:{en_US:"Debug Log",zh_CN:"调试日志",zh:"调试日志"},controls:[{uuid:`${t.nodeId}-debuglog`,type:"debug_log",label:{zh_CN:"调试日志"}}]}})),n.componentId=n.node.component,o.nodeCompType=n.node.metadata.def.type;let d=o.appConfig._board?o.appConfig._board.id:null;n.logId=s.getLogId(window.appConfig.userId,t.id,t.nodeId,d),o.$broadcast("toggle.node",n.node),n.resetTabInfo(n.node.metadata.def.params,n.nodeTabInfo),n.appList=[],998===o.nodeCompType&&c.list(9999,"algo").then(function(e){e&&e.list&&(n.appList=e.list)},function(e){toaster.pop("error","获取项目列表失败: "+e.msg)}),l.addClass("selected");let u=document.querySelector(".edges"),h=document.querySelector(".edges").childNodes,f=[];for(let e=0;e<h.length;e++)h[e].attributes&&($(h[e]).removeClass("active"),h[e].getAttribute("id")&&h[e].getAttribute("id").indexOf(t.nodeId)>-1&&($(h[e]).addClass("active"),f.push(h[e])));for(let e=0;e<f.length;e++)u.appendChild(f[e]);$(document).on("keydown.node.read",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),o.copyNode(n.node.metadata,n.node.component))}}),n.$on("$destroy",function(){l.removeClass("selected"),$(h).removeClass("active"),$(document).off("keydown.node.read"),o.nodeCompType=void 0,h=void 0,o.$broadcast("toggle.node",null)})}]).controller("readGroupController",["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService","appService",function(e,t,n,o,r,i,a,s,c){n.group=a.getGroup(t.groupId);let l=$("#editor #"+t.groupId);l.addClass("selection"),n.$on("$destroy",function(){l.removeClass("selection"),l=void 0})}]).controller("prepareController",["$state","$stateParams","$scope","rpaService","toaster","$rootScope","predictService","appService","loopService",function(e,t,n,o,r,i,a,s,c){let l,p,d,u=!0,h=function(e){u&&s.edgeImageStatus(e).then(function(t){let n=0,o=0,i=!1;if(Object.keys(t).forEach(function(e){if(t[e]){let r=t[e].match(/^(\d+(\.\d+)?)%$/);if(r&&r[1]){let e=parseInt(r[1],10);if(!isNaN(e)&&e>=0&&e<=100)return n+=e,void o++}}i=e}),i)m("文件 "+i+" 下载失败");else if(0!==o){if(100===(n=Math.floor(n/o)))return l?(l.toaster.title="下载完成",r.reset(l)):l=r.pop({type:"info",title:"下载完成",timeout:3e3}),void w();l?(l.toaster.title="正在下载项目所需文件 "+n+"%",r.reset(l)):l=r.pop({type:"info",title:"正在下载项目所需文件 "+n+"%",timeout:3e3,tapToDismiss:!1}),window.setTimeout(function(){h(e)},1e3)}else w()},function(e){m("获取下载进度失败")})},f=function(){"edge"===window.appConfig.env?s.edgeImagePrepare(t.id).then(function(e){h(e)},function(e){m("下载文件失败")}):w()},g=function(e,t){t||f(),r.clear(p)};let m=function(e){r.clear(p),p=r.pop({type:"error",title:e,body:'<a style="margin-top: 4px; color: #00c1de">重试</a>',bodyOutputType:"trustedHtml",showCloseButton:!0,tapToDismiss:!1,timeout:0,clickHandler:g})},v=i.appConfig._board,y=function(){d=r.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"正在将资源发送到边缘端"},timeout:0}),hardwareService.post("storage.create",{appId:t.id,boardId:v.id,keys:["dashboard","configs","share"]}).then(function(e){r.clear(d),r.pop("success","发送完成"),b()},function(e){r.clear(d),r.pop("error","发送失败："+e.msg)})},b=function(){hardwareService.post("get",{hwtype:"board",boardId:v.id}).then(function(n){n.success&&"online"===_.get(n,"data.state")?hardwareService.post("app/deploy",{boardId:v.id,appId:t.id}).then(function(t){t.success?(r.pop("success","正在部署"),e.params.nodeId?e.go("app.predict.run.node",{nodeId:e.params.nodeId}):e.go("app.predict.run")):r.pop("error","部署失败")},function(e){r.pop("error","部署失败: "+e.msg)}):r.pop("error","板子 "+v.id+" 已经掉线")})},w=function(){if(e.includes("app.exp")){("rpa"===t.type?o:s).run(t.id,t.targetNodeId,t.runType).then(function(t){r.pop("success","开始运行"),e.params.nodeId?e.go("app.exp.run.node",{nodeId:e.params.nodeId}):e.go("app.exp.run")},function(e){r.pop("error","运行失败: "+e.msg)})}else e.includes("app.predict")&&(v?s.export(t.id,{type:"appDashboardExport"}).then(function(e){c.fetchJob({title:"正在导出"},e.job.id,s.getJob,y)},function(e){}):a.deploy(t.id).then(function(t){r.pop("success","正在部署"),e.params.nodeId?e.go("app.predict.run.node",{nodeId:e.params.nodeId}):e.go("app.predict.run")},function(e){r.pop("error","部署失败: "+e.msg)}))};f(),n.stop=function(){let n=e.current.name.split(".prepare")[0];e.go(n,{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1})},n.release=function(){e.go("app.predict",{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1})},n.$on("$destroy",function(){u=!1,r.clear(p)})}]),angular.module("app").controller("predictNodeSettingTestController",["$state","$scope","$rootScope","$http",function(e,t,n,o){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN"),t.testing=!1,t.test=function(e){try{e=JSON.parse(e)}catch(e){return void(t.test_error="请输入正确的 JSON 字符串")}if(t.test_error="",t.testing)return;t.testing=!0;const r=("hardware"==n.appConfig._context?location.protocol+"//"+n.appConfig._board.ip:location.protocol+"//"+t.appConfig.predictHost)+"/"+t.appInfo.id+"/"+_.get(t.node,"metadata.apiName")||"api名称未设置";o({method:"POST",url:r,data:{debug:!0,data:e}}).then(function(e){"object"==typeof e.data&&(e.data=JSON.stringify(e.data)),t.testResult=e.data},function(e,n){t.testResult="error"}).finally(function(){t.testing=!1})}}]),angular.module("app").factory("remoteService",["$http","$q",function(e,t){let n={},o=function(e){return window.appConfig.affinity?["/app/status","/app/stop","/app/run","/app/cron/start","/app/cron/stop","/app/get/permission","/app/set/permission","/component/get/permission","/component/set/permission","/predict/release","/predict/deploy","/predict/status","/oss/object/check"].includes(e)?e:0===e.indexOf("/edge")?e:0===e.indexOf("http")?e:e.startsWith("/table/meta")?e:e.startsWith("/local")||e.startsWith("/system")?e:window.appConfig.affinity+e:e};return n.get=function(n){let r=t.defer();return e({method:"GET",url:o(n),headers:{"x-sp-user-id":window.appConfig.userId,"x-sp-signature":window.appConfig.signature,"x-sp-sign-version":window.appConfig.signVersion}}).then(function(e){e&&e.data&&e.data.success?r.resolve(e.data):r.reject(e.data)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},n.post=function(n,r){let i=t.defer();return e({method:"POST",url:o(n),headers:{"Content-Type":"application/json; charset=utf-8","x-sp-user-id":window.appConfig.userId,"x-sp-signature":window.appConfig.signature,"x-sp-sign-version":window.appConfig.signVersion},data:r}).then(function(e){e.data.success?i.resolve(e.data):i.reject(e.data)},function(e,t){i.reject({success:!1,msg:"网络错误"})}),i.promise},n.getBinary=function(n,r){let i=t.defer();return e({method:"GET",url:o(n),responseType:r}).then(function(e){i.resolve(e.data)},function(e,t){i.reject({success:!1,msg:_.get(e,"statusText")||"网络错误"})}),i.promise},n.head=function(n){let r=t.defer();return e({method:"HEAD",url:o(n)}).then(function(e){r.resolve(e)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},n.delete=function(n){let r=t.defer();return e({method:"DELETE",url:o(n)}).then(function(e){r.resolve(e)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},n.put=function(n,r){let i=t.defer();return e({method:"PUT",url:o(n),headers:{"Content-Type":"application/octet-stream;"},data:r,transformRequest:[]}).then(function(e){i.resolve(e)},function(e,t){i.reject({success:!1,msg:"网络错误"})}),i.promise},n}]).factory("appService",["$http","remoteService","$q","ossService","ccc","appDataStoreService","statisticsService",function(e,t,n,o,r,i,a){let s={},c={};return s.create=function(e,o,r){let i=n.defer();return t.post("/app/create",{name:e,dir:o,type:r}).then(function(e){c={},a.trackEvent(a.STAT_ACTIONS.APP.CREATE,e.id,{},e),i.resolve(e)},function(e){i.reject(e)}),i.promise},s.get=function(e,i){let a=n.defer();return t.post("/app/get",{id:e}).then(function(e){if(i)return void a.resolve(e.appInfo);const t=e.appInfo.data;o.getObject(window.appConfig.oss.bucket,t,null,!0).then(function(t){e.appInfo.data=r.d(t),a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},s.head=function(e){let r=n.defer();return t.post("/app/get",{id:e}).then(function(e){const t=e.appInfo.data;o.headObject(window.appConfig.oss.bucket,t).then(function(e){r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},s.del=function(e){let o=n.defer();return t.post("/app/del",{id:e}).then(function(t){c={},a.trackEvent(a.STAT_ACTIONS.APP.DELETE,e),o.resolve(t)},function(e){o.reject(e)}),o.promise},s.edgeImagePrepare=function(e){let o=n.defer();return t.get("/edge/images/prepare/"+e).then(function(e){try{let t=JSON.parse(e.result);o.resolve(t.download_id)}catch(e){o.reject(e)}},function(e){o.reject(e)}),o.promise},s.edgeImageStatus=function(e){let o=n.defer();return t.get("/edge/images/status/"+e).then(function(e){try{let t=JSON.parse(e.result);o.resolve(t)}catch(e){o.reject(e)}},function(e){o.reject(e)}),o.promise},s.delnode=function(e,o){let r=n.defer();return t.post("/app/delnode",{id:e,nodeId:o}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.getPermission=function(e){let o=n.defer();return t.post("/app/get/permission",{id:e}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.setPermission=function(e){let o=n.defer();return t.post("/app/set/permission",{id:e,permission:"write"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.listCron=function(e,o,r){let i=n.defer();return t.post("/app/cron/list",{id:e,limit:o,offset:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},s.save=function(e,t){let r=n.defer(),i="studio/"+window.appConfig.userId+"/"+e+"/data";return o.putObject(window.appConfig.oss.bucket,i,t).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.saveScripts=function(e,t){let i=n.defer(),a="studio/"+window.appConfig.userId+"/"+e+"/data";return o.putObject(window.appConfig.oss.bucket,a,r.c(JSON.stringify(t),"v2"),void 0,void 0,!0).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},s.share=function(e,o,r,i,s,c=!1){let l=n.defer();return t.post("/app/share",{id:e,targetUserId:r,name:o,description:i,type:s,withData:c}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.SHARE,e,{id:e,userId:appConfig.userId,name:o,description:i,type:s,withData:c},{id:t.id,userId:r,name:o,description:i,type:s}),l.resolve(t)},function(e){l.reject(e)}),l.promise},s.duplicate=function(e,o,r,i,s=!1,l){let p=n.defer();return t.post("/app/duplicate",{id:e,name:o,description:r,type:i,withData:s,dir:l}).then(function(t){c={},p.resolve(t),a.trackEvent(a.STAT_ACTIONS.APP.COPY,e,{id:e,description:r,type:i,withData:s},{id:t.id,name:o,dir:l})},function(e){p.reject(e)}),p.promise},s.duplicatePublic=function(e,o,r,i){let s=n.defer();return t.post("/app/public/duplicate",{id:e,name:o,description:r,type:i}).then(function(t){c={},a.trackEvent(a.STAT_ACTIONS.APP.DUPLICATE_FROM_TEMPLATE,e,{id:e,name:o,description:r,type:i},{id:t.id}),s.resolve(t)},function(e){s.reject(e)}),s.promise},s.changeName=function(e,o){let r=n.defer();return t.post("/app/update/name",{id:e,name:o}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeTags=function(e,o){let r=n.defer();return t.post("/app/update/tags",{id:e,tags:o}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeDir=function(e,o){let r=n.defer();return t.post("/app/update/dir",{id:e,dir:o}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeDescription=function(e,o){let r=n.defer();return t.post("/app/update/description",{id:e,description:o}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.list=function(e,o,r){let i=n.defer(),a=e+"-"+o;return!r&&c[a]?i.resolve(c[a]):t.post("/app/list",{limit:e,type:o}).then(function(e){c={},i.resolve(e)},function(e){i.reject(e)}),i.promise},s.listPublic=function(e){let o=n.defer();return t.post("/app/public/list",{type:e}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.getVersion=function(){let t=n.defer();return e({method:"GET",url:window.appConfig.publicOss+"/version.json?"+(new Date).getTime()}).then(function(e){200==e.status&&t.resolve(e.data)},function(e){t.reject(e)}),t.promise},s.startCron=function(e,o){let r=n.defer();return t.post("/app/cron/start",{id:e,cronConfig:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.RUN_CRON,e,{},{id:e,cronConfig:o}),r.resolve(t)},function(e){r.reject(e)}),r.promise},s.stopCron=function(e,o){let r=n.defer();return t.post("/app/cron/stop",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.STOP_CRON,e),r.resolve(t)},function(e){r.reject(e)}),r.promise},s.run=function(e,o,r){let i=n.defer();return t.post("/app/run",{id:e,nodeId:o,type:r}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.RUN,e,{},{id:e,nodeId:o,type:r}),i.resolve(t)},function(e){i.reject(e)}),i.promise},s.stop=function(e){let o=n.defer();return t.post("/app/stop",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.STOP,e),o.resolve(t)},function(e){o.reject(e)}),o.promise},s.getNetworkStatus=function(e){let o=n.defer();return t.post("/app/status",{id:e}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.getContents=function(e,t,o=1e3,r=!1){let a=n.defer(),s=[],c=[],l=e.length;return function(t){i.list(e,t,o).then(function(e){if(e.success){let t=e.data.CommonPrefixes,n=e.data.Contents;_.isEmpty(t)||t.forEach(function(e){let t=e.Prefix.slice(l);c.push({id:e.Prefix,label:t,isFolder:!0,type:"folder",checked:r})}),_.isEmpty(n)||n.forEach(function(e){let t=e.Key.slice(l),n=Math.ceil(e.Size/1024),o=_.toLower(t.split(".")[1]);"upload_meta"!==t&&s.push({id:e.Key,label:t,size:n,type:o,checked:r})}),a.resolve({prefixes:c,catalog:s,NextMarker:e.data.NextMarker})}else a.resolve({prefixes:c,catalog:s})},function(e){a.reject(e)})}(t),a.promise},s.getImgUrl=function(e,r){const a=n.defer(),s=window.appConfig.oss.bucket;return(r?o.headObject(s,e):i.head(e)).then(function(n){t.post("/oss/object/get",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){if(e.success){let t=e.data;a.resolve(t)}},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},s.getMetrics=function(e){let o=n.defer();return t.get(e).then(function(e){e.success?o.resolve(e.result):o.reject(err)},function(e){o.reject(e)}),o.promise},s.getMetricsList=function(e){let o=n.defer();return t.get("/app/metrics?type="+e).then(function(e){o.resolve(e.result)},function(e){o.reject(e)}),o.promise},s.import=function(e){const o=n.defer(),{id:r,name:i,dataPath:a,dir:s}=e;return t.post("/app/import",{appId:r,newAppName:i,importAppDataPath:a,dir:s}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.export=function(e,o){const r=n.defer();return t.post("/app/"+e+"/export",o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.switch=function(e,o){const r=n.defer();return t.post("/app/"+e+"/switch",{appVersion:o}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.getJobs=function(e){const o=n.defer();return t.get("/app/"+e+"/jobs").then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},s.getJob=function(e){const o=n.defer();return t.get("/app/job/"+e).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},window.appService=s,s}]).factory("componentService",["$http","remoteService","$q","ccc","ossService","appDataStoreService","statisticsService",function(e,t,n,o,r,i,a){let s={create:function(e,o,r,i,s,c){let l=n.defer();return t.post("/component/create",{name:e,dir:o,type:r,fromAppId:i,fromNodeId:s,codeUnEditable:c}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.CREATE,t.id,{},{id:t.id,name:e,dir:o,type:r,fromAppId:i,fromNodeId:s}),l.resolve(t)},function(e){l.reject(e)}),l.promise},import:function(e,o,r,i){const s=n.defer();return t.post("/component/import",{newComponentName:e,componentId:o||"",dir:r,importComponentDataPath:i}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.IMPORT,o,{},{id:t.id,newComponentName:e,componentId:o||"",dir:r,importComponentDataPath:i}),s.resolve(t)},function(e){s.reject(e)}),s.promise},export:function(e){const o=n.defer();return t.post("/component/"+e+"/export",{packComponentNext:!0}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.EXPORT,e),o.resolve(t)},function(e){o.reject(e)}),o.promise},switch:function(e,o){const r=n.defer();return t.post("/component/"+e+"/switch",{componentVersion:o}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getJob:function(e){const o=n.defer();return t.get("/component/job/"+e).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},exportModel:function(e,n,o,r,s){const c="studio/{USER_ID}/{APP_ID}/{NODE_ID}/{PORT_ID}/model".replace(/{USER_ID}/g,window.appConfig.userId).replace(/{APP_ID}/g,e).replace(/{NODE_ID}/g,n).replace(/{PORT_ID}/g,o);return i.sync(c,"upload").then(function(){return t.post("/component/export/model",{id:e,nodeId:n,portId:o,name:r,overwrite:s})}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.EXPORT_MODEL,e,{},{id:e,nodeId:n,portId:o,name:r,overwrite:s});const c="studio/{USER_ID}/component/{COMPONENT_ID}/out1/model/{MODEL_VERSION}".replace(/{USER_ID}/g,window.appConfig.userId).replace(/{COMPONENT_ID}/g,t.componentInfo.id).replace(/{MODEL_VERSION}/g,t.componentInfo.data.version);return i.sync(c,"download").then(function(){return t})})},get:function(e){let i=n.defer();return t.post("/component/get",{id:e}).then(function(e){r.getObject(window.appConfig.oss.bucket,e.componentInfo.data,null,!0).then(function(t){e.componentInfo.data=o.d(t),i.resolve(e)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},getPublic:function(e){let r=n.defer();return t.post("/component/public/get",{id:e}).then(function(e){t.getBinary(e.componentInfo.data,"arraybuffer").then(function(t){e.componentInfo.data=o.d(new Uint8Array(t)),r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},getExternal:function(t,o){const r=n.defer();return e({method:"GET",url:t,params:o,withCredentials:!0}).then(function(e){200==e.status?r.resolve(e.data):r.reject(e.data)},function(e){r.reject(e)}),r.promise},del:function(e){let o=n.defer();return t.post("/component/del",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.DEL,e),o.resolve(t)},function(e){o.reject(e)}),o.promise},removeList:function(e){const t=n.defer(),o=[],r=e.length;let i=0;const a=function(n){i++,s.del(n.id).then(function(e){o.push(Object.assign({},n,{removed:!0}))},function(e){o.push(Object.assign({},n,{removed:!1}))}).finally(function(){i==r?t.resolve(o):a(e[i])})};return a(e[i]),t.promise},getPermission:function(e){let o=n.defer();return t.post("/component/get/permission",{id:e}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},setPermission:function(e){let o=n.defer();return t.post("/component/set/permission",{id:e,permission:"write"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},save:function(e,t){let i=n.defer(),a="studio/"+window.appConfig.userId+"/component/"+e+"/data";return r.putObject(window.appConfig.oss.bucket,a,o.c(JSON.stringify(t)),"application/octet-stream").then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},share:function(e,o,r){let i=n.defer();return t.post("/component/share",{id:e,targetUserId:r,name:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.SHARE,e,{id:e,userId:appConfig.userId,name:o},{id:t.id,userId:r,name:o}),i.resolve(t)},function(e){i.reject(e)}),i.promise},duplicate:function(e,o){let r=n.defer();return t.post("/component/duplicate",{id:e,name:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.COPY,e,{id:e,name:o},{id:t.id,name:o}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeName:function(e,o){let r=n.defer();return t.post("/component/update/name",{id:e,name:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{id:e},{id:e,name:o}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeTags:function(e,o){let r=n.defer();return t.post("/component/update/tags",{id:e,tags:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{},{id:e,tags:o}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeDir:function(e,o){let r=n.defer();return t.post("/component/update/dir",{id:e,dir:o}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{},{id:e,dir:o}),r.resolve(t)},function(e){r.reject(e)}),r.promise},list:function(e,o){const r=n.defer();return t.post("/component/list",{limit:o||9999,type:e}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},listPublic:function(e){let o=n.defer();return t.post("/component/public/list",{type:e}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}};return window.componentService=s,s}]).factory("predictScriptService",["remoteService","$q","ccc","ossService",function(e,t,n,o){let r={getPredictScriptPath:function(e,t){return"studio/"+window.appConfig.userId+"/predict/"+e+"/"+t+"/predict_script"},get:function(e,n){let i=t.defer();return o.getObject(window.appConfig.oss.bucket,r.getPredictScriptPath(e,n),null,!1).then(function(e){i.resolve(e)}),i.promise},save:function(e,n,i){let a=t.defer();return o.putObject(window.appConfig.oss.bucket,r.getPredictScriptPath(e,n),i,"application/octet-stream").then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}};return r}]).factory("predictService",["remoteService","$q","ccc","ossService","nodeService","statisticsService",function(e,t,n,o,r,i){let a={getNetworkStatus:function(n){let o=t.defer();return e.post("/predict/status",{id:n}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},deploy:function(n){let o=t.defer();return e.post("/predict/deploy",{id:n,predictConfig:r.getPredictConfig()}).then(function(e){i.trackEvent(i.STAT_ACTIONS.APP.RUN,n,{},{id:n,predictConfig:r.getPredictConfig()}),o.resolve(e)},function(e){o.reject(e)}),o.promise},release:function(n){let o=t.defer();return e.post("/predict/release",{id:n}).then(function(e){i.trackEvent(i.STAT_ACTIONS.APP.STOP,n),o.resolve(e)},function(e){o.reject(e)}),o.promise}};return a}]).factory("rpaService",["remoteService","$q","ccc","ossService","nodeService",function(e,t,n,o,r){let i={getNetworkStatus:function(n){let o=t.defer();return e.post("/rpa/status",{id:n}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},run:function(n,o,r){let i=t.defer();return e.post("/rpa/run",{id:n,nodeId:o,type:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},stop:function(n){let o=t.defer();return e.post("/rpa/stop",{id:n}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}};return i}]).factory("userService",["remoteService","$q","ossService","ccc","USER_CONFIG",function(e,t,n,o,r){const i={getConfig:function(){let e=t.defer();return n.getObject(window.appConfig.oss.bucket,window.appConfig.userConfigPath,null,!0).then(function(t){let n=o.d(t);try{n=JSON.parse(n)}catch(e){}_.isEmpty(n)?i.saveConfig(r).then(function(t){e.resolve(r)},function(t){e.reject(t)}):e.resolve(n)},function(t){e.reject(t)}),e.promise},saveConfig:function(e){let r=t.defer();return n.putObject(window.appConfig.oss.bucket,window.appConfig.userConfigPath,o.c(JSON.stringify(e))).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getAccessKey:function(){let n=t.defer();return e.get("/oss/ak").then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}};return window.userService=i,i}]).factory("hardwareService",["remoteService","$q",function(e,t){const n={},o={broadcast:"/hardware/broadcast",register:"/hardware/register",list:"/hardware/list",get:"/hardware/get",remove:"/hardware/remove","app/deploy":"/hardware/app/deploy","app/release":"/hardware/app/release",status:"/hardware/status","storage.list":"/hardware/storage/list","storage.create":"/hardware/storage/create","storage.remove":"/hardware/storage/remove"};return n.post=function(n,r){let i=t.defer();return e.post(o[n],r).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},window.hardwareService=n,n}]),angular.module("app").factory("getStsToken",["remoteService","$q",function(e,t){let n="",o=!1,r=[];return function(){let i=t.defer();return n&&n.Credentials&&n.Credentials.Expiration&&new Date(n.Credentials.Expiration).getTime()-(new Date).getTime()>18e5?i.resolve({token:n,refresh:!1}):o?r.push(i):(o=!0,e.get("/oss/token").then(function(e){for(n=e,i.resolve({token:e,refresh:!0});r.length;){r.pop().resolve({token:e,refresh:!0})}},function(e){for(i.reject(e);r.length;){r.pop().reject(e)}}).finally(function(){o=!1})),i.promise}}]).factory("logService",["ossService","$q",function(e,t){let n={getLogId:function(e,t,n,o){return _.isEmpty(o)||(t=o+"-"+t),"studio/"+e+"/logs/"+t+"/"+n},getAppLogId:function(e,t,n,o){return _.isEmpty(o)||(t=o+"-"+t),"studio/"+e+"/logs/"+t+"/app.log"},getLog:function(n,o){let r=t.defer();return e.headObject(window.appConfig.oss.bucket,n).then(function(t){let i=t.NextAppendPosition-1;i>o?e.getObject(window.appConfig.oss.bucket,n,o+"-"+i).then(function(e){r.resolve({text:e,nextLogPosition:i})}):i===o?r.resolve():r.resolve("reload")},function(e){r.resolve("reload")}),r.promise}};return n}]).factory("ossService",["$http","$q","$timeout","$rootScope","getStsToken","remoteService",function(e,t,n,o,r,i){let a,s=window.ALY,c=function(e){let t="";return e.code,t="网络错误"},l=function(){let e=t.defer();return r().then(function(t){let n=t.token;!a||t.refresh?(a=new s.OSS({accessKeyId:n.Credentials.AccessKeyId,secretAccessKey:n.Credentials.AccessKeySecret,securityToken:n.Credentials.SecurityToken,endpoint:window.appConfig.oss.endpoint,apiVersion:"2013-10-15"}),e.resolve(a)):e.resolve(a)},function(t){e.reject(t)}),e.promise};const p=function(e,n,o,r,i){let a=t.defer();return l().then(function(t){t.putObject({Bucket:e,Key:n,Body:o,ACL:i,ContentType:r,Expires:0,CacheControl:"no-cache, must-revalidate"},function(e,t){e?a.reject({err:e,msg:c(e)}):a.resolve(t)})},function(e){a.reject(e)}),a.promise};let d=function(e,n,o,r){let a=t.defer();return i.post("/oss/object/get",{Bucket:e,Key:n}).then(function(e){i.getBinary(e.data,r?"arraybuffer":"").then(function(e){r?a.resolve(new Uint8Array(e)):a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},u=function(e,n){let o=t.defer();return i.post("/oss/object/head",{Bucket:e,Key:n}).then(function(e){e.data.NextAppendPosition=e.data.ContentLength,o.resolve(e.data)},function(e){o.reject(e)}),o.promise},h=function(e,n){let o=t.defer();return i.post("/oss/object/delete",{Bucket:e,Key:n}).then(function(e){i.delete(e.data).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise},f=function(e,n,o,r,a,s=!1){let c=t.defer();return i.post("/oss/object/put",{Bucket:e,Key:n,Expires:0,CacheControl:"no-cache, must-revalidate",ignoreCheck:s}).then(function(e){i.put(e.data,o).then(function(e){c.resolve(e)},function(e){c.reject(e)})},function(e){c.reject(e)}),c.promise},g=function(e,n,o,r,a){let s=t.defer();return i.post("/oss/object/put",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){let t=new XMLHttpRequest;t.onload=function(){200===t.status?a():r(t.statusText)},t.onprogress=function(e){o(e)},t.open("PUT",e.data,!0),t.send(n),s.resolve(e)},function(e){s.reject(e)}),s.promise},m={getOss:l,upload:function(e,n,o,i,a){let s=t.defer();return r().then(function(t){new window.OssUpload({bucket:window.appConfig.oss.bucket,endpoint:window.appConfig.oss.endpoint,chunkSize:1048576,concurrency:3,stsToken:t.token}).upload({file:n,key:e,maxRetry:1,headers:{ServerSideEncryption:""},onprogress:function(e){o(e)},onerror:function(e){i(e)},oncomplete:function(e){a(e)}}),s.resolve("uploaded")},function(e){s.reject(e)}),s.promise},getObject:function(e,n,o,r){let a=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:n,type:"get"}).then(function(t){l().then(function(t){t.getObject({Bucket:e,Key:n,Range:o?"bytes="+o:""},function(e,t){e?a.reject({err:e,msg:c(e)}):r?a.resolve(t.Body):a.resolve(t.Body.toString())})},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},headObject:function(e,n){let o=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:n,type:"head"}).then(function(t){l().then(function(t){t.headObject({Bucket:e,Key:n},function(e,t){e?o.reject({err:e,msg:c(e)}):o.resolve(t)})},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise},putObject:function(e,n,o,r,a,s){let c=t.defer();return s?p(e,n,o,r,a).then(function(e){c.resolve(e)},function(){c.reject(err)}):i.post("/oss/object/check",{Bucket:e,Key:n,type:"put"}).then(function(t){p(e,n,o,r,a).then(function(e){c.resolve(e)},function(e){c.reject(e)})},function(e){c.reject(e)}),c.promise},putObjectAcl:function(e,n,o){let r=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:n,type:"put"}).then(function(t){l().then(function(t){t.putObjectAcl({Bucket:e,Key:n,ACL:o},function(e,t){e?r.reject({err:e,msg:c(e)}):r.resolve(t)})},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},deleteObject:function(e,n){let o=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:n,type:"get"}).then(function(t){l().then(function(t){t.deleteObject({Bucket:e,Key:n},function(e,t){e?o.reject({err:e,msg:c(e)}):o.resolve(t)})},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise},getSignedUrl:function(e){let n=t.defer();return i.post("/oss/object/get",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}};return"minio"===window.appConfig.ossType&&(m.getObject=d,m.headObject=u,m.deleteObject=h,m.putObject=f,m.upload=g),window.ossService=m,m}]),angular.module("app").factory("pageLoading",function(){const e=angular.element(".page-loading");return{show:function(){e.css({display:"block"}).css({opacity:1})},hide:function(){window.setTimeout(function(){e.css({opacity:0}).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){e.css({display:"none"})})},300)}}}).factory("ccc",function(){let e=function(){let e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function r(e,t){if(!o[e]){o[e]={};for(let t=0;t<e.length;t++)o[e][e.charAt(t)]=t}return o[e][t]}let i={compressToBase64:function(e){if(null==e)return"";let n=i._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(n){return r(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},encoder:new TextEncoder,decoder:new TextDecoder,secret:new Uint8Array([8,2,1,2,1,6]),checkVersion:function(e){return 8!==e[e.length-6]?"v1":2!==e[e.length-5]?"v1":1!==e[e.length-4]?"v1":2!==e[e.length-3]?"v1":1!==e[e.length-2]?"v1":6!==e[e.length-1]?"v1":"v2"},compressToUint8Array:function(e,t){switch(t=t||"v1"){case"v1":let n=i.compress(e),o=new Uint8Array(2*n.length);for(let e=0,t=n.length;e<t;e++){let t=n.charCodeAt(e);o[2*e]=t>>>8,o[2*e+1]=t%256}return o;case"v2":let r=i.encoder.encode(e),a=new Uint8Array(r.length+i.secret.length);return a.set(r,0),a.set(i.secret,r.length),a}},decompressFromUint8Array:function(t){switch(i.checkVersion(t)){case"v1":if(null==t)return i.decompress(t);{let n=new Array(t.length/2);for(let e=0,o=n.length;e<o;e++)n[e]=256*t[2*e]+t[2*e+1];let o=[];return n.forEach(function(t){o.push(e(t))}),i.decompress(o.join(""))}case"v2":let n=new Uint8Array(t.buffer,0,t.length-i.secret.length);return i.decoder.decode(n)}},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return r(n,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(!e)return"";let o,r,i,a={},s={},c="",l="",p="",d=2,u=3,h=2,f=[],g=0,m=0;for(i=0;i<e.length;i+=1)if(c=e.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=u++,s[c]=!0),l=p+c,Object.prototype.hasOwnProperty.call(a,l))p=l;else{if(Object.prototype.hasOwnProperty.call(s,p)){if(p.charCodeAt(0)<256){for(o=0;o<h;o++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=p.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,o=0;o<h;o++)g=g<<1|r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=p.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--d&&(d=Math.pow(2,h),h++),delete s[p]}else for(r=a[p],o=0;o<h;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--d&&(d=Math.pow(2,h),h++),a[l]=u++,p=String(c)}if(""!==p){if(Object.prototype.hasOwnProperty.call(s,p)){if(p.charCodeAt(0)<256){for(o=0;o<h;o++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=p.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,o=0;o<h;o++)g=g<<1|r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=p.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--d&&(d=Math.pow(2,h),h++),delete s[p]}else for(r=a[p],o=0;o<h;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--d&&(d=Math.pow(2,h),h++)}for(r=2,o=0;o<h;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;for(;;){if(g<<=1,m==t-1){f.push(n(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,o){let r,i,a,s,c,l,p,d,u=[],h=4,f=4,g=3,m="",v=[],y={val:o(0),position:n,index:1};for(i=0;i<3;i+=1)u[i]=i;for(s=0,l=Math.pow(2,2),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;switch(r=s){case 0:for(s=0,l=Math.pow(2,8),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;d=e(s);break;case 1:for(s=0,l=Math.pow(2,16),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;d=e(s);break;case 2:return""}for(u[3]=d,a=d,v.push(d);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,g),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;switch(d=s){case 0:for(s=0,l=Math.pow(2,8),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;u[f++]=e(s),d=f-1,h--;break;case 1:for(s=0,l=Math.pow(2,16),p=1;p!=l;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(c>0?1:0)*p,p<<=1;u[f++]=e(s),d=f-1,h--;break;case 2:return v.join("")}if(0==h&&(h=Math.pow(2,g),g++),u[d])m=u[d];else{if(d!==f)return null;m=a+a.charAt(0)}v.push(m),u[f++]=a+m.charAt(0),a=m,0==--h&&(h=Math.pow(2,g),g++)}}};return i}(),t={};return t.c=e.compressToUint8Array,t.d=e.decompressFromUint8Array,t.c1=e.compressToBase64,t.d1=e.decompressFromBase64,t}).factory("xssList",function(){let e=[];return{filterXSS:function(e){return filterXSS(e)},escape:function(e){return escape(e)},add:function(t){let n=!1;e.map(function(e,o){e.data==t.data&&(n=!0)}),n||e.push(t)},xss:function(){e.map(function(e,t){let n=e.data[e.key];e.data[e.key]=filterXSS(n)}),e=[]}}}).factory("common",function(){let e={now:function(){return(new Date).getTime()},uuid:function(e,t,n){return(n=n||"")+uuidv1().replace(/-/g,"")},arrayContainsArray:function(e,t){return!!(e&&t&&e.length&&t.length)&&(!(e.length<t.length)&&e.filter(function(e){return t.includes(e)}).length===t.length)},getIndexFromPortUuid:function(e){return e.includes("in")?parseInt(e.substr(2),10):parseInt(e.substr(3),10)},getDirList:function(t,n){let o=[];if(!t||!t.length)return o;for(let r=0;r<t.length;r++){let i=t[r];n&&(i.parentId=n),i.selected&&delete i.selected,o.push(i),i.children&&(o=o.concat(e.getDirList(i.children,i.id)))}return o},getDirMap:function(t){let n={},o=e.getDirList(t);for(let e=0;e<o.length;e++)n[o[e].id]=o[e];return n},expandDir:function(e,t){for(;t;){let n=e[t];void 0===n.expanded&&(n.expanded=!0),t=n.parentId}},handleLinkInDesc:function(e){function t(e){let t="";return 0===e.length?t:t=(t+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let n=e.indexOf("http");if(n>-1){let o=e.slice(n),r=o.indexOf(" "),i=o.indexOf("\n"),a=o.length;r>0?a=r:i>0&&(a=i);let s=o.slice(0,a);e=t(e.slice(0,n))+'<a href="'+s+'" target="_blank" ng-click="$event.stopPropagation()">'+s+"</a>"+t(e.slice(n+a))}else e=t(e);return e},getUploadPath:function(t,n,o){return"studio/"+t+"/component/"+n+"/uploaded_code_"+e.uuid()},getUploadPyLibPath:function(e,t){return"studio/"+e+"/component/"+t+"/uploaded_py_lib.zip"},getUploadNodeDataPath:function(e,t="data"){return"studio/{{userId}}/{{appId}}/{{nodeId}}/"+e+"/"+t+"/"},getUploadDataPath:function(e){return"studio/{{userId}}/share/{{appId}}/uploads/"+e+"/"},getScreenshotKey:function(e,t){return`studio/${e}/${t}/screen_shot.png`},getImportPath:function(e){return`studio/${e}/tmp/import/`},calImageSize:function(e,t){let n=new Image;n.src=e,n.onload=function(){let e=n.naturalWidth,o=n.naturalHeight;t({width:126,height:126*(o/e)})}},isEmpty:function(e){for(let t in e)if(e.hasOwnProperty(t))return!1;return!0},changeBackspaceDefault:function(e){let t=e.srcElement||e.target,n=!1;(n=("INPUT"!==t.tagName.toUpperCase()||"TEXT"!==t.type.toUpperCase()&&"PASSWORD"!==t.type.toUpperCase()&&"FILE"!==t.type.toUpperCase()&&"EMAIL"!==t.type.toUpperCase()&&"SEARCH"!==t.type.toUpperCase()&&"DATE"!==t.type.toUpperCase())&&"TEXTAREA"!==t.tagName.toUpperCase()||(t.readOnly||t.disabled))&&e.preventDefault()},detectFormElement:function(e){let t,n=e.srcElement||e.target;return t="INPUT"===n.tagName.toUpperCase()&&("TEXT"===n.type.toUpperCase()||"PASSWORD"===n.type.toUpperCase()||"FILE"===n.type.toUpperCase()||"SEARCH"===n.type.toUpperCase()||"DATE"===n.type.toUpperCase())||"TEXTAREA"===n.tagName.toUpperCase()},getInitedNodeColor:function(e){switch(e){case"default":return"rgba(255,255,255,1)";case"primary":return"rgba(69,112,253,1)";case"info":return"rgba(214,69,250,1)";case"success":return"rgba(253,91,70,1)";case"warning":return"rgba(254,70,144,1)";case"danger":return"rgba(79,86,104,1)";case"orange":return"rgba(243,152,0,1)";case"green":return"rgba(0,153,68,1)";case"blue":return"rgba(0,70,134,1)";case"cyan":return"rgba(19,181,177,1)";case"golden":return"rgba(237,0,27,1)";case"warmgreen":return"rgba(179,212,101,1)";default:return"rgba(255,255,255,1)"}}};return window.handleLinkInDesc=e.handleLinkInDesc,window.common={uuid:e.uuid,getImportPath:e.getImportPath},e}).factory("multiselect",function(){let e,t,n,o=[];return{init:function(r,i,a){let s=$(r);e=s,t=i,n=a;s.on("dragstart",{distance:2},function(e,t){return o=[],$('<div class="drag-selection" />').css({position:"fixed",zIndex:1e3}).appendTo(document.body)}).on("drag",function(e,t){$(t.proxy).css({top:Math.min(e.clientY,t.startY),left:Math.min(e.clientX,t.startX),height:Math.abs(e.clientY-t.startY),width:Math.abs(e.clientX-t.startX)})}).on("dragend",function(e,t){$(t.proxy).remove(),"function"==typeof a&&a(o)}),s.find(".element").on("dropstart",function(e,t){$(this).addClass("mock-selected"),o.push(this),"function"==typeof i&&i()}).on("dropend",function(e,t){$(this).removeClass("mock-selected");let n=o.indexOf(this);o.splice(n,1),"function"==typeof i&&i()}).on("drop",function(e,t){$(this).addClass("selected"),o.push(this)}),$.drop({multi:!0})},select:function(e){e&&e.map(function(e){let t=$("#player #"+e.id);t.addClass("selected"),o.push(t[0])})},add:function(n){e.find("#"+n.id).on("dropstart",function(e,n){$(this).addClass("mock-selected"),o.push(this),"function"==typeof t&&t()}).on("dropend",function(e,n){$(this).removeClass("mock-selected");let r=o.indexOf(this);o.splice(r,1),"function"==typeof t&&t()}).on("drop",function(e,t){$(this).addClass("selected"),o.push(this)})},remove:function(t){e.find("#"+t.id).off("drop dropstart dragend")},disable:function(){e.off("drag dragstart dragend"),e.find(".element").off("drop dropstart dropend")},getCurrent:function(){return o},clearCurrent:function(){o=[],e&&e.find(".element").removeClass("selected")}}}).factory("align",function(){function e(e,t){let n=[];for(let o=0;o<e.length;o++)n.push(e[o].css[t]);return Math.min.apply(null,n)}function t(e,t){$("#player #"+e).css(t),$(".app-aside #"+e).css(t)}return{left:function(n){let o=e(n,"left");for(let e=0;e<n.length;e++)n[e].css.left=o,t(n[e].id,{left:o})},top:function(n){let o=e(n,"top");for(let e=0;e<n.length;e++)n[e].css.top=o,t(n[e].id,{top:o})},right:function(e){let n=[];for(let t=0;t<e.length;t++)n.push(parseInt(e[t].css.left)+parseInt(e[t].css.width));let o=Math.max.apply(null,n);for(let n=0;n<e.length;n++)e[n].css.left=o-parseInt(e[n].css.width),t(e[n].id,{left:o-parseInt(e[n].css.width)})},bottom:function(e){let n=[];for(let t=0;t<e.length;t++)n.push(parseInt(e[t].css.top)+parseInt(e[t].css.height));let o=Math.max.apply(null,n);for(let n=0;n<e.length;n++)e[n].css.top=o-parseInt(e[n].css.height),t(e[n].id,{top:o-parseInt(e[n].css.height)})},center:function(n){let o=e(n,"left"),r=[];for(let e=0;e<n.length;e++)r.push(parseInt(n[e].css.left)+parseInt(n[e].css.width));let i=Math.max.apply(null,r)/2+o/2;for(let e=0;e<n.length;e++)n[e].css.left=i-parseInt(n[e].css.width)/2,t(n[e].id,{left:i-parseInt(n[e].css.width)/2})},middle:function(n){let o=e(n,"top"),r=[];for(let e=0;e<n.length;e++)r.push(parseInt(n[e].css.top)+parseInt(n[e].css.height));let i=o/2+Math.max.apply(null,r)/2;for(let e=0;e<n.length;e++)n[e].css.top=i-parseInt(n[e].css.height)/2,t(n[e].id,{top:i-parseInt(n[e].css.height)/2})}}}).factory("multidrag",function(){let e,t,n,o,r,i,a,s;return{enable:function(c,l,p){let d=$(p);function u(e){let t,n=$(e).attr("id");return l.map(function(e){e.id==n&&(t=e)}),t}a=d,d.on("mousedown.multi",function(a){(s=Draggable.create(this,{type:"top,left",zIndexBoost:!1,bounds:".edit_main",onPress:function(){e=[],t=this.x,n=this.y;for(let t=0;t<d.length;t++)if(d[t]!==this.target){let n=u(d[t]),o={element:d[t],preview:$(".app-aside #"+$(d[t]).attr("id")),data:n,x:n.css.left,y:n.css.top};e.push(o)}r=$(this.target),i=$(".app-aside #"+$(this.target).attr("id")),TweenLite.killTweensOf(d)},onDragStart:function(){o=function(e){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].css.top);let n=Math.min.apply(null,t),o=[];for(let t=0;t<e.length;t++)o.push(e[t].css.left);let r=Math.min.apply(null,o);return{top:n,left:r}}(l)},onDrag:function(){d.addClass("user-move");let o={left:this.x,top:this.y};TweenLite.set(i,{css:o}),angular.extend(u(r).css,o),function(){let o,r=this.x-t,i=this.y-n;for(let t=0;t<e.length;t++){let n={top:(o=e[t]).y+i,left:o.x+r};TweenLite.set(o.element,{css:n}),TweenLite.set(o.preview,{css:n}),angular.extend(o.data.css,n)}}.apply(this)},onDragEnd:function(){d.removeClass("user-move"),s[0].kill()}}))[0].startDrag(a)})},disable:function(){a&&a.off("mousedown.multi")}}}).factory("ossImageProcess",function(){return function(e){return e.rotate+"r|"+(t=e.x,n=e.y,o=e.width,r=e.height,t+"-"+n+"-"+o+"-"+r+"a")+"|506h_320w_0e";var t,n,o,r}}).factory("selectionOp",function(){return function(e){try{document.execCommand("MultipleSelection",null,!0)}catch(e){}rangy.init();let t=null,n=rangy.createHighlighter();return n.addClassApplier(rangy.createClassApplier("highlight",{ignoreWhiteSpace:!0,tagNames:["span","a"]})),e.on("focus.rangy",function(){t&&rangy.removeMarkers(t),t=rangy.saveSelection()}).on("blur.rangy",function(){n.highlightSelection("highlight")}),function(){e.off("focus.rangy").off("focus.rangy"),$("input.sp-input").off("focus.current").off("blur.current")}}}).factory("enabledUser",function(){let e=[["s","h","a","n","g","l","u","e"]];e=_.map(e,function(e){return e.join("")});let t=-1==_.indexOf(e,window.appConfig.userId);return window.enabled=t,t}).factory("format",["$stateParams",function(e){return function(t,n){if(n||(n={"{{userId}}":window.appConfig.userId,"{{appId}}":e.id,"{{nodeId}}":e.nodeId,"{{componentId}}":e.componentId}),_.isEmpty(t))return t;let o=t;return _.keys(n).forEach(e=>{o=o.replace(e,n[e])}),o}}]).factory("loopService",["$q","toaster",function(e,t){const n={};let o,r,i;const a=function(n,s,c,l){n&&n.asyncable&&(i=e.defer()),_.has(n,"title")&&(r?r&&(r.toaster.title=n.title,t.reset(r)):r=t.pop({type:"info",title:n.title,timeout:0,tapToDismiss:!1}));const p=function(){o&&(clearTimeout(o),o=null),o=setTimeout(function(){c(s).then(function(e){"completed"===e.job.status?_.get(e.job.returnvalue,"id")&&"export"===n.type?a({type:n.type},e.job.returnvalue.id,c,l):(r&&t.clear(r),clearTimeout(o),o=null,r=null,l&&l(e.job.returnvalue),i&&i.resolve(e.job.returnvalue)):"failed"===e.job.status?(r&&t.clear(r),clearTimeout(o),o=null,r=null,i&&i.reject({msg:e.job.failedReason})):(r&&(r.toaster.title=n.title+"，已完成 "+e.job.progress+"%",t.reset(r)),p())},function(e){i&&i.reject(e)})},2e3)};if(p(),i)return i.promise};return n.fetchJob=a,window.loopService=n,n}]).factory("downloadFile",["appDataStoreService","$q",function(e,t){let n={};function o(e,t){if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(e,t);else{let n=document.createElement("a"),o=document.querySelector("body");n.href=window.URL.createObjectURL(e),n.download=t,n.style.display="none",o.appendChild(n),n.click(),o.removeChild(n),window.URL.revokeObjectURL(n.href)}}function r(e,t){n.getBlob(e).then(function(e){o(e,t)},function(e){})}let i={oss:r,minio:r,local:function(e){open("/local/"+e)}};return n.getBlob=function(n,o){let r=t.defer();return e.get(n,!0).then(function(e){return new Blob([e.buffer])}).then(function(e){if(o){let t=new FileReader;t.onloadend=function(){r.resolve(t.result)},t.readAsDataURL(e)}else r.resolve(e)}).catch(function(e){r.reject(e)}),r.promise},n.download=function(e,t){i[appConfig.appDataStoreType](e,t)},n.downloadZip=function(e,r){let i=t.defer(),a=new JSZip,s=e.length,c=0,l=[],p=function(){c<s?d(e[c]):a.generateAsync({type:"blob"}).then(function(e){o(e,r+".zip"),i.resolve({completed:!l.length,failedFile:l})})},d=function(t){c++,n.getBlob(t.id).then(function(e){a.file(t.label,e),p()},function(n){l.push({id:e.id,label:t.label,error:n}),p()})};return d(e[c]),i.promise},n}]).factory("copyToClipboard",function(){return{copy:function(e){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}finally{document.body.removeChild(t)}}}}}).factory("uuidService",function(){return{v4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}}}),angular.module("app").factory("nodeService",["$q","format","common","componentService","$state","toaster","$stateParams","appDataStoreService","statisticsService",function(e,t,n,o,r,i,a,s,c){let l,d,u,h=window.TheGraph.fbpGraph,f={getComponentInfo:function(e){return f[e]}},g=null,m=null,v=null,y=null,b=null,w=null,x=null,C=null,S=null,I=null,N=function(e,t,n,o){g&&g(e,t,n,o)},T=function(e,t,n){m&&m(e,t,n)},E=function(e,t,n){v&&v(e,t,n)},k=function(e,t,n,o){y&&y(e,t,n,o)},$=function(e){b&&b(e)},P=function(e){I&&I(e)},O=function(){let e={x:d.properties.x||0,y:d.properties.y||0,scale:d.properties.scale||1,readonly:!1,height:l.height(),width:l.width(),graph:d,library:f,showScriptEditIcon:r.includes("app.predict"),showContext:P,onEdgeSelection:E,onClickEdgeCode:k,onNodeSelection:N,onNodeRectImgDblclick:T,onGroupSelection:$,onExpandIconClicked:function(e,t){S&&S(e,t)},onMoved:function(e,t,n){d.properties.x=e,d.properties.y=t,d.properties.scale=n,w&&w()}},t=React.createElement(TheGraph.App,e);u=ReactDOM.render(t,l.get(0))};const A=function(e){const t=[],n=[];for(let o in e)t.push(e[o].metadata.x),n.push(e[o].metadata.y);const o=_.min(t),r=_.max(t),i=_.min(n),a=_.max(n),s=_.find(e,function(e){return e.metadata.x==r}).metadata.width,c=_.find(e,function(e){return e.metadata.y==a}).metadata.height;return{x:{min:o,max:r,width:s},y:{min:i,max:a,height:c}}};let M={init:function(e,t,n){l=e,t&&"{}"!==t?(t=function(e,t,n){let o=JSON.parse(e);try{o=JSON.parse(e)}catch(e){}const r=o.properties.x,i=o.properties.y,a=o.properties.scale,s=A(o.processes);let c=s.x.min,l=s.y.min,p=s.x.max,d=s.y.max;if(c*a+r<0&&p*a+r<0||c*a+r>t&&p*a+r>t){const e=p-c+s.x.width;o.properties.x=(t-e*a)/2-c*a}if(l*a+i<0&&d*a+i<0||l*a+i>n&&d*a+i>n){const e=d-l+s.y.height;o.properties.y=(n-e*a)/2-l*a}if(o.properties.theme!==appConfig.theme){const e=M.handleNodesCalculated(appConfig.theme,o.processes);o.processes=e}return JSON.stringify(o)}(t,l.innerWidth(),l.innerHeight()),h.graph.loadJSON(t,function(e,t){d=t,O(),n()})):(d=new h.Graph,O(),n()),d.on("endTransaction",function(e){w&&w(e)}),window.addEventListener("resize",function(){M.resetCanvas()})},handleNodesCalculated:function(e,t){let n,o,r;n=t?Object.keys(t).map(function(e){return Object.assign({id:e},t[e])}):d.nodes,"dark"==e?(o=TheGraph.config.nodeSize1,r=TheGraph.config.nodeSize2):(o=TheGraph.config.nodeSize2,r=TheGraph.config.nodeSize1);const i=_.sortBy(n,"metadata.x"),a={},s={},c={};i.forEach(function(e,t){if(c[e.id]={x:e.metadata.x,y:e.metadata.y},t>0){const n=i[t-1],o=n.metadata.size,s=(c[e.id].x-c[n.id].x)/n.metadata.width,l=c[n.id].x+r[o]*s,p=l-c[e.id].x;a[e.id]=p,e.metadata.x=l+a[n.id]}else a[e.id]=0});const l=_.sortBy(i,"metadata.y");if(l.forEach(function(n,o){if(o>0){const t=l[o-1],i=t.metadata.size,a=(c[n.id].y-c[t.id].y)/t.metadata.height,p="dark"==e?TheGraph.config.nodeSize2MinHeight[i]:r[i],d=c[t.id].y+p*a,u=d-c[n.id].y;s[n.id]=u,n.metadata.y=d+s[t.id]}else s[n.id]=0;t&&(t[n.id].metadata.x=n.metadata.x,t[n.id].metadata.y=n.metadata.y)}),t)return t;d.nodes=l},resetCanvas:function(){let e=l.width(),t=l.height();if(l.is(":hidden")){const n=l.parents("#edit");e=n.width(),t=n.height()-64-16-2,n.hasClass("left-hidden")?e-=32:e-=296,n.hasClass("right-hidden")?e-=32:e-=296,e-=2}u.setState({width:e,height:t})},getPosition:function(){return{x:u.state.x,y:u.state.y,scale:u.state.scale}},setPosition:function(e,t,n){u.setState({x:e,y:t,scale:n||1})},setAppState:function(e,t){u.setState({[e]:t})},addGroup:function(e,t,n){d.addGroup(e,t,n)},getGroups:function(){return d.groups},getGroup:function(e){for(let t=0;t<d.groups.length;t++){let n=d.groups[t];if(n.name===e)return n}return null},getChildGroup:function(e){let t=[],o=M.getGroups(),r=M.getGroup(e);if(!r||!r.nodes)return!1;for(let i=0;i<o.length;i++){let a=o[i];a.name!==e&&(n.arrayContainsArray(r.nodes,a.nodes)&&t.push(a))}return t},getParentGroup:function(e){let t=[],o=M.getGroups(),r=M.getGroup(e);if(!r||!r.nodes)return!1;for(let i=0;i<o.length;i++){let a=o[i];a.name!==e&&(n.arrayContainsArray(a.nodes,r.nodes)&&t.push(a))}return t},whichGroup:function(e){let t=[],n=M.getGroups();if(!n)return t;for(let o=0;o<n.length;o++){let r=n[o];r.nodes&&(r.nodes.includes(e)&&t.push(r))}return t},removeGroup:function(e){d.removeGroup(e)},getPortHasTargetNodePort:function(e,t,n,o){let r=0;for(let i=0;i<e.length;i++){let a=e[i];if(a.ioType===t&&(r++,a.targetNode===n&&a.targetPort===o))return{result:!0,id:a.uuid}}return{result:!1,id:t+(r+1)}},expandGroup:function(e){let t=M.whichGroup(e.id),n=d.toJSON(),o=function(t){for(let n=0;n<e.metadata.def.ports.length;n++){let o=e.metadata.def.ports[n];if(o.uuid===t)return o}},r=_.get(e,"metadata.def.composite"),a=0,s=0;if(e.metadata.initCoord)a=e.metadata.x-e.metadata.initCoord.x,s=e.metadata.y-e.metadata.initCoord.y;else if(r){const t=A(r.processes);let n=t.x.min+(t.x.max-t.x.min)/2,o=t.y.min+(t.y.max-t.y.min)/2;a=e.metadata.x-n,s=e.metadata.y-o}let c=[];Object.keys(r.processes).forEach(function(e){c.push(e);const n=r.processes[e].metadata;n.x+=a,n.y+=s,M.addNode(e,r.processes[e].component,n),t.forEach(function(t){t.nodes.push(e)})}),n.connections.forEach(function(t){if(t.src.process===e.id){let e=o(t.src.port);e&&e.display?d.addEdge(e.targetNode,e.targetPort,t.tgt.process,t.tgt.port):(d.removeEdge(t.src.process,t.src.port,t.tgt.process,t.tgt.port),i.pop("info","运行项目更新，连线删除"))}else if(t.tgt.process===e.id){let e=o(t.tgt.port);e&&e.display?d.addEdge(t.src.process,t.src.port,e.targetNode,e.targetPort):(d.removeEdge(t.src.process,t.src.port,t.tgt.process,t.tgt.port),i.pop("info","运行项目更新，连线删除"))}}),r.connections.forEach(function(e){d.addEdge(e.src.process,e.src.port,e.tgt.process,e.tgt.port)}),-1==_.findIndex(d.groups,{name:e.id})?M.addGroup(e.id,c,{name:e.metadata.label,component:e.component,data:e.metadata}):d.setGroupMetadata(e.id,{name:e.metadata.label,component:e.component,data:e.metadata}),e.id,d.removeNode(e.id)},collectCompositePorts:function(e,t){const n=Object.keys(e.processes);_.remove(t,function(e){return-1==_.indexOf(n,e.targetNode)});let o=_.map(_.filter(t,{ioType:"in"}),function(e){return parseInt(e.uuid.slice(2))}),r=_.map(_.filter(t,{ioType:"out"}),function(e){return parseInt(e.uuid.slice(3))}),i=_.isEmpty(o)?1:_.max(o)+1,a=_.isEmpty(r)?1:_.max(r)+1,s={};e.connections.forEach(function(e){s[e.src.process+"-"+e.src.port]=1,s[e.tgt.process+"-"+e.tgt.port]=1}),n.forEach(function(n){e.processes[n].metadata.def.ports.forEach(function(e){const o=_.findIndex(t,function(t){return t.targetNode==n&&t.targetPort==e.uuid});var r;if(e.display){if(!s[n+"-"+e.uuid])return o>-1?(t[o].type=e.type,t[o].display=e.display,void(t[o].description=e.description)):void t.push({description:e.description,display:1,ioType:e.ioType,targetNode:n,targetPort:e.uuid,type:e.type,uuid:(r=e.ioType,"in"===r?"in"+i++:"out"+a++)});o>-1&&t.splice(o,1)}else o>-1&&(t[o].display=e.display)})})},collectGroupInport:function(e,t){for(let n=0;n<e.length;n++){let o=e[n],r=M.getPort(o.tgt.process,o.tgt.port);if(!r)continue;let i=M.getPortHasTargetNodePort(t,"in",o.tgt.process,o.tgt.port);i.result||t.push({description:angular.copy(r.description),display:1,ioType:"in",targetNode:o.tgt.process,targetPort:o.tgt.port,type:r.type,uuid:i.id})}t.length||t.push({description:"",display:0,ioType:"in",uuid:"in1"})},collectGroupOutport:function(e,t){for(let n=0;n<e.length;n++){let o=e[n],r=M.getPort(o.src.process,o.src.port);if(!r)continue;let i=M.getPortHasTargetNodePort(t,"out",o.src.process,o.src.port);i.result||t.push({description:angular.copy(r.description),display:1,ioType:"out",targetNode:o.src.process,targetPort:o.src.port,type:r.type,uuid:i.id})}},findGroupMinMax:function(e){return window.TheGraph.findMinMax(d,e)},getGroupNodeUiControl:function(e,t){let n;if(t.metadata.ui.tabs.fields&&t.metadata.ui.tabs.fields.controls){n=t.metadata.ui.tabs.fields.controls;for(let t=0;t<n.length;t++){let o=n[t];if(o.uuid===e.controlId)return o}}if(t.metadata.ui.tabs.params&&t.metadata.ui.tabs.params.controls){n=t.metadata.ui.tabs.params.controls;for(let t=0;t<n.length;t++){let o=n[t];if(o.uuid===e.controlId)return o}}if(t.metadata.ui.tabs.tune&&t.metadata.ui.tabs.tune.controls){n=t.metadata.ui.tabs.tune.controls;for(let t=0;t<n.length;t++){let o=n[t];if(o.uuid===e.controlId)return o}}return null},genGroupTabInfo:function(e){let t=[];if(!e)return t;for(let n=0;n<e.length;n++){let o=e[n],r=M.getNode(o.nodeId),i=M.getGroupNodeUiControl(o,r);i&&t.push(i)}return t},genCompositeTabInfo:function(e,t,n,o){let r=[];if(!e)return r;for(let i=0;i<e.length;i++){let a=e[i];if("global"===a.type)n&&n.forEach(function(e){e.id===a.id&&r.push({type:"global",uuid:e.id})});else{let e=t[a.nodeId],n=M.getGroupNodeUiControl(a,e);n&&(p.nodeId=a.nodeId,p.appId=o,r.push(n))}}return r},getInitedMetadata:function(){return{def:{description:{zh_CN:""},type:999,params:{},ports:[]},ui:{tabs:{params:{tabName:{en_US:"Parameters Setting",zh_CN:"参数设置",zh:"参数设置"},controls:[]}}},locale:"zh_CN"}},foldGroup:function(e){let t=M.getParentGroup(e),n=M.getGroup(e);if(!n)return;let o=_.isEmpty(n.metadata.data)?M.getInitedMetadata():Object.assign({},_.get(n,"metadata.data"));if(o.label=n.metadata.name,n&&!_.isEmpty(n.nodes)){const e=M.findGroupMinMax(n.nodes);if(e){const t=(e.minX+e.maxX)/2-45,n=(e.minY+e.maxY)/2-45;o.x=t,o.y=n,o.initCoord={x:t,y:n}}}_.has(n,"metadata.def")&&Object.assign(o.def,n.metadata.def);let r=d.toJSON(),i=M.getGroupConnections(r,n);M.collectGroupInport(i.inConnections,o.def.ports),M.collectGroupOutport(i.outConnections,o.def.ports),M.genParamsFromPorts(o.def.ports,o.def.params),"composite"==n.metadata.component&&_.isEmpty(o.def.composite)&&(o.def.composite=JSON.parse('{"caseSensitive":false,"properties":{},"inports":{},"outports":{},"groups":[],"processes":{},"connections":[]}'),o.def.composite.connections=angular.copy(i.innerConnections),Object.keys(r.processes).forEach(function(e){n.nodes.includes(e)&&(o.def.composite.processes[e]=r.processes[e])})),d.removeGroup(e),n.nodes,n.nodes.forEach(function(e){d.removeNode(e)}),-1==_.findIndex(d.nodes,{id:e})?d.addNode(e,n.metadata.component,o):d.setNodeMetadata(e,o);for(let t=0;t<i.inConnections.length;t++){let n=i.inConnections[t],r=M.getPortHasTargetNodePort(o.def.ports,"in",n.tgt.process,n.tgt.port);d.addEdge(n.src.process,n.src.port,e,r.id)}for(let t=0;t<i.outConnections.length;t++){let n=i.outConnections[t],r=M.getPortHasTargetNodePort(o.def.ports,"out",n.src.process,n.src.port);d.addEdge(e,r.id,n.tgt.process,n.tgt.port)}t.forEach(function(t){t.nodes.push(e)})},getPort:function(e,t){let n=M.getNode(e);if(!n)return null;let o=n.metadata.def.ports;for(let e=0;e<o.length;e++){let n=o[e];if(n.uuid===t)return n}return null},genParamsFromPorts:function(e,t){for(let n=0;n<e.length;n++){let o=e[n];if(o.display&&o.type){let e=M.getNode(o.targetNode);if(e){let r=e.metadata.def.params;for(let e in r){let i=r[e];"in"===o.ioType?i.defInPortUuid===o.targetPort&&(t[e+n]=angular.copy(i),t[e+n].defInPortUuid=o.uuid):i.defOutPortUuid===o.targetPort&&(t[e+n]=angular.copy(i),t[e+n].defOutPortUuid=o.uuid)}}}}},getGroupConnections:function(e,t){let n=[],o=[],r=[],i=[];return Object.keys(e.connections).forEach(function(a){let s=e.connections[a];t.nodes.includes(s.tgt.process)?t.nodes.includes(s.src.process)?r.push(s):n.push(s):t.nodes.includes(s.src.process)?o.push(s):i.push(s)}),angular.copy({inConnections:n,outConnections:o,innerConnections:r,outerConnections:i})},getNode:function(e){return d?d.getNode(e):null},showAllScreenshots:function(){},updateScreenshot:function(e){},getEdge:function(e,t,n,o){return d.getEdge(e,t,n,o)},getNodeScriptEdges:function(e){return _.filter(d.edges,function(t){return(t.from.node==e||t.to.node==e)&&_.has(t,"metadata.script")})},setEdgeMetadata:function(e,t,n,o,r){return d.setEdgeMetadata(e,t,n,o,r)},getPredictConfig:function(){return angular.copy(d.properties.predictConfig)},getCronConfig:function(){return angular.copy(d.properties.cronConfig)},setCronConfig:function(e){d.properties.cronConfig=angular.copy(e)},getDashboardConfig:function(){return angular.copy(d.properties.dashboardConfig)},setDashboardConfig:function(e){d.properties.dashboardConfig=angular.copy(e)},setEdgeScript:function(e,t,n,o){return d.appScripts||(d.appScripts={}),_.set(d,`appScripts.${e}.${t}.${n}`,o),d},setGlobalScript:function(e){return d.appScripts||(d.appScripts={}),d.appScripts.global=e,d},getGraph:function(){return d},getParamsModel:function(e){let t={port:{},control:{}},n=function(e,n){if(!n.controlInstUuid||"undefined"===n.controlInstUuid)return;const o=_.cloneDeep(n);_.unset(o,"controlInstUuid");let r=t.control[n.controlInstUuid]={meta:o};r.value=e,n.defInPortUuid&&(r.inport=n.defInPortUuid),n.defOutPortUuid&&(r.outport=n.defOutPortUuid,r.outportProperty=n.propertyName);for(let e in n)switch(e){case"type":case"defInPortUuid":case"defOutPortUuid":case"controlInstUuid":case"propertyName":break;default:r.meta[e]=n[e]}},o=function(e,n){t.port[n.defInPortUuid]||(t.port[n.defInPortUuid]={});let o=t.port[n.defInPortUuid];"tableName"===n.propertyName&&(o.table=e),"partitionName"===n.propertyName&&(o.partition=e),"modelName"===n.propertyName&&(o.model=e),"dataName"===n.propertyName&&(o.data=e),"visualName"===n.propertyName&&(o.visual=e)},r=function(e,o){t.port[o.defOutPortUuid]||(t.port[o.defOutPortUuid]={});let r=t.port[o.defOutPortUuid];"tableName"===o.propertyName&&(r.table=e),"partitionName"===o.propertyName&&(r.partition=e),"modelName"===o.propertyName&&(r.model=e),"dataName"===o.propertyName&&(r.data=e),"visualName"===o.propertyName&&(r.visual=e),o.defOutPortUuid&&n("",o)};for(let t in e)e[t].defOutPortUuid?r(t,e[t]):e[t].controlInstUuid?n(t,e[t]):e[t].defInPortUuid&&o(t,e[t]);return t},getCustomizeNodeMetadata:function(e,t){let n={},o=function(e){switch(e){case"table":return"tableName";case"partition":return"partitionName";case"model":return"modelName";case"visual":return"visualName";case"data":return"dataName"}};for(let e in t.port){let r=t.port[e];for(let t in r)r[t]&&(0===e.indexOf("in")?n[r[t]]={type:"string",propertyName:o(t),defInPortUuid:e}:n[r[t]]={type:"string",propertyName:o(t),defOutPortUuid:e})}for(let e in t.control)if(t.control[e].value){n[t.control[e].value]={type:"string",controlInstUuid:e};for(let o in t.control[e].meta)n[t.control[e].value][o]=t.control[e].meta[o];t.control[e].inport&&(n[t.control[e].value].defInPortUuid=t.control[e].inport)}else if(t.control[e].outport)for(let o in n)if(n[o].defOutPortUuid===t.control[e].outport&&n[o].propertyName===t.control[e].outportProperty){n[o].controlInstUuid=e;for(let r in t.control[e].meta)n[o][r]=t.control[e].meta[r]}let r=angular.copy(M.getNode(e)).metadata;return delete r.x,delete r.y,delete r.width,delete r.height,delete r.label,r.def.params=n,r},getPositionInGraph:function(e,t){let n=l.offset(),o=l.find(".view").attr("transform"),r=_.toNumber(_.split(_.split(o,",")[0],"(")[1]);return t=t||0,{x:e=((e=e||0)-n.left-45*r-u.state.x)/r,y:t=(t-n.top-45*r-u.state.y)/r}},addNode:function(e,t,n){let o=d.addNode(e,t,n);return M.analyzeGraph(),setTimeout(function(){c.trackEvent(c.STAT_ACTIONS.APP.NODE_ADDED,t,{},{nodeId:e,componentId:t,metadata:n})},0),o},addPublicRemoteNode:function(e,r,c,l){const p=this;let d=i.pop({type:"info",title:"加载中",timeout:0,tapToDismiss:!1});o.getPublic(e).then(function(o){let u=JSON.parse(o.componentInfo.data);const h=p.getPositionInGraph(r,c);u.label=o.componentInfo.name,u.x=h.x,u.y=h.y,u.type=l,u.sublabel=o.componentInfo.name;const f=n.uuid();10002==u.def.type&&(u.apiName=f),M.addNode(f,e,u);const g=t(window.appConfig.nodeCopyDir.source,{"{{userId}}":window.appConfig.publicUserId,"{{componentId}}":e}),m=t(window.appConfig.nodeCopyDir.target,{"{{userId}}":window.appConfig.userId,"{{appId}}":a.id,"{{nodeId}}":f});return s.copy(g,m).then(function(e){},function(e){i.pop("error","数据拷贝失败")}).finally(function(){i.clear(d)}),f},function(e){i.clear(d),_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addRemoteNode:function(e,r,c,p){let d=i.pop({type:"info",title:"加载中",timeout:0,tapToDismiss:!1});o.get(e).then(function(o){let h=JSON.parse(o.componentInfo.data),f=l.offset(),g=l.find(".view").attr("transform"),m=_.toNumber(_.split(_.split(g,",")[0],"(")[1]);c=c||0,r=((r=r||0)-f.left-45*m-u.state.x)/m,c=(c-f.top-45*m-u.state.y)/m,h.label=o.componentInfo.name,h.x=r,h.y=c,h.type=p,h.sublabel=o.componentInfo.name;let v=n.uuid();M.addNode(v,e,h);const y={"{{userId}}":window.appConfig.userId,"{{appId}}":a.id,"{{nodeId}}":v,"{{componentId}}":e},b=t(window.appConfig.nodeCopyDir.source,y),w=t(window.appConfig.nodeCopyDir.target,y);return s.copy(b,w).then(function(e){},function(e){i.pop("error","数据拷贝失败")}).finally(function(){i.clear(d)}),v},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.message),i.clear(d)})},addRemoteDashboardNode:function(e){o.get(e).then(function(e){let t=JSON.parse(e.componentInfo.data).def.dashboardComponentType;x(t)},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addDashboardNode:function(e){if(!e.x||!e.y){const t=u.state.scale,n=Math.floor(9*Math.random()),o=Math.floor(6*Math.random()),r=(90*n+30-u.state.x)/t,i=(90*o+30-u.state.y)/t;e.x=r,e.y=i,e.sublabel=e.label}let t=n.uuid();return M.addNode(t,"dashboard",e),t},addExternalNode:function(e,t,r,a){t=t||0,r=r||0;const s=e.componentId,c=e.label,p=l.offset(),d=l.find(".view").attr("transform"),h=_.toNumber(_.split(_.split(d,",")[0],"(")[1]);t=(t-p.left-45*h-u.state.x)/h,r=(r-p.top-45*h-u.state.y)/h;const f=n.uuid();let g=o.getPublic;"device_component"===a&&(g=o.get),g(s).then(function(n){let o=JSON.parse(n.componentInfo.data),i=n.componentInfo.id;if(o.label=c,o.sublabel=c,o.x=t,o.y=r,o.type=a,o.tags=n.componentInfo.tags,"device_component"===a){o.def.params.param2.value=e.deviceId,o.def.dashboardComponentType="xly-iframe";const t=o.def.dashboardComponentType;x(t,{propName:e.label,url:e.mxgraphUrl})}return M.addNode(f,i,o),f},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addWebCompNode:function(e,t,o,r,i){let a;"__web_input"===e&&(a={uuid:r,apiName:"",icon:"globe",def:{description:{zh_CN:"web input "+i},type:"web-input",theme:"green",docUrl:"",author:"aliyun",params:{__script:{type:"string",value:"",isRequired:!0}},ports:[{uuid:"out1",description:{en_US:"input data",zh_CN:"web input 数据"},display:1,ioType:"out",type:"data"}]},locale:"zh_CN"}),"__web_output"===e&&(a={uuid:r,icon:"globe",def:{icon:"globe",description:{zh_CN:"web output "+i},type:"web-output",theme:"green",docUrl:"",author:"aliyun",params:{},ports:[{uuid:"in1",description:{en_US:"output data",zh_CN:"web output 数据"},display:1,ioType:"in",type:"data"}]},locale:"zh_CN"});let s=l.offset(),c=l.find(".view").attr("transform"),p=_.toNumber(_.split(_.split(c,",")[0],"(")[1]);o=o||0,t=((t=t||0)-s.left-45*p-u.state.x)/p,o=(o-s.top-45*p-u.state.y)/p,a.label=a.def.description.zh_CN,a.sublabel=a.def.description.zh_CN,a.x=t,a.y=o;let d=n.uuid();return M.addNode(d,e,a),d},addCustomNode:function(e,t,o){"string"==typeof t&&(t=JSON.parse(t));let r=angular.copy(t);r.label=e,r.x=u.state.width/2-100,r.y=200,r.type=o;let i=n.uuid();return M.addNode(i,"custom",r),i},pasteNode:function(e){const o=e.component,r=e.id;let c=angular.copy(e.metadata),l=c.x+20,p=c.y+20;c.x=l,c.y=p;let d=n.uuid();M.addNode(d,o,c);const u={"{{userId}}":window.appConfig.userId,"{{appId}}":a.id,"{{nodeId}}":r},h={"{{userId}}":window.appConfig.userId,"{{appId}}":a.id,"{{nodeId}}":d},f=t(window.appConfig.nodeCopyDir.target,u),g=t(window.appConfig.nodeCopyDir.target,h);let m=i.pop({type:"info",title:"加载中",timeout:0,tapToDismiss:!1});return s.copy(f,g).then(function(e){},function(e){i.port("error","数据拷贝失败")}).finally(function(){i.clear(m)}),d},removeNode:function(e,t){if(!t){const t=M.getNode(e),n=_.get(t,"metadata.def.dashboardId");n&&C&&C(n)}d.removeNode(e),setTimeout(function(){c.trackEvent(c.STAT_ACTIONS.APP.NODE_DELETED,e)},0)},removeEdge:function(e,t,n,o){d.removeEdge(e,t,n,o)},getGraphJson:function(){return angular.copy(d.toJSON())},hightEdges:function(e){let t=document.querySelector(".edges"),n=document.querySelector(".edges").childNodes,o=[];for(let t=0;t<n.length;t++)n[t].attributes&&(angular.element(n[t]).removeClass("active"),n[t].getAttribute("id")&&n[t].getAttribute("id").indexOf(e)>-1&&(angular.element(n[t]).addClass("active"),o.push(n[t])));for(let e=0;e<o.length;e++)t.appendChild(o[e]);return n},getDashboardNode:function(e){for(let t=0;t<d.nodes.length;t++)if(_.get(d.nodes[t],"metadata.def.dashboardId")===e)return d.nodes[t]},analyzeGraph:function(e){let t={},n={},o={};d.nodes.forEach(function(e){_.get(e,"metadata.def.ports").forEach(function(r){if(!r.display||!r.type||!r.subType)return;let i=r.type+":"+r.subType;t[e.id+":"+r.uuid]=i,"out"===r.ioType?(n[i]||(n[i]=[]),n[i].push({nodeId:e.id,port:r.uuid})):r.autoReceive&&(o[e.id+":"+r.uuid]={nodeId:e.id,port:r.uuid,type:i})})}),d.edges.forEach(function(e){e.metadata&&e.metadata.auto?(t[e.from.node+":"+e.from.port]!==t[e.to.node+":"+e.to.port]&&d.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),o[e.to.node+":"+e.to.port]||d.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)):o[e.to.node+":"+e.to.port]&&d.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)});for(let e in o){let t=o[e],r=n[t.type];r&&r.forEach(function(e){e.nodeId!==t.nodeId&&d.addEdge(e.nodeId,e.port,t.nodeId,t.port,{auto:1})})}M.changeNode()},addEdge:function(e){let t=d.nodes,n=t.length;if(n<1)return;let o=e||t[Math.floor(Math.random()*n)].id,r=t[Math.floor(Math.random()*n)].id,i="out"+Math.floor(3*Math.random()),a="in"+Math.floor(12*Math.random()),s={route:Math.floor(10*Math.random())};return d.addEdge(o,i,r,a,s)},updateEdges:function(e,t,n,o){const r={in:"to",out:"from"};for(let i=0;i<d.edges.length;i++){const a=d.edges[i][r[e]];if(a.node==t&&a.port==e+n){a.port=o;break}}},getNodeOriginalPosision:function(e,t){let n=l.offset(),o=l.find(".view").attr("transform"),r=_.toNumber(_.split(_.split(o,",")[0],"(")[1]);return t=t||0,{x:e=(e=e||0)*r+u.state.x+45*r+n.left,y:t=t*r+u.state.y+45*r+n.left}},getTheGraphInstance:function(){return u},setNodeSelectionHandler:function(e){g=e},setNodeRectImgDblclickHandler:function(e){m=e},setEdgeSelectionHandler:function(e){v=e},setEdgeIconClickHandler:function(e){y=e},setGroupSelectionHandler:function(e){b=e},setGraphChangeHandler:function(e){w=e},setGraphAddNodeHandler:function(e){x=e},setGraphDeleteNodeHandler:function(e){C=e},setExpandIconClickedHandler:function(e){S=e},showContext:function(e){I=e},getComponentInfo:function(e){return f.getComponentInfo(e)},changeNode:function(e){d.setNodeMetadata(e,{})},changeGraph:function(e){d.setGroupMetadata(e,{})},getRunJson:function(){let e=M.getGraphJson();for(let t in e.processes){let n=e.processes[t];n.metadata={codeName:n.metadata.def.codeName,type:n.metadata.def.type,baseRunner:n.metadata.def.baseRunner,codePath:n.metadata.def.codePath,pyLibPath:n.metadata.def.pyLibPath,params:n.metadata.def.params,ports:n.metadata.def.ports,author:n.metadata.def.author}}return e},getIgnoredNodes:function(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;let n=[];for(let e=0;e<d.nodes.length;e++)t[d.nodes[e].id]||n.push(d.nodes[e].id);return n},getAllUpstreamNodes:function(e){let t=M.getUpstreamNodes(e);for(let e=0;e<t.length;e++)t=t.concat(M.getAllUpstreamNodes(t[e]));let n=[];for(let e=0;e<t.length;e++)n.indexOf(t[e])<0&&n.push(t[e]);return n},getUpstreamNodes:function(e){let t=[];if(!d||!d.edges)return t;for(let n=0;n<d.edges.length;n++){let o=d.edges[n];o.to.node===e&&t.push(o.from.node)}return t},getUpstreamNodeByPort:function(e,t){return d&&d.edges?_.map(_.filter(d.edges,{to:{port:t,node:e}}),"from")[0]:null},getDownstreamNodeByPort:function(e,t){return d&&d.edges?_.map(_.filter(d.edges,{from:{port:t,node:e}}),"to"):null},getDownstreamNodes:function(e){let t=[];if(!d||!d.edges)return t;for(let n=0;n<d.edges.length;n++){let o=d.edges[n];o.from.node===e&&t.push(o.to.node)}return t},getAllDownstreamNodes:function(e){let t=M.getDownstreamNodes(e);for(let e=0;e<t.length;e++)t=t.concat(M.getAllDownstreamNodes(t[e]));let n=[];for(let e=0;e<t.length;e++)n.indexOf(t[e])<0&&n.push(t[e]);return n},load:function(t){let n=e.defer();return d.loadJSON(t,function(){n.resolve(res)}),n.promise},getNodeOutputTypeArr:function(e){let t=[];if(!e)return t;let o=M.getNode(e);if(!o)return t;let r=_.filter(o.metadata.def.ports,{ioType:"out"});for(let e in o.metadata.def.params){let i=o.metadata.def.params[e],a=_.findIndex(t,{portId:i.defOutPortUuid}),s=-1==_.findIndex(r,{uuid:i.defOutPortUuid});if(a>-1||!i.propertyName||"partitionName"===i.propertyName||s)continue;let c={},l="";for(let e=0;e<o.metadata.def.ports.length;e++)if(o.metadata.def.ports[e].uuid==i.defOutPortUuid){c=o.metadata.def.ports[e];const t=o.metadata.def.ports[e].type;"model"!=t&&"data"!=t||"/"!=(l=_.get(i,"value")||n.getUploadNodeDataPath(c.uuid,t)).slice(-1)&&(l+="/")}let p={portId:i.defOutPortUuid,propertyName:i.propertyName,label:_.get(c,"description.zh_CN","")};l&&(p.path=l),_.isEmpty(c.subType)||(p.subType=c.subType),t.push(p)}return t},onValidated:function(e){if(_.isEmpty(d.nodes))return{status:"error",message:"项目中没有节点"};const t=_.filter(d.nodes,function(t){if(e&&t.id!==e)return!1;const n=_.filter(_.values(_.get(t,"metadata.def.params")),function(e){return(e.required||e.isRequired)&&_.isUndefined(e.value)});return!_.isEmpty(n)}),n=_.map(t,function(e){return e.metadata.label});if(!_.isEmpty(t))return{status:"error",message:n.join("、")+" 中的必填参数不能为空！"};if(!e&&_.findIndex(d.edges,"metadata.error")>-1)return{status:"error",message:"请检查项目中的连线！"};const o=_.filter(d.groups,function(e){return"composite"!==e.metadata.component});if(!e&&!_.isEmpty(o)){return{status:"error",message:"请将项目中的复合组件 “"+_.map(o,"metadata.name").join("”、“")+"” 折叠！"}}}};return M}]),angular.module("app").directive("scriptLog",["appDataStoreService",function(e){return{restrict:"EA",link:function(t,n,o){n.on("click","a[data-preview]",function(t){const n=t.target,o=n.getAttribute("data-preview"),r=n.getAttribute("data-subtype"),i=n.parentNode.querySelector(".data-container");switch(r){case"file":e.get(o).then(e=>{i.innerHTML=`文件内容：<br /><pre style="color: #fff; background-color: #272822;">${e}</pre>`});break;default:i.innerHTML=`<pre style="color: #fff; background-color: #272822;">${o}</pre>`}}),t.$watch(function(e){return e.$eval(o.scriptLog)},function(e){n.html(e)})}}}]).factory("scriptService",["$rootScope","appService","nodeService","$state","$stateParams","toaster",function(e,t,n,o,r,i){return{DIRECTION:{IN:"in",OUT:"out"},APP_GLOBAL_SCRIPT_NODEID:"app",APP_GLOBAL_SCRIPT_PORTID:"global",APP_GLOBAL_SCRIPT_KEYWORD:"content",MAX_LOG_LIMIT:100,sockets:{},logs:{},connect:function(e){const t=this,n=window.io(`${location.protocol}//${window.appConfig.predictHost}/appScripts`,{path:`/socket/${e}`});return n.on("connect",function(){n.id,t.logs[e]=[]}),n.on("disconnect",function(){n.id}),n.on("scriptParseError",function({err:n}){t.logs[e].push({type:"error",appId:e,err:n.message,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),n.on("scriptProcessed",function({node:n,port:o,when:r,before:i,after:a}){t.logs[e].push({type:"port",node:n,port:o,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,timestamp:moment().format("YYYY-MM-DD hh:mm:ss"),before:i,after:a})}),n.on("scriptRuntimeError",function({node:n,port:o,when:r,err:i}){t.logs[e].push({type:"error",node:n,port:o,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,timestamp:moment().format("YYYY-MM-DD hh:mm:ss"),err:i})}),n.on("globalLogging",function({userId:e,appId:n,content:o}){t.logs[n].push({type:"app",appId:n,userId:e,msg:`${o}\n\n`,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),n.on("scriptLogging",function({node:n,port:o,when:r,content:i}){t.logs[e].push({type:"app",node:n,port:o,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,msg:`${i}\n\n`,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),this.sockets[e]=n,n},disconnect:function(e){this.sockets[e]&&(this.sockets[e].disconnect(),delete this.sockets[e])},getAppLogs:function(e,t=(e=>e)){const o=[];return this.logs[e]||(this.logs[e]=[]),this.logs[e].sort((e,t)=>moment(e.timestamp).isAfter(moment(t.timestamp))).filter(t).forEach(({type:e,before:t,after:r,timestamp:i,err:a,msg:s,node:c,port:l})=>{switch(e){case"port":const p=n.getPort(c,l);o.push(`<div>${i} 输入 <a data-preview="${t}" data-subtype="${p.subType}" href="javascript:void(0)">${t}</a><div class="data-container"></div></div>`),o.push(`<div>${i} 输出 <a data-preview="${r}" data-subtype="${p.subType}" href="javascript:void(0)">${r}</a><div class="data-container"></div></div>`);break;case"error":o.push(`<div>${i} ${a}</div>`);break;case"app":o.push(`<div>${i} ${s}</div>`);break;default:return}}),o.slice(-this.MAX_LOG_LIMIT).join("")},getGlobalLogs:function(e){return this.getAppLogs(e,e=>"app"===e.type||"error"===e.type)},getLogsByEdge:function(e,{from:t,to:n}){return this.getAppLogs(e,({type:e,node:o,port:r})=>"error"===e||"port"===e&&(t.node===o&&t.port===r||n.node===o&&n.port===r))},getLogsByPort:function(e,t,n){return this.getAppLogs(e,({type:e,node:o,port:r})=>"error"===e||"port"===e&&t===o&&n===r)},getPortLogs:function(e){return this.getAppLogs(e,e=>"port"===e.type)},getErrorLogs:function(e){return this.getAppLogs(e,e=>"error"===e.type)},cleanOldScripts:function(e){delete e.properties.appScripts,delete e.properties.appScriptString,e.edges.forEach(function(e){delete e.metadata.script})},doSaveScript:function(n,o){const r=this.packScripts(o);_.set(o,"properties.packedScripts",r),this.cleanOldScripts(o),t.saveScripts(n,o).then(function(){i.pop("success","脚本数据保存成功"),setTimeout(function(){e.sockets&&e.sockets[n]&&e.sockets[n].emit("scriptsChanged",o.properties.packedScripts)},2e3)},function(e){i.pop("error","脚本数据保存失败："+e.msg)})},getOldEdgeScripts:function(e){if(!e)return"";if(e.content)return e.content;const{afterLeave:t,beforeEnter:n}=e;return`${t}\n${n}`},getFunctionBlock:function(e){switch(e){case"afterLeave":case"beforeEnter":return`\n${e}((data, $) => {});\n`;case"initializer":return`\n${e}(($) => {});\n`;case"onSystemMessage":return`\n${e}((data) => {});\n`;default:return"() => {};\n"}},getKeyword:function(e=""){return{in:"beforeEnter",out:"afterLeave",beforeEnter:"beforeEnter",afterLeave:"afterLeave",content:"content"}[e]||""},getAppGlobalScriptKey:function(){return`${this.APP_GLOBAL_SCRIPT_NODEID}.${this.APP_GLOBAL_SCRIPT_PORTID}.${this.APP_GLOBAL_SCRIPT_KEYWORD}`},getSupportedFunctions:function(){return["afterLeave","beforeEnter","onSystemMessage","initializer"]},getScriptKey:function(e,t,n){return`properties.scripts.${e}.${t}.${this.getKeyword(n)}`},getScriptsByNode:function(e,t){const o=n.getGraph();return _.get(o,`properties.scripts.${e.node}.${e.port}.${this.getKeyword(t)}`,"")},idNodeDeletable:function(e){const t=_.get(n.getGraph(),`properties.scripts.${e}`,{});return _.isEmpty(t)},isEdgeDeletable:function(e){const{from:t,to:o}=e,r=n.getGraph(),i=_.get(r,`properties.scripts.${t.node}.${t.port}`,{}),a=_.get(r,`properties.scripts.${o.node}.${o.port}`,{});return!_.isEmpty(i)||!_.isEmpty(a)},packBlock:function(e){return"\n(function() {\n"+e+"\n})();\n"},packFunction:function(e,t,n,o){o=o||"";const r=new RegExp(`${e}\\(`,"g");return o.replace(r,`${e}('${t}', '${n}', `)},packScripts:function(e){const t=this;let o="";const r=_.get(e,"properties.scripts",{}),i=this.getAppGlobalScriptKey();Object.keys(r).forEach(function(e){Object.keys(r[e]).forEach(function(a){Object.keys(r[e][a]).forEach(function(s){if(`${e}.${a}.${s}`===i)return;const c=n.getNode(e),l=`// <${_.get(c,"metadata.label","")}> - <${a}> - <${s}>\n`;o+=t.packBlock(`${l}${t.packFunction(s,e,a,r[e][a][s])}`)})})});const a=`// 全局脚本\n${_.get(r,i,"")}\n`;return o=this.packBlock(`${a}${o}`)},removeScriptByEdge:function(e){const{from:t,to:o}=e,r=n.getGraph();_.get(r,`properties.scripts.${t.node}.${t.port}`,null)&&delete r.properties.scripts[t.node][t.port],_.get(r,`properties.scripts.${o.node}.${o.port}`,null)&&delete r.properties.scripts[o.node][o.port]},removeScriptByNode:function(e){const t=this,o=n.getGraph();delete _.get(o,"properties.scripts",{})[e];const r=_.filter(o.edges,function(t){return t.from.node===e||t.to.node===e});r&&r.forEach(function(e){t.removeScriptByEdge(e)})},setScript:function(e,t,o,r){return _.set(n.getGraph(),this.getScriptKey(e,t,o),r)},saveEdgeScripts:function(e,t,o){const r=n.getGraph();_.set(r,this.getScriptKey(e.node,e.port,t),o),this.saveAppScripts()},saveAppScripts:function(){const e=this,a=r.id,s=n.getGraph();o.includes("app.predict.edit")?e.doSaveScript(a,s):t.setPermission(a).then(function(t){e.doSaveScript(a,s)},function(e){i.pop("error","请求失败: "+e.msg)})}}}]),angular.module("app").directive("nodeDebugLog",["instantNodeLogService",function(e){return{strict:"EA",template:'<div class="node-debug-log">\n                    <input type="checkbox" class="sp-checkbox" ng-checked="isEnabled" style="vertical-align: middle;margin: 0;" ng-click="toggleNodeLog()">\n                    <span style="color: #b3b3b3;">开启</span>\n                    <div class="json-viewer"><textarea class="textarea" ng-model="logs"></textarea></div>\n                   </textarea></div>',scope:{nodeId:"="},link:function(t,n,o,r){const{nodeId:i}=t;t.isEnabled=e.getNodeLogStatus(i);let a=null;const s=function(){t.logs=e.getNodeLog(i).map(function(e){return e.timestamp+"\n"+e.type+" : "+e.port+"\n数据："+e.data}).join("\n"),a=setTimeout(s,2e3)};t.toggleNodeLog=function(){t.isEnabled=!t.isEnabled,t.isEnabled?(e.enableNodeLog(i),s()):(e.disableNodeLog(i),t.logs="",a&&(clearTimeout(a),a=null))},t.isEnabled&&s()}}}]).factory("instantNodeLogService",["$rootScope","appService","nodeService","$state","$stateParams","toaster","uuidService",function(e,t,n,o,r,i,a){return{MAP_DIRECTION_LABEL:{source:"输出",target:"输入"},nodeLogs:{},isAnimationEnabled:!1,isNodeDataLogEnabled:{},edgeAnimator:null,nodeDataLogSocket:null,maxLength:100,appendLog:function(e,t){this.nodeLogs[e.node_id]||(this.nodeLogs[e.node_id]=[]),this.nodeLogs[e.node_id].length>this.maxLength&&this.nodeLogs[e.node_id].shift();let n={data:"string"==typeof e.data?e.data:JSON.stringify(e.data),type:this.MAP_DIRECTION_LABEL[t],port:e.port,timestamp:moment(new Date(e.timestamp)).format("YYYY-MM-DD hh:mm:ss"),node_id:e.node_id,htime:e.timestamp,key:a.v4()};this.nodeLogs[e.node_id].push(n)},connect:function(){const t=this,o=this.nodeDataLogSocket=window.io(`${location.protocol}//${window.appConfig.predictHost}/pstream`,{path:`/socket/${r.id}/pstream`});return o.on("data.replay",function(e){t.packNodeLog(e)}),o.on("error",e=>{console.error("nodeDataLogSocket error:",e),this.connect()}),o.on("listen.replay.status",({success:e,data:n})=>{e&&(t.isAnimationEnabled=n)}),o.on("connect",function(){o.emit("control.replay",{start:!0}),n.getGraph()?t.initAnimator():e.$on("editor.ready",t.initAnimator.bind(t))}),o.on("error",e=>{console.error("nodeDataLogSocket error:",e),this.connect()}),o},disconnect:function(){this.nodeDataLogSocket&&(this.nodeDataLogSocket.disconnect(),this.nodeDataLogSocket=null)},toggleAnimation:function(e){this.isAnimationEnabled=e||!_.isEmpty(this.isNodeDataLogEnabled),this.nodeDataLogSocket&&this.nodeDataLogSocket.emit("control.replay",{start:this.isAnimationEnabled})},enableNodeLog:function(e){delete this.nodeLogs[e],this.nodeDataLogSocket&&(this.isNodeDataLogEnabled[e]=!0,this.toggleAnimation(!0))},disableNodeLog:function(e){delete this.isNodeDataLogEnabled[e],delete this.nodeLogs[e],this.toggleAnimation(!1)},getNodeLog:function(e){return this.nodeLogs[e]&&this.isNodeDataLogEnabled[e]?this.nodeLogs[e]:[]},getNodeLogStatus:function(e){return this.isNodeDataLogEnabled[e]},initAnimator:function(){this.nodeDataLogSocket&&this.nodeDataLogSocket.emit("query.replay.status")},packNodeLog:function(e){const t=this;for(const n in e)if(e.hasOwnProperty(n)){const{messages:o=[]}=e[n];o.forEach(({source:e,target:n})=>{t.appendLog(e,"source"),t.appendLog(n,"target")})}}}}]),angular.module("app").factory("tableService",["$rootScope","format","$q","remoteService","nodeService","appDataStoreService",function(e,t,n,o,r,i){let a={getUpstreamTableName:function(o,i,s){let c,l,p=n.defer(),d=r.getNode(i);for(let e in d.metadata.def.params){let t=d.metadata.def.params[e];if(t.controlInstUuid===s){c=t.defInPortUuid||"in1",l=t;break}}if(c){let n=r.getUpstreamNodeByPort(i,c);if(n){let r=n.node,i=n.port;const s={"{{userId}}":e.appConfig.userId,"{{appId}}":o,"{{nodeId}}":r};a.getNodeTableName(o,r,i).then(function(e){p.resolve({propertyName:e.propertyName,value:t(e.value,s),controlObj:l})},function(e){p.reject("未获取到上游节点输出表名")})}else p.reject("未找到上游节点")}else p.reject("未获取到输入桩信息");return p.promise},getNodeTableName:function(e,t,i){let a=n.defer(),s=r.getNode(t),c=!1;for(let e=0;e<s.metadata.def.ports.length;e++){let t=s.metadata.def.ports[e];if("in"===t.ioType&&0!==t.display){c=!0;break}}let l="xuelang"===s.metadata.def.author&&"save"===s.metadata.def.codeName;if(!c||l)for(let e in s.metadata.def.params){let t=s.metadata.def.params[e];t.defOutPortUuid!==i||"tableName"!==t.propertyName&&"dataName"!==t.propertyName||a.resolve(t)}else{let n=_.find(_.values(s.metadata.def.params),{defOutPortUuid:i});if(n)if(_.isEmpty(n.value))if("tableName"==n.propertyName)o.get("/table/name/"+e+"/"+t+"/"+i).then(function(e){a.resolve({propertyName:"tableName",value:e.table})},function(e){a.reject(e)});else if("dataName"==n.propertyName){let o="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+i+"/data/";a.resolve({propertyName:n.propertyName,value:o})}else a.reject("类型不匹配");else a.resolve({propertyName:n.propertyName,value:n.value})}return a.promise},getTableMeta:function(e,t){let r=n.defer();return"dataName"==t?i.get(e+"data.csv").then(function(e){let t=_.slice(_.split(e.split(/\r\n|\n/)[0],","),1);r.resolve(t)},function(e){r.reject(e)}):o.post("/table/meta/"+e,{}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},listTable:function(e){let t=n.defer();return o.post("/table/list/"+e,{}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},existTable:function(e){let t=n.defer();return o.post("/table/exist/"+e,{}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}};return a}]),angular.module("app").factory("dashboardAssetService",["appDataStoreService","userService","$q","$rootScope",function(e,t,n,o){return{nextMarker:null,filter:"",maxKeys:10,listImages:function(){const t=this;let o=n.defer();const r=`studio/${window.appConfig.userId}/dashboard/assets/`;return e.list(r,this.nextMarker,this.maxKeys).then(function(e){const n=e.data;t.nextMarker=n.NextMarker;let r=n.Contents.sort((e,t)=>moment(e.LastModified).isBefore(moment(t.LastModified))?1:-1).map(e=>({type:"image",key:e.Key,name:e.Key.slice(e.Key.lastIndexOf("/")+1),src:`/oss_public/${e.Key}`}));t.filter&&(r=r.filter(function(e){return e.name.indexOf(t.filter.trim())>-1})),o.resolve(r.map(e=>_.assign(e)))},function(e){o.reject(e)}),o.promise},reset:function(){this.nextMarker=null,this.filter="",this.maxKeys=10},search:function(e){return this.filter=e||"",this.nextMarker=null,this.maxKeys=e?1e3:10,this.listImages()},uploadImage:function(t){let o=n.defer(),r=t.name||"",i=`${(new Date).getTime()}_${r}`;const a=`studio/${window.appConfig.userId}/dashboard/assets/${i}`;return e.upload(a,t,function(){},function(e){o.reject(e)},function(n){const r={name:t.name,key:a,src:`/oss_public/${a}`};"oss"===window.appConfig.ossType?e.putObjectAcl(window.appConfig.oss.bucket,a,"public-read").then(()=>{o.resolve(r)},e=>{console.warn("set public failed",e),o.reject(e)}):o.resolve(r)}),o.promise},deleteImage:function(t){let o=n.defer();return t.key?e.remove(t.key).then(function(e){o.resolve(t)},function(e){o.reject(e)}):o.resolve(t),o.promise}}}]),angular.module("app").factory("statisticsService",["remoteService","toaster","$q",function(e,t,n){const o={UNDEFINED:"undefined",SYSTEM:{LOGIN:"login",LOGOUT:"logout",ERROR:"error"},APP:{CREATE:"appCreated",COPY:"appDuplicated",DUPLICATE_FROM_TEMPLATE:"appDuplicatedFromTemplate",IMPORT:"appImported",EXPORT:"appExported",SHARE:"appShared",DELETE:"appDeleted",RUN:"appDeployed",STOP:"appReleased",ERROR:"error",RUN_CRON:"runCron",STOP_CRON:"stopCron",EXPORT_MODEL:"modelExported",NODE_ADDED:"appNodeAdded",NODE_DELETED:"appNodeDeleted",NODE_UPDATED:"appNodeUpdated"},COMPONENT:{CREATE:"componentCreated",IMPORT:"componentImported",EXPORT:"componentExported",SHARE:"componentShared",COPY:"componentDuplicated",DEL:"componentDeleted",EDIT_PARAM:"componentUpdated"}},r={login:function({objectId:e,oldState:t,newState:n}){return{event:"登录",objectId:e,oldState:t,newState:n}},logout:function({objectId:e,oldState:t,newState:n}){return{event:"登出",objectId:e,oldState:t,newState:n}},error:function({objectId:e,oldState:t,newState:n}){return{event:"发生错误",objectId:e,oldState:t,newState:n}},appCreated:function({objectId:e,oldState:t,newState:n}){return{event:"新建项目",objectId:e,oldState:t,newState:n}},appDuplicated:function({objectId:e,oldState:t,newState:n}){return{event:"复制项目",objectId:e,oldState:t,newState:n}},appDuplicatedFromTemplate:function({objectId:e,oldState:t,newState:n}){return{event:"从模板创建项目",objectId:e,oldState:t,newState:n}},appImported:function({objectId:e,oldState:t,newState:n}){return{event:"导入项目",objectId:e,oldState:t,newState:n}},appExported:function({objectId:e,oldState:t,newState:n}){return{event:"导出项目",objectId:e,oldState:t,newState:n}},appShared:function({objectId:e,oldState:t,newState:n}){return{event:"分享项目",objectId:e,oldState:t,newState:n}},appDeleted:function({objectId:e,oldState:t,newState:n}){return{event:"删除项目",objectId:e,oldState:t,newState:n}},appDeployed:function({objectId:e,oldState:t,newState:n}){return{event:"部署项目",objectId:e,oldState:t,newState:n}},appReleased:function({objectId:e,oldState:t,newState:n}){return{event:"释放项目",objectId:e,oldState:t,newState:n}},runCron:function({objectId:e,oldState:t,newState:n}){return{event:"运行定时任务",objectId:e,oldState:t,newState:n}},stopCron:function({objectId:e,oldState:t,newState:n}){return{event:"停止定时任务",objectId:e,oldState:t,newState:n}},modelExported:function({objectId:e,oldState:t,newState:n}){return{event:"导出模型",objectId:e,oldState:t,newState:n}},appNodeAdded:function({objectId:e,oldState:t,newState:n}){return{event:"向项目中拖入新组件",objectId:e,oldState:t,newState:n}},appNodeDeleted:function({objectId:e,oldState:t,newState:n}){return{event:"删除项目中的组件",objectId:e,oldState:t,newState:n}},appNodeUpdated:function({objectId:e,oldState:t,newState:n}){return{event:"更新项目中的组件",objectId:e,oldState:t,newState:n}},componentCreated:function({objectId:e,oldState:t,newState:n}){return{event:"新建组件",objectId:e,oldState:t,newState:n}},componentImported:function({objectId:e,oldState:t,newState:n}){return{event:"导入组件",objectId:e,oldState:t,newState:n}},componentExported:function({objectId:e,oldState:t,newState:n}){return{event:"导出组件",objectId:e,oldState:t,newState:n}},componentShared:function({objectId:e,oldState:t,newState:n}){return{event:"分享组件",objectId:e,oldState:t,newState:n}},componentDuplicated:function({objectId:e,oldState:t,newState:n}){return{event:"复制组件",objectId:e,oldState:t,newState:n}},componentDeleted:function({objectId:e,oldState:t,newState:n}){return{event:"删除组件",objectId:e,oldState:t,newState:n}},componentUpdated:function({objectId:e,oldState:t,newState:n}){return{event:"修改组件",objectId:e,oldState:t,newState:n}}},i={},a={page:1,size:50};return{STAT_ACTIONS:o,getLogs:function(){const t=n.defer();return e.post("/api/v1/audit/events/list",{filter:i,pagination:a}).then(function(e){const{success:n=!1,items:o=[]}=e,i=[];n&&(o.forEach(function(e){r[e.event]&&i.push(r[e.event](e))}),t.resolve(i))},function(e){t.reject(e)}),t.promise},setPagination:function(e){return Object.assign(a,e),this.getLogs()},setFilter:function(e){return Object.assign(i,e),this.getLogs()},trackEvent:function(t=o.UNDEFINED,n,r={},i={}){window.appConfig.auditEnable&&e.post("/api/v1/audit/events",{event:t,objectId:n,oldState:r,newState:i}).then(function(e){},function(e){console.error("error in recording",t,e)})},trackLoginEvent:function(){this.trackEvent(o.SYSTEM.LOGIN,void 0,{},appConfig)},trackLogoutEvent:function(){this.trackEvent(o.SYSTEM.LOGOUT,void 0,{},appConfig)},trackErrorEvent:function(e){this.trackEvent(o.SYSTEM.ERROR,appConfig.appId||appConfig.userId,{},{appConfig:appConfig,err:e})}}}]),angular.module("app").factory("uiService",["applyFn",function(e){let t=function(t,n){let o=angular.element(".sp-app-bottom");o&&e(function(){o.scope().toggleTab(t,n),o=null})};return{toggleStatusbarLog:function(e){t(e,"log")},toggleStatusbarData:function(e){t(e,"data")},toggleStatusbarAnalysis:function(e){t(e,"analysis")}}}]),angular.module("app").factory("appDataStoreService",["$q","remoteService","ossService","localStorageService","fileServerService","toaster",function(e,t,n,o,r,i){let a=window.appConfig.oss.bucket,s=window.appConfig.appDataStoreType,c={head:function(e){return n.headObject(a,e)},get:function(e,t){return n.getObject(a,e,null,t)},list:function(e,n,o=1e3){return t.post("/oss/object/list",{Bucket:a,Key:e,Delimiter:"/",Marker:n,MaxKeys:o})},putObjectAcl:function(e,t,o){return n.putObjectAcl(e,t,o)},url:function(e){return t.post("/oss/object/get",{Bucket:a,Key:e})},upload:function(e,o,r,s,c){return t.post("/oss/object/check",{Bucket:a,Key:e,type:"put"}).then(function(t){if(t.success)return n.upload(e,o,r,s,c)},function(e){i.pop("error","上传失败："+e.msg)})},remove:function(e){function t(e){return n.deleteObject(a,e)}return c.head(e).then(function(){return t(e)},function(){return function e(n,o){return c.list(n,o).then(function(o){if(o.success){let r=o.data.NextMarker?[e(n,o.data.NextMarker)]:[],i=_.map(o.data.Contents,function(e){return t(e.Key)}),a=_.map(o.data.CommonPrefixes,function(t){return e(t.Prefix)});return r.concat(i,a)}})}(e)})},copy:function(e,n){return t.post("/oss/object/copyDir",{Bucket:a,Key:e,targetKey:n})},sync:function(t,n){return console.debug("Nothing to sync (appDataStoreType is oss)"),e.resolve()}},l={oss:c,minio:c,local:{head:function(e){return o.head(e)},get:function(e){return o.get(e)},list:function(e,t){return o.list(e,t)},url:function(e){return o.url(e)},upload:function(e,t,n,r,i){return o.upload(e,t,n,r,i)},remove:function(e){return o.remove(e)},sync:function(e,t){return new Promise(function(n,r){o.sync(e,t).then(function(e){n(e)}).catch(function(e){n()})})}},fileServer:{head:function(e){return r.head(e)},get:function(e){return r.get(e)},list:function(e,t){return r.list(e,t)},url:function(e){return r.url(e)},upload:function(e,t,n,o,i){return r.upload(e,t,n,o,i)},remove:function(e){return r.remove(e)},sync:function(e,t){return new Promise(function(n,o){r.sync(e,t).then(function(e){n(e)}).catch(function(e){n()})})}}}[s];if(!l)throw Error("Unknown App Data Store Type: "+s);return window.appDataStore=l,l}]),angular.module("app").factory("localStorageService",["$q","$http","remoteService",function(e,t,n){return{url:function(t){return e.resolve({success:!0,data:"/local/"+t})},head:function(e){return n.head("/local/"+e).then(function(e){return e.ContentType=e.headers("Content-Type"),e.ContentLength=e.headers("Content-Length"),e})},get:function(e){return t.get("/local/"+e).then(function(e){return e.data})},list:function(e){return n.post("/local/list",{Key:e})},upload:function(e,t,o,r,i){return n.post("/local/upload",{Key:e,file:t.path}).then(function(e){return i(e),e},function(e){throw r(e),e})},remove:function(e){return n.post("/local/remove",{Key:e})},sync:function(e,t){return n.post("/local/sync",{key:e,action:t})}}}]),angular.module("app").factory("fileServerService",["$q","$http","localStorageService",function(e,t,n){return{url:n.url,head:n.head,get:n.get,list:n.list,upload:function(n,o,r,i,a){let s=e.defer();return t({method:"POST",url:"/local/upload",headers:{"Content-Type":void 0},data:{key:n,files:o},transformRequest:function(e,t){return Object.keys(e).reduce(function(t,n){return t.append(n,e[n]),t},new FormData)},uploadEventHandlers:{progress:r}}).then(function(e){a(e),s.resolve(e)},function(e){i(e),s.reject(e)}),s.promise},remove:n.remove,sync:n.sync}}]);