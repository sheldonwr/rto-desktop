"use strict";var app;!function(){var e=function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&t[o]&&(e[o]=t[o])};function t(t){if(t&&(this._config={chunkSize:1048576},!(this._config.chunkSize&&this._config.chunkSize<102400)&&(e(this._config,t),(this._config.aliyunCredential||this._config.stsToken)&&this._config.endpoint))){var o=window.ALY;this._config.stsToken?this.oss=new o.OSS({accessKeyId:this._config.stsToken.Credentials.AccessKeyId,secretAccessKey:this._config.stsToken.Credentials.AccessKeySecret,securityToken:this._config.stsToken.Credentials.SecurityToken,endpoint:this._config.endpoint,apiVersion:"2013-10-15"}):this.oss=new o.OSS({accessKeyId:this._config.aliyunCredential.accessKeyId,secretAccessKey:this._config.aliyunCredential.secretAccessKey,endpoint:this._config.endpoint,apiVersion:"2013-10-15"});var n=this._config.endpoint.split("://");n.length<2||(this._config.endpoint={protocol:n[0],host:n[1]})}}t.prototype.upload=function(t){if(t)if(t.file){var o=t.file;if(t.key){t.key.replace(new RegExp("^/"),"");var n=this;!function(e){var r={chunksHash:{},chunks:[]},i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=n._config.chunkSize,s=Math.ceil(o.size/a),c=0,p=function(t){r.chunks[c]=t.target.result,++c<s?d():(r.file_size=o.size,e(null,r))},l=function(){console.error("读取文件失败"),"function"==typeof t.onerror&&t.onerror("读取文件失败")};function d(){var e=new FileReader;e.onload=p,e.onerror=l;var t=c*a,n=t+a>=o.size?o.size:t+a,r=i.call(o,t,n);e.readAsArrayBuffer(r)}d()}(function(r,i){var a=function(e,o){e?"function"==typeof t.onerror&&t.onerror(e):"function"==typeof t.oncomplete&&t.oncomplete(o)};1==i.chunks.length?function(r,i){var a={Bucket:n._config.bucket,Key:t.key,Body:r.chunks[0],ContentType:o.type||""};e(a,t.headers),n.oss.putObject(a,i).on("httpUploadProgress",function(e){"function"==typeof t.onprogress&&t.onprogress({loaded:e.loaded,total:o.size})})}(i,a):function(r,i){var a,s,c=t.maxRetry||3,p=0,l=-1,d=0,u={Parts:[]},f=function(e){if(!(e>=r.chunks.length)){l<e&&(l=e),++d<n._config.concurrency&&e<r.chunks.length-1&&f(e+1);var s={Body:r.chunks[e],Bucket:n._config.bucket,Key:t.key,PartNumber:String(e+1),UploadId:a},m=1,g=function(){u.Parts[e]={PartNumber:e+1,loaded:0},n.oss.uploadPart(s,function(t,o){t?m>c?i(t):(u.Parts[e].loaded=0,m++,g()):(u.Parts[e].ETag=o.ETag,u.Parts[e].loaded=s.Body.byteLength,d--,++p==r.chunks.length?h():f(l+1))}).on("httpUploadProgress",function(n){u.Parts[e].loaded=n.loaded;var r=0;for(var i in u.Parts)r+=u.Parts[i].loaded;"function"==typeof t.onprogress&&t.onprogress({loaded:r,total:o.size})})};g()}},h=function(){for(var e in u.Parts)delete u.Parts[e].loaded;var o={Bucket:n._config.bucket,Key:t.key,CompleteMultipartUpload:u,UploadId:a};n.oss.completeMultipartUpload(o,i)};s={Bucket:n._config.bucket,Key:t.key,ContentType:o.type||""},e(s,t.headers),n.oss.createMultipartUpload(s,function(e,t){e?i(e):(a=t.UploadId,f(0))})}(i,a)})}else"function"==typeof t.onerror&&t.onerror("需要 key")}else"function"==typeof t.onerror&&t.onerror("需要 file");else"function"==typeof t.onerror&&t.onerror("需要 options")},window.OssUpload=t}(),function(){var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){switch(t.which){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return!!(t.metaKey||t.ctrlKey||t.altKey)},isFunctionKey:function(e){return(e=e.which?e.which:e)>=112&&e<=123},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)},toSeparator:function(t){var o={ENTER:"\n",TAB:"\t",SPACE:" "}[t];return o||(e[t]?void 0:t)}};function t(e){return angular.isUndefined(e)||null===e}void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),void 0===angular.element.prototype.closest&&(angular.element.prototype.closest=function(e){for(var t=this[0],o=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(o.bind(t)(e))return t;t=t.parentElement}return!1});var o=0,n=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,skipFocusser:!1,dropdownPosition:"auto",removeSelected:!0,resetSearchInput:!1,generateId:function(){return o++},appendToBody:!1,spinnerEnabled:!1,spinnerClass:"glyphicon glyphicon-refresh ui-select-spin",backspaceReset:!0}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments).message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(t)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,o,n,r){r(e,function(e){t.append(e)})}}}).filter("highlight",function(){return function(e,t){return t&&e?(""+e).replace(new RegExp((""+t).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"gi"),'<span class="ui-select-highlight">$&</span>'):e}}).factory("uisOffset",["$document","$window",function(e,t){return function(o){var n=o[0].getBoundingClientRect();return{width:n.width||o.prop("offsetWidth"),height:n.height||o.prop("offsetHeight"),top:n.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:n.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);n.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile","$window",function(e,t,o,n,r){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){return t.addClass("ui-select-choices"),(t.parent().attr("theme")||e.theme)+"/choices.tpl.html"},compile:function(n,i){if(!i.repeat)throw o("repeat","Expected 'repeat' expression.");var a=i.groupBy,s=i.groupFilter;if(a){var c=n.querySelectorAll(".ui-select-choices-group");if(1!==c.length)throw o("rows","Expected 1 .ui-select-choices-group but got '{0}'.",c.length);c.attr("ng-repeat",t.getGroupNgRepeatExpression())}var p=t.parse(i.repeat),l=n.querySelectorAll(".ui-select-choices-row");if(1!==l.length)throw o("rows","Expected 1 .ui-select-choices-row but got '{0}'.",l.length);l.attr("ng-repeat",p.repeatExpression(a)).attr("ng-if","$select.open");var d=n.querySelectorAll(".ui-select-choices-row-inner");if(1!==d.length)throw o("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",d.length);return d.attr("uis-transclude-append",""),(r.document.addEventListener?l:d).attr("ng-click","$select.select("+p.itemName+",$select.skipFocusser,$event)"),function(t,o,r,i){i.parseRepeatAttr(r.repeat,a,s),i.disableChoiceExpression=r.uiDisableChoice,i.onHighlightCallback=r.onHighlight,i.minimumInputLength=parseInt(r.minimumInputLength)||0,i.dropdownPosition=r.position?r.position.toLowerCase():e.dropdownPosition,t.$watch("$select.search",function(e){e&&!i.open&&i.multiple&&i.activate(!1,!0),i.activeIndex=i.tagging.isActivated?-1:0,!r.minimumInputLength||i.search.length>=r.minimumInputLength?i.refresh(r.refresh):i.items=[]}),r.$observe("refreshDelay",function(){var o=t.$eval(r.refreshDelay);i.refreshDelay=void 0!==o?o:e.refreshDelay}),t.$watch("$select.open",function(e){e?(n.attr("role","listbox"),i.refresh(r.refresh)):o.removeAttr("role")})}}}}]),n.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","$$uisDebounce","uisRepeatParser","uiSelectMinErr","uiSelectConfig","$parse","$injector","$window",function(o,n,r,i,a,s,c,p,l,d,u){var f,h=this,m="";if(h.placeholder=p.placeholder,h.searchEnabled=p.searchEnabled,h.sortable=p.sortable,h.refreshDelay=p.refreshDelay,h.paste=p.paste,h.resetSearchInput=p.resetSearchInput,h.refreshing=!1,h.spinnerEnabled=p.spinnerEnabled,h.spinnerClass=p.spinnerClass,h.removeSelected=p.removeSelected,h.closeOnSelect=!0,h.skipFocusser=!1,h.search=m,h.activeIndex=0,h.items=[],h.open=!1,h.focus=!1,h.disabled=!1,h.selected=void 0,h.dropdownPosition="auto",h.focusser=void 0,h.multiple=void 0,h.disableChoiceExpression=void 0,h.tagging={isActivated:!1,fct:void 0},h.taggingTokens={isActivated:!1,tokens:void 0},h.lockChoiceExpression=void 0,h.clickTriggeredSelect=!1,h.$filter=i,h.$element=n,h.$animate=function(){try{return d.get("$animate")}catch(e){return null}}(),h.searchInput=n.querySelectorAll("input.ui-select-search"),1!==h.searchInput.length)throw c("searchInput","Expected 1 input.ui-select-search but got '{0}'.",h.searchInput.length);function g(){h.resetSearchInput&&(h.search=m,h.selected&&h.items.length&&!h.multiple&&(h.activeIndex=function(e,t,o){if(e.findIndex)return e.findIndex(t,o);for(var n,r=Object(e),i=r.length>>>0,a=0;a<i;a++)if(n=r[a],t.call(o,n,a,r))return a;return-1}(h.items,function(e){return angular.equals(this,e)},h.selected)))}h.isEmpty=function(){return t(h.selected)||""===h.selected||h.multiple&&0===h.selected.length},h.activate=function(e,t){if(h.disabled||h.open)h.open&&!h.searchEnabled&&h.close();else{t||g(),o.$broadcast("uis:activate"),h.open=!0,h.activeIndex=h.activeIndex>=h.items.length?0:h.activeIndex,-1===h.activeIndex&&!1!==h.taggingLabel&&(h.activeIndex=0);var i=n.querySelectorAll(".ui-select-choices-content"),a=n.querySelectorAll(".ui-select-search");if(h.$animate&&h.$animate.on&&h.$animate.enabled(i[0])){var s=function(t,o){"start"===o&&0===h.items.length?(h.$animate.off("removeClass",a[0],s),r(function(){h.focusSearchInput(e)})):"close"===o&&(h.$animate.off("enter",i[0],s),r(function(){h.focusSearchInput(e)}))};h.items.length>0?h.$animate.on("enter",i[0],s):h.$animate.on("removeClass",a[0],s)}else r(function(){h.focusSearchInput(e),!h.tagging.isActivated&&h.items.length>1&&S()})}},h.focusSearchInput=function(e){h.search=e||h.search,h.searchInput[0].focus()},h.findGroupByName=function(e){return h.groups&&h.groups.filter(function(t){return t.name===e})[0]},h.parseRepeatAttr=function(e,t,n){h.setItemsFn=t?function(e){var r=o.$eval(t);if(h.groups=[],angular.forEach(e,function(e){var t=angular.isFunction(r)?r(e):e[r],o=h.findGroupByName(t);o?o.items.push(e):h.groups.push({name:t,items:[e]})}),n){var i=o.$eval(n);angular.isFunction(i)?h.groups=i(h.groups):angular.isArray(i)&&(h.groups=function(e,t){var o,n,r=[];for(o=0;o<t.length;o++)for(n=0;n<e.length;n++)e[n].name==[t[o]]&&r.push(e[n]);return r}(h.groups,i))}h.items=[],h.groups.forEach(function(e){h.items=h.items.concat(e.items)})}:function(e){h.items=e||[]},h.parserResult=s.parse(e),h.isGrouped=!!t,h.itemProperty=h.parserResult.itemName;var r=h.parserResult.source,i=function(){var e=r(o);o.$uisSource=Object.keys(e).map(function(t){var o={};return o[h.parserResult.keyName]=t,o.value=e[t],o})};h.parserResult.keyName&&(i(),h.parserResult.source=l("$uisSource"+h.parserResult.filters),o.$watch(r,function(e,t){e!==t&&i()},!0)),h.refreshItems=function(e){e=e||h.parserResult.source(o);var t=h.selected;if(h.isEmpty()||angular.isArray(t)&&!t.length||!h.multiple||!h.removeSelected)h.setItemsFn(e);else if(null!=e){var n=e.filter(function(e){return angular.isArray(t)?t.every(function(t){return!angular.equals(e,t)}):!angular.equals(e,t)});h.setItemsFn(n)}"auto"!==h.dropdownPosition&&"up"!==h.dropdownPosition||o.calculateDropdownPos(),o.$broadcast("uis:refresh")},o.$watchCollection(h.parserResult.source,function(e){if(null==e)h.items=[];else{if(!angular.isArray(e))throw c("items","Expected an array but got '{0}'.",e);h.refreshItems(e),angular.isDefined(h.ngModel.$modelValue)&&(h.ngModel.$modelValue=null)}})},h.refresh=function(e){void 0!==e&&(f&&r.cancel(f),f=r(function(){if(o.$select.search.length>=o.$select.minimumInputLength){var t=o.$eval(e);t&&angular.isFunction(t.then)&&!h.refreshing&&(h.refreshing=!0,t.finally(function(){h.refreshing=!1}))}},h.refreshDelay))},h.isActive=function(e){if(!h.open)return!1;var t=h.items.indexOf(e[h.itemProperty]),o=t==h.activeIndex;return!(!o||t<0)&&(o&&!angular.isUndefined(h.onHighlightCallback)&&e.$eval(h.onHighlightCallback),o)};var v=function(e){return h.selected&&angular.isArray(h.selected)&&h.selected.filter(function(t){return angular.equals(t,e)}).length>0},y=[];function b(e){return y.indexOf(e)>-1}h.isDisabled=function(e){if(h.open){var t=e[h.itemProperty],o=!1;if(h.items.indexOf(t)>=0&&(angular.isDefined(h.disableChoiceExpression)||h.multiple)){if(t.isTag)return!1;h.multiple&&(o=v(t)),!o&&angular.isDefined(h.disableChoiceExpression)&&(o=!!e.$eval(h.disableChoiceExpression)),function(e,t){var o=y.indexOf(e);t&&-1===o&&y.push(e),!t&&o>-1&&y.splice(o,1)}(t,o)}return o}},h.select=function(e,n,r){if(t(e)||!b(e)){if(!h.items&&!h.search&&!h.tagging.isActivated)return;if(!e||!b(e)){if(h.clickTriggeredSelect=!1,r&&("click"===r.type||"touchend"===r.type)&&e&&(h.clickTriggeredSelect=!0),h.tagging.isActivated&&!1===h.clickTriggeredSelect){if(!1===h.taggingLabel)if(h.activeIndex<0){if(void 0===e&&(e=void 0!==h.tagging.fct?h.tagging.fct(h.search):h.search),!e||angular.equals(h.items[0],e))return}else e=h.items[h.activeIndex];else if(0===h.activeIndex){if(void 0===e)return;if(void 0!==h.tagging.fct&&"string"==typeof e){if(!(e=h.tagging.fct(e)))return}else"string"==typeof e&&(e=e.replace(h.taggingLabel,"").trim())}if(v(e))return void h.close(n)}g(),o.$broadcast("uis:select",e),h.closeOnSelect&&h.close(n)}}},h.close=function(e){h.open&&(h.ngModel&&h.ngModel.$setTouched&&h.ngModel.$setTouched(),h.open=!1,g(),o.$broadcast("uis:close",e))},h.setFocus=function(){h.focus||h.focusInput[0].focus()},h.clear=function(e){h.select(null),e.stopPropagation(),r(function(){h.focusser[0].focus()},0,!1)},h.toggle=function(e){h.open?(h.close(),e.preventDefault(),e.stopPropagation()):h.activate()},h.isLocked=function(){return!1},o.$watch(function(){return angular.isDefined(h.lockChoiceExpression)&&""!==h.lockChoiceExpression},function(e){if(!e)return;var t=[];h.isLocked=function(e,o){var n=!1,r=h.selected[o];return r&&(e?(n=!!e.$eval(h.lockChoiceExpression),function(e,o){var n=t.indexOf(e);o&&-1===n&&t.push(e);!o&&n>-1&&t.splice(n,1)}(r,n)):n=function(e){return t.indexOf(e)>-1}(r)),n}});var w=null,x=!1;function S(){var e=n.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw c("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(!(h.activeIndex<0)){var o=t[h.activeIndex],r=o.offsetTop+o.clientHeight-e[0].scrollTop,i=e[0].offsetHeight;r>i?e[0].scrollTop+=r-i:r<o.clientHeight&&(h.isGrouped&&0===h.activeIndex?e[0].scrollTop=0:e[0].scrollTop-=o.clientHeight-r)}}h.sizeSearchInput=function(){var e=h.searchInput[0],t=h.$element[0],n=function(){return t.clientWidth*!!e.offsetParent},i=function(t){if(0===t)return!1;var o=t-e.offsetLeft;return o<50&&(o=t),h.searchInput.css("width",o+"px"),!0};h.searchInput.css("width","10px"),r(function(){null!==w||i(n())||(w=o.$watch(function(){x||(x=!0,o.$$postDigest(function(){x=!1,i(n())&&(w(),w=null)}))},angular.noop))})},h.searchInput.on("keydown",function(t){var n=t.which;~[e.ENTER,e.ESC].indexOf(n)&&(t.preventDefault(),t.stopPropagation()),o.$apply(function(){var o=!1;if((h.items.length>0||h.tagging.isActivated)&&(function(t){var o=!0;switch(t){case e.DOWN:if(!h.open&&h.multiple)h.activate(!1,!0);else if(h.activeIndex<h.items.length-1)for(var n=++h.activeIndex;b(h.items[n])&&n<h.items.length;)h.activeIndex=++n;break;case e.UP:var r=0===h.search.length&&h.tagging.isActivated?-1:0;if(!h.open&&h.multiple)h.activate(!1,!0);else if(h.activeIndex>r)for(var i=--h.activeIndex;b(h.items[i])&&i>r;)h.activeIndex=--i;break;case e.TAB:h.multiple&&!h.open||h.select(h.items[h.activeIndex],!0);break;case e.ENTER:h.open&&(h.tagging.isActivated||h.activeIndex>=0)?h.select(h.items[h.activeIndex],h.skipFocusser):h.activate(!1,!0);break;case e.ESC:h.close();break;default:o=!1}return o}(n)||h.searchEnabled||(t.preventDefault(),t.stopPropagation()),h.taggingTokens.isActivated)){for(var i=0;i<h.taggingTokens.tokens.length;i++)h.taggingTokens.tokens[i]===e.MAP[t.keyCode]&&h.search.length>0&&(o=!0);o&&r(function(){h.searchInput.triggerHandler("tagged");var o=h.search.replace(e.MAP[t.keyCode],"").trim();h.tagging.fct&&(o=h.tagging.fct(o)),o&&h.select(o,!0)})}}),e.isVerticalMovement(n)&&h.items.length>0&&S(),n!==e.ENTER&&n!==e.ESC||(t.preventDefault(),t.stopPropagation())}),h.searchInput.on("paste",function(t){var o;if(o=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain"),(o=h.search+o)&&o.length>0)if(h.taggingTokens.isActivated){for(var n=[],r=0;r<h.taggingTokens.tokens.length;r++){var i=e.toSeparator(h.taggingTokens.tokens[r])||h.taggingTokens.tokens[r];if(o.indexOf(i)>-1){n=o.split(i);break}}0===n.length&&(n=[o]);var a=h.search;angular.forEach(n,function(e){var t=h.tagging.fct?h.tagging.fct(e):e;t&&h.select(t,!0)}),h.search=a||m,t.preventDefault(),t.stopPropagation()}else h.paste&&(h.paste(o),h.search=m,t.preventDefault(),t.stopPropagation())}),h.searchInput.on("tagged",function(){r(function(){g()})});var C=a(function(){h.sizeSearchInput()},50);angular.element(u).bind("resize",C),o.$on("$destroy",function(){h.searchInput.off("keyup keydown tagged blur paste"),angular.element(u).off("resize",C)}),o.$watch("$select.activeIndex",function(e){e&&n.find("input").attr("aria-activedescendant","ui-select-choices-row-"+h.generatedId+"-"+e)}),o.$watch("$select.open",function(e){e||n.find("input").removeAttr("aria-activedescendant")})}]),n.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,o,n,r,i,a){return{restrict:"EA",templateUrl:function(e,o){return(o.theme||t.theme)+(angular.isDefined(o.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(r,s){var c=/{(.*)}\s*{(.*)}/.exec(s.ngClass);if(c){var p="{"+c[1]+", "+c[2]+"}";s.ngClass=p,r.attr("ng-class",p)}return angular.isDefined(s.multiple)?r.append("<ui-select-multiple/>").removeAttr("multiple"):r.append("<ui-select-single/>"),s.inputId&&(r.querySelectorAll("input.ui-select-search")[0].id=s.inputId),function(r,s,c,p,l){var d=p[0],u=p[1];function f(e){if(d.open){if(!(window.jQuery?window.jQuery.contains(s[0],e.target):s[0].contains(e.target))&&!d.clickTriggeredSelect){var t;if(d.skipFocusser)t=!0;else{var o=angular.element(e.target).controller("uiSelect");(t=o&&o!==d)||(t=~["input","button","textarea","select"].indexOf(e.target.tagName.toLowerCase()))}d.close(t),r.$digest()}d.clickTriggeredSelect=!1}}d.generatedId=t.generateId(),d.baseTitle=c.title||"Select box",d.focusserTitle=d.baseTitle+" focus",d.focusserId="focusser-"+d.generatedId,d.closeOnSelect=angular.isDefined(c.closeOnSelect)?i(c.closeOnSelect)():t.closeOnSelect,r.$watch("skipFocusser",function(){var e=r.$eval(c.skipFocusser);d.skipFocusser=void 0!==e?e:t.skipFocusser}),d.onSelectCallback=i(c.onSelect),d.onRemoveCallback=i(c.onRemove),d.ngModel=u,d.choiceGrouped=function(e){return d.isGrouped&&e&&e.name},c.tabindex&&c.$observe("tabindex",function(e){d.focusInput.attr("tabindex",e),s.removeAttr("tabindex")}),r.$watch(function(){return r.$eval(c.searchEnabled)},function(e){d.searchEnabled=void 0!==e?e:t.searchEnabled}),r.$watch("sortable",function(){var e=r.$eval(c.sortable);d.sortable=void 0!==e?e:t.sortable}),c.$observe("backspaceReset",function(){var e=r.$eval(c.backspaceReset);d.backspaceReset=void 0===e||e}),c.$observe("limit",function(){d.limit=angular.isDefined(c.limit)?parseInt(c.limit,10):void 0}),r.$watch("removeSelected",function(){var e=r.$eval(c.removeSelected);d.removeSelected=void 0!==e?e:t.removeSelected}),c.$observe("disabled",function(){d.disabled=void 0!==c.disabled&&c.disabled}),c.$observe("resetSearchInput",function(){var e=r.$eval(c.resetSearchInput);d.resetSearchInput=void 0===e||e}),c.$observe("paste",function(){d.paste=r.$eval(c.paste)}),c.$observe("tagging",function(){if(void 0!==c.tagging){var e=r.$eval(c.tagging);d.tagging={isActivated:!0,fct:!0!==e?e:void 0}}else d.tagging={isActivated:!1,fct:void 0}}),c.$observe("taggingLabel",function(){void 0!==c.tagging&&("false"===c.taggingLabel?d.taggingLabel=!1:d.taggingLabel=void 0!==c.taggingLabel?c.taggingLabel:"(new)")}),c.$observe("taggingTokens",function(){if(void 0!==c.tagging){var e=void 0!==c.taggingTokens?c.taggingTokens.split("|"):[",","ENTER"];d.taggingTokens={isActivated:!0,tokens:e}}}),c.$observe("spinnerEnabled",function(){var e=r.$eval(c.spinnerEnabled);d.spinnerEnabled=void 0!==e?e:t.spinnerEnabled}),c.$observe("spinnerClass",function(){var e=c.spinnerClass;d.spinnerClass=void 0!==e?c.spinnerClass:t.spinnerClass}),angular.isDefined(c.autofocus)&&a(function(){d.setFocus()}),angular.isDefined(c.focusOn)&&r.$on(c.focusOn,function(){a(function(){d.setFocus()})}),e.on("click",f),r.$on("$destroy",function(){e.off("click",f)}),l(r,function(e){var t=angular.element("<div>").append(e),n=t.querySelectorAll(".ui-select-match");if(n.removeAttr("ui-select-match"),n.removeAttr("data-ui-select-match"),1!==n.length)throw o("transcluded","Expected 1 .ui-select-match but got '{0}'.",n.length);s.querySelectorAll(".ui-select-match").replaceWith(n);var r=t.querySelectorAll(".ui-select-choices");if(r.removeAttr("ui-select-choices"),r.removeAttr("data-ui-select-choices"),1!==r.length)throw o("transcluded","Expected 1 .ui-select-choices but got '{0}'.",r.length);s.querySelectorAll(".ui-select-choices").replaceWith(r);var i=t.querySelectorAll(".ui-select-no-choice");i.removeAttr("ui-select-no-choice"),i.removeAttr("data-ui-select-no-choice"),1==i.length&&s.querySelectorAll(".ui-select-no-choice").replaceWith(i)});var h=r.$eval(c.appendToBody);(void 0!==h?h:t.appendToBody)&&(r.$watch("$select.open",function(t){var o;t?(o=n(s),(m=angular.element('<div class="ui-select-placeholder"></div>'))[0].style.width=o.width+"px",m[0].style.height=o.height+"px",s.after(m),g=s[0].style.width,e.find("body").append(s),s[0].style.position="absolute",s[0].style.left=o.left+"px",s[0].style.top=o.top+"px",s[0].style.width=o.width+"px"):v()}),r.$on("$destroy",function(){v()}));var m=null,g="";function v(){null!==m&&(m.replaceWith(s),m=null,s[0].style.position="",s[0].style.left="",s[0].style.top="",s[0].style.width=g,d.setFocus())}var y=null;r.$watch("$select.open",function(){"auto"!==d.dropdownPosition&&"up"!==d.dropdownPosition||r.calculateDropdownPos()});var b=function(e,t){e=e||n(s),t=t||n(y),y[0].style.position="absolute",y[0].style.top=-1*t.height+"px",s.addClass("direction-up")},w=function(){a(function(){if("up"===d.dropdownPosition)b();else{s.removeClass("direction-up");var t=n(s),o=n(y),r=e[0].documentElement.scrollTop||e[0].body.scrollTop;t.top+t.height+o.height>r+e[0].documentElement.clientHeight?b(t,o):function(e,t){s.removeClass("direction-up"),e=e||n(s),t=t||n(y),y[0].style.position="",y[0].style.top=""}(t,o)}y[0].style.opacity=1})},x=!1;r.calculateDropdownPos=function(){if(d.open){if(0===(y=angular.element(s).querySelectorAll(".ui-select-dropdown")).length)return;if(""!==d.search||x||(y[0].style.opacity=0,x=!0),!n(y).height&&d.$animate&&d.$animate.on&&d.$animate.enabled(y)){var e=!0;d.$animate.on("enter",y,function(t,o){"close"===o&&e&&(w(),e=!1)})}else w()}else{if(null===y||0===y.length)return;y[0].style.opacity=0,y[0].style.position="",y[0].style.top="",s.removeClass("direction-up")}}}}}}]),n.directive("uiSelectMatch",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(o){o.addClass("ui-select-match");var n=o.parent();return(t(n,"theme")||e.theme)+(angular.isDefined(t(n,"multiple"))?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,o,n,r){function i(e){r.allowClear=!!angular.isDefined(e)&&(""===e||"true"===e.toLowerCase())}r.lockChoiceExpression=n.uiLockChoice,n.$observe("placeholder",function(t){r.placeholder=void 0!==t?t:e.placeholder}),n.$observe("allowClear",i),i(n.allowClear),r.multiple&&r.sizeSearchInput()}};function t(e,t){return e[0].hasAttribute(t)?e.attr(t):e[0].hasAttribute("data-"+t)?e.attr("data-"+t):e[0].hasAttribute("x-"+t)?e.attr("x-"+t):void 0}}]),n.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(o,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var o,n=this,r=e.$select;angular.isUndefined(r.selected)&&(r.selected=[]),e.$evalAsync(function(){o=e.ngModel}),n.activeMatchIndex=-1,n.updateModel=function(){o.$setViewValue(Date.now()),n.refreshComponent()},n.refreshComponent=function(){r.refreshItems&&r.refreshItems(),r.sizeSearchInput&&r.sizeSearchInput()},n.removeChoice=function(o){if(r.isLocked(null,o))return!1;var i=r.selected[o],a={};return a[r.parserResult.itemName]=i,r.selected.splice(o,1),n.activeMatchIndex=-1,r.sizeSearchInput(),t(function(){r.onRemoveCallback(e,{$item:i,$model:r.parserResult.modelMapper(e,a)})}),n.updateModel(),!0},n.getPlaceholder=function(){if(!r.selected||!r.selected.length)return r.placeholder}}],controllerAs:"$selectMultiple",link:function(r,i,a,s){var c=s[0],p=r.ngModel=s[1],l=r.$selectMultiple;function d(e){return void 0!==e&&void 0!==c.search&&e.filter(function(e){return void 0!==c.search.toUpperCase()&&void 0!==e&&e.toUpperCase()===c.search.toUpperCase()}).length>0}function u(e,t){var o=-1;if(angular.isArray(e))for(var n=angular.copy(e),r=0;r<n.length;r++)if(void 0===c.tagging.fct)n[r]+" "+c.taggingLabel===t&&(o=r);else{var i=n[r];angular.isObject(i)&&(i.isTag=!0),angular.equals(i,t)&&(o=r)}return o}c.multiple=!0,c.focusInput=c.searchInput,p.$isEmpty=function(e){return!e||0===e.length},p.$parsers.unshift(function(){for(var e,t={},o=[],n=c.selected.length-1;n>=0;n--)(t={})[c.parserResult.itemName]=c.selected[n],e=c.parserResult.modelMapper(r,t),o.unshift(e);return o}),p.$formatters.unshift(function(e){var t,o=c.parserResult&&c.parserResult.source(r,{$select:{search:""}}),n={};if(!o)return e;var i=[],a=function(e,o){if(e&&e.length){for(var a=e.length-1;a>=0;a--){if(n[c.parserResult.itemName]=e[a],t=c.parserResult.modelMapper(r,n),c.parserResult.trackByExp){var s=/(\w*)\./.exec(c.parserResult.trackByExp),p=/\.([^\s]+)/.exec(c.parserResult.trackByExp);if(s&&s.length>0&&s[1]==c.parserResult.itemName&&p&&p.length>0&&t[p[1]]==o[p[1]])return i.unshift(e[a]),!0}if(angular.equals(t,o))return i.unshift(e[a]),!0}return!1}};if(!e)return i;for(var s=e.length-1;s>=0;s--)a(c.selected,e[s])||a(o,e[s])||i.unshift(e[s]);return i}),r.$watchCollection(function(){return p.$modelValue},function(e,t){t!=e&&(angular.isDefined(p.$modelValue)&&(p.$modelValue=null),l.refreshComponent())}),p.$render=function(){if(!angular.isArray(p.$viewValue)){if(!t(p.$viewValue))throw o("multiarr","Expected model value to be array but got '{0}'",p.$viewValue);p.$viewValue=[]}c.selected=p.$viewValue,l.refreshComponent(),r.$evalAsync()},r.$on("uis:select",function(e,t){if(!(c.selected.length>=c.limit)){c.selected.push(t);var o={};o[c.parserResult.itemName]=t,n(function(){c.onSelectCallback(r,{$item:t,$model:c.parserResult.modelMapper(r,o)})}),l.updateModel()}}),r.$on("uis:activate",function(){l.activeMatchIndex=-1}),r.$watch("$select.disabled",function(e,t){t&&!e&&c.sizeSearchInput()}),c.searchInput.on("keydown",function(t){var o=t.which;r.$apply(function(){var n=!1;e.isHorizontalMovement(o)&&(n=function(t){var o=(d=c.searchInput[0],angular.isNumber(d.selectionStart)?d.selectionStart:d.value.length),n=c.selected.length,r=n-1,i=l.activeMatchIndex,a=l.activeMatchIndex+1,s=l.activeMatchIndex-1,p=i;var d;if(o>0||c.search.length&&t==e.RIGHT)return!1;c.close(),p=function(){switch(t){case e.LEFT:return~l.activeMatchIndex?s:r;case e.RIGHT:return~l.activeMatchIndex&&i!==r?a:(c.activate(),!1);case e.BACKSPACE:return~l.activeMatchIndex?l.removeChoice(i)?s:i:r;case e.DELETE:return!!~l.activeMatchIndex&&(l.removeChoice(l.activeMatchIndex),i)}}(),c.selected.length&&!1!==p?l.activeMatchIndex=Math.min(r,Math.max(0,p)):l.activeMatchIndex=-1;return!0}(o)),n&&o!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),c.searchInput.on("keyup",function(t){if(e.isVerticalMovement(t.which)||r.$evalAsync(function(){c.activeIndex=!1===c.taggingLabel?-1:0}),c.tagging.isActivated&&c.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;if(c.activeIndex=!1===c.taggingLabel?-1:0,!1===c.taggingLabel)return;var o,n,i,a=angular.copy(c.items),s=angular.copy(c.items),p=!1,l=-1;if(void 0!==c.tagging.fct){if((n=c.$filter("filter")(a,{isTag:!0})).length>0&&(i=n[0]),a.length>0&&i&&(p=!0,a=a.slice(1,a.length),s=s.slice(1,s.length)),o=c.tagging.fct(c.search),s.some(function(e){return angular.equals(e,o)})||c.selected.some(function(e){return angular.equals(e,o)}))return void r.$evalAsync(function(){c.activeIndex=0,c.items=a});o&&(o.isTag=!0)}else{if((n=c.$filter("filter")(a,function(e){return e.match(c.taggingLabel)})).length>0&&(i=n[0]),void 0!==a[0]&&a.length>0&&i&&(p=!0,a=a.slice(1,a.length),s=s.slice(1,s.length)),o=c.search+" "+c.taggingLabel,u(c.selected,c.search)>-1)return;if(d(s.concat(c.selected)))return void(p&&(a=s,r.$evalAsync(function(){c.activeIndex=0,c.items=a})));if(d(s))return void(p&&(c.items=s.slice(1,s.length)))}p&&(l=u(c.selected,o)),l>-1?a=a.slice(l+1,a.length-1):(a=[],o&&a.push(o),a=a.concat(s)),r.$evalAsync(function(){if(c.activeIndex=0,c.items=a,c.isGrouped){var e=o?a.slice(1):a;c.setItemsFn(e),o&&(c.items.unshift(o),c.groups.unshift({name:"",items:[o],tagging:!0}))}})}}),c.searchInput.on("blur",function(){n(function(){l.activeMatchIndex=-1})})}}}]),n.directive("uiSelectNoChoice",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){return t.addClass("ui-select-no-choice"),(t.parent().attr("theme")||e.theme)+"/no-choice.tpl.html"}}}]),n.directive("uiSelectSingle",["$timeout","$compile",function(o,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(r,i,a,s){var c=s[0],p=s[1];p.$parsers.unshift(function(e){if(t(e))return e;var o={};return o[c.parserResult.itemName]=e,c.parserResult.modelMapper(r,o)}),p.$formatters.unshift(function(e){if(t(e))return e;var o=c.parserResult&&c.parserResult.source(r,{$select:{search:""}}),n={};if(o){var i=function(t){return n[c.parserResult.itemName]=t,c.parserResult.modelMapper(r,n)===e};if(c.selected&&i(c.selected))return c.selected;for(var a=o.length-1;a>=0;a--)if(i(o[a]))return o[a]}return e}),r.$watch("$select.selected",function(e){p.$viewValue!==e&&p.$setViewValue(e)}),p.$render=function(){c.selected=p.$viewValue},r.$on("uis:select",function(e,n){c.selected=n;var i={};i[c.parserResult.itemName]=n,o(function(){c.onSelectCallback(r,{$item:n,$model:t(n)?n:c.parserResult.modelMapper(r,i)})})}),r.$on("uis:close",function(e,t){o(function(){c.focusser.prop("disabled",!1),t||c.focusser[0].focus()},0,!1)}),r.$on("uis:activate",function(){l.prop("disabled",!0)});var l=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");n(l)(r),c.focusser=l,c.focusInput=l,i.parent().append(l),l.bind("focus",function(){r.$evalAsync(function(){c.focus=!0})}),l.bind("blur",function(){r.$evalAsync(function(){c.focus=!1})}),l.bind("keydown",function(t){if(t.which===e.BACKSPACE&&!1!==c.backspaceReset)return t.preventDefault(),t.stopPropagation(),c.select(void 0),void r.$apply();t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||(t.which!=e.DOWN&&t.which!=e.UP&&t.which!=e.ENTER&&t.which!=e.SPACE||(t.preventDefault(),t.stopPropagation(),c.activate()),r.$digest())}),l.bind("keyup input",function(t){t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE||(c.activate(l.val()),l.val(""),r.$digest())})}}}]),n.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,o){return{require:["^^uiSelect","^ngModel"],link:function(t,n,r,i){if(null===t[r.uiSelectSort])throw o("sort","Expected a list to sort");var a=i[0],s=i[1],c=angular.extend({axis:"horizontal"},t.$eval(r.uiSelectSortOptions)).axis;t.$watch(function(){return a.sortable},function(e){e?n.attr("draggable",!0):n.removeAttr("draggable")}),n.on("dragstart",function(e){n.addClass("dragging"),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text",t.$index.toString())}),n.on("dragend",function(){l("dragging")});var p,l=function(e){angular.forEach(a.$element.querySelectorAll("."+e),function(t){angular.element(t).removeClass(e)})},d=function(e){e.preventDefault(),("vertical"===c?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0))<this["vertical"===c?"offsetHeight":"offsetWidth"]/2?(l("dropping-after"),n.addClass("dropping-before")):(l("dropping-before"),n.addClass("dropping-after"))},u=function(t){t.preventDefault();var o=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text"),10);e.cancel(p),p=e(function(){f(o)},20)},f=function(e){var o=t.$eval(r.uiSelectSort),i=o[e],a=null;a=n.hasClass("dropping-before")?e<t.$index?t.$index-1:t.$index:e<t.$index?t.$index:t.$index+1,function(e,t){this.splice(t,0,this.splice(e,1)[0])}.apply(o,[e,a]),s.$setViewValue(Date.now()),t.$apply(function(){t.$emit("uiSelectSort:change",{array:o,item:i,from:e,to:a})}),l("dropping"),l("dropping-before"),l("dropping-after"),n.off("drop",u)};n.on("dragenter",function(){n.hasClass("dragging")||(n.addClass("dropping"),n.on("dragover",d),n.on("drop",u))}),n.on("dragleave",function(e){e.target==n&&(l("dropping"),l("dropping-before"),l("dropping-after"),n.off("dragover",d),n.off("drop",u))})}}}]),n.factory("$$uisDebounce",["$timeout",function(e){return function(t,o){var n;return function(){var r=this,i=Array.prototype.slice.call(arguments);n&&e.cancel(n),n=e(function(){t.apply(r,i)},o)}}}]),n.directive("uisOpenClose",["$parse","$timeout",function(e,t){return{restrict:"A",require:"uiSelect",link:function(o,n,r,i){i.onOpenCloseCallback=e(r.uisOpenClose),o.$watch("$select.open",function(e,n){e!==n&&t(function(){i.onOpenCloseCallback(o,{isOpen:e})})})}}}]),n.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){this.parse=function(o){var n;if(!(n=o.match(/^\s*(?:([\s\S]+?)\s+as\s+)?(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(\s*[\s\S]+?)?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/)))throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",o);var r=n[5],i="";if(n[3]){r=n[5].replace(/(^\()|(\)$)/g,"");var a=n[5].match(/^\s*(?:[\s\S]+?)(?:[^\|]|\|\|)+([\s\S]*)\s*$/);a&&a[1].trim()&&(i=a[1],r=r.replace(i,""))}return{itemName:n[4]||n[2],keyName:n[3],source:t(r),filters:i,trackByExp:n[6],modelMapper:t(n[1]||n[4]||n[2]),repeatExpression:function(e){var t=this.itemName+" in "+(e?"$group.items":"$select.items");return this.trackByExp&&(t+=" track by "+this.trackByExp),t}}},this.getGroupNgRepeatExpression=function(){return"$group in $select.groups track by $group.name"}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices ui-select-dropdown selectize-dropdown" ng-class="{\'single\': !$select.multiple, \'multi\': $select.multiple}"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match-multiple.tpl.html",'<div class="ui-select-match" data-value="" ng-repeat="$item in $select.selected track by $index" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'active\':$selectMultiple.activeMatchIndex === $index}" ui-select-sort="$select.selected"><span class="ui-select-match-item" ng-class="{\'select-locked\':$select.isLocked(this, $index)}"><span uis-transclude-append=""></span> <span class="remove ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&times;</span></span></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="$select.searchEnabled && ($select.open || $select.isEmpty())" class="ui-select-match"><span ng-show="!$select.searchEnabled && ($select.isEmpty() || $select.open)" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty() || $select.open" ng-transclude=""></span></div>'),e.put("selectize/no-choice.tpl.html",'<div class="ui-select-no-choice selectize-dropdown" ng-show="$select.items.length == 0"><div class="selectize-dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("selectize/select-multiple.tpl.html",'<div class="ui-select-container selectize-control multi plugin-remove_button" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-model="$select.search" ng-disabled="$select.disabled" aria-expanded="{{$select.open}}" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus, \'refreshing\': $select.open && $select.refreshing && $select.spinnerEnabled }" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><i class="iconfont iconspinner fa-pulse"></i><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.isEmpty() && !$select.open" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu" ng-show="$select.open && $select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><span class="ui-select-choices-row-inner"></span></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected track by $index"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/no-choice.tpl.html",'<ul class="ui-select-no-choice dropdown-menu" ng-show="$select.items.length == 0"><li ng-transclude=""></li></ul>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-expanded="{{$select.open}}" aria-label="{{$select.baseTitle}}" ng-class="{\'spinner\': $select.refreshing}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><span ng-show="$select.open && $select.refreshing && $select.spinnerEnabled" class="ui-select-refreshing {{$select.spinnerClass}}"></span> <input type="search" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" class="form-control ui-select-search" ng-class="{ \'ui-select-search-hidden\' : !$select.searchEnabled }" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.open"><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>')}]),window,document,angular.module("toaster",[]).constant("toasterConfig",{limit:0,"tap-to-dismiss":!0,"close-button":!1,"close-html":'<button class="toast-close-button" type="button">&times;</button>',"newest-on-top":!0,"time-out":5e3,"icon-classes":{error:"toast-error",info:"toast-info",wait:"toast-wait",success:"toast-success",warning:"toast-warning"},"body-output-type":"","body-template":"toasterBodyTmpl.html","icon-class":"toast-info","position-class":"toast-top-right","title-class":"toast-title","message-class":"toast-message","prevent-duplicates":!1,"mouseover-timer-stop":!0}).run(["$templateCache",function(e){e.put("angularjs-toaster/toast.html",'<div id="toast-container" ng-class="[config.position, config.animation]"><div ng-repeat="toaster in toasters" class="toast" ng-class="toaster.type" ng-click="click($event, toaster)" ng-mouseover="stopTimer(toaster)" ng-mouseout="restartTimer(toaster)"><div ng-if="toaster.showCloseButton" ng-click="click($event, toaster, true)" ng-bind-html="toaster.closeHtml"></div><div ng-class="config.title">{{toaster.title}}</div><div ng-class="config.message" ng-switch on="toaster.bodyOutputType"><div ng-switch-when="trustedHtml" ng-bind-html="toaster.html"></div><div ng-switch-when="template"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="templateWithData"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="directive"><div directive-template directive-name="{{toaster.html}}" directive-data="{{toaster.directiveData}}"></div></div><div ng-switch-default >{{toaster.body}}</div></div></div></div>')}]).service("toaster",["$rootScope","toasterConfig",function(e,t){var o=function(){var e={newGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};return e}();for(var n in this.pop=function(t,n,r,i,a,s,c,p,l,d){if(angular.isObject(t)){var u=t;this.toast={type:u.type,title:u.title,body:u.body,timeout:u.timeout,bodyOutputType:u.bodyOutputType,clickHandler:u.clickHandler,showCloseButton:u.showCloseButton,closeHtml:u.closeHtml,toastId:u.toastId,onShowCallback:u.onShowCallback,onHideCallback:u.onHideCallback,directiveData:u.directiveData,tapToDismiss:u.tapToDismiss},c=u.toasterId}else this.toast={type:t,title:n,body:r,timeout:i,bodyOutputType:a,clickHandler:s,showCloseButton:p,toastId:l,onHideCallback:d};return this.toast.toastId&&this.toast.toastId.length||(this.toast.toastId=o.newGuid()),e.$emit("toaster-newToast",c,this.toast.toastId),{toasterId:c,toastId:this.toast.toastId,toaster:this.toast}},this.clear=function(t,o){angular.isObject(t)?e.$emit("toaster-clearToasts",t.toasterId,t.toastId):e.$emit("toaster-clearToasts",t,o)},this.reset=function(t){e.$emit("toaster-resetToasts",t.toasterId,t.toastId)},t["icon-classes"])this[n]=r(n);function r(e){return function(t,o,n,r,i,a,s,c,p){return angular.isString(t)?this.pop(e,t,o,n,r,i,a,s,c,p):this.pop(angular.extend(t,{type:e}))}}}]).factory("toasterEventRegistry",["$rootScope",function(e){var t,o=null,n=null,r=null,i=[],a=[],s=[];return{setup:(t={setup:function(){o||(o=e.$on("toaster-newToast",function(e,t,o){for(var n=0,r=i.length;n<r;n++)i[n](e,t,o)})),n||(n=e.$on("toaster-clearToasts",function(e,t,o){for(var n=0,r=a.length;n<r;n++)a[n](e,t,o)})),r||(r=e.$on("toaster-resetToasts",function(e,t,o){for(var n=0,r=s.length;n<r;n++)s[n](e,t,o)}))},subscribeToNewToastEvent:function(e){i.push(e)},subscribeToClearToastsEvent:function(e){a.push(e)},subscribeToResetToastsEvent:function(e){s.push(e)},unsubscribeToNewToastEvent:function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1),0===i.length&&(o(),o=null)},unsubscribeToClearToastsEvent:function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1),0===a.length&&(n(),n=null)},unsubscribeToResetToastsEvent:function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&(r(),r=null)}}).setup,subscribeToNewToastEvent:t.subscribeToNewToastEvent,subscribeToClearToastsEvent:t.subscribeToClearToastsEvent,subscribeToResetToastsEvent:t.subscribeToResetToastsEvent,unsubscribeToNewToastEvent:t.unsubscribeToNewToastEvent,unsubscribeToClearToastsEvent:t.unsubscribeToClearToastsEvent,unsubscribeToResetToastsEvent:t.unsubscribeToResetToastsEvent}}]).directive("directiveTemplate",["$compile","$injector","$interval",function(e,t,o){return{restrict:"A",scope:{directiveName:"@directiveName",directiveData:"@directiveData"},replace:!0,link:function(o,n,r){o.$watch("directiveName",function(i){if(angular.isUndefined(i)||i.length<=0)throw new Error("A valid directive name must be provided via the toast body argument when using bodyOutputType: directive");var a;try{a=t.get(r.$normalize(i)+"Directive")}catch(e){throw new Error(i+" could not be found. The name should appear as it exists in the markup, not camelCased as it would appear in the directive declaration, e.g. directive-name not directiveName.")}var s=a[0];if(!0!==s.scope&&s.scope)throw new Error("Cannot use a directive with an isolated scope. The scope must be either true or falsy (e.g. false/null/undefined). Occurred for directive "+i+".");if(s.restrict.indexOf("A")<0)throw new Error('Directives must be usable as attributes. Add "A" to the restrict option (or remove the option entirely). Occurred for directive '+i+".");o.directiveData&&(o.directiveData=angular.fromJson(o.directiveData));var c=e("<div "+i+"></div>")(o);n.append(c)})}}}]).directive("toasterContainer",["$parse","$rootScope","$interval","$sce","toasterConfig","toaster","toasterEventRegistry",function(e,t,o,n,r,i,a){return{replace:!0,restrict:"EA",scope:!0,link:function(t,s,c){var p;function l(e){var n=t.toasters[e];n.timeoutPromise&&o.cancel(n.timeoutPromise),t.toasters.splice(e,1),angular.isFunction(n.onHideCallback)&&n.onHideCallback(n)}function d(e){return angular.isUndefined(e)||null===e}p=angular.extend({},r,t.$eval(c.toasterOptions)),t.config={toasterId:p["toaster-id"],position:p["position-class"],title:p["title-class"],message:p["message-class"],tap:p["tap-to-dismiss"],closeButton:p["close-button"],closeHtml:p["close-html"],animation:p["animation-class"],mouseoverTimer:p["mouseover-timer-stop"]},t.$on("$destroy",function(){a.unsubscribeToNewToastEvent(t._onNewToast),a.unsubscribeToClearToastsEvent(t._onClearToasts),a.unsubscribeToResetToastsEvent(t._onResetToasts)}),t.configureTimer=function(e){var n=angular.isNumber(e.timeout)?e.timeout:p["time-out"];"object"==typeof n&&(n=n[e.type]),n>0&&function(e,n){e.timeoutPromise=o(function(){t.removeToast(e.toastId)},n,1)}(e,n)},t.removeToast=function(e){var o,n;for(o=0,n=t.toasters.length;o<n;o++)if(t.toasters[o].toastId===e){l(o);break}},t.toasters=[],t._onNewToast=function(o,r,a){(d(t.config.toasterId)&&d(r)||!d(t.config.toasterId)&&!d(r)&&t.config.toasterId==r)&&function(o,r){if(o.type=p["icon-classes"][o.type],o.type||(o.type=p["icon-class"]),!0===p["prevent-duplicates"]&&t.toasters.length){if(t.toasters[t.toasters.length-1].body===o.body)return;var i,a,s=!1;for(i=0,a=t.toasters.length;i<a;i++)if(t.toasters[i].toastId===r){s=!0;break}if(s)return}var c=p["close-button"];if("boolean"==typeof o.showCloseButton);else if("boolean"==typeof c)o.showCloseButton=c;else if("object"==typeof c){var l=c[o.type];null!=l&&(o.showCloseButton=l)}else o.showCloseButton=!1;switch(o.showCloseButton&&(o.closeHtml=n.trustAsHtml(o.closeHtml||t.config.closeHtml)),o.bodyOutputType=o.bodyOutputType||p["body-output-type"],o.bodyOutputType){case"trustedHtml":o.html=n.trustAsHtml(o.body);break;case"template":o.bodyTemplate=o.body||p["body-template"];break;case"templateWithData":var d=e(o.body||p["body-template"])(t);o.bodyTemplate=d.template,o.data=d.data;break;case"directive":o.html=o.body}t.configureTimer(o),!0===p["newest-on-top"]?(t.toasters.unshift(o),p.limit>0&&t.toasters.length>p.limit&&t.toasters.pop()):(t.toasters.push(o),p.limit>0&&t.toasters.length>p.limit&&t.toasters.shift()),angular.isFunction(o.onShowCallback)&&o.onShowCallback(o)}(i.toast,a)},t._onClearToasts=function(e,o,n){("*"==o||d(t.config.toasterId)&&d(o)||!d(t.config.toasterId)&&!d(o)&&t.config.toasterId==o)&&function(e){for(var o=t.toasters.length-1;o>=0;o--)d(e)?l(o):t.toasters[o].toastId==e&&l(o)}(n)},t._onResetToasts=function(e,n,r){i.toast.timeoutPromise&&(o.cancel(i.toast.timeoutPromise),i.toast.timeoutPromise=null),t.configureTimer(i.toast)},a.setup(),a.subscribeToNewToastEvent(t._onNewToast),a.subscribeToClearToastsEvent(t._onClearToasts),a.subscribeToResetToastsEvent(t._onResetToasts)},controller:["$scope","$element","$attrs",function(e,t,n){e.stopTimer=function(t){!0===e.config.mouseoverTimer&&t.timeoutPromise&&(o.cancel(t.timeoutPromise),t.timeoutPromise=null)},e.restartTimer=function(t){!0===e.config.mouseoverTimer?t.timeoutPromise||e.configureTimer(t):null===t.timeoutPromise&&e.removeToast(t.toastId)},e.click=function(t,o,n){if(t.stopPropagation(),!0===("boolean"==typeof o.tapToDismiss?o.tapToDismiss:e.config.tap)||!0===o.showCloseButton&&!0===n){var r=!0;o.clickHandler&&(angular.isFunction(o.clickHandler)?r=o.clickHandler(o,n):angular.isFunction(e.$parent.$eval(o.clickHandler))&&(r=e.$parent.$eval(o.clickHandler)(o,n))),r&&e.removeToast(o.toastId)}}}],templateUrl:"angularjs-toaster/toast.html"}}]),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TheGraph=e()}}(function(){return function(){return function e(t,o,n){function r(a,s){if(!o[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var l=o[a]={exports:{}};t[a][0].call(l.exports,function(e){return r(t[a][1][e]||e)},l,l.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}}()({1:[function(e,t,o){var n={};n.fbpGraph=e("fbp-graph"),n.Ease=e("ease-component"),"undefined"!=typeof window&&void 0===window.Ease&&(window.Ease=n.Ease);var r={TheGraph:n};n.factories=e("./the-graph/factories.js"),n.merge=e("./the-graph/merge.js"),e("./the-graph/the-graph.js").register(r),e("./the-graph/the-graph-app.js").register(r),e("./the-graph/the-graph-graph.js").register(r),e("./the-graph/the-graph-node.js").register(r),e("./the-graph/the-graph-port.js").register(r),e("./the-graph/the-graph-edge.js").register(r),e("./the-graph/the-graph-iip.js").register(r),e("./the-graph/the-graph-group.js").register(r),e("./the-graph/iconfont-unicode-map.js").register(r),n.tooltip=e("./the-graph/the-graph-tooltip.js"),n.Tooltip=n.tooltip.Tooltip,n.config.tooltip=n.tooltip.config,n.factories.tooltip=n.tooltip.factories,n.mixins=e("./the-graph/mixins.js"),n.arcs=e("./the-graph/arcs.js"),n.thumb=e("./the-graph-thumb/the-graph-thumb.js"),n.nav=e("./the-graph-nav/the-graph-nav.js"),n.autolayout=e("./the-graph/the-graph-autolayout.js"),n.library=e("./the-graph/the-graph-library.js"),n.EdgeAnimator=e("./the-graph/the-graph-edge-animator.js"),t.exports=n},{"./the-graph-nav/the-graph-nav.js":19,"./the-graph-thumb/the-graph-thumb.js":20,"./the-graph/arcs.js":21,"./the-graph/factories.js":23,"./the-graph/iconfont-unicode-map.js":24,"./the-graph/merge.js":25,"./the-graph/mixins.js":26,"./the-graph/the-graph-app.js":27,"./the-graph/the-graph-autolayout.js":28,"./the-graph/the-graph-edge-animator.js":29,"./the-graph/the-graph-edge.js":30,"./the-graph/the-graph-graph.js":31,"./the-graph/the-graph-group.js":32,"./the-graph/the-graph-iip.js":33,"./the-graph/the-graph-library.js":34,"./the-graph/the-graph-node.js":35,"./the-graph/the-graph-port.js":36,"./the-graph/the-graph-tooltip.js":37,"./the-graph/the-graph.js":38,"ease-component":6,"fbp-graph":8}],2:[function(e,t,o){o.byteLength=function(e){var t=p(e),o=t[0],n=t[1];return 3*(o+n)/4-n},o.toByteArray=function(e){var t,o,n=p(e),a=n[0],s=n[1],c=new i(function(e,t,o){return 3*(t+o)/4-o}(0,a,s)),l=0,d=s>0?a-4:a;for(o=0;o<d;o+=4)t=r[e.charCodeAt(o)]<<18|r[e.charCodeAt(o+1)]<<12|r[e.charCodeAt(o+2)]<<6|r[e.charCodeAt(o+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=r[e.charCodeAt(o)]<<2|r[e.charCodeAt(o+1)]>>4,c[l++]=255&t);1===s&&(t=r[e.charCodeAt(o)]<<10|r[e.charCodeAt(o+1)]<<4|r[e.charCodeAt(o+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},o.fromByteArray=function(e){for(var t,o=e.length,r=o%3,i=[],a=0,s=o-r;a<s;a+=16383)i.push(l(e,a,a+16383>s?s:a+16383));1===r?(t=e[o-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[o-2]<<8)+e[o-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function p(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=e.indexOf("=");return-1===o&&(o=t),[o,o===t?0:4-o%4]}function l(e,t,o){for(var r,i,a=[],s=t;s<o;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(i=r)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],3:[function(e,t,o){},{}],4:[function(e,t,o){(function(t){(function(){var t=e("base64-js"),n=e("ieee754"),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;o.Buffer=s,o.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},o.INSPECT_MAX_BYTES=50;var i=2147483647;function a(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,o){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return c(e,t,o)}function c(e,t,o){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var o=0|h(e,t),n=a(o),r=n.write(e,t);r!==o&&(n=n.slice(0,r));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(z(e,Uint8Array)){var t=new Uint8Array(e);return u(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer))return u(e,t,o);if("undefined"!=typeof SharedArrayBuffer&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return u(e,t,o);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,o);var r=function(e){if(s.isBuffer(e)){var t=0|f(e.length),o=a(t);return 0===o.length?o:(e.copy(o,0,0,t),o)}if(void 0!==e.length)return"number"!=typeof e.length||j(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function p(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return p(e),a(e<0?0:0|f(e))}function d(e){for(var t=e.length<0?0:0|f(e.length),o=a(t),n=0;n<t;n+=1)o[n]=255&e[n];return o}function u(e,t,o){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(o||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===o?new Uint8Array(e):void 0===o?new Uint8Array(e,t):new Uint8Array(e,t,o),Object.setPrototypeOf(n,s.prototype),n}function f(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function h(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var o=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===o)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return R(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*o;case"hex":return o>>>1;case"base64":return D(e).length;default:if(r)return n?-1:R(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function g(e,t,o,n,r){if(0===e.length)return-1;if("string"==typeof o?(n=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),j(o=+o)&&(o=r?0:e.length-1),o<0&&(o=e.length+o),o>=e.length){if(r)return-1;o=e.length-1}else if(o<0){if(!r)return-1;o=0}if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:v(e,t,o,n,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,o):Uint8Array.prototype.lastIndexOf.call(e,t,o):v(e,[t],o,n,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,o,n,r){var i,a=1,s=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,o/=2}function p(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var l=-1;for(i=o;i<s;i++)if(p(e,i)===p(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*a}else-1!==l&&(i-=i-l),l=-1}else for(o+c>s&&(o=s-c),i=o;i>=0;i--){for(var d=!0,u=0;u<c;u++)if(p(e,i+u)!==p(t,u)){d=!1;break}if(d)return i}return-1}function y(e,t,o,n){o=Number(o)||0;var r=e.length-o;n?(n=Number(n))>r&&(n=r):n=r;var i=t.length;n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(j(s))return a;e[o+a]=s}return a}function b(e,t,o,n){return U(R(t,e.length-o),e,o,n)}function w(e,t,o,n){return U(function(e){for(var t=[],o=0;o<e.length;++o)t.push(255&e.charCodeAt(o));return t}(t),e,o,n)}function x(e,t,o,n){return U(D(t),e,o,n)}function S(e,t,o,n){return U(function(e,t){for(var o,n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)o=e.charCodeAt(a),n=o>>8,r=o%256,i.push(r),i.push(n);return i}(t,e.length-o),e,o,n)}function C(e,o,n){return 0===o&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(o,n))}function I(e,t,o){o=Math.min(e.length,o);for(var n=[],r=t;r<o;){var i,a,s,c,p=e[r],l=null,d=p>239?4:p>223?3:p>191?2:1;if(r+d<=o)switch(d){case 1:p<128&&(l=p);break;case 2:128==(192&(i=e[r+1]))&&(c=(31&p)<<6|63&i)>127&&(l=c);break;case 3:i=e[r+1],a=e[r+2],128==(192&i)&&128==(192&a)&&(c=(15&p)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[r+1],a=e[r+2],s=e[r+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&p)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),r+=d}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var o="",n=0;for(;n<t;)o+=String.fromCharCode.apply(String,e.slice(n,n+=_));return o}(n)}o.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,o){return c(e,t,o)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,o){return function(e,t,o){return p(e),e<=0?a(e):void 0!==t?"string"==typeof o?a(e).fill(t,o):a(e).fill(t):a(e)}(e,t,o)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var o=e.length,n=t.length,r=0,i=Math.min(o,n);r<i;++r)if(e[r]!==t[r]){o=e[r],n=t[r];break}return o<n?-1:n<o?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var o;if(void 0===t)for(t=0,o=0;o<e.length;++o)t+=e[o].length;var n=s.allocUnsafe(t),r=0;for(o=0;o<e.length;++o){var i=e[o];if(z(i,Uint8Array))r+i.length>n.length?s.from(i).copy(n,r):Uint8Array.prototype.set.call(n,i,r);else{if(!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,r)}r+=i.length}return n},s.byteLength=h,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):function(e,t,o){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===o||o>this.length)&&(o=this.length),o<=0)return"";if((o>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,o);case"utf8":case"utf-8":return I(this,t,o);case"ascii":return E(this,t,o);case"latin1":case"binary":return N(this,t,o);case"base64":return C(this,t,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,t,o);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=o.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,o,n,r){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===o&&(o=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),t<0||o>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&t>=o)return 0;if(n>=r)return-1;if(t>=o)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(n>>>=0),a=(o>>>=0)-(t>>>=0),c=Math.min(i,a),p=this.slice(n,r),l=e.slice(t,o),d=0;d<c;++d)if(p[d]!==l[d]){i=p[d],a=l[d];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(e,t,o){return-1!==this.indexOf(e,t,o)},s.prototype.indexOf=function(e,t,o){return g(this,e,t,o,!0)},s.prototype.lastIndexOf=function(e,t,o){return g(this,e,t,o,!1)},s.prototype.write=function(e,t,o,n){if(void 0===t)n="utf8",o=this.length,t=0;else if(void 0===o&&"string"==typeof t)n=t,o=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(o)?(o>>>=0,void 0===n&&(n="utf8")):(n=o,o=void 0)}var r=this.length-t;if((void 0===o||o>r)&&(o=r),e.length>0&&(o<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return y(this,e,t,o);case"utf8":case"utf-8":return b(this,e,t,o);case"ascii":case"latin1":case"binary":return w(this,e,t,o);case"base64":return x(this,e,t,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,o);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function E(e,t,o){var n="";o=Math.min(e.length,o);for(var r=t;r<o;++r)n+=String.fromCharCode(127&e[r]);return n}function N(e,t,o){var n="";o=Math.min(e.length,o);for(var r=t;r<o;++r)n+=String.fromCharCode(e[r]);return n}function T(e,t,o){var n=e.length;(!t||t<0)&&(t=0),(!o||o<0||o>n)&&(o=n);for(var r="",i=t;i<o;++i)r+=G[e[i]];return r}function $(e,t,o){for(var n=e.slice(t,o),r="",i=0;i<n.length-1;i+=2)r+=String.fromCharCode(n[i]+256*n[i+1]);return r}function k(e,t,o){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>o)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,o,n,r,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(o+n>e.length)throw new RangeError("Index out of range")}function A(e,t,o,n,r,i){if(o+n>e.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function O(e,t,o,r,i){return t=+t,o>>>=0,i||A(e,0,o,4),n.write(e,t,o,r,23,4),o+4}function M(e,t,o,r,i){return t=+t,o>>>=0,i||A(e,0,o,8),n.write(e,t,o,r,52,8),o+8}s.prototype.slice=function(e,t){var o=this.length;(e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,o){e>>>=0,t>>>=0,o||k(e,t,this.length);for(var n=this[e],r=1,i=0;++i<t&&(r*=256);)n+=this[e+i]*r;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,o){e>>>=0,t>>>=0,o||k(e,t,this.length);for(var n=this[e+--t],r=1;t>0&&(r*=256);)n+=this[e+--t]*r;return n},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,o){e>>>=0,t>>>=0,o||k(e,t,this.length);for(var n=this[e],r=1,i=0;++i<t&&(r*=256);)n+=this[e+i]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,o){e>>>=0,t>>>=0,o||k(e,t,this.length);for(var n=t,r=1,i=this[e+--n];n>0&&(r*=256);)i+=this[e+--n]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},s.prototype.readInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||k(e,2,this.length);var o=this[e]|this[e+1]<<8;return 32768&o?4294901760|o:o},s.prototype.readInt16BE=function(e,t){e>>>=0,t||k(e,2,this.length);var o=this[e+1]|this[e]<<8;return 32768&o?4294901760|o:o},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||k(e,4,this.length),n.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||k(e,4,this.length),n.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||k(e,8,this.length),n.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||k(e,8,this.length),n.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,o,n){(e=+e,t>>>=0,o>>>=0,n)||P(this,e,t,o,Math.pow(2,8*o)-1,0);var r=1,i=0;for(this[t]=255&e;++i<o&&(r*=256);)this[t+i]=e/r&255;return t+o},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,o,n){(e=+e,t>>>=0,o>>>=0,n)||P(this,e,t,o,Math.pow(2,8*o)-1,0);var r=o-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+o},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,o,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*o-1);P(this,e,t,o,r-1,-r)}var i=0,a=1,s=0;for(this[t]=255&e;++i<o&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+o},s.prototype.writeIntBE=function(e,t,o,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*o-1);P(this,e,t,o,r-1,-r)}var i=o-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+o},s.prototype.writeInt8=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,o){return e=+e,t>>>=0,o||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,o){return O(this,e,t,!0,o)},s.prototype.writeFloatBE=function(e,t,o){return O(this,e,t,!1,o)},s.prototype.writeDoubleLE=function(e,t,o){return M(this,e,t,!0,o)},s.prototype.writeDoubleBE=function(e,t,o){return M(this,e,t,!1,o)},s.prototype.copy=function(e,t,o,n){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(o||(o=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<o&&(n=o),n===o)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-o&&(n=e.length-t+o);var r=n-o;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,o,n):Uint8Array.prototype.set.call(e,this.subarray(o,n),t),r},s.prototype.fill=function(e,t,o,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,o=this.length):"string"==typeof o&&(n=o,o=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var r=e.charCodeAt(0);("utf8"===n&&r<128||"latin1"===n)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<o)throw new RangeError("Out of range index");if(o<=t)return this;var i;if(t>>>=0,o=void 0===o?this.length:o>>>0,e||(e=0),"number"==typeof e)for(i=t;i<o;++i)this[i]=e;else{var a=s.isBuffer(e)?e:s.from(e,n),c=a.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<o-t;++i)this[i+t]=a[i%c]}return this};var L=/[^+/0-9A-Za-z-_]/g;function R(e,t){var o;t=t||1/0;for(var n=e.length,r=null,i=[],a=0;a<n;++a){if((o=e.charCodeAt(a))>55295&&o<57344){if(!r){if(o>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&i.push(239,191,189);continue}r=o;continue}if(o<56320){(t-=3)>-1&&i.push(239,191,189),r=o;continue}o=65536+(r-55296<<10|o-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,o<128){if((t-=1)<0)break;i.push(o)}else if(o<2048){if((t-=2)<0)break;i.push(o>>6|192,63&o|128)}else if(o<65536){if((t-=3)<0)break;i.push(o>>12|224,o>>6&63|128,63&o|128)}else{if(!(o<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(o>>18|240,o>>12&63|128,o>>6&63|128,63&o|128)}}return i}function D(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,o,n){for(var r=0;r<n&&!(r+o>=t.length||r>=e.length);++r)t[r+o]=e[r];return r}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function j(e){return e!=e}var G=function(){for(var e=new Array(256),t=0;t<16;++t)for(var o=16*t,n=0;n<16;++n)e[o+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}()}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":2,buffer:4,ieee754:16}],5:[function(e,t,o){(function(e){(function(){var o=function(){function t(e,t){return null!=t&&e instanceof t}var o,n,r;try{o=Map}catch(e){o=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,c,p,l,d){"object"==typeof c&&(p=c.depth,l=c.prototype,d=c.includeNonEnumerable,c=c.circular);var u=[],f=[],h=void 0!==e;return void 0===c&&(c=!0),void 0===p&&(p=1/0),function a(p,m){if(null===p)return null;if(0===m)return p;var g,v;if("object"!=typeof p)return p;if(t(p,o))g=new o;else if(t(p,n))g=new n;else if(t(p,r))g=new r(function(e,t){p.then(function(t){e(a(t,m-1))},function(e){t(a(e,m-1))})});else if(i.__isArray(p))g=[];else if(i.__isRegExp(p))g=new RegExp(p.source,s(p)),p.lastIndex&&(g.lastIndex=p.lastIndex);else if(i.__isDate(p))g=new Date(p.getTime());else{if(h&&e.isBuffer(p))return g=e.allocUnsafe?e.allocUnsafe(p.length):new e(p.length),p.copy(g),g;t(p,Error)?g=Object.create(p):void 0===l?(v=Object.getPrototypeOf(p),g=Object.create(v)):(g=Object.create(l),v=l)}if(c){var y=u.indexOf(p);if(-1!=y)return f[y];u.push(p),f.push(g)}for(var b in t(p,o)&&p.forEach(function(e,t){var o=a(t,m-1),n=a(e,m-1);g.set(o,n)}),t(p,n)&&p.forEach(function(e){var t=a(e,m-1);g.add(t)}),p){var w;v&&(w=Object.getOwnPropertyDescriptor(v,b)),w&&null==w.set||(g[b]=a(p[b],m-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(p);for(b=0;b<x.length;b++){var S=x[b];(!(I=Object.getOwnPropertyDescriptor(p,S))||I.enumerable||d)&&(g[S]=a(p[S],m-1),I.enumerable||Object.defineProperty(g,S,{enumerable:!1}))}}if(d){var C=Object.getOwnPropertyNames(p);for(b=0;b<C.length;b++){var I,_=C[b];(I=Object.getOwnPropertyDescriptor(p,_))&&I.enumerable||(g[_]=a(p[_],m-1),Object.defineProperty(g,_,{enumerable:!1}))}}return g}(a,p)}function a(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=s,i}();"object"==typeof t&&t.exports&&(t.exports=o)}).call(this)}).call(this,e("buffer").Buffer)},{buffer:4}],6:[function(e,t,o){o.linear=function(e){return e},o.inQuad=function(e){return e*e},o.outQuad=function(e){return e*(2-e)},o.inOutQuad=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},o.inCube=function(e){return e*e*e},o.outCube=function(e){return--e*e*e+1},o.inOutCube=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},o.inQuart=function(e){return e*e*e*e},o.outQuart=function(e){return 1- --e*e*e*e},o.inOutQuart=function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},o.inQuint=function(e){return e*e*e*e*e},o.outQuint=function(e){return--e*e*e*e*e+1},o.inOutQuint=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},o.inSine=function(e){return 1-Math.cos(e*Math.PI/2)},o.outSine=function(e){return Math.sin(e*Math.PI/2)},o.inOutSine=function(e){return.5*(1-Math.cos(Math.PI*e))},o.inExpo=function(e){return 0==e?0:Math.pow(1024,e-1)},o.outExpo=function(e){return 1==e?e:1-Math.pow(2,-10*e)},o.inOutExpo=function(e){return 0==e?0:1==e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},o.inCirc=function(e){return 1-Math.sqrt(1-e*e)},o.outCirc=function(e){return Math.sqrt(1- --e*e)},o.inOutCirc=function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},o.inBack=function(e){var t=1.70158;return e*e*((t+1)*e-t)},o.outBack=function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},o.inOutBack=function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},o.inBounce=function(e){return 1-o.outBounce(1-e)},o.outBounce=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},o.inOutBounce=function(e){return e<.5?.5*o.inBounce(2*e):.5*o.outBounce(2*e-1)+.5},o["in-quad"]=o.inQuad,o["out-quad"]=o.outQuad,o["in-out-quad"]=o.inOutQuad,o["in-cube"]=o.inCube,o["out-cube"]=o.outCube,o["in-out-cube"]=o.inOutCube,o["in-quart"]=o.inQuart,o["out-quart"]=o.outQuart,o["in-out-quart"]=o.inOutQuart,o["in-quint"]=o.inQuint,o["out-quint"]=o.outQuint,o["in-out-quint"]=o.inOutQuint,o["in-sine"]=o.inSine,o["out-sine"]=o.outSine,o["in-out-sine"]=o.inOutSine,o["in-expo"]=o.inExpo,o["out-expo"]=o.outExpo,o["in-out-expo"]=o.inOutExpo,o["in-circ"]=o.inCirc,o["out-circ"]=o.outCirc,o["in-out-circ"]=o.inOutCirc,o["in-back"]=o.inBack,o["out-back"]=o.outBack,o["in-out-back"]=o.inOutBack,o["in-bounce"]=o.inBounce,o["out-bounce"]=o.outBounce,o["in-out-bounce"]=o.inOutBounce},{}],7:[function(e,t,o){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,o,n,s,c,p;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(a(o=this._events[e]))return!1;if(r(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),o.apply(this,s)}else if(i(o))for(s=Array.prototype.slice.call(arguments,1),n=(p=o.slice()).length,c=0;c<n;c++)p[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var o=!1;function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var o,n,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(o=this._events[e]).length,n=-1,o===t||r(o.listener)&&o.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(o)){for(s=a;s-- >0;)if(o[s]===t||o[s].listener&&o[s].listener===t){n=s;break}if(n<0)return this;1===o.length?(o.length=0,delete this._events[e]):o.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,o;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(o=this._events[e]))this.removeListener(e,o);else if(o)for(;o.length;)this.removeListener(e,o[o.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],8:[function(e,t,o){o.graph=e("./lib/Graph"),o.Graph=o.graph.Graph,o.journal=e("./lib/Journal"),o.Journal=o.journal.Journal},{"./lib/Graph":9,"./lib/Journal":10}],9:[function(e,t,o){(function(){var t,n,r,i,a,s,c={}.hasOwnProperty;t=e("events").EventEmitter,r=e("clone"),a=e("./Platform"),n=function(o){function n(e,t){this.name=null!=e?e:"",null==t&&(t={}),this.properties={},this.nodes=[],this.edges=[],this.initializers=[],this.exports=[],this.inports={},this.outports={},this.groups=[],this.transaction={id:null,depth:0},this.caseSensitive=t.caseSensitive||!1}return function(e,t){for(var o in t)c.call(t,o)&&(e[o]=t[o]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,t),n.prototype.name="",n.prototype.caseSensitive=!1,n.prototype.properties={},n.prototype.nodes=[],n.prototype.edges=[],n.prototype.initializers=[],n.prototype.exports=[],n.prototype.inports={},n.prototype.outports={},n.prototype.groups=[],n.prototype.getPortName=function(e){return this.caseSensitive?e:e.toLowerCase()},n.prototype.startTransaction=function(e,t){if(this.transaction.id)throw Error("Nested transactions not supported");return this.transaction.id=e,this.transaction.depth=1,this.emit("startTransaction",e,t)},n.prototype.endTransaction=function(e,t){if(!this.transaction.id)throw Error("Attempted to end non-existing transaction");return this.transaction.id=null,this.transaction.depth=0,this.emit("endTransaction",e,t)},n.prototype.checkTransactionStart=function(){return this.transaction.id?"implicit"===this.transaction.id?this.transaction.depth+=1:void 0:this.startTransaction("implicit")},n.prototype.checkTransactionEnd=function(){if("implicit"===this.transaction.id&&(this.transaction.depth-=1),0===this.transaction.depth)return this.endTransaction("implicit")},n.prototype.setProperties=function(e){var t,o,n;for(o in this.checkTransactionStart(),t=r(this.properties),e)n=e[o],this.properties[o]=n;return this.emit("changeProperties",this.properties,t),this.checkTransactionEnd()},n.prototype.addExport=function(e,t,o,n){var r;if(null==n&&(n={x:0,y:0}),a.deprecated("fbp-graph.Graph exports is deprecated: please use specific inport or outport instead"),this.getNode(t))return this.checkTransactionStart(),r={public:this.getPortName(e),process:t,port:this.getPortName(o),metadata:n},this.exports.push(r),this.emit("addExport",r),this.checkTransactionEnd()},n.prototype.removeExport=function(e){var t,o,n,r,i,s;for(a.deprecated("fbp-graph.Graph exports is deprecated: please use specific inport or outport instead"),e=this.getPortName(e),o=null,r=n=0,i=(s=this.exports).length;n<i;r=++n)(t=s[r]).public===e&&(o=t);if(o)return this.checkTransactionStart(),this.exports.splice(this.exports.indexOf(o),1),this.emit("removeExport",o),this.checkTransactionEnd()},n.prototype.addInport=function(e,t,o,n){if(this.getNode(t))return e=this.getPortName(e),this.checkTransactionStart(),this.inports[e]={process:t,port:this.getPortName(o),metadata:n},this.emit("addInport",e,this.inports[e]),this.checkTransactionEnd()},n.prototype.removeInport=function(e){var t;if(e=this.getPortName(e),this.inports[e])return this.checkTransactionStart(),t=this.inports[e],this.setInportMetadata(e,{}),delete this.inports[e],this.emit("removeInport",e,t),this.checkTransactionEnd()},n.prototype.renameInport=function(e,t){if(e=this.getPortName(e),t=this.getPortName(t),this.inports[e])return this.checkTransactionStart(),this.inports[t]=this.inports[e],delete this.inports[e],this.emit("renameInport",e,t),this.checkTransactionEnd()},n.prototype.setInportMetadata=function(e,t){var o,n,i;if(e=this.getPortName(e),this.inports[e]){for(n in this.checkTransactionStart(),o=r(this.inports[e].metadata),this.inports[e].metadata||(this.inports[e].metadata={}),t)null!=(i=t[n])?this.inports[e].metadata[n]=i:delete this.inports[e].metadata[n];return this.emit("changeInport",e,this.inports[e],o),this.checkTransactionEnd()}},n.prototype.addOutport=function(e,t,o,n){if(this.getNode(t))return e=this.getPortName(e),this.checkTransactionStart(),this.outports[e]={process:t,port:this.getPortName(o),metadata:n},this.emit("addOutport",e,this.outports[e]),this.checkTransactionEnd()},n.prototype.removeOutport=function(e){var t;if(e=this.getPortName(e),this.outports[e])return this.checkTransactionStart(),t=this.outports[e],this.setOutportMetadata(e,{}),delete this.outports[e],this.emit("removeOutport",e,t),this.checkTransactionEnd()},n.prototype.renameOutport=function(e,t){if(e=this.getPortName(e),t=this.getPortName(t),this.outports[e])return this.checkTransactionStart(),this.outports[t]=this.outports[e],delete this.outports[e],this.emit("renameOutport",e,t),this.checkTransactionEnd()},n.prototype.setOutportMetadata=function(e,t){var o,n,i;if(e=this.getPortName(e),this.outports[e]){for(n in this.checkTransactionStart(),o=r(this.outports[e].metadata),this.outports[e].metadata||(this.outports[e].metadata={}),t)null!=(i=t[n])?this.outports[e].metadata[n]=i:delete this.outports[e].metadata[n];return this.emit("changeOutport",e,this.outports[e],o),this.checkTransactionEnd()}},n.prototype.addGroup=function(e,t,o){var n;return this.checkTransactionStart(),n={name:e,nodes:t,metadata:o},this.groups.push(n),this.emit("addGroup",n),this.checkTransactionEnd()},n.prototype.renameGroup=function(e,t){var o,n,r,i;for(this.checkTransactionStart(),n=0,r=(i=this.groups).length;n<r;n++)(o=i[n])&&o.name===e&&(o.name=t,this.emit("renameGroup",e,t));return this.checkTransactionEnd()},n.prototype.removeGroup=function(e){var t,o,n,r;for(this.checkTransactionStart(),o=0,n=(r=this.groups).length;o<n;o++)(t=r[o])&&t.name===e&&(this.setGroupMetadata(t.name,{}),this.groups.splice(this.groups.indexOf(t),1),this.emit("removeGroup",t));return this.checkTransactionEnd()},n.prototype.setGroupMetadata=function(e,t){var o,n,i,a,s,c,p;for(this.checkTransactionStart(),i=0,s=(c=this.groups).length;i<s;i++)if((n=c[i])&&n.name===e){for(a in o=r(n.metadata),t)null!=(p=t[a])?n.metadata[a]=p:delete n.metadata[a];this.emit("changeGroup",n,o)}return this.checkTransactionEnd()},n.prototype.addNode=function(e,t,o){var n;return this.checkTransactionStart(),o||(o={}),n={id:e,component:t,metadata:o},this.nodes.push(n),this.emit("addNode",n),this.checkTransactionEnd(),n},n.prototype.removeNode=function(e){var t,o,n,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_,E,N,T,$,k,P,A;if(x=this.getNode(e)){for(this.checkTransactionStart(),A=[],r=0,l=(E=this.edges).length;r<l;r++)(t=E[r]).from.node!==x.id&&t.to.node!==x.id||A.push(t);for(s=0,d=A.length;s<d;s++)t=A[s],this.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);for(A=[],c=0,u=(N=this.initializers).length;c<u;c++)(a=N[c]).to.node===x.id&&A.push(a);for(p=0,f=A.length;p<f;p++)a=A[p],this.removeInitial(a.to.node,a.to.port);for(A=[],b=0,h=(T=this.exports).length;b<h;b++)o=T[b],this.getPortName(e)===o.process&&A.push(o);for(w=0,m=A.length;w<m;w++)o=A[w],this.removeExport(o.public);for(I in A=[],$=this.inports)$[I].process===e&&A.push(I);for(S=0,g=A.length;S<g;S++)I=A[S],this.removeInport(I);for(I in A=[],k=this.outports)k[I].process===e&&A.push(I);for(C=0,v=A.length;C<v;C++)I=A[C],this.removeOutport(I);for(_=0,y=(P=this.groups).length;_<y;_++)(n=P[_])&&-1!==(i=n.nodes.indexOf(e))&&n.nodes.splice(i,1);return this.setNodeMetadata(e,{}),-1!==this.nodes.indexOf(x)&&this.nodes.splice(this.nodes.indexOf(x),1),this.emit("removeNode",x),this.checkTransactionEnd()}},n.prototype.getNode=function(e){var t,o,n,r;for(t=0,o=(r=this.nodes).length;t<o;t++)if((n=r[t])&&n.id===e)return n;return null},n.prototype.renameNode=function(e,t){var o,n,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C;if(this.checkTransactionStart(),m=this.getNode(e)){for(m.id=t,i=0,d=(y=this.edges).length;i<d;i++)(o=y[i])&&(o.from.node===e&&(o.from.node=t),o.to.node===e&&(o.to.node=t));for(c=0,u=(b=this.initializers).length;c<u;c++)(a=b[c])&&a.to.node===e&&(a.to.node=t);for(v in w=this.inports)(g=w[v]).process===e&&(g.process=t);for(v in x=this.outports)(g=x[v]).process===e&&(g.process=t);for(p=0,f=(S=this.exports).length;p<f;p++)(n=S[p]).process===e&&(n.process=t);for(l=0,h=(C=this.groups).length;l<h;l++)(r=C[l])&&-1!==(s=r.nodes.indexOf(e))&&(r.nodes[s]=t);return this.emit("renameNode",e,t),this.checkTransactionEnd()}},n.prototype.setNodeMetadata=function(e,t){var o,n,i,a;if(i=this.getNode(e)){for(n in this.checkTransactionStart(),o=r(i.metadata),i.metadata||(i.metadata={}),t)null!=(a=t[n])?i.metadata[n]=a:delete i.metadata[n];return this.emit("changeNode",i,o),this.checkTransactionEnd()}},n.prototype.addEdge=function(e,t,o,n,r){var i,a,s,c;for(null==r&&(r={}),t=this.getPortName(t),n=this.getPortName(n),a=0,s=(c=this.edges).length;a<s;a++)if((i=c[a]).from.node===e&&i.from.port===t&&i.to.node===o&&i.to.port===n)return;if(this.getNode(e)&&this.getNode(o))return this.checkTransactionStart(),i={from:{node:e,port:t},to:{node:o,port:n},metadata:r},this.edges.push(i),this.emit("addEdge",i),this.checkTransactionEnd(),i},n.prototype.addEdgeIndex=function(e,t,o,n,r,i,a){var s;if(null==a&&(a={}),this.getNode(e)&&this.getNode(n))return t=this.getPortName(t),r=this.getPortName(r),null===i&&(i=void 0),null===o&&(o=void 0),a||(a={}),this.checkTransactionStart(),s={from:{node:e,port:t,index:o},to:{node:n,port:r,index:i},metadata:a},this.edges.push(s),this.emit("addEdge",s),this.checkTransactionEnd(),s},n.prototype.removeEdge=function(e,t,o,n){var r,i,a,s,c,p,l,d,u,f,h,m;if(this.checkTransactionStart(),t=this.getPortName(t),n=this.getPortName(n),m=[],h=[],o&&n)for(a=i=0,p=(u=this.edges).length;i<p;a=++i)(r=u[a]).from.node===e&&r.from.port===t&&r.to.node===o&&r.to.port===n?(this.setEdgeMetadata(r.from.node,r.from.port,r.to.node,r.to.port,{}),m.push(r)):h.push(r);else for(a=s=0,l=(f=this.edges).length;s<l;a=++s)(r=f[a]).from.node===e&&r.from.port===t||r.to.node===e&&r.to.port===t?(this.setEdgeMetadata(r.from.node,r.from.port,r.to.node,r.to.port,{}),m.push(r)):h.push(r);for(this.edges=h,c=0,d=m.length;c<d;c++)r=m[c],this.emit("removeEdge",r);return this.checkTransactionEnd()},n.prototype.getEdge=function(e,t,o,n){var r,i,a,s,c;for(t=this.getPortName(t),n=this.getPortName(n),a=i=0,s=(c=this.edges).length;i<s;a=++i)if((r=c[a])&&r.from.node===e&&r.from.port===t&&r.to.node===o&&r.to.port===n)return r;return null},n.prototype.setEdgeMetadata=function(e,t,o,n,i){var a,s,c,p;if(s=this.getEdge(e,t,o,n)){for(c in this.checkTransactionStart(),a=r(s.metadata),s.metadata||(s.metadata={}),i)null!=(p=i[c])?s.metadata[c]=p:delete s.metadata[c];return this.emit("changeEdge",s,a),this.checkTransactionEnd()}},n.prototype.addInitial=function(e,t,o,n){var r;if(this.getNode(t))return o=this.getPortName(o),this.checkTransactionStart(),r={from:{data:e},to:{node:t,port:o},metadata:n},this.initializers.push(r),this.emit("addInitial",r),this.checkTransactionEnd(),r},n.prototype.addInitialIndex=function(e,t,o,n,r){var i;if(this.getNode(t))return null===n&&(n=void 0),o=this.getPortName(o),this.checkTransactionStart(),i={from:{data:e},to:{node:t,port:o,index:n},metadata:r},this.initializers.push(i),this.emit("addInitial",i),this.checkTransactionEnd(),i},n.prototype.addGraphInitial=function(e,t,o){var n;if(n=this.inports[t])return this.addInitial(e,n.process,n.port,o)},n.prototype.addGraphInitialIndex=function(e,t,o,n){var r;if(r=this.inports[t])return this.addInitialIndex(e,r.process,r.port,o,n)},n.prototype.removeInitial=function(e,t){var o,n,r,i,a,s,c,p,l;for(t=this.getPortName(t),this.checkTransactionStart(),l=[],p=[],r=n=0,a=(c=this.initializers).length;n<a;r=++n)(o=c[r]).to.node===e&&o.to.port===t?l.push(o):p.push(o);for(this.initializers=p,i=0,s=l.length;i<s;i++)o=l[i],this.emit("removeInitial",o);return this.checkTransactionEnd()},n.prototype.removeGraphInitial=function(e){var t;if(t=this.inports[e])return this.removeInitial(t.process,t.port)},n.prototype.toDOT=function(){var e,t,o,n,r,i,a,s,c,p,l,d,u,f,h,m;for(e=function(e){return e.replace(/\s*/g,"")},t=function(e){return e.replace(/\./g,"")},o="digraph {\n",r=0,p=(f=this.nodes).length;r<p;r++)o+="    "+e((u=f[r]).id)+" [label="+u.id+" shape=box]\n";for(i=s=0,l=(h=this.initializers).length;s<l;i=++s)o+="    data"+i+" [label=\"'"+("function"==typeof(a=h[i]).from.data?"Function":a.from.data)+"'\" shape=plaintext]\n",o+="    data"+i+" -> "+e(a.to.node)+"[headlabel="+t(a.to.port)+" labelfontcolor=blue labelfontsize=8.0]\n";for(c=0,d=(m=this.edges).length;c<d;c++)o+="    "+e((n=m[c]).from.node)+" -> "+e(n.to.node)+"[taillabel="+t(n.from.port)+" headlabel="+t(n.to.port)+" labelfontcolor=blue labelfontsize=8.0]\n";return o+="}"},n.prototype.toYUML=function(){var e,t,o,n,r,i,a,s,c;for(c=[],t=0,r=(a=this.initializers).length;t<r;t++)o=a[t],c.push("(start)["+o.to.port+"]->("+o.to.node+")");for(n=0,i=(s=this.edges).length;n<i;n++)e=s[n],c.push("("+e.from.node+")["+e.from.port+"]->("+e.to.node+")");return c.join(",")},n.prototype.toJSON=function(){var e,t,o,n,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_,E,N,T,$;for(b in c={caseSensitive:this.caseSensitive,properties:{},inports:{},outports:{},groups:[],processes:{},connections:[]},this.name&&(c.properties.name=this.name),x=this.properties)$=x[b],c.properties[b]=$;for(w in S=this.inports)y=S[w],c.inports[w]=y;for(w in C=this.outports)y=C[w],c.outports[w]=y;for(i=0,d=(I=this.exports).length;i<d;i++)o=I[i],c.exports||(c.exports=[]),c.exports.push(o);for(s=0,u=(_=this.groups).length;s<u;s++)r={name:(n=_[s]).name,nodes:n.nodes},Object.keys(n.metadata).length&&(r.metadata=n.metadata),c.groups.push(r);for(p=0,f=(E=this.nodes).length;p<f;p++)v=E[p],c.processes[v.id]={component:v.component},v.metadata&&(c.processes[v.id].metadata=v.metadata);for(l=0,h=(N=this.edges).length;l<h;l++)e={src:{process:(t=N[l]).from.node,port:t.from.port,index:t.from.index},tgt:{process:t.to.node,port:t.to.port,index:t.to.index}},Object.keys(t.metadata).length&&(e.metadata=t.metadata),c.connections.push(e);for(g=0,m=(T=this.initializers).length;g<m;g++)a=T[g],c.connections.push({data:a.from.data,tgt:{process:a.to.node,port:a.to.port,index:a.to.index}});return c},n.prototype.save=function(t,o){var n;return a.isBrowser()?o(new Error("Saving graphs not supported on browser")):(n=JSON.stringify(this.toJSON(),null,4),e("fs").writeFile(t+".json",n,"utf-8",function(e,n){if(e)throw e;return o(t)}))},n}(),o.Graph=n,o.createGraph=function(e,t){return new n(e,t)},o.loadJSON=function(e,t,o){var r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_,E,N,T,$,k,P;for(x in null==o&&(o={}),"string"==typeof e&&(e=JSON.parse(e)),e.properties||(e.properties={}),e.processes||(e.processes={}),e.connections||(e.connections=[]),r=e.caseSensitive||!1,(c=new n(e.properties.name,{caseSensitive:r})).startTransaction("loadJSON",o),w={},C=e.properties)P=C[x],"name"!==x&&(w[x]=P);for(d in c.setProperties(w),I=e.processes)(a=I[d]).metadata||(a.metadata={}),c.addNode(d,a.component,a.metadata);for(l=0,h=(_=e.connections).length;l<h;l++)o=(i=_[l]).metadata?i.metadata:{},void 0===i.data?"number"!=typeof i.src.index&&"number"!=typeof i.tgt.index?c.addEdge(i.src.process,c.getPortName(i.src.port),i.tgt.process,c.getPortName(i.tgt.port),o):c.addEdgeIndex(i.src.process,c.getPortName(i.src.port),i.src.index,i.tgt.process,c.getPortName(i.tgt.port),i.tgt.index,o):"number"==typeof i.tgt.index?c.addInitialIndex(i.data,i.tgt.process,c.getPortName(i.tgt.port),i.tgt.index,o):c.addInitial(i.data,i.tgt.process,c.getPortName(i.tgt.port),o);if(e.exports&&e.exports.length)for(u=0,m=(E=e.exports).length;u<m;u++){if((s=E[u]).private){if(2!==(k=s.private.split(".")).length)continue;for(d in b=k[0],v=k[1],e.processes)c.getPortName(d)===c.getPortName(b)&&(b=d)}else b=s.process,v=c.getPortName(s.port);c.addExport(s.public,b,v,s.metadata)}if(e.inports)for(S in N=e.inports)y=N[S],c.addInport(S,y.process,c.getPortName(y.port),y.metadata);if(e.outports)for(S in T=e.outports)y=T[S],c.addOutport(S,y.process,c.getPortName(y.port),y.metadata);if(e.groups)for(f=0,g=($=e.groups).length;f<g;f++)p=$[f],c.addGroup(p.name,p.nodes,p.metadata||{});return c.endTransaction("loadJSON"),t(null,c)},o.loadFBP=function(t,n,r,i){var a,s;null==r&&(r={}),null==i&&(i=!1);try{a=e("fbp").parse(t,{caseSensitive:i})}catch(s){return n(s)}return o.loadJSON(a,n,r)},o.loadHTTP=function(e,t){var o;return(o=new XMLHttpRequest).onreadystatechange=function(){if(4===o.readyState)return 200!==o.status?t(new Error("Failed to load "+e+": HTTP "+o.status)):t(null,o.responseText)},o.open("GET",e,!0),o.send()},o.loadFile=function(t,n,r,i){if(null==r&&(r={}),null==i&&(i=!1),!a.isBrowser())return e("fs").readFile(t,"utf-8",function(e,r){var a;return e?n(e):"fbp"===t.split(".").pop()?o.loadFBP(r,n,{},i):(a=JSON.parse(r),o.loadJSON(a,n,{}))});o.loadHTTP(t,function(e,i){var a;return e?n(e):"fbp"===t.split(".").pop()?o.loadFBP(i,n,r):(a=JSON.parse(i),o.loadJSON(a,n,r))})},s=function(e){var t,o,n,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_;for(i=0,l=(y=r(e.groups).reverse()).length;i<l;i++)null!=(n=y[i])&&e.removeGroup(n.name);for(v in b=r(e.outports))b[v],e.removeOutport(v);for(v in w=r(e.inports))w[v],e.removeInport(v);for(s=0,d=(x=r(e.exports.reverse())).length;s<d;s++)o=x[s],e.removeExport(o.public);for(e.setProperties({}),c=0,u=(S=r(e.initializers).reverse()).length;c<u;c++)a=S[c],e.removeInitial(a.to.node,a.to.port);for(p=0,f=(C=r(e.edges).reverse()).length;p<f;p++)t=C[p],e.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);for(_=[],m=0,h=(I=r(e.nodes).reverse()).length;m<h;m++)g=I[m],_.push(e.removeNode(g.id));return _},i=function(e,t){var o,n,r,i,a,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_,E,N;for(s(e),i=0,d=(w=t.nodes).length;i<d;i++)v=w[i],e.addNode(v.id,v.component,v.metadata);for(c=0,u=(x=t.edges).length;c<u;c++)o=x[c],e.addEdge(o.from.node,o.from.port,o.to.node,o.to.port,o.metadata);for(p=0,f=(S=t.initializers).length;p<f;p++)a=S[p],e.addInitial(a.from.data,a.to.node,a.to.port,a.metadata);for(l=0,h=(C=t.exports).length;l<h;l++)n=C[l],e.addExport(n.public,n.node,n.port,n.metadata);for(b in e.setProperties(t.properties),I=t.inports)y=I[b],e.addInport(b,y.process,y.port,y.metadata);for(b in _=t.outports)y=_[b],e.addOutport(b,y.process,y.port,y.metadata);for(N=[],g=0,m=(E=t.groups).length;g<m;g++)r=E[g],N.push(e.addGroup(r.name,r.nodes,r.metadata));return N},o.equivalent=function(e,t,o){return null==o&&(o={}),JSON.stringify(e)===JSON.stringify(t)},o.mergeResolveTheirs=i}).call(this)},{"./Platform":11,clone:5,events:7,fbp:13,fs:3}],10:[function(e,t,o){(function(){var t,n,r,i,a,s,c,p=function(e,t){for(var o in t)l.call(t,o)&&(e[o]=t[o]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},l={}.hasOwnProperty,d=function(e,t){return function(){return e.apply(t,arguments)}};t=e("events").EventEmitter,s=e("clone"),c=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return t.id+"("+t.component+")";case"removeNode":return"DEL "+t.id+"("+t.component+")";case"renameNode":return"RENAME "+t.oldId+" "+t.newId;case"changeNode":return"META "+t.id;case"addEdge":return t.from.node+" "+t.from.port+" -> "+t.to.port+" "+t.to.node;case"removeEdge":return t.from.node+" "+t.from.port+" -X> "+t.to.port+" "+t.to.node;case"changeEdge":return"META "+t.from.node+" "+t.from.port+" -> "+t.to.port+" "+t.to.node;case"addInitial":return"'"+t.from.data+"' -> "+t.to.port+" "+t.to.node;case"removeInitial":return"'"+t.from.data+"' -X> "+t.to.port+" "+t.to.node;case"startTransaction":return">>> "+e.rev+": "+t.id;case"endTransaction":return"<<< "+e.rev+": "+t.id;case"changeProperties":return"PROPERTIES";case"addGroup":return"GROUP "+t.name;case"renameGroup":return"RENAME GROUP "+t.oldName+" "+t.newName;case"removeGroup":return"DEL GROUP "+t.name;case"changeGroup":return"META GROUP "+t.name;case"addInport":return"INPORT "+t.name;case"removeInport":return"DEL INPORT "+t.name;case"renameInport":return"RENAME INPORT "+t.oldId+" "+t.newId;case"changeInport":return"META INPORT "+t.name;case"addOutport":return"OUTPORT "+t.name;case"removeOutport":return"DEL OUTPORT "+t.name;case"renameOutport":return"RENAME OUTPORT "+t.oldId+" "+t.newId;case"changeOutport":return"META OUTPORT "+t.name;default:throw new Error("Unknown journal entry: "+e.cmd)}},a=function(e,t){var o,n,r;for(o in n={},e)r=e[o],n[o]=null;for(o in t)r=t[o],n[o]=r;return n},r=function(e){function o(e){this.graph=e,this.lastRevision=0}return p(o,t),o.prototype.lastRevision=0,o.prototype.putTransaction=function(e,t){return e>this.lastRevision&&(this.lastRevision=e),this.emit("transaction",e)},o.prototype.fetchTransaction=function(e,t){},o}(),i=function(e){function t(e){t.__super__.constructor.call(this,e),this.transactions=[]}return p(t,r),t.prototype.putTransaction=function(e,o){return t.__super__.putTransaction.call(this,e,o),this.transactions[e]=o},t.prototype.fetchTransaction=function(e){return this.transactions[e]},t}(),n=function(o){function n(e,t,o){var n,r,a,s,c,p,l,u,f,h,m,g,v,y,b,w,x,S,C,I,_;if(this.endTransaction=d(this.endTransaction,this),this.startTransaction=d(this.startTransaction,this),this.graph=e,this.entries=[],this.subscribed=!0,this.store=o||new i(this.graph),0===this.store.transactions.length){for(this.currentRevision=-1,this.startTransaction("initial",t),s=0,l=(y=this.graph.nodes).length;s<l;s++)v=y[s],this.appendCommand("addNode",v);for(p=0,u=(b=this.graph.edges).length;p<u;p++)n=b[p],this.appendCommand("addEdge",n);for(m=0,f=(w=this.graph.initializers).length;m<f;m++)a=w[m],this.appendCommand("addInitial",a);for(c in Object.keys(this.graph.properties).length>0&&this.appendCommand("changeProperties",this.graph.properties,{}),x=this.graph.inports)I=x[c],this.appendCommand("addInport",{name:c,port:I});for(c in S=this.graph.outports)I=S[c],this.appendCommand("addOutport",{name:c,port:I});for(g=0,h=(C=this.graph.groups).length;g<h;g++)r=C[g],this.appendCommand("addGroup",r);this.endTransaction("initial",t)}else this.currentRevision=this.store.lastRevision;this.graph.on("addNode",(_=this,function(e){return _.appendCommand("addNode",e)})),this.graph.on("removeNode",function(e){return function(t){return e.appendCommand("removeNode",t)}}(this)),this.graph.on("renameNode",function(e){return function(t,o){var n;return n={oldId:t,newId:o},e.appendCommand("renameNode",n)}}(this)),this.graph.on("changeNode",function(e){return function(t,o){return e.appendCommand("changeNode",{id:t.id,new:t.metadata,old:o})}}(this)),this.graph.on("addEdge",function(e){return function(t){return e.appendCommand("addEdge",t)}}(this)),this.graph.on("removeEdge",function(e){return function(t){return e.appendCommand("removeEdge",t)}}(this)),this.graph.on("changeEdge",function(e){return function(t,o){return e.appendCommand("changeEdge",{from:t.from,to:t.to,new:t.metadata,old:o})}}(this)),this.graph.on("addInitial",function(e){return function(t){return e.appendCommand("addInitial",t)}}(this)),this.graph.on("removeInitial",function(e){return function(t){return e.appendCommand("removeInitial",t)}}(this)),this.graph.on("changeProperties",function(e){return function(t,o){return e.appendCommand("changeProperties",{new:t,old:o})}}(this)),this.graph.on("addGroup",function(e){return function(t){return e.appendCommand("addGroup",t)}}(this)),this.graph.on("renameGroup",function(e){return function(t,o){return e.appendCommand("renameGroup",{oldName:t,newName:o})}}(this)),this.graph.on("removeGroup",function(e){return function(t){return e.appendCommand("removeGroup",t)}}(this)),this.graph.on("changeGroup",function(e){return function(t,o){return e.appendCommand("changeGroup",{name:t.name,new:t.metadata,old:o})}}(this)),this.graph.on("addExport",function(e){return function(t){return e.appendCommand("addExport",t)}}(this)),this.graph.on("removeExport",function(e){return function(t){return e.appendCommand("removeExport",t)}}(this)),this.graph.on("addInport",function(e){return function(t,o){return e.appendCommand("addInport",{name:t,port:o})}}(this)),this.graph.on("removeInport",function(e){return function(t,o){return e.appendCommand("removeInport",{name:t,port:o})}}(this)),this.graph.on("renameInport",function(e){return function(t,o){return e.appendCommand("renameInport",{oldId:t,newId:o})}}(this)),this.graph.on("changeInport",function(e){return function(t,o,n){return e.appendCommand("changeInport",{name:t,new:o.metadata,old:n})}}(this)),this.graph.on("addOutport",function(e){return function(t,o){return e.appendCommand("addOutport",{name:t,port:o})}}(this)),this.graph.on("removeOutport",function(e){return function(t,o){return e.appendCommand("removeOutport",{name:t,port:o})}}(this)),this.graph.on("renameOutport",function(e){return function(t,o){return e.appendCommand("renameOutport",{oldId:t,newId:o})}}(this)),this.graph.on("changeOutport",function(e){return function(t,o,n){return e.appendCommand("changeOutport",{name:t,new:o.metadata,old:n})}}(this)),this.graph.on("startTransaction",function(e){return function(t,o){return e.startTransaction(t,o)}}(this)),this.graph.on("endTransaction",function(e){return function(t,o){return e.endTransaction(t,o)}}(this))}return p(n,t),n.prototype.graph=null,n.prototype.entries=[],n.prototype.subscribed=!0,n.prototype.startTransaction=function(e,t){if(this.subscribed){if(this.entries.length>0)throw Error("Inconsistent @entries");return this.currentRevision++,this.appendCommand("startTransaction",{id:e,metadata:t},this.currentRevision)}},n.prototype.endTransaction=function(e,t){if(this.subscribed)return this.appendCommand("endTransaction",{id:e,metadata:t},this.currentRevision),this.store.putTransaction(this.currentRevision,this.entries),this.entries=[]},n.prototype.appendCommand=function(e,t,o){var n;if(this.subscribed)return n={cmd:e,args:s(t)},null!=o&&(n.rev=o),this.entries.push(n)},n.prototype.executeEntry=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return this.graph.addNode(t.id,t.component);case"removeNode":return this.graph.removeNode(t.id);case"renameNode":return this.graph.renameNode(t.oldId,t.newId);case"changeNode":return this.graph.setNodeMetadata(t.id,a(t.old,t.new));case"addEdge":return this.graph.addEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"removeEdge":return this.graph.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"changeEdge":return this.graph.setEdgeMetadata(t.from.node,t.from.port,t.to.node,t.to.port,a(t.old,t.new));case"addInitial":return this.graph.addInitial(t.from.data,t.to.node,t.to.port);case"removeInitial":return this.graph.removeInitial(t.to.node,t.to.port);case"startTransaction":case"endTransaction":return null;case"changeProperties":return this.graph.setProperties(t.new);case"addGroup":return this.graph.addGroup(t.name,t.nodes,t.metadata);case"renameGroup":return this.graph.renameGroup(t.oldName,t.newName);case"removeGroup":return this.graph.removeGroup(t.name);case"changeGroup":return this.graph.setGroupMetadata(t.name,a(t.old,t.new));case"addInport":return this.graph.addInport(t.name,t.port.process,t.port.port,t.port.metadata);case"removeInport":return this.graph.removeInport(t.name);case"renameInport":return this.graph.renameInport(t.oldId,t.newId);case"changeInport":return this.graph.setInportMetadata(t.name,a(t.old,t.new));case"addOutport":return this.graph.addOutport(t.name,t.port.process,t.port.port,t.port.metadata(t.name));case"removeOutport":return this.graph.removeOutport;case"renameOutport":return this.graph.renameOutport(t.oldId,t.newId);case"changeOutport":return this.graph.setOutportMetadata(t.name,a(t.old,t.new));default:throw new Error("Unknown journal entry: "+e.cmd)}},n.prototype.executeEntryInversed=function(e){var t;switch(t=e.args,e.cmd){case"addNode":return this.graph.removeNode(t.id);case"removeNode":return this.graph.addNode(t.id,t.component);case"renameNode":return this.graph.renameNode(t.newId,t.oldId);case"changeNode":return this.graph.setNodeMetadata(t.id,a(t.new,t.old));case"addEdge":return this.graph.removeEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"removeEdge":return this.graph.addEdge(t.from.node,t.from.port,t.to.node,t.to.port);case"changeEdge":return this.graph.setEdgeMetadata(t.from.node,t.from.port,t.to.node,t.to.port,a(t.new,t.old));case"addInitial":return this.graph.removeInitial(t.to.node,t.to.port);case"removeInitial":return this.graph.addInitial(t.from.data,t.to.node,t.to.port);case"startTransaction":case"endTransaction":return null;case"changeProperties":return this.graph.setProperties(t.old);case"addGroup":return this.graph.removeGroup(t.name);case"renameGroup":return this.graph.renameGroup(t.newName,t.oldName);case"removeGroup":return this.graph.addGroup(t.name,t.nodes,t.metadata);case"changeGroup":return this.graph.setGroupMetadata(t.name,a(t.new,t.old));case"addInport":return this.graph.removeInport(t.name);case"removeInport":return this.graph.addInport(t.name,t.port.process,t.port.port,t.port.metadata);case"renameInport":return this.graph.renameInport(t.newId,t.oldId);case"changeInport":return this.graph.setInportMetadata(t.name,a(t.new,t.old));case"addOutport":return this.graph.removeOutport(t.name);case"removeOutport":return this.graph.addOutport(t.name,t.port.process,t.port.port,t.port.metadata);case"renameOutport":return this.graph.renameOutport(t.newId,t.oldId);case"changeOutport":return this.graph.setOutportMetadata(t.name,a(t.new,t.old));default:throw new Error("Unknown journal entry: "+e.cmd)}},n.prototype.moveToRevision=function(e){var t,o,n,r,i,a,s,c,p,l,d,u,f;if(e!==this.currentRevision){if(this.subscribed=!1,e>this.currentRevision)for(p=r=l=this.currentRevision+1,d=e;l<=d?r<=d:r>=d;p=l<=d?++r:--r)for(i=0,a=(u=this.store.fetchTransaction(p)).length;i<a;i++)o=u[i],this.executeEntry(o);else for(p=s=this.currentRevision,f=e+1;s>=f;p=s+=-1)for(n=c=(t=this.store.fetchTransaction(p)).length-1;c>=0;n=c+=-1)this.executeEntryInversed(t[n]);return this.currentRevision=e,this.subscribed=!0}},n.prototype.undo=function(){if(this.canUndo())return this.moveToRevision(this.currentRevision-1)},n.prototype.canUndo=function(){return this.currentRevision>0},n.prototype.redo=function(){if(this.canRedo())return this.moveToRevision(this.currentRevision+1)},n.prototype.canRedo=function(){return this.currentRevision<this.store.lastRevision},n.prototype.toPrettyString=function(e,t){var o,n,r,i,a,s,p,l,d;for(s=[],p=r=l=e|=0,d=t|=this.store.lastRevision;l<=d?r<d:r>d;p=l<=d?++r:--r)for(i=0,a=(o=this.store.fetchTransaction(p)).length;i<a;i++)n=o[i],s.push(c(n));return s.join("\n")},n.prototype.toJSON=function(e,t){var o,n,r,i,a,s,p,l;for(o=[],s=r=e|=0,p=t|=this.store.lastRevision;r<p;s=r+=1)for(i=0,a=(l=this.store.fetchTransaction(s)).length;i<a;i++)n=l[i],o.push(c(n));return o},n.prototype.save=function(t,o){var n;return n=JSON.stringify(this.toJSON(),null,4),e("fs").writeFile(t+".json",n,"utf-8",function(e,n){if(e)throw e;return o(t)})},n}(),o.Journal=n,o.JournalStore=r,o.MemoryJournalStore=i}).call(this)},{clone:5,events:7,fs:3}],11:[function(e,t,o){(function(e){(function(){(function(){o.isBrowser=function(){return void 0===e||!e.execPath||!e.execPath.match(/node|iojs/)},o.deprecated=function(t){if(!o.isBrowser()){if(e.env.NOFLO_FATAL_DEPRECATED)throw new Error(t);return console.warn(t)}if(window.NOFLO_FATAL_DEPRECATED)throw new Error(t);console.warn(t)}}).call(this)}).call(this)}).call(this,e("_process"))},{_process:17}],12:[function(e,t,o){t.exports=function(){function t(e,o,n,r){this.message=e,this.expected=o,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(e,t){function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o}(t,Error),{SyntaxError:t,parse:function(o){var n,r,i=arguments.length>1?arguments[1]:{},a=this,s={},c={start:co},p=co,l=function(){return a.getResult()},d="INPORT=",u={type:"literal",value:"INPORT=",description:'"INPORT="'},f=".",h={type:"literal",value:".",description:'"."'},m=":",g={type:"literal",value:":",description:'":"'},v=function(e,t,o){return a.registerInports(e,t,o)},y="OUTPORT=",b={type:"literal",value:"OUTPORT=",description:'"OUTPORT="'},w=function(e,t,o){return a.registerOutports(e,t,o)},x="DEFAULT_INPORT=",S={type:"literal",value:"DEFAULT_INPORT=",description:'"DEFAULT_INPORT="'},C=function(e){Uo=e},I="DEFAULT_OUTPORT=",_={type:"literal",value:"DEFAULT_OUTPORT=",description:'"DEFAULT_OUTPORT="'},E=function(e){zo=e},N=function(e){return a.registerAnnotation(e[0],e[1])},T=function(e){return a.registerEdges(e)},$=",",k={type:"literal",value:",",description:'","'},P=/^[\n\r\u2028\u2029]/,A={type:"class",value:"[\\n\\r\\u2028\\u2029]",description:"[\\n\\r\\u2028\\u2029]"},O="#",M={type:"literal",value:"#",description:'"#"'},L="->",R={type:"literal",value:"->",description:'"->"'},D=function(e,t){return[e,t]},U=function(e,t,o){return[{tgt:Yo(t,e)},{src:Ko(t,o)}]},z=function(e,t){return{src:Ko(e,t)}},j=function(e,t){return{tgt:Yo(t,e)}},G="'",B={type:"literal",value:"'",description:'"\'"'},F=function(e){return{data:e.join("")}},H=function(e){return{data:e}},Y=function(e){return e},K=/^[a-zA-Z_]/,V={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},X=/^[a-zA-Z0-9_\-]/,q={type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},W=function(e){return Fo(e)},J=function(e,t){return a.addNode(e,t),e},Z=function(e){return a.addAnonymousNode(e,io(Qt,Zt).start.offset)},Q="(",ee={type:"literal",value:"(",description:'"("'},te=/^[a-zA-Z\/\-0-9_]/,oe={type:"class",value:"[a-zA-Z/\\-0-9_]",description:"[a-zA-Z/\\-0-9_]"},ne=")",re={type:"literal",value:")",description:'")"'},ie=function(e,t){var o={};return o.comp=e?e.join(""):"",t&&(o.meta=t.join("").split(",")),o},ae=/^[a-zA-Z\/=_,0-9]/,se={type:"class",value:"[a-zA-Z/=_,0-9]",description:"[a-zA-Z/=_,0-9]"},ce=function(e){return e},pe="@",le={type:"literal",value:"@",description:'"@"'},de=/^[a-zA-Z0-9\-_]/,ue={type:"class",value:"[a-zA-Z0-9\\-_]",description:"[a-zA-Z0-9\\-_]"},fe=/^[a-zA-Z0-9\-_ .]/,he={type:"class",value:"[a-zA-Z0-9\\-_ \\.]",description:"[a-zA-Z0-9\\-_ \\.]"},me=function(e,t){return[e.join(""),t.join("")]},ge=function(e,t){return{port:i.caseSensitive?e:e.toLowerCase(),index:null!=t?t:void 0}},ve=function(e){return e},ye=/^[a-zA-Z.0-9_]/,be={type:"class",value:"[a-zA-Z.0-9_]",description:"[a-zA-Z.0-9_]"},we=function(e){return Fo(e)},xe="[",Se={type:"literal",value:"[",description:'"["'},Ce=/^[0-9]/,Ie={type:"class",value:"[0-9]",description:"[0-9]"},_e="]",Ee={type:"literal",value:"]",description:'"]"'},Ne=function(e){return parseInt(e.join(""))},Te=/^[^\n\r\u2028\u2029]/,$e={type:"class",value:"[^\\n\\r\\u2028\\u2029]",description:"[^\\n\\r\\u2028\\u2029]"},ke=/^[\\]/,Pe={type:"class",value:"[\\\\]",description:"[\\\\]"},Ae=/^[']/,Oe={type:"class",value:"[']",description:"[']"},Me=function(){return"'"},Le=/^[^']/,Re={type:"class",value:"[^']",description:"[^']"},De=" ",Ue={type:"literal",value:" ",description:'" "'},ze=function(e){return e},je="{",Ge={type:"literal",value:"{",description:'"{"'},Be="}",Fe={type:"literal",value:"}",description:'"}"'},He={type:"other",description:"whitespace"},Ye=/^[ \t\n\r]/,Ke={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Ve="false",Xe={type:"literal",value:"false",description:'"false"'},qe=function(){return!1},We="null",Je={type:"literal",value:"null",description:'"null"'},Ze=function(){return null},Qe="true",et={type:"literal",value:"true",description:'"true"'},tt=function(){return!0},ot=function(e,t){return t},nt=function(e,t){var o,n={};for(n[e.name]=e.value,o=0;o<t.length;o++)n[t[o].name]=t[o].value;return n},rt=function(e){return null!==e?e:{}},it=function(e,t){return{name:e,value:t}},at=function(e,t){return t},st=function(e,t){return[e].concat(t)},ct=function(e){return null!==e?e:[]},pt={type:"other",description:"number"},lt=function(){return parseFloat(o.substring(Qt,Zt))},dt=/^[1-9]/,ut={type:"class",value:"[1-9]",description:"[1-9]"},ft=/^[eE]/,ht={type:"class",value:"[eE]",description:"[eE]"},mt="-",gt={type:"literal",value:"-",description:'"-"'},vt="+",yt={type:"literal",value:"+",description:'"+"'},bt="0",wt={type:"literal",value:"0",description:'"0"'},xt={type:"other",description:"string"},St=function(e){return e.join("")},Ct='"',It={type:"literal",value:'"',description:'"\\""'},_t="\\",Et={type:"literal",value:"\\",description:'"\\\\"'},Nt="/",Tt={type:"literal",value:"/",description:'"/"'},$t="b",kt={type:"literal",value:"b",description:'"b"'},Pt=function(){return"\b"},At="f",Ot={type:"literal",value:"f",description:'"f"'},Mt=function(){return"\f"},Lt="n",Rt={type:"literal",value:"n",description:'"n"'},Dt=function(){return"\n"},Ut="r",zt={type:"literal",value:"r",description:'"r"'},jt=function(){return"\r"},Gt="t",Bt={type:"literal",value:"t",description:'"t"'},Ft=function(){return"\t"},Ht="u",Yt={type:"literal",value:"u",description:'"u"'},Kt=function(e){return String.fromCharCode(parseInt(e,16))},Vt=function(e){return e},Xt=/^[^\0-\x1F"\\]/,qt={type:"class",value:"[^\\0-\\x1F\\x22\\x5C]",description:"[^\\0-\\x1F\\x22\\x5C]"},Wt=/^[0-9a-f]/i,Jt={type:"class",value:"[0-9a-f]i",description:"[0-9a-f]i"},Zt=0,Qt=0,eo=[{line:1,column:1,seenCR:!1}],to=0,oo=[],no=0;if("startRule"in i){if(!(i.startRule in c))throw new Error("Can't start parsing from rule \""+i.startRule+'".');p=c[i.startRule]}function ro(e){var t,n,r=eo[e];if(r)return r;for(t=e-1;!eo[t];)t--;for(r={line:(r=eo[t]).line,column:r.column,seenCR:r.seenCR};t<e;)"\n"===(n=o.charAt(t))?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===n||"\u2028"===n||"\u2029"===n?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1),t++;return eo[e]=r,r}function io(e,t){var o=ro(e),n=ro(t);return{start:{offset:e,line:o.line,column:o.column},end:{offset:t,line:n.line,column:n.column}}}function ao(e){Zt<to||(Zt>to&&(to=Zt,oo=[]),oo.push(e))}function so(e,o,n,r){return null!==o&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(o),new t(null!==e?e:function(e,t){var o,n=new Array(e.length);for(o=0;o<e.length;o++)n[o]=e[o].description;return"Expected "+(e.length>1?n.slice(0,-1).join(", ")+" or "+n[e.length-1]:n[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(o,n),o,n,r)}function co(){var e,t,o;for(e=Zt,t=[],o=po();o!==s;)t.push(o),o=po();return t!==s&&(Qt=e,t=l()),e=t}function po(){var e,t,n,r,i,a,c,p,l;return e=Zt,(t=Eo())!==s?(o.substr(Zt,7)===d?(n=d,Zt+=7):(n=s,0===no&&ao(u)),n!==s&&(r=mo())!==s?(46===o.charCodeAt(Zt)?(i=f,Zt++):(i=s,0===no&&ao(h)),i!==s&&(a=Co())!==s?(58===o.charCodeAt(Zt)?(c=m,Zt++):(c=s,0===no&&ao(g)),c!==s&&(p=Co())!==s&&Eo()!==s?((l=lo())===s&&(l=null),l!==s?(Qt=e,e=t=v(r,a,p)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=Eo())!==s?(o.substr(Zt,8)===y?(n=y,Zt+=8):(n=s,0===no&&ao(b)),n!==s&&(r=mo())!==s?(46===o.charCodeAt(Zt)?(i=f,Zt++):(i=s,0===no&&ao(h)),i!==s&&(a=Co())!==s?(58===o.charCodeAt(Zt)?(c=m,Zt++):(c=s,0===no&&ao(g)),c!==s&&(p=Co())!==s&&Eo()!==s?((l=lo())===s&&(l=null),l!==s?(Qt=e,e=t=w(r,a,p)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=Eo())!==s?(o.substr(Zt,15)===x?(n=x,Zt+=15):(n=s,0===no&&ao(S)),n!==s&&(r=Co())!==s&&(i=Eo())!==s?((a=lo())===s&&(a=null),a!==s?(Qt=e,e=t=C(r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=Eo())!==s?(o.substr(Zt,16)===I?(n=I,Zt+=16):(n=s,0===no&&ao(_)),n!==s&&(r=Co())!==s&&(i=Eo())!==s?((a=lo())===s&&(a=null),a!==s?(Qt=e,e=t=E(r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=function(){var e,t,n,r,i,a,c;if(e=Zt,35===o.charCodeAt(Zt)?(t=O,Zt++):(t=s,0===no&&ao(M)),t!==s)if(No()!==s)if(64===o.charCodeAt(Zt)?(n=pe,Zt++):(n=s,0===no&&ao(le)),n!==s){if(r=[],de.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(ue)),i!==s)for(;i!==s;)r.push(i),de.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(ue));else r=s;if(r!==s)if((i=No())!==s){if(a=[],fe.test(o.charAt(Zt))?(c=o.charAt(Zt),Zt++):(c=s,0===no&&ao(he)),c!==s)for(;c!==s;)a.push(c),fe.test(o.charAt(Zt))?(c=o.charAt(Zt),Zt++):(c=s,0===no&&ao(he));else a=s;a!==s?(Qt=e,t=me(r,a),e=t):(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s}else Zt=e,e=s;else Zt=e,e=s;else Zt=e,e=s;return e}())!==s&&(n=uo())!==s?(Qt=e,e=t=N(t)):(Zt=e,e=s),e===s&&(e=Zt,(t=fo())!==s?((n=uo())===s&&(n=null),n!==s?e=t=[t,n]:(Zt=e,e=s)):(Zt=e,e=s),e===s&&(e=Zt,(t=Eo())!==s&&(n=uo())!==s?e=t=[t,n]:(Zt=e,e=s),e===s&&(e=Zt,(t=Eo())!==s&&(n=function e(){var t,n,r,i;return t=Zt,(n=function(){var e;return(e=ho())===s&&(e=function(){var e,t,o;return e=Zt,(t=mo())!==s?((o=So())===s&&(o=null),o!==s?(Qt=e,t=z(t,o),e=t):(Zt=e,e=s)):(Zt=e,e=s),e}())===s&&(e=function(){var e,t,n,r;if(e=Zt,39===o.charCodeAt(Zt)?(t=G,Zt++):(t=s,0===no&&ao(B)),t!==s){for(n=[],r=_o();r!==s;)n.push(r),r=_o();n!==s?(39===o.charCodeAt(Zt)?(r=G,Zt++):(r=s,0===no&&ao(B)),r!==s?(Qt=e,t=F(n),e=t):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e===s&&(e=Zt,(t=function(){var e,t,o;return e=Zt,(t=$o())!==s&&(o=ko())!==s&&$o()!==s?(Qt=e,t=ze(o),e=t):(Zt=e,e=s),e}())!==s&&(Qt=e,t=H(t)),e=t),e}()),e}())!==s&&Eo()!==s?(o.substr(Zt,2)===L?(r=L,Zt+=2):(r=s,0===no&&ao(R)),r!==s&&Eo()!==s&&(i=e())!==s?(Qt=t,n=D(n,i),t=n):(Zt=t,t=s)):(Zt=t,t=s),t===s&&(t=function(){var e;return(e=function(){var e,t,o;return e=Zt,(t=xo())===s&&(t=null),t!==s&&(o=mo())!==s?(Qt=e,t=j(t,o),e=t):(Zt=e,e=s),e}())===s&&(e=ho()),e}()),t}())!==s&&(r=Eo())!==s?((i=lo())===s&&(i=null),i!==s?(Qt=e,e=t=T(n)):(Zt=e,e=s)):(Zt=e,e=s)))))))),e}function lo(){var e,t,n,r,i;return e=Zt,(t=Eo())!==s?(44===o.charCodeAt(Zt)?(n=$,Zt++):(n=s,0===no&&ao(k)),n===s&&(n=null),n!==s?((r=fo())===s&&(r=null),r!==s?((i=uo())===s&&(i=null),i!==s?e=t=[t,n,r,i]:(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),e}function uo(){var e;return P.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(A)),e}function fo(){var e,t,n,r,i;if(e=Zt,(t=Eo())!==s)if(35===o.charCodeAt(Zt)?(n=O,Zt++):(n=s,0===no&&ao(M)),n!==s){for(r=[],i=Io();i!==s;)r.push(i),i=Io();r!==s?e=t=[t,n,r]:(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s;return e}function ho(){var e,t,o,n;return e=Zt,(t=xo())!==s&&(o=mo())!==s&&(n=So())!==s?(Qt=e,e=t=U(t,o,n)):(Zt=e,e=s),e===s&&(e=Zt,(t=xo())===s&&(t=null),t!==s&&(o=function(){var e;return(e=vo())===s&&(e=yo()),e}())!==s?((n=So())===s&&(n=null),n!==s?(Qt=e,e=t=U(t,o,n)):(Zt=e,e=s)):(Zt=e,e=s)),e}function mo(){var e,t;return e=Zt,(t=vo())!==s&&(Qt=e,t=Y(t)),(e=t)===s&&(e=Zt,(t=go())!==s&&(Qt=e,t=Y(t)),(e=t)===s&&(e=Zt,(t=yo())!==s&&(Qt=e,t=Y(t)),e=t)),e}function go(){var e,t,n,r,i;if(e=Zt,t=Zt,K.test(o.charAt(Zt))?(n=o.charAt(Zt),Zt++):(n=s,0===no&&ao(V)),n!==s){for(r=[],X.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(q));i!==s;)r.push(i),X.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(q));r!==s?t=n=[n,r]:(Zt=t,t=s)}else Zt=t,t=s;return t!==s&&(Qt=e,t=W(t)),e=t}function vo(){var e,t,o;return e=Zt,(t=go())!==s&&(o=bo())!==s?(Qt=e,e=t=J(t,o)):(Zt=e,e=s),e}function yo(){var e,t;return e=Zt,(t=bo())!==s&&(Qt=e,t=Z(t)),e=t}function bo(){var e,t,n,r,i;if(e=Zt,40===o.charCodeAt(Zt)?(t=Q,Zt++):(t=s,0===no&&ao(ee)),t!==s){for(n=[],te.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(oe));r!==s;)n.push(r),te.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(oe));n===s&&(n=null),n!==s?((r=function(){var e,t,n,r;if(e=Zt,58===o.charCodeAt(Zt)?(t=m,Zt++):(t=s,0===no&&ao(g)),t!==s){if(n=[],ae.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(se)),r!==s)for(;r!==s;)n.push(r),ae.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(se));else n=s;n!==s?(Qt=e,t=ce(n),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(r=null),r!==s?(41===o.charCodeAt(Zt)?(i=ne,Zt++):(i=s,0===no&&ao(re)),i!==s?(Qt=e,e=t=ie(n,r)):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e}function wo(){var e,t,n;return e=Zt,(t=Co())!==s?((n=function(){var e,t,n,r;if(e=Zt,91===o.charCodeAt(Zt)?(t=xe,Zt++):(t=s,0===no&&ao(Se)),t!==s){if(n=[],Ce.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(Ie)),r!==s)for(;r!==s;)n.push(r),Ce.test(o.charAt(Zt))?(r=o.charAt(Zt),Zt++):(r=s,0===no&&ao(Ie));else n=s;n!==s?(93===o.charCodeAt(Zt)?(r=_e,Zt++):(r=s,0===no&&ao(Ee)),r!==s?(Qt=e,t=Ne(n),e=t):(Zt=e,e=s)):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(n=null),n!==s?(Qt=e,e=t=ge(t,n)):(Zt=e,e=s)):(Zt=e,e=s),e}function xo(){var e,t;return e=Zt,(t=wo())!==s&&No()!==s?(Qt=e,e=t=ve(t)):(Zt=e,e=s),e}function So(){var e,t;return e=Zt,No()!==s&&(t=wo())!==s?(Qt=e,e=ve(t)):(Zt=e,e=s),e}function Co(){var e,t,n,r,i;if(e=Zt,t=Zt,K.test(o.charAt(Zt))?(n=o.charAt(Zt),Zt++):(n=s,0===no&&ao(V)),n!==s){for(r=[],ye.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(be));i!==s;)r.push(i),ye.test(o.charAt(Zt))?(i=o.charAt(Zt),Zt++):(i=s,0===no&&ao(be));r!==s?t=n=[n,r]:(Zt=t,t=s)}else Zt=t,t=s;return t!==s&&(Qt=e,t=we(t)),e=t}function Io(){var e;return Te.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao($e)),e}function _o(){var e,t,n;return e=Zt,ke.test(o.charAt(Zt))?(t=o.charAt(Zt),Zt++):(t=s,0===no&&ao(Pe)),t!==s?(Ae.test(o.charAt(Zt))?(n=o.charAt(Zt),Zt++):(n=s,0===no&&ao(Oe)),n!==s?(Qt=e,e=t=Me()):(Zt=e,e=s)):(Zt=e,e=s),e===s&&(Le.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(Re))),e}function Eo(){var e,t;for(e=[],32===o.charCodeAt(Zt)?(t=De,Zt++):(t=s,0===no&&ao(Ue));t!==s;)e.push(t),32===o.charCodeAt(Zt)?(t=De,Zt++):(t=s,0===no&&ao(Ue));return e===s&&(e=null),e}function No(){var e,t;if(e=[],32===o.charCodeAt(Zt)?(t=De,Zt++):(t=s,0===no&&ao(Ue)),t!==s)for(;t!==s;)e.push(t),32===o.charCodeAt(Zt)?(t=De,Zt++):(t=s,0===no&&ao(Ue));else e=s;return e}function To(){var e,t,n,r;return e=Zt,(t=$o())!==s?(44===o.charCodeAt(Zt)?(n=$,Zt++):(n=s,0===no&&ao(k)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}function $o(){var e,t;for(no++,e=[],Ye.test(o.charAt(Zt))?(t=o.charAt(Zt),Zt++):(t=s,0===no&&ao(Ke));t!==s;)e.push(t),Ye.test(o.charAt(Zt))?(t=o.charAt(Zt),Zt++):(t=s,0===no&&ao(Ke));return no--,e===s&&(t=s,0===no&&ao(He)),e}function ko(){var e;return(e=function(){var e,t;return e=Zt,o.substr(Zt,5)===Ve?(t=Ve,Zt+=5):(t=s,0===no&&ao(Xe)),t!==s&&(Qt=e,t=qe()),e=t}())===s&&(e=function(){var e,t;return e=Zt,o.substr(Zt,4)===We?(t=We,Zt+=4):(t=s,0===no&&ao(Je)),t!==s&&(Qt=e,t=Ze()),e=t}())===s&&(e=function(){var e,t;return e=Zt,o.substr(Zt,4)===Qe?(t=Qe,Zt+=4):(t=s,0===no&&ao(et)),t!==s&&(Qt=e,t=tt()),e=t}())===s&&(e=function(){var e,t,n,r,i,a,c,p;if(e=Zt,(t=function(){var e,t,n,r;return e=Zt,(t=$o())!==s?(123===o.charCodeAt(Zt)?(n=je,Zt++):(n=s,0===no&&ao(Ge)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s){if(n=Zt,(r=Po())!==s){for(i=[],a=Zt,(c=To())!==s&&(p=Po())!==s?(Qt=a,c=ot(r,p),a=c):(Zt=a,a=s);a!==s;)i.push(a),a=Zt,(c=To())!==s&&(p=Po())!==s?(Qt=a,c=ot(r,p),a=c):(Zt=a,a=s);i!==s?(Qt=n,r=nt(r,i),n=r):(Zt=n,n=s)}else Zt=n,n=s;n===s&&(n=null),n!==s&&(r=function(){var e,t,n,r;return e=Zt,(t=$o())!==s?(125===o.charCodeAt(Zt)?(n=Be,Zt++):(n=s,0===no&&ao(Fe)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s?(Qt=e,t=rt(n),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(e=function(){var e,t,n,r,i,a,c,p;if(e=Zt,(t=function(){var e,t,n,r;return e=Zt,(t=$o())!==s?(91===o.charCodeAt(Zt)?(n=xe,Zt++):(n=s,0===no&&ao(Se)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s){if(n=Zt,(r=ko())!==s){for(i=[],a=Zt,(c=To())!==s&&(p=ko())!==s?(Qt=a,c=at(r,p),a=c):(Zt=a,a=s);a!==s;)i.push(a),a=Zt,(c=To())!==s&&(p=ko())!==s?(Qt=a,c=at(r,p),a=c):(Zt=a,a=s);i!==s?(Qt=n,r=st(r,i),n=r):(Zt=n,n=s)}else Zt=n,n=s;n===s&&(n=null),n!==s&&(r=function(){var e,t,n,r;return e=Zt,(t=$o())!==s?(93===o.charCodeAt(Zt)?(n=_e,Zt++):(n=s,0===no&&ao(Ee)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}())!==s?(Qt=e,t=ct(n),e=t):(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(e=function(){var e,t,n,r;return no++,e=Zt,(t=Ao())===s&&(t=null),t!==s&&function(){var e,t,n,r;if((e=function(){var e;return 48===o.charCodeAt(Zt)?(e=bt,Zt++):(e=s,0===no&&ao(wt)),e}())===s)if(e=Zt,(t=function(){var e;return dt.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(ut)),e}())!==s){for(n=[],r=Ro();r!==s;)n.push(r),r=Ro();n!==s?e=t=[t,n]:(Zt=e,e=s)}else Zt=e,e=s;return e}()!==s?((n=function(){var e,t,n,r;if(e=Zt,(t=function(){var e;return 46===o.charCodeAt(Zt)?(e=f,Zt++):(e=s,0===no&&ao(h)),e}())!==s){if(n=[],(r=Ro())!==s)for(;r!==s;)n.push(r),r=Ro();else n=s;n!==s?e=t=[t,n]:(Zt=e,e=s)}else Zt=e,e=s;return e}())===s&&(n=null),n!==s?((r=function(){var e,t,n,r,i;if(e=Zt,(t=function(){var e;return ft.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(ht)),e}())!==s)if((n=Ao())===s&&(n=function(){var e;return 43===o.charCodeAt(Zt)?(e=vt,Zt++):(e=s,0===no&&ao(yt)),e}()),n===s&&(n=null),n!==s){if(r=[],(i=Ro())!==s)for(;i!==s;)r.push(i),i=Ro();else r=s;r!==s?e=t=[t,n,r]:(Zt=e,e=s)}else Zt=e,e=s;else Zt=e,e=s;return e}())===s&&(r=null),r!==s?(Qt=e,t=lt(),e=t):(Zt=e,e=s)):(Zt=e,e=s)):(Zt=e,e=s),no--,e===s&&(t=s,0===no&&ao(pt)),e}())===s&&(e=Oo()),e}function Po(){var e,t,n;return e=Zt,(t=Oo())!==s&&function(){var e,t,n,r;return e=Zt,(t=$o())!==s?(58===o.charCodeAt(Zt)?(n=m,Zt++):(n=s,0===no&&ao(g)),n!==s&&(r=$o())!==s?e=t=[t,n,r]:(Zt=e,e=s)):(Zt=e,e=s),e}()!==s&&(n=ko())!==s?(Qt=e,e=t=it(t,n)):(Zt=e,e=s),e}function Ao(){var e;return 45===o.charCodeAt(Zt)?(e=mt,Zt++):(e=s,0===no&&ao(gt)),e}function Oo(){var e,t,o;if(no++,e=Zt,Lo()!==s){for(t=[],o=Mo();o!==s;)t.push(o),o=Mo();t!==s&&(o=Lo())!==s?(Qt=e,e=St(t)):(Zt=e,e=s)}else Zt=e,e=s;return no--,e===s&&0===no&&ao(xt),e}function Mo(){var e,t,n,r,i,a,c,p,l;return(e=function(){var e;return Xt.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(qt)),e}())===s&&(e=Zt,function(){var e;return 92===o.charCodeAt(Zt)?(e=_t,Zt++):(e=s,0===no&&ao(Et)),e}()!==s?(34===o.charCodeAt(Zt)?(t=Ct,Zt++):(t=s,0===no&&ao(It)),t===s&&(92===o.charCodeAt(Zt)?(t=_t,Zt++):(t=s,0===no&&ao(Et)),t===s&&(47===o.charCodeAt(Zt)?(t=Nt,Zt++):(t=s,0===no&&ao(Tt)),t===s&&(t=Zt,98===o.charCodeAt(Zt)?(n=$t,Zt++):(n=s,0===no&&ao(kt)),n!==s&&(Qt=t,n=Pt()),(t=n)===s&&(t=Zt,102===o.charCodeAt(Zt)?(n=At,Zt++):(n=s,0===no&&ao(Ot)),n!==s&&(Qt=t,n=Mt()),(t=n)===s&&(t=Zt,110===o.charCodeAt(Zt)?(n=Lt,Zt++):(n=s,0===no&&ao(Rt)),n!==s&&(Qt=t,n=Dt()),(t=n)===s&&(t=Zt,114===o.charCodeAt(Zt)?(n=Ut,Zt++):(n=s,0===no&&ao(zt)),n!==s&&(Qt=t,n=jt()),(t=n)===s&&(t=Zt,116===o.charCodeAt(Zt)?(n=Gt,Zt++):(n=s,0===no&&ao(Bt)),n!==s&&(Qt=t,n=Ft()),(t=n)===s&&(t=Zt,117===o.charCodeAt(Zt)?(n=Ht,Zt++):(n=s,0===no&&ao(Yt)),n!==s?(r=Zt,i=Zt,(a=Do())!==s&&(c=Do())!==s&&(p=Do())!==s&&(l=Do())!==s?i=a=[a,c,p,l]:(Zt=i,i=s),(r=i!==s?o.substring(r,Zt):i)!==s?(Qt=t,t=n=Kt(r)):(Zt=t,t=s)):(Zt=t,t=s))))))))),t!==s?(Qt=e,e=Vt(t)):(Zt=e,e=s)):(Zt=e,e=s)),e}function Lo(){var e;return 34===o.charCodeAt(Zt)?(e=Ct,Zt++):(e=s,0===no&&ao(It)),e}function Ro(){var e;return Ce.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(Ie)),e}function Do(){var e;return Wt.test(o.charAt(Zt))?(e=o.charAt(Zt),Zt++):(e=s,0===no&&ao(Jt)),e}var Uo="IN",zo="OUT";delete(a=this).properties,delete a.inports,delete a.outports,delete a.groups,a.edges=[],r={},a.validateContents=function(e,t){e.processes&&Object.keys(e.processes).forEach(function(t){if(!e.processes[t].component)throw new Error('Node "'+t+'" does not have a component defined')}),e.inports&&Object.keys(e.inports).forEach(function(t){var o=e.inports[t];if(!e.processes[o.process])throw new Error('Inport "'+t+'" is connected to an undefined target node "'+o.process+'"')}),e.outports&&Object.keys(e.outports).forEach(function(t){var o=e.outports[t];if(!e.processes[o.process])throw new Error('Outport "'+t+'" is connected to an undefined source node "'+o.process+'"')}),e.connections&&e.connections.forEach(function(t){if(t.tgt&&!e.processes[t.tgt.process]){if(t.data)throw new Error('IIP containing "'+t.data+'" is connected to an undefined target node "'+t.tgt.process+'"');throw new Error('Edge from "'+t.src.process+'" port "'+t.src.port+'" is connected to an undefined target node "'+t.tgt.process+'"')}if(t.src&&!e.processes[t.src.process])throw new Error('Edge to "'+t.tgt.process+'" port "'+t.tgt.port+'" is connected to an undefined source node "'+t.src.process+'"')})},a.addNode=function(e,t){if(r[e]||(r[e]={}),t.comp&&(r[e].component=t.comp),t.meta){for(var o={},n=0;n<t.meta.length;n++){var i=t.meta[n].split("=");1===i.length&&(i=["routes",i[0]]);var a=i[0],s=i[1];"x"!==a&&"y"!==a||(s=parseFloat(s)),o[a]=s}r[e].metadata=o}};var jo={},Go={};a.addAnonymousNode=function(e,t){if(!Go[t]){var o=e.comp.replace(/[^a-zA-Z0-9]+/,"_");jo[o]=(jo[o]||0)+1,Go[t]="_"+o+"_"+jo[o],this.addNode(Go[t],e)}return Go[t]},a.getResult=function(){var t={inports:a.inports||{},outports:a.outports||{},groups:a.groups||[],processes:r||{},connections:a.processEdges()};a.properties&&(t.properties=a.properties),t.caseSensitive=i.caseSensitive||!1;var o=a.validateSchema;if(void 0!==i.validateSchema&&(o=i.validateSchema),o){if(void 0===n)var n=e("tv4");var s=e("../schema/graph.json"),c=n.validateMultiple(t,s);if(!c.valid)throw new Error("fbp: Did not validate againt graph schema:\n"+JSON.stringify(c.errors,null,2))}return(void 0===i.validateContents||i.validateContents)&&a.validateContents(t),t};var Bo=function(e,t){for(var o=-1,n=e?e.length:0,r=[];++o<n;){var i=e[o];i instanceof Array?Array.prototype.push.apply(r,t?i:Bo(i)):r.push(i)}return r};function Fo(e){return e[0]+e[1].join("")}function Ho(e,t,o){i.caseSensitive||(o=o.toLowerCase());var n={process:e,port:t?t.port:o};return t&&null!=t.index&&(n.index=t.index),n}function Yo(e,t){return Ho(e,t,Uo)}function Ko(e,t){return Ho(e,t,zo)}if(a.registerAnnotation=function(e,t){if(a.properties||(a.properties={}),"runtime"===e)return a.properties.environment={},void(a.properties.environment.type=t);a.properties[e]=t},a.registerInports=function(e,t,o){a.inports||(a.inports={}),i.caseSensitive||(o=o.toLowerCase(),t=t.toLowerCase()),a.inports[o]={process:e,port:t}},a.registerOutports=function(e,t,o){a.outports||(a.outports={}),i.caseSensitive||(o=o.toLowerCase(),t=t.toLowerCase()),a.outports[o]={process:e,port:t}},a.registerEdges=function(e){Array.isArray(e)&&e.forEach(function(e,t){a.edges.push(e)})},a.processEdges=function(){var e,t;e=Bo(a.edges),t=[];for(var o=1;o<e.length;o+=1)("src"in e[o-1]||"data"in e[o-1])&&"tgt"in e[o]&&(e[o-1].tgt=e[o].tgt,t.push(e[o-1]),o++);return t},(n=p())!==s&&Zt===o.length)return n;throw n!==s&&Zt<o.length&&ao({type:"end",description:"end of input"}),so(null,oo,to<o.length?o.charAt(to):null,to<o.length?io(to,to+1):io(to,to))}}}()},{"../schema/graph.json":15,tv4:18}],13:[function(e,t,o){var n=e("./fbp"),r=e("./serialize");t.exports={SyntaxError:n.SyntaxError,parse:n.parse,serialize:r}},{"./fbp":12,"./serialize":14}],14:[function(e,t,o){var n=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};t.exports=function(e,t){var o,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x,S,C,I,_;for(l in null==t&&(t={}),c="string"==typeof e?JSON.parse(e):e,d=[],f="",i=function(e){return null!=c.processes[e].metadata&&(e=c.processes[e].metadata.label),e.indexOf("/")>-1&&(e=e.split("/").pop()),e},r=function(e,t){return null!=t.process&&null!=c.processes[t.process].metadata?e=c.processes[t.process].metadata.label:null!=t.process&&(e=t.process),e.indexOf("/")>-1&&(e=e.split("/").pop()),e},c.properties&&(c.properties.environment&&c.properties.environment.type&&(f+="# @runtime "+c.properties.environment.type+"\n"),Object.keys(c.properties).forEach(function(e){if(e.match(/^[a-zA-Z0-9\-_]+$/)){var t=c.properties[e];"string"==typeof t&&t.match(/^[a-zA-Z0-9\-_\s\.]+$/)&&(f+="# @"+e+" "+t+"\n")}})),m=c.inports)h=r(l,s=m[l]),l=c.caseSensitive?l:l.toUpperCase(),s.port=c.caseSensitive?s.port:s.port.toUpperCase(),f+="INPORT="+h+"."+s.port+":"+l+"\n";for(l in g=c.outports)h=r(l,u=g[l]),l=c.caseSensitive?l:l.toUpperCase(),u.port=c.caseSensitive?u.port:u.port.toUpperCase(),f+="OUTPORT="+h+"."+u.port+":"+l+"\n";for(f+="\n",a=0,p=(v=c.connections).length;a<p;a++)null!=(o=v[a]).data?(I=c.caseSensitive?o.tgt.port:o.tgt.port.toUpperCase(),C=o.tgt.process,_=c.processes[C].component,S=i(C),n.call(d,_)<0&&(S+="("+_+")",d.push(_)),f+='"'+o.data+'" -> '+I+" "+S+"\n"):(w=c.caseSensitive?o.src.port:o.src.port.toUpperCase(),b=o.src.process,x=c.processes[b].component,y=i(b),n.call(d,x)<0&&(y+="("+x+")",d.push(x)),I=c.caseSensitive?o.tgt.port:o.tgt.port.toUpperCase(),C=o.tgt.process,_=c.processes[C].component,S=i(C),n.call(d,_)<0&&(S+="("+_+")",d.push(_)),f+=y+" "+w+" -> "+I+" "+S+"\n");return f}},{}],15:[function(e,t,o){t.exports={$schema:"http://json-schema.org/draft-04/schema",id:"graph.json",title:"FBP graph",description:"A graph of FBP processes and connections between them.\nThis is the primary way of specifying FBP programs.\n",name:"graph",type:"object",additionalProperties:!1,properties:{caseSensitive:{type:"boolean",description:"Whether the graph port identifiers should be treated as case-sensitive"},properties:{type:"object",description:"User-defined properties attached to the graph.",additionalProperties:!0,properties:{name:{type:"string",description:"Name of the graph"},environment:{type:"object",description:"Information about the execution environment for the graph",additionalProperties:!0,required:["type"],properties:{type:{type:"string",description:"Runtime type the graph is for",example:"noflo-nodejs"},content:{type:"string",description:"HTML fixture for browser-based graphs"}}},description:{type:"string",description:"Graph description"},icon:{type:"string",description:"Name of the icon that can be used for depicting the graph"}}},inports:{type:["object","undefined"],description:"Exported inports of the graph",additionalProperties:!0,patternProperties:{"[a-z0-9]+":{type:"object",properties:{process:{type:"string"},port:{type:"string"},metadata:{type:"object",additionalProperties:!0,required:[],properties:{x:{type:"integer",description:"X coordinate of a graph inport"},y:{type:"integer",description:"Y coordinate of a graph inport"}}}}}}},outports:{type:["object","undefined"],description:"Exported outports of the graph",additionalProperties:!0,patternProperties:{"[a-z0-9]+":{type:"object",properties:{process:{type:"string"},port:{type:"string"},metadata:{type:"object",required:[],additionalProperties:!0,properties:{x:{type:"integer",description:"X coordinate of a graph outport"},y:{type:"integer",description:"Y coordinate of a graph outport"}}}}}}},groups:{type:"array",description:"List of groups of processes",items:{type:"object",additionalProperties:!1,properties:{name:{type:"string"},nodes:{type:"array",items:{type:"string"}},metadata:{type:"object",additionalProperties:!0,required:[],properties:{description:{type:"string"}}}}}},processes:{type:"object",description:"The processes of this graph.\nEach process is an instance of a component.\n",additionalProperties:!1,patternProperties:{"[a-zA-Z0-9_]+":{type:"object",properties:{component:{type:"string"},metadata:{type:"object",additionalProperties:!0,required:[],properties:{x:{type:"integer",description:"X coordinate of a graph node"},y:{type:"integer",description:"Y coordinate of a graph node"}}}}}}},connections:{type:"array",description:"Connections of the graph.\nA connection either connects ports of two processes, or specifices an IIP as initial input packet to a port.\n",items:{type:"object",additionalProperties:!1,properties:{src:{type:"object",additionalProperties:!1,properties:{process:{type:"string"},port:{type:"string"},index:{type:"integer"}}},tgt:{type:"object",additionalProperties:!1,properties:{process:{type:"string"},port:{type:"string"},index:{type:"integer"}}},data:{},metadata:{type:"object",additionalProperties:!0,required:[],properties:{route:{type:"integer",description:"Route identifier of a graph edge"},schema:{type:"string",format:"uri",description:"JSON schema associated with a graph edge"},secure:{type:"boolean",description:"Whether edge data should be treated as secure"}}}}}}}}},{}],16:[function(e,t,o){o.read=function(e,t,o,n,r){var i,a,s=8*r-n-1,c=(1<<s)-1,p=c>>1,l=-7,d=o?r-1:0,u=o?-1:1,f=e[t+d];for(d+=u,i=f&(1<<-l)-1,f>>=-l,l+=s;l>0;i=256*i+e[t+d],d+=u,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=n;l>0;a=256*a+e[t+d],d+=u,l-=8);if(0===i)i=1-p;else{if(i===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),i-=p}return(f?-1:1)*a*Math.pow(2,i-n)},o.write=function(e,t,o,n,r,i){var a,s,c,p=8*i-r-1,l=(1<<p)-1,d=l>>1,u=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?u/c:u*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[o+f]=255&s,f+=h,s/=256,r-=8);for(a=a<<r|s,p+=r;p>0;e[o+f]=255&a,f+=h,a/=256,p-=8);e[o+f-h]|=128*m}},{}],17:[function(e,t,o){var n,r,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var p,l=[],d=!1,u=-1;function f(){d&&p&&(d=!1,p.length?l=p.concat(l):u=-1,l.length&&h())}function h(){if(!d){var e=c(f);d=!0;for(var t=l.length;t;){for(p=l,l=[];++u<t;)p&&p[u].run();u=-1,t=l.length}p=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];l.push(new m(e,t)),1!==l.length||d||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],18:[function(e,t,o){var n,r;n=this,r=function(){var e,t,o,n;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var i=[];for(var a in r)e.call(r,a)&&i.push(a);if(t)for(var s=0;s<n;s++)e.call(r,o[s])&&i.push(o[s]);return i})),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),o=t.length>>>0;if(0===o)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=o)return-1;for(var r=n>=0?n:Math.max(o-Math.abs(n),0);r<o;r++)if(r in t&&t[r]===e)return r;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var r={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},i={"*":!0};function a(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function s(e){var t="";r[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var o="",n="",s=!0,c=!1,p=!1;"+"===t?s=!1:"."===t?(n=".",o="."):"/"===t?(n="/",o="/"):"#"===t?(n="#",s=!1):";"===t?(n=";",o=";",c=!0,p=!0):"?"===t?(n="?",o="&",c=!0):"&"===t&&(n="&",o="&",c=!0);for(var l=[],d=e.split(","),u=[],f={},h=0;h<d.length;h++){var m=d[h],g=null;if(-1!==m.indexOf(":")){var v=m.split(":");m=v[0],g=parseInt(v[1],10)}for(var y={};i[m.charAt(m.length-1)];)y[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);var b={truncate:g,name:m,suffices:y};u.push(b),f[m]=b,l.push(m)}var w=function(e){for(var t="",r=0,i=0;i<u.length;i++){var l=u[i],d=e(l.name);if(null==d||Array.isArray(d)&&0===d.length||"object"==typeof d&&0===Object.keys(d).length)r++;else if(t+=i===r?n:o||",",Array.isArray(d)){c&&(t+=l.name+"=");for(var f=0;f<d.length;f++)f>0&&(t+=l.suffices["*"]&&o||",",l.suffices["*"]&&c&&(t+=l.name+"=")),t+=s?encodeURIComponent(d[f]).replace(/!/g,"%21"):a(d[f])}else if("object"==typeof d){c&&!l.suffices["*"]&&(t+=l.name+"=");var h=!0;for(var m in d)h||(t+=l.suffices["*"]&&o||","),h=!1,t+=s?encodeURIComponent(m).replace(/!/g,"%21"):a(m),t+=l.suffices["*"]?"=":",",t+=s?encodeURIComponent(d[m]).replace(/!/g,"%21"):a(d[m])}else c&&(t+=l.name,p&&""===d||(t+="=")),null!=l.truncate&&(d=d.substring(0,l.truncate)),t+=s?encodeURIComponent(d).replace(/!/g,"%21"):a(d)}return t};return w.varNames=l,{prefix:n,substitution:w}}function c(e){if(!(this instanceof c))return new c(e);for(var t=e.split("{"),o=[t.shift()],n=[],r=[],i=[];t.length>0;){var a=t.shift(),p=a.split("}")[0],l=a.substring(p.length+1),d=s(p);r.push(d.substitution),n.push(d.prefix),o.push(l),i=i.concat(d.substitution.varNames)}this.fill=function(e){for(var t=o[0],n=0;n<r.length;n++){t+=(0,r[n])(e),t+=o[n+1]}return t},this.varNames=i,this.template=e}c.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(function(t){return e[t]})}};var p=function(e,t,o,n,r){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,n&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),r&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=o||v("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var i in e.definedKeywords)this.definedKeywords[i]=e.definedKeywords[i].slice(0)};function l(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var o=0;o<e.length;o++)if(!l(e[o],t[o]))return!1}else{var n;for(n in e)if(void 0===t[n]&&void 0!==e[n])return!1;for(n in t)if(void 0===e[n]&&void 0!==t[n])return!1;for(n in e)if(!l(e[n],t[n]))return!1}return!0}return!1}p.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},p.prototype.createError=function(e,t,o,n,r,i,a){var s=new S(e,t,o,n,r);return s.message=this.errorReporter(s,i,a),s},p.prototype.returnError=function(e){return e},p.prototype.collectError=function(e){return e&&this.errors.push(e),null},p.prototype.prefixErrors=function(e,t,o){for(var n=e;n<this.errors.length;n++)this.errors[n]=this.errors[n].prefixWith(t,o);return this},p.prototype.banUnknownProperties=function(e,t){for(var o in this.unknownPropertyPaths){var n=this.createError(y.UNKNOWN_PROPERTY,{path:o},o,"",null,e,t),r=this.handleError(n);if(r)return r}return null},p.prototype.addFormat=function(e,t){if("object"==typeof e){for(var o in e)this.addFormat(o,e[o]);return this}this.formatValidators[e]=t},p.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){if((t=t||{})[e.$ref])return this.createError(y.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},p.prototype.getSchema=function(e,t){var o;if(void 0!==this.schemas[e])return o=this.schemas[e],this.resolveRefs(o,t);var n=e,r="";if(-1!==e.indexOf("#")&&(r=e.substring(e.indexOf("#")+1),n=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[n]){o=this.schemas[n];var i=decodeURIComponent(r);if(""===i)return this.resolveRefs(o,t);if("/"!==i.charAt(0))return;for(var a=i.split("/").slice(1),s=0;s<a.length;s++){var c=a[s].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===o[c]){o=void 0;break}o=o[c]}if(void 0!==o)return this.resolveRefs(o,t)}void 0===this.missing[n]&&(this.missing.push(n),this.missing[n]=n,this.missingMap[n]=n)},p.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var o=0;o<e.length;o++)this.searchSchemas(e[o],t);else if(e&&"object"==typeof e)for(var n in"string"==typeof e.id&&function(e,t){if(t.substring(0,e.length)===e){var o=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===o.charAt(0)||"?"===o.charAt(0))return!0}return!1}(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)if("enum"!==n)if("object"==typeof e[n])this.searchSchemas(e[n],t);else if("$ref"===n){var r=m(e[n]);r&&void 0===this.schemas[r]&&void 0===this.missingMap[r]&&(this.missingMap[r]=r)}},p.prototype.addSchema=function(e,t){if("string"!=typeof e||void 0===t){if("object"!=typeof e||"string"!=typeof e.id)return;e=(t=e).id}e===m(e)+"#"&&(e=m(e)),this.schemas[e]=t,delete this.missingMap[e],g(t,e),this.searchSchemas(t,e)},p.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},p.prototype.getSchemaUris=function(e){var t=[];for(var o in this.schemas)e&&!e.test(o)||t.push(o);return t},p.prototype.getMissingUris=function(e){var t=[];for(var o in this.missingMap)e&&!e.test(o)||t.push(o);return t},p.prototype.dropSchemas=function(){this.schemas={},this.reset()},p.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},p.prototype.validateAll=function(e,t,o,n,r){var i;if(!(t=this.resolveRefs(t)))return null;if(t instanceof S)return this.errors.push(t),t;var a,s=this.errors.length,c=null,p=null;if(this.checkRecursive&&e&&"object"==typeof e){if(i=!this.scanned.length,e[this.validatedSchemasKey]){var l=e[this.validatedSchemasKey].indexOf(t);if(-1!==l)return this.errors=this.errors.concat(e[this.validationErrorsKey][l]),null}if(Object.isFrozen(e)&&-1!==(a=this.scannedFrozen.indexOf(e))){var d=this.scannedFrozenSchemas[a].indexOf(t);if(-1!==d)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[a][d]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===a&&(a=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),c=this.scannedFrozenSchemas[a].length,this.scannedFrozenSchemas[a][c]=t,this.scannedFrozenValidationErrors[a][c]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}p=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][p]=t,e[this.validationErrorsKey][p]=[]}}var u=this.errors.length,f=this.validateBasic(e,t,r)||this.validateNumeric(e,t,r)||this.validateString(e,t,r)||this.validateArray(e,t,r)||this.validateObject(e,t,r)||this.validateCombinations(e,t,r)||this.validateHypermedia(e,t,r)||this.validateFormat(e,t,r)||this.validateDefinedKeywords(e,t,r)||null;if(i){for(;this.scanned.length;){delete this.scanned.pop()[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(f||u!==this.errors.length)for(;o&&o.length||n&&n.length;){var h=o&&o.length?""+o.pop():null,m=n&&n.length?""+n.pop():null;f&&(f=f.prefixWith(h,m)),this.prefixErrors(u,h,m)}return null!==c?this.scannedFrozenValidationErrors[a][c]=this.errors.slice(s):null!==p&&(e[this.validationErrorsKey][p]=this.errors.slice(s)),this.handleError(f)},p.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var o=this.formatValidators[t.format].call(null,e,t);return"string"==typeof o||"number"==typeof o?this.createError(y.FORMAT_CUSTOM,{message:o},"","/format",null,e,t):o&&"object"==typeof o?this.createError(y.FORMAT_CUSTOM,{message:o.message||"?"},o.dataPath||"",o.schemaPath||"/format",null,e,t):null},p.prototype.validateDefinedKeywords=function(e,t,o){for(var n in this.definedKeywords)if(void 0!==t[n])for(var r=this.definedKeywords[n],i=0;i<r.length;i++){var a=(0,r[i])(e,t[n],t,o);if("string"==typeof a||"number"==typeof a)return this.createError(y.KEYWORD_CUSTOM,{key:n,message:a},"","",null,e,t).prefixWith(null,n);if(a&&"object"==typeof a){var s=a.code;if("string"==typeof s){if(!y[s])throw new Error("Undefined error code (use defineError): "+s);s=y[s]}else"number"!=typeof s&&(s=y.KEYWORD_CUSTOM);var c="object"==typeof a.message?a.message:{key:n,message:a.message||"?"},p=a.schemaPath||"/"+n.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(s,c,a.dataPath||null,p,null,e,t)}}return null},p.prototype.validateBasic=function(e,t,o){var n;return(n=this.validateType(e,t,o))?n.prefixWith(null,"type"):(n=this.validateEnum(e,t,o))?n.prefixWith(null,"type"):null},p.prototype.validateType=function(e,t){if(void 0===t.type)return null;var o=typeof e;null===e?o="null":Array.isArray(e)&&(o="array");var n=t.type;Array.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){var i=n[r];if(i===o||"integer"===i&&"number"===o&&e%1==0)return null}return this.createError(y.INVALID_TYPE,{type:o,expected:n.join("/")},"","",null,e,t)},p.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var o=0;o<t.enum.length;o++){if(l(e,t.enum[o]))return null}return this.createError(y.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},p.prototype.validateNumeric=function(e,t,o){return this.validateMultipleOf(e,t,o)||this.validateMinMax(e,t,o)||this.validateNaN(e,t,o)||null};var d=Math.pow(2,-51),u=1-d;function f(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function h(e,t){return t=f(t||""),e=f(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+(o=t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname,n=[],o.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?n.pop():n.push(e)}),n.join("").replace(/^\//,"/"===o.charAt(0)?"/":""))+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null;var o,n}function m(e){return e.split("#")[0]}function g(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=h(t,e.id),e.id=t),Array.isArray(e))for(var o=0;o<e.length;o++)g(e[o],t);else for(var n in"string"==typeof e.$ref&&(e.$ref=h(t,e.$ref)),e)"enum"!==n&&g(e[n],t)}function v(e){var t=C[e=e||"en"];return function(e){var o=t[e.code]||x[e.code];if("string"!=typeof o)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var n=e.params;return o.replace(/\{([^{}]*)\}/g,function(e,t){var o=n[t];return"string"==typeof o||"number"==typeof o?o:e})}}p.prototype.validateMultipleOf=function(e,t){var o=t.multipleOf||t.divisibleBy;if(void 0===o)return null;if("number"==typeof e){var n=e/o%1;if(n>=d&&n<u)return this.createError(y.NUMBER_MULTIPLE_OF,{value:e,multipleOf:o},"","",null,e,t)}return null},p.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(y.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(y.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(y.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(y.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},p.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:!0===isNaN(e)||e===1/0||e===-1/0?this.createError(y.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},p.prototype.validateString=function(e,t,o){return this.validateStringLength(e,t,o)||this.validateStringPattern(e,t,o)||null},p.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(y.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(y.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},p.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var o;if(t.pattern instanceof RegExp)o=t.pattern;else{var n,r="",i=t.pattern.match(/^\/(.+)\/([img]*)$/);i?(n=i[1],r=i[2]):n=t.pattern,o=new RegExp(n,r)}return o.test(e)?null:this.createError(y.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},p.prototype.validateArray=function(e,t,o){return Array.isArray(e)&&(this.validateArrayLength(e,t,o)||this.validateArrayUniqueItems(e,t,o)||this.validateArrayItems(e,t,o))||null},p.prototype.validateArrayLength=function(e,t){var o;return void 0!==t.minItems&&e.length<t.minItems&&(o=this.createError(y.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(o))?o:void 0!==t.maxItems&&e.length>t.maxItems&&(o=this.createError(y.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(o))?o:null},p.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var o=0;o<e.length;o++)for(var n=o+1;n<e.length;n++)if(l(e[o],e[n])){var r=this.createError(y.ARRAY_UNIQUE,{match1:o,match2:n},"","/uniqueItems",null,e,t);if(this.handleError(r))return r}return null},p.prototype.validateArrayItems=function(e,t,o){if(void 0===t.items)return null;var n,r;if(Array.isArray(t.items)){for(r=0;r<e.length;r++)if(r<t.items.length){if(n=this.validateAll(e[r],t.items[r],[r],["items",r],o+"/"+r))return n}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(n=this.createError(y.ARRAY_ADDITIONAL_ITEMS,{},"/"+r,"/additionalItems",null,e,t),this.handleError(n)))return n}else if(n=this.validateAll(e[r],t.additionalItems,[r],["additionalItems"],o+"/"+r))return n}else for(r=0;r<e.length;r++)if(n=this.validateAll(e[r],t.items,[r],["items"],o+"/"+r))return n;return null},p.prototype.validateObject=function(e,t,o){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,o)||this.validateObjectRequiredProperties(e,t,o)||this.validateObjectProperties(e,t,o)||this.validateObjectDependencies(e,t,o)||null},p.prototype.validateObjectMinMaxProperties=function(e,t){var o,n=Object.keys(e);return void 0!==t.minProperties&&n.length<t.minProperties&&(o=this.createError(y.OBJECT_PROPERTIES_MINIMUM,{propertyCount:n.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(o))?o:void 0!==t.maxProperties&&n.length>t.maxProperties&&(o=this.createError(y.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:n.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(o))?o:null},p.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var o=0;o<t.required.length;o++){var n=t.required[o];if(void 0===e[n]){var r=this.createError(y.OBJECT_REQUIRED,{key:n},"","/required/"+o,null,e,t);if(this.handleError(r))return r}}return null},p.prototype.validateObjectProperties=function(e,t,o){var n;for(var r in e){var i=o+"/"+r.replace(/~/g,"~0").replace(/\//g,"~1"),a=!1;if(void 0!==t.properties&&void 0!==t.properties[r]&&(a=!0,n=this.validateAll(e[r],t.properties[r],[r],["properties",r],i)))return n;if(void 0!==t.patternProperties)for(var s in t.patternProperties){if(new RegExp(s).test(r)&&(a=!0,n=this.validateAll(e[r],t.patternProperties[s],[r],["patternProperties",s],i)))return n}if(a)this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(n=this.createError(y.OBJECT_ADDITIONAL_PROPERTIES,{key:r},"","/additionalProperties",null,e,t).prefixWith(r,null),this.handleError(n)))return n}else if(n=this.validateAll(e[r],t.additionalProperties,[r],["additionalProperties"],i))return n}else this.trackUnknownProperties&&!this.knownPropertyPaths[i]&&(this.unknownPropertyPaths[i]=!0)}return null},p.prototype.validateObjectDependencies=function(e,t,o){var n;if(void 0!==t.dependencies)for(var r in t.dependencies)if(void 0!==e[r]){var i=t.dependencies[r];if("string"==typeof i){if(void 0===e[i]&&(n=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:r,missing:i},"","",null,e,t).prefixWith(null,r).prefixWith(null,"dependencies"),this.handleError(n)))return n}else if(Array.isArray(i))for(var a=0;a<i.length;a++){var s=i[a];if(void 0===e[s]&&(n=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:r,missing:s},"","/"+a,null,e,t).prefixWith(null,r).prefixWith(null,"dependencies"),this.handleError(n)))return n}else if(n=this.validateAll(e,i,[],["dependencies",r],o))return n}return null},p.prototype.validateCombinations=function(e,t,o){return this.validateAllOf(e,t,o)||this.validateAnyOf(e,t,o)||this.validateOneOf(e,t,o)||this.validateNot(e,t,o)||null},p.prototype.validateAllOf=function(e,t,o){if(void 0===t.allOf)return null;for(var n,r=0;r<t.allOf.length;r++){var i=t.allOf[r];if(n=this.validateAll(e,i,[],["allOf",r],o))return n}return null},p.prototype.validateAnyOf=function(e,t,o){if(void 0===t.anyOf)return null;var n,r,i=[],a=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,r=this.knownPropertyPaths);for(var s=!0,c=0;c<t.anyOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var p=t.anyOf[c],l=this.errors.length,d=this.validateAll(e,p,[],["anyOf",c],o);if(null===d&&l===this.errors.length){if(this.errors=this.errors.slice(0,a),this.trackUnknownProperties){for(var u in this.knownPropertyPaths)r[u]=!0,delete n[u];for(var f in this.unknownPropertyPaths)r[f]||(n[f]=!0);s=!1;continue}return null}d&&i.push(d.prefixWith(null,""+c).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=r),s?(i=i.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(y.ANY_OF_MISSING,{},"","/anyOf",i,e,t)):void 0},p.prototype.validateOneOf=function(e,t,o){if(void 0===t.oneOf)return null;var n,r,i=null,a=[],s=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,r=this.knownPropertyPaths);for(var c=0;c<t.oneOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var p=t.oneOf[c],l=this.errors.length,d=this.validateAll(e,p,[],["oneOf",c],o);if(null===d&&l===this.errors.length){if(null!==i)return this.errors=this.errors.slice(0,s),this.createError(y.ONE_OF_MULTIPLE,{index1:i,index2:c},"","/oneOf",null,e,t);if(i=c,this.trackUnknownProperties){for(var u in this.knownPropertyPaths)r[u]=!0,delete n[u];for(var f in this.unknownPropertyPaths)r[f]||(n[f]=!0)}}else d&&a.push(d)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=r),null===i?(a=a.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),this.createError(y.ONE_OF_MISSING,{},"","/oneOf",a,e,t)):(this.errors=this.errors.slice(0,s),null)},p.prototype.validateNot=function(e,t,o){if(void 0===t.not)return null;var n,r,i=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,r=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var a=this.validateAll(e,t.not,null,null,o),s=this.errors.slice(i);return this.errors=this.errors.slice(0,i),this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=r),null===a&&0===s.length?this.createError(y.NOT_PASSED,{},"","/not",null,e,t):null},p.prototype.validateHypermedia=function(e,t,o){if(!t.links)return null;for(var n,r=0;r<t.links.length;r++){var i=t.links[r];if("describedby"===i.rel){for(var a=new c(i.href),s=!0,p=0;p<a.varNames.length;p++)if(!(a.varNames[p]in e)){s=!1;break}if(s){var l={$ref:a.fillFromObject(e)};if(n=this.validateAll(e,l,[],["links",r],o))return n}}}};var y={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},b={};for(var w in y)b[y[w]]=w;var x={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function S(e,t,o,n,r){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+n);this.message="",this.params=t,this.code=e,this.dataPath=o||"",this.schemaPath=n||"",this.subErrors=r||null;var i=new Error(this.message);if(this.stack=i.stack||i.stacktrace,!this.stack)try{throw i}catch(i){this.stack=i.stack||i.stacktrace}}S.prototype=Object.create(Error.prototype),S.prototype.constructor=S,S.prototype.name="ValidationError",S.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var o=0;o<this.subErrors.length;o++)this.subErrors[o].prefixWith(e,t);return this};var C={};var I=function e(t){var o,n,r=new p,i={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(n=e,!0)},addFormat:function(){r.addFormat.apply(r,arguments)},language:function(e){return e?(C[e]||(e=e.split("-")[0]),!!C[e]&&(o=e,e)):o},addLanguage:function(e,t){var o;for(o in y)t[o]&&!t[y[o]]&&(t[y[o]]=t[o]);var n=e.split("-")[0];if(C[n])for(o in C[e]=Object.create(C[n]),t)void 0===C[n][o]&&(C[n][o]=t[o]),C[e][o]=t[o];else C[e]=t,C[n]=t;return this},freshApi:function(t){var o=e();return t&&o.language(t),o},validate:function(e,t,i,a){var s=v(o),c=new p(r,!1,n?function(e,t,o){return n(e,t,o)||s(e,t,o)}:s,i,a);"string"==typeof t&&(t={$ref:t}),c.addSchema("",t);var l=c.validateAll(e,t,null,null,"");return!l&&a&&(l=c.banUnknownProperties(e,t)),this.error=l,this.missing=c.missing,this.valid=null===l,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,t,i,a){var s=v(o),c=new p(r,!0,n?function(e,t,o){return n(e,t,o)||s(e,t,o)}:s,i,a);"string"==typeof t&&(t={$ref:t}),c.addSchema("",t),c.validateAll(e,t,null,null,""),a&&c.banUnknownProperties(e,t);var l={toString:function(){return this.valid?"valid":this.error.message}};return l.errors=c.errors,l.missing=c.missing,l.valid=0===l.errors.length,l},addSchema:function(){return r.addSchema.apply(r,arguments)},getSchema:function(){return r.getSchema.apply(r,arguments)},getSchemaMap:function(){return r.getSchemaMap.apply(r,arguments)},getSchemaUris:function(){return r.getSchemaUris.apply(r,arguments)},getMissingUris:function(){return r.getMissingUris.apply(r,arguments)},dropSchemas:function(){r.dropSchemas.apply(r,arguments)},defineKeyword:function(){r.defineKeyword.apply(r,arguments)},defineError:function(e,t,o){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!=0||t<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==y[e])throw new Error("Error already defined: "+e+" as "+y[e]);if(void 0!==b[t])throw new Error("Error code already used: "+b[t]+" as "+t);for(var n in y[e]=t,b[t]=e,x[e]=x[t]=o,C){var r=C[n];r[e]&&(r[t]=r[t]||r[e])}},reset:function(){r.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:g,resolveUrl:h,getDocumentUri:m,errorCodes:y};return i.language(t||"en"),i}();return I.addLanguage("en-gb",x),I.tv4=I,I},void 0!==t&&t.exports?t.exports=r():n.tv4=r()},{}],19:[function(e,t,o){var n=e("../the-graph-thumb/the-graph-thumb.js");function r(e,t,o){e.clearRect(0,0,o.width,o.height),e.fillStyle=o.outsideFill;var n=Math.round((o.viewrectangle[0]/o.scale-o.thumbrectangle[0])*o.thumbscale),r=Math.round((o.viewrectangle[1]/o.scale-o.thumbrectangle[1])*o.thumbscale),i=Math.round(o.viewrectangle[2]*o.thumbscale/o.scale),a=Math.round(o.viewrectangle[3]*o.thumbscale/o.scale),s=!1;return n<0&&r<0&&i>o.width-n&&a>o.height-r?{hide:s=!0}:(s=!1,n<0?(i+=n,n=0,t.style.borderLeftColor=o.viewBoxBorder2):(t.style.borderLeftColor=o.viewBoxBorder,e.fillRect(0,0,n,o.height)),r<0?(a+=r,r=0,t.style.borderTopColor=o.viewBoxBorder2):(t.style.borderTopColor=o.viewBoxBorder,e.fillRect(n,0,i,r)),i>o.width-n?(i=o.width-n,t.style.borderRightColor=o.viewBoxBorder2):(t.style.borderRightColor=o.viewBoxBorder,e.fillRect(n+i,0,o.width-(n+i),o.height)),a>o.height-r?(a=o.height-r,t.style.borderBottomColor=o.viewBoxBorder2):(t.style.borderBottomColor=o.viewBoxBorder,e.fillRect(n,r+a,i,o.height-(r+a))),t.style.left=n+"px",t.style.top=r+"px",t.style.width=i+"px",t.style.height=a+"px",{hide:s})}var i=React.createClass({propTypes:{},getDefaultProps:function(){return{width:200,height:150,hidden:!1,backgroundColor:"hsla(184, 8%, 75%, 0.9)",outsideFill:"hsla(0, 0%, 0%, 0.4)",nodeSize:60,nodeLineWidth:1,viewrectangle:[0,0,0,0],viewscale:1,viewBoxBorder:"hsla(190, 100%, 80%, 0.4)",viewBoxBorder2:"hsla( 10,  60%, 32%, 0.3)",viewBoxBorderStyle:"dotted",graph:null}},getInitialState:function(){return{thumbscale:1,currentPan:[0,0]}},render:function(){var e=this.props,t={position:"absolute",top:0,left:0},o={height:e.height,width:e.width,overflow:"hidden",cursor:"move",backgroundColor:e.backgroundColor},n={key:"thumb",ref:this._refThumbCanvas,width:e.width,height:e.height,style:t},r={key:"viewbox",ref:this._refViewboxCanvas,width:e.width,height:e.height,style:t},i={key:"viewboxdiv",ref:this._refViewboxElement,style:{position:"absolute",top:0,left:0,width:e.width,height:e.height,borderStyle:"dotted",borderWidth:1}},a=React.DOM;return a.div({key:"nav",style:o,ref:this._refTopElement},[a.div(i),a.canvas(r),a.canvas(n)])},componentDidUpdate:function(){this._updatePan(),this._renderElements()},componentDidMount:function(){this._updatePan(),this._renderElements(),this._setupEvents()},_refThumbCanvas:function(e){this._thumbContext=e.getContext("2d")},_refViewboxCanvas:function(e){this._viewboxContext=e.getContext("2d")},_refViewboxElement:function(e){this._viewboxElement=e},_refTopElement:function(e){this._topElement=e},_renderElements:function(){var e=function(e,t){var o={};for(var r in t)o[r]=t[r];return o.graph=null,o.lineWidth=t.nodeLineWidth,n.render(e,t.graph,o)}(this._thumbContext,this.props);!function(e,t,o,n){var i={};for(var a in n)i[a]=n[a];i.graph=null,i.scale=n.viewscale;var s=o.rectangle[2],c=o.rectangle[3];i.thumbscale=s>c?n.width/s:n.height/c,i.thumbrectangle=o.rectangle,r(e,t,i)}(this._viewboxContext,this._viewboxElement,e,this.props)},_updatePan:function(){this.state.currentPan=[-this.props.viewrectangle[0],-this.props.viewrectangle[1]]},_setupEvents:function(){this.hammer=new Hammer.Manager(this._topElement,{recognizers:[[Hammer.Tap],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),this.hammer.on("tap",function(e){this.props.onTap&&this.props.onTap(null,e)}.bind(this)),this.hammer.on("panmove",function(e){if(this.props.onPanTo){var t=this.state.currentPan[0],o=this.state.currentPan[1],n=this.state.thumbscale/this.props.viewscale;t-=e.deltaX/n,o-=e.deltaY/n;var r={x:Math.round(t),y:Math.round(o)};this.state.currentPan[0]=r.x,this.state.currentPan[1]=r.y,this.props.onPanTo(r,e)}}.bind(this))}});t.exports={render:r,calculateStyleFromTheme:function(e){var t={};return"dark"===e?(t.viewBoxBorder="hsla(190, 100%, 80%, 0.4)",t.viewBoxBorder2="hsla( 10,  60%, 32%, 0.3)",t.outsideFill="hsla(0, 0%, 0%, 0.4)",t.backgroundColor="hsla(0, 0%, 0%, 0.9)"):(t.viewBoxBorder="hsla(190, 100%, 20%, 0.8)",t.viewBoxBorder2="hsla( 10,  60%, 80%, 0.8)",t.outsideFill="hsla(0, 0%, 100%, 0.4)",t.backgroundColor="hsla(0, 0%, 100%, 0.9)"),t},Component:i}},{"../the-graph-thumb/the-graph-thumb.js":20}],20:[function(e,t,o){function n(e,t,o,n,r,i){try{e.strokeStyle=i.edgeColors[0],r&&(e.strokeStyle=i.edgeColors[r]);var a=Math.round(o.metadata.x*t)-.5,s=Math.round(o.metadata.y*t)-.5,c=Math.round(n.metadata.x*t)-.5,p=Math.round(n.metadata.y*t)-.5;e.beginPath(),e.moveTo(a,s),e.lineTo(c,p),e.stroke()}catch(e){}}t.exports={render:function(e,t,o){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,o.width,o.height),e.lineWidth=o.lineWidth;var r=[],i=1/0,a=1/0,s=-1/0,c=-1/0,p={};if(t.nodes.forEach(function(e){!e.metadata||isNaN(e.metadata.x)||isNaN(e.metadata.y)||(r.push(e),p[e.id]=e,i=Math.min(i,e.metadata.x),a=Math.min(a,e.metadata.y),s=Math.max(s,e.metadata.x),c=Math.max(c,e.metadata.y))}.bind(this)),t.inports&&Object.keys(t.inports).forEach(function(e){var o=t.inports[e];!o.metadata||isNaN(o.metadata.x)||isNaN(o.metadata.y)||(r.push(o),i=Math.min(i,o.metadata.x),a=Math.min(a,o.metadata.y),s=Math.max(s,o.metadata.x),c=Math.max(c,o.metadata.y))}.bind(this)),t.outports&&Object.keys(t.outports).forEach(function(e){var o=t.outports[e];!o.metadata||isNaN(o.metadata.x)||isNaN(o.metadata.y)||(r.push(o),i=Math.min(i,o.metadata.x),a=Math.min(a,o.metadata.y),s=Math.max(s,o.metadata.x),c=Math.max(c,o.metadata.y))}.bind(this)),0===r.length)return{scale:1,rectangle:[0,0,0,0]};if(!(isFinite(i)&&isFinite(a)&&isFinite(s)&&isFinite(c)))throw new Error("the-graph-thumb: Invalid space spanned");i-=o.nodeSize,a-=o.nodeSize,s+=2*o.nodeSize,c+=2*o.nodeSize;var l=s-i,d=c-a,u=[];u[0]=i,u[1]=a,u[2]=l,u[3]=d;var f=l>d?o.width/l:o.height/d,h=f,m=Math.round(o.nodeSize*f)/2;return e.setTransform(1,0,0,1,0-i*f,0-a*f),t.inports&&Object.keys(t.inports).forEach(function(r){var i=t.inports[r];if(i.metadata&&!isNaN(i.metadata.x)&&!isNaN(i.metadata.y)){var a=p[i.process];if(!a)return;n(e,f,i,a,2,o)}}.bind(this)),t.outports&&Object.keys(t.outports).forEach(function(r){var i=t.outports[r];if(i.metadata&&!isNaN(i.metadata.x)&&!isNaN(i.metadata.y)){var a=p[i.process];if(!a)return;n(e,f,a,i,5,o)}}.bind(this)),t.edges.forEach(function(t){var r=p[t.from.node],i=p[t.to.node];r&&i&&n(e,f,r,i,t.metadata.route,o)}.bind(this)),r.forEach(function(t){var n=Math.round(t.metadata.x*f),r=Math.round(t.metadata.y*f);e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,e.beginPath(),t.process&&!t.component?e.arc(n,r,m/2,0,2*Math.PI,!1):e.arc(n,r,m,0,2*Math.PI,!1),e.fill(),e.stroke(),e.beginPath();var i=Math.max(m-1.5,1);t.process&&!t.component?e.arc(n,r,i/2,0,2*Math.PI,!1):e.arc(n,r,i,0,2*Math.PI,!1),e.fill()}.bind(this)),{rectangle:u,scale:h}},styleFromTheme:function(e){var t={};return"dark"===e?(t.fill="hsl(184, 8%, 10%)",t.stroke="hsl(180, 11%, 70%)",t.edgeColors=["white","hsl(  0, 100%, 46%)","hsl( 35, 100%, 46%)","hsl( 60, 100%, 46%)","hsl(135, 100%, 46%)","hsl(160, 100%, 46%)","hsl(185, 100%, 46%)","hsl(210, 100%, 46%)","hsl(285, 100%, 46%)","hsl(310, 100%, 46%)","hsl(335, 100%, 46%)"]):(t.fill="hsl(184, 8%, 75%)",t.stroke="hsl(180, 11%, 20%)",t.edgeColors=["hsl(  0,   0%, 50%)","hsl(  0, 100%, 40%)","hsl( 29, 100%, 40%)","hsl( 47, 100%, 40%)","hsl(138, 100%, 40%)","hsl(160,  73%, 50%)","hsl(181, 100%, 40%)","hsl(216, 100%, 40%)","hsl(260, 100%, 40%)","hsl(348, 100%, 50%)","hsl(328, 100%, 40%)"]),t}}},{}],21:[function(e,t,o){let n=function(e,t){return t*Math.cos(2*Math.PI*e)},r=function(e,t){return t*Math.sin(2*Math.PI*e)},i=function(e,t,o){return["M",n(e,o),r(e,o),"A",o,o,0,0,0,n(t,o),r(t,o)].join(" ")},a={n4:i(7/8,5/8,36),s4:i(3/8,1/8,36),e4:i(1/8,-1/8,36),w4:i(5/8,3/8,36),inport:i(-.25,.25,4),outport:i(.25,-.25,4),inportBig:i(-.25,.25,6),outportBig:i(.25,-.25,6)};t.exports=a},{}],22:[function(e,t,o){o.nodeStyles={default:{bg:"rgba(255,255,255,1)",color:"#555"},primary:{bg:"rgba(69,112,253,1)",color:"#fff"},info:{bg:"rgba(214,69,250,1)",color:"#fff"},success:{bg:"rgba(253,91,70,1)",color:"#fff"},warning:{bg:"rgba(254,70,144,1)",color:"#fff"},danger:{bg:"rgba(79,86,104,1)",color:"#fff"},orange:{bg:"rgba(243,152,0,1)",color:"#fff"},green:{bg:"rgba(0,153,68,1)",color:"#fff"},blue:{bg:"rgba(0,70,134,1)",color:"#fff"},cyan:{bg:"rgba(19,181,177,1)",color:"#fff"},golden:{bg:"rgba(237,0,27,1)",color:"#fff"},warmgreen:{bg:"rgba(179,212,101,1)",color:"#fff"}},o.iconSvgD={code:"M10,3.5H9.1c0,0-0.1,0-0.1,0.1l-3.1,9c0,0,0,0,0,0c0,0.1,0,0.1,0.1,0.1h0.9c0,0,0.1,0,0.1-0.1l0,0l3-8.7l0.1-0.3c0,0,0,0,0,0C10.1,3.5,10.1,3.5,10,3.5L10,3.5zM14,8C13.9,8,13.9,8,14,8l-3-2.3c0,0-0.1,0-0.2,0c0,0,0,0,0,0.1v1.1c0,0,0,0.1,0,0.1l1.5,1.2l-1.5,1.2c0,0,0,0.1,0,0.1v1.1c0,0.1,0,0.1,0.1,0.1c0,0,0,0,0.1,0l2.9-2.3C14,8.2,14,8.1,14,8L14,8zM5,5.6L2.1,7.9c0,0,0,0,0,0C2,8.1,2,8.2,2.1,8.3L5,10.6c0,0,0,0,0.1,0c0.1,0,0.1,0,0.1-0.1V9.4c0,0,0-0.1,0-0.1L3.6,8.1l1.5-1.2c0,0,0-0.1,0-0.1V5.7c0,0,0,0,0-0.1C5.1,5.6,5.1,5.6,5,5.6L5,5.6z",alert:"M8,0C3.6,0,0,3.6,0,8s3.6,8,8,8s8-3.6,8-8S12.4,0,8,0 M8,13.7c-0.6,0-1.1-0.5-1.1-1.1c0-0.6,0.5-1.1,1.1-1.1c0.6,0,1.1,0.5,1.1,1.1C9.1,13.2,8.6,13.7,8,13.7 M9.5,5.1C9.5,5.1,9.5,5.1,9.5,5.1c0,0.1-1,4.6-1,4.6s0.1-0.3,0,0C8.5,10,8.3,10.2,8,10.2S7.5,9.9,7.5,9.6c-0.1-0.3-1-4.4-1-4.4c0-0.1-0.1-0.2-0.1-0.3c0-0.4,0.2-0.8,0.4-1.1S7.6,3.4,8,3.4c0.4,0,0.8,0.2,1.1,0.4s0.5,0.7,0.4,1.1C9.5,4.9,9.5,5,9.5,5.1",cube:"M16.2,27.1l11.5-6.3V9.3l-11.5,4.2V27.1z M15,11.5l12.6-4.6L15,2.3L2.4,6.9L15,11.5z M30,6.9v13.8c0,0.4-0.1,0.8-0.3,1.2 c-0.2,0.3-0.5,0.6-0.9,0.9l-12.7,6.9C15.8,29.9,15.4,30,15,30s-0.7-0.1-1.1-0.3L1.2,22.8c-0.4-0.2-0.7-0.5-0.9-0.9 C0.1,21.6,0,21.2,0,20.8V6.9C0,6.5,0.2,6,0.4,5.6C0.7,5.2,1.1,5,1.5,4.8l12.7-4.6C14.5,0.1,14.8,0,15,0s0.5,0,0.8,0.1l12.7,4.6 c0.4,0.1,0.8,0.4,1.1,0.9C29.9,6,30,6.5,30,6.9z",microchip:"M24.4,2.8v24.4c0,1.6-1.3,2.8-2.8,2.8H8.4c-1.6,0-2.8-1.3-2.8-2.8V2.8C5.6,1.3,6.9,0,8.4,0h13.1C23.1,0,24.4,1.3,24.4,2.8z\t M30,6.2v0.7c0,0.2-0.2,0.4-0.4,0.4h-1.1v0.4c0,0.2-0.2,0.4-0.4,0.4h-2.5V5.2h2.5c0.2,0,0.4,0.2,0.4,0.4v0.4h1.1\tC29.8,5.9,30,6,30,6.2z M30,11.8v0.7c0,0.2-0.2,0.4-0.4,0.4h-1.1v0.4c0,0.2-0.2,0.4-0.4,0.4h-2.5v-2.8h2.5c0.2,0,0.4,0.2,0.4,0.4\tv0.4h1.1C29.8,11.5,30,11.6,30,11.8z M30,17.5v0.7c0,0.2-0.2,0.4-0.4,0.4h-1.1v0.4c0,0.2-0.2,0.4-0.4,0.4h-2.5v-2.8h2.5\tc0.2,0,0.4,0.2,0.4,0.4v0.4h1.1C29.8,17.1,30,17.3,30,17.5z M30,23.1v0.7c0,0.2-0.2,0.4-0.4,0.4h-1.1v0.4c0,0.2-0.2,0.4-0.4,0.4\th-2.5V22h2.5c0.2,0,0.4,0.2,0.4,0.4v0.4h1.1C29.8,22.7,30,22.9,30,23.1z M1.8,22h2.5v2.8H1.8c-0.2,0-0.4-0.2-0.4-0.4v-0.4H0.4\tC0.2,24.1,0,24,0,23.8v-0.7c0-0.2,0.2-0.4,0.4-0.4h1.1v-0.4C1.4,22.2,1.6,22,1.8,22z M1.8,16.4h2.5v2.8H1.8c-0.2,0-0.4-0.2-0.4-0.4\tv-0.4H0.4c-0.2,0-0.4-0.2-0.4-0.4v-0.7c0-0.2,0.2-0.4,0.4-0.4h1.1v-0.4C1.4,16.6,1.6,16.4,1.8,16.4z M1.8,10.8h2.5v2.8H1.8\tc-0.2,0-0.4-0.2-0.4-0.4v-0.4H0.4c-0.2,0-0.4-0.2-0.4-0.4v-0.7c0-0.2,0.2-0.4,0.4-0.4h1.1v-0.4C1.4,10.9,1.6,10.8,1.8,10.8z\t M1.8,5.2h2.5V8H1.8C1.6,8,1.4,7.8,1.4,7.6V7.3H0.4C0.2,7.3,0,7.1,0,6.9V6.2C0,6,0.2,5.9,0.4,5.9h1.1V5.5C1.4,5.3,1.6,5.2,1.8,5.2z",flask:"M28.6,25.8c0.7,1.2,0.9,2.2,0.4,3c-0.4,0.8-1.4,1.2-2.7,1.2H3.8c-1.4,0-2.3-0.4-2.7-1.2c-0.4-0.8-0.3-1.8,0.4-3l9.8-15.5 V2.5H10c-0.3,0-0.6-0.1-0.9-0.4C8.9,1.9,8.8,1.6,8.8,1.2s0.1-0.6,0.4-0.9C9.4,0.1,9.7,0,10,0h10c0.3,0,0.6,0.1,0.9,0.4 c0.2,0.2,0.4,0.5,0.4,0.9s-0.1,0.6-0.4,0.9c-0.2,0.2-0.5,0.4-0.9,0.4h-1.3v7.8L28.6,25.8z M13.4,11.6L8,20H22l-5.3-8.4L16.3,11V2.5 h-2.5V11L13.4,11.6z",globe:"M20.3,9.2C19.5,3.8,17.4,0,15,0s-4.5,3.8-5.4,9.2H20.3z M9.2,15c0,1.3,0.1,2.6,0.2,3.9h11.2c0.1-1.2,0.2-2.5,0.2-3.9\ts-0.1-2.6-0.2-3.9H9.4C9.2,12.4,9.2,13.7,9.2,15z M28.8,9.2c-1.7-4.1-5.2-7.3-9.6-8.6c1.5,2,2.5,5.1,3,8.6H28.8z M10.7,0.6\tC6.4,1.9,2.9,5.1,1.1,9.2h6.5C8.2,5.8,9.2,2.7,10.7,0.6z M29.5,11.1h-6.9c0.1,1.3,0.2,2.6,0.2,3.9s-0.1,2.6-0.2,3.9h6.9\tc0.3-1.2,0.5-2.5,0.5-3.9S29.8,12.4,29.5,11.1L29.5,11.1z M7.2,15c0-1.3,0.1-2.6,0.2-3.9H0.5C0.2,12.4,0,13.7,0,15s0.2,2.6,0.5,3.9\th6.9C7.3,17.6,7.2,16.3,7.2,15z M9.6,20.8c0.9,5.4,2.9,9.2,5.4,9.2s4.5-3.8,5.4-9.2H9.6z M19.3,29.4c4.3-1.3,7.8-4.5,9.6-8.6h-6.5\tC21.8,24.2,20.7,27.3,19.3,29.4z M1.1,20.8c1.7,4.1,5.2,7.3,9.6,8.6c-1.5-2-2.5-5.1-3-8.6C7.7,20.8,1.1,20.8,1.1,20.8z","chart-area":"M29.3,22.5c0.4,0,0.7,0.3,0.7,0.7v2.3c0,0.4-0.3,0.7-0.7,0.7H0.7c-0.4,0-0.7-0.3-0.7-0.7V4.5c0-0.4,0.3-0.7,0.7-0.7H3 c0.4,0,0.7,0.3,0.7,0.7v18H29.3z M21.8,9.3l-5,3.3l-5-6.7c-0.3-0.4-0.9-0.4-1.2,0.1l-5.1,8.5v6.1h22.5l-5.3-11 C22.7,9.2,22.2,9.1,21.8,9.3z",strikethrough:"M30,14.5v2.7h-6c1.4,2.9,1.3,10.9-8.5,10.9C4.2,28.2,4.6,19.3,4.6,19.3l5.4,0.1c0,4.6,4.3,4.6,5.2,4.5 c0.9-0.1,4.1-0.1,4.4-3.2c0.1-1.5-1.4-2.6-3-3.4H0v-2.7H30 M25.1,8.9l-5.4,0c0,0,0.2-3.8-4.5-3.8c-4.7,0-4.3,3-4.3,3.4 c0.1,0.4,0.5,2.3,4.1,3.2H6.4c0,0-4.8-9.2,6.9-10.7C25.2-0.7,25.1,8.9,25.1,8.9z","shekel-sign":"M16.6,9.1v11.3c0,0.6,0.5,1.1,1.1,1.1h3.2c0.6,0,1.1-0.5,1.1-1.1V9.1c0-5-4.1-9.1-9.1-9.1H1.6C0.7,0,0,0.7,0,1.6v27.3 C0,29.5,0.5,30,1.1,30h3.2c0.6,0,1.1-0.5,1.1-1.1V5.4h7.5C14.9,5.4,16.6,7,16.6,9.1z M28.9,0h-3.2c-0.6,0-1.1,0.5-1.1,1.1v19.8 c0,2.1-1.7,3.8-3.8,3.8h-7.5v-15c0-0.6-0.5-1.1-1.1-1.1H9.1C8.5,8.6,8,9.1,8,9.6v18.8C8,29.3,8.8,30,9.6,30h11.2 c5,0,9.1-4.1,9.1-9.1V1.1C30,0.5,29.5,0,28.9,0z",random:"M29.6,21c0.5,0.5,0.5,1.4,0,2l-4.7,4.7c-0.9,0.9-2.4,0.3-2.4-1v-2.3h-3.4c-0.2,0-0.4-0.1-0.5-0.2l-4.1-4.4l3.1-3.3l3.1,3.3\th1.9v-2.3c0-1.3,1.5-1.9,2.4-1L29.6,21z M0.7,10.3h4.9l3.1,3.3l3.1-3.3L7.7,5.8C7.6,5.7,7.4,5.6,7.2,5.6H0.7C0.3,5.6,0,5.9,0,6.3\tv3.3C0,10,0.3,10.3,0.7,10.3z M22.5,10.3v2.3c0,1.3,1.5,1.9,2.4,1L29.6,9c0.5-0.5,0.5-1.4,0-2l-4.7-4.7c-0.9-0.9-2.4-0.3-2.4,1v2.3\th-3.4c-0.2,0-0.4,0.1-0.5,0.2L5.6,19.7H0.7C0.3,19.7,0,20,0,20.4v3.3c0,0.4,0.3,0.7,0.7,0.7h6.5c0.2,0,0.4-0.1,0.5-0.2l12.9-13.8\tH22.5z",signature:"M29.1,18.8h-5.4c-0.5,0-1.2-0.7-1.5-1.7c-0.9-2.5-2.8-4.1-5-4.1c-1.8,0-3.4,1.1-4.5,2.9l-1.3-9.6c-0.3-1.5-1.5-2.5-2.8-2.5 c-1.4,0-2.5,1-2.8,2.5L3.3,16.7C3,18,2.2,18.8,1.7,18.8H0.9c-0.5,0-0.9,0.4-0.9,0.9v1.9c0,0.5,0.4,0.9,0.9,0.9h0.7 c2.5,0,4.6-2,5.3-5l1.4-6l1.7,13c0.1,0.9,0.8,1.6,1.7,1.7c0.1,0,0.1,0,0.2,0c0.8,0,1.6-0.5,1.8-1.3l1.9-6.6c0.3-1,0.9-1.6,1.5-1.6 c0.6,0,1.1,0.6,1.5,1.7c0.9,2.5,2.8,4.1,5,4.1h5.4c0.5,0,0.9-0.4,0.9-0.9v-1.9C30,19.2,29.6,18.8,29.1,18.8L29.1,18.8z",adjust:"M15,25.6V4.4c-1.9,0-3.7,0.5-5.3,1.4S6.8,8,5.8,9.7S4.4,13.1,4.4,15c0,1.9,0.5,3.7,1.4,5.3s2.2,2.9,3.9,3.9 S13.1,25.6,15,25.6L15,25.6z M30,15c0,2.7-0.7,5.2-2,7.5s-3.2,4.1-5.5,5.5s-4.8,2-7.5,2s-5.2-0.7-7.5-2S3.4,24.8,2,22.5S0,17.7,0,15 c0-2.7,0.7-5.2,2-7.5S5.2,3.4,7.5,2s4.8-2,7.5-2s5.2,0.7,7.5,2s4.1,3.2,5.5,5.5S30,12.3,30,15z",atlas:"M20.5,12.2h-2.3c-0.1,1.6-0.4,3-0.8,4.1C19,15.5,20.2,14,20.5,12.2z M20.5,10.3C20.2,8.5,19,7,17.4,6.2\tc0.5,1.1,0.7,2.5,0.8,4.1H20.5z M15,5.7c-0.5,0.4-1.2,2-1.4,4.6h2.7C16.2,7.7,15.5,6.1,15,5.7z M12.6,6.2C11,7,9.8,8.5,9.5,10.3h2.3\tC11.8,8.7,12.1,7.3,12.6,6.2z M12.6,16.3c-0.4-1.1-0.7-2.5-0.8-4.1H9.5C9.8,14,11,15.5,12.6,16.3z M16.4,12.2h-2.7\tc0.2,2.6,0.9,4.2,1.4,4.6C15.5,16.4,16.2,14.8,16.4,12.2z M28.1,21V1.5c0-0.9-0.6-1.5-1.5-1.5H7.5C4.3,0,1.9,2.4,1.9,5.6v18.8\tc0,3.2,2.4,5.6,5.6,5.6h19.1c0.7,0,1.5-0.6,1.5-1.5v-0.9c0-0.4-0.2-0.8-0.6-1.1c-0.2-0.9-0.2-3.6,0-4.3C27.9,21.9,28.1,21.6,28.1,21\tL28.1,21z M15,3.8c4.1,0,7.5,3.4,7.5,7.5s-3.4,7.5-7.5,7.5s-7.5-3.4-7.5-7.5S10.9,3.8,15,3.8z M24.4,26.3H7.5\tc-1.1,0-1.9-0.8-1.9-1.9s0.9-1.9,1.9-1.9h16.9V26.3z",blanket:"M24.6,0H5.4C2.8,0,0.6,2.1,0.6,4.8V30h5.1v-5.1h1.8V30h3v-5.1h1.8V30h3v-5.1h1.8V30h5.1V4.8c-0.1-1.3,0.9-2.5,2.2-2.6 c1.3-0.1,2.5,0.9,2.6,2.2c0,0.1,0,0.2,0,0.3V21c0,0.3-0.3,0.6-0.6,0.6c-0.3,0-0.6-0.3-0.6-0.6v-7.8h-2.4V21c0.1,1.7,1.5,2.9,3.2,2.8 c1.5-0.1,2.7-1.3,2.8-2.8V4.8C29.4,2.1,27.2,0,24.6,0L24.6,0z",bong:"M19.6,30c1.4,0,2.6-0.7,3.3-1.9c0.9-1.6,1.5-3.6,1.5-5.6c0-2.1-0.6-4.1-1.6-5.8l2.5-2.5l0.5,0.5c0.4,0.4,1,0.4,1.3,0\tl0.7-0.7c0.4-0.4,0.4-1,0-1.3l-3.1-3.1c-0.4-0.4-1-0.4-1.3,0l-0.7,0.7c-0.4,0.4-0.4,1,0,1.3l0.5,0.5L21,14.5\tc-0.7-0.7-1.4-1.2-2.3-1.7v-9l0.9,0c0.5,0,0.9-0.4,0.9-0.9l0-1.9c0-0.5-0.4-0.9-0.9-0.9L6.6,0C6,0,5.6,0.4,5.6,1l0,1.9\tc0,0.5,0.4,0.9,0.9,0.9l0.9,0v9c-3.4,1.9-5.6,5.6-5.6,9.7c0,2,0.5,3.9,1.5,5.6C4,29.3,5.3,30,6.6,30H19.6z M8.9,15.2l1.4-0.8V3.7\tl5.6,0v10.6l1.4,0.8c1.5,0.8,2.6,2.1,3.3,3.5H5.6C6.3,17.3,7.5,16,8.9,15.2z",burn:"M15,0C8.4,5.9,3.8,12.9,3.8,17.6C3.8,24.9,8.4,30,15,30s11.3-5.1,11.3-12.4C26.3,12.9,21.6,5.9,15,0z M15,26.3 c-3.3,0-5.6-2.3-5.6-5.6c0-0.8,0.3-3.6,5.6-9.4c5.4,5.8,5.6,8.7,5.6,9.4C20.6,24,18.3,26.3,15,26.3z","chart-line":"M29.1,22.5H3.8V4.7c0-0.5-0.4-0.9-0.9-0.9H0.9C0.4,3.8,0,4.2,0,4.7v19.7c0,1,0.8,1.9,1.9,1.9h27.2c0.5,0,0.9-0.4,0.9-0.9 v-1.9C30,22.9,29.6,22.5,29.1,22.5z M27.2,5.6h-6.9c-1.3,0-1.9,1.5-1,2.4l1.9,1.9l-4.3,4.3l-4.3-4.3c-0.7-0.7-1.9-0.7-2.7,0l-4,4 c-0.4,0.4-0.4,1,0,1.3l1.3,1.3c0.4,0.4,1,0.4,1.3,0l2.7-2.7l4.3,4.3c0.7,0.7,1.9,0.7,2.7,0l5.6-5.6l1.9,1.9c0.9,0.9,2.4,0.3,2.4-1 V6.6C28.1,6,27.7,5.6,27.2,5.6z",clone:"M27.2,0C28.7,0,30,1.3,30,2.8v16.9c0,1.6-1.3,2.8-2.8,2.8H10.3c-1.6,0-2.8-1.3-2.8-2.8V2.8C7.5,1.3,8.8,0,10.3,0H27.2 M10.3,24.4c-2.6,0-4.7-2.1-4.7-4.7V7.5H2.8C1.3,7.5,0,8.8,0,10.3v16.9C0,28.7,1.3,30,2.8,30h16.9c1.6,0,2.8-1.3,2.8-2.8v-2.8H10.3z","cloud-upload-alt":"M20,15.5c0-0.1,0-0.3-0.1-0.4l-5.5-5.5c-0.1-0.1-0.2-0.1-0.4-0.1s-0.3,0-0.4,0.1l-5.5,5.5C8.1,15.3,8,15.4,8,15.5\tc0,0.1,0,0.3,0.1,0.4S8.4,16,8.5,16H12v5.5c0,0.1,0,0.3,0.1,0.4c0.1,0.1,0.2,0.1,0.4,0.1h3c0.1,0,0.3,0,0.4-0.1\tc0.1-0.1,0.1-0.2,0.1-0.4V16h3.5c0.1,0,0.3,0,0.4-0.1C20,15.8,20,15.6,20,15.5L20,15.5z M30,20c0,1.7-0.6,3.1-1.8,4.2\tC27.1,25.4,25.7,26,24,26H7c-1.9,0-3.6-0.7-4.9-2.1S0,20.9,0,19c0-1.4,0.4-2.6,1.1-3.8s1.7-2,2.9-2.6c0-0.3,0-0.5,0-0.7\tc0-2.2,0.8-4.1,2.3-5.7S9.8,4,12,4c1.6,0,3.1,0.5,4.5,1.4c1.3,0.9,2.3,2.1,2.9,3.6C20.1,8.3,21,8,22,8c1.1,0,2,0.4,2.8,1.2\tC25.6,10,26,10.9,26,12c0,0.8-0.2,1.5-0.6,2.2c1.4,0.3,2.5,1,3.3,2.1C29.6,17.4,30,18.6,30,20L30,20z","code-branch":"M25.7,8.6c0-2.4-1.9-4.3-4.3-4.3s-4.3,1.9-4.3,4.3c0,1.5,0.9,2.8,1.9,3.6c-0.6,1.9-2.1,3.6-4.5,4.1c-1.5,0-2.8,0.6-3.9,1.3\tV7.9c1.3-0.6,2.1-2.1,2.1-3.6c0-2.4-1.9-4.3-4.3-4.3S4.3,1.9,4.3,4.3c0,1.5,0.9,3,2.1,3.6v14.1c-1.3,0.6-2.1,2.1-2.1,3.6\tc0,2.4,1.9,4.3,4.3,4.3s4.3-1.9,4.3-4.3c0-1.1-0.4-2.1-1.3-3c0.9-1.3,2.1-2.1,3.9-2.4c4.1-0.7,7.3-3.8,7.9-7.9\tC24.9,11.6,25.7,10.3,25.7,8.6L25.7,8.6z M8.6,2.1c1.3,0,2.1,0.9,2.1,2.1S9.9,6.4,8.6,6.4S6.4,5.6,6.4,4.3S7.3,2.1,8.6,2.1z\t M8.6,27.9c-1.3,0-2.1-0.9-2.1-2.1c0-1.3,0.9-2.1,2.1-2.1s2.1,0.9,2.1,2.1C10.7,27,9.9,27.9,8.6,27.9z M21.4,10.7\tc-1.3,0-2.1-0.9-2.1-2.1s0.9-2.1,2.1-2.1c1.3,0,2.1,0.9,2.1,2.1S22.7,10.7,21.4,10.7z","code-commit":"M23.3,12.9C22.4,9.2,19,6.6,15,6.6s-7.3,2.7-8.3,6.3H0v4.2h6.7c1,3.7,4.3,6.4,8.3,6.4s7.4-2.7,8.3-6.4H30v-4.2H23.3 M15,19.2c-2.3,0-4.3-1.9-4.3-4.2c0-2.4,1.9-4.2,4.3-4.2s4.3,1.8,4.3,4.2C19.3,17.3,17.3,19.2,15,19.2",cog:"M26.9,17.2l2.7,1.6c0.3,0.2,0.5,0.5,0.3,0.9c-0.7,2.3-1.9,4.3-3.5,6c-0.2,0.3-0.6,0.3-0.9,0.1l-2.7-1.6\tc-1.1,1-2.4,1.7-3.8,2.2v3.1c0,0.4-0.2,0.7-0.6,0.7c-2.2,0.5-4.6,0.5-6.9,0c-0.3-0.1-0.6-0.4-0.6-0.7v-3.1c-1.4-0.5-2.7-1.2-3.8-2.2\tl-2.7,1.6c-0.3,0.2-0.7,0.1-0.9-0.1c-1.6-1.7-2.8-3.7-3.5-6c-0.1-0.3,0-0.7,0.3-0.9l2.7-1.6c-0.3-1.5-0.3-3,0-4.4l-2.7-1.6\tc-0.3-0.2-0.5-0.5-0.3-0.9c0.7-2.3,1.9-4.3,3.5-6C3.7,4.1,4.1,4,4.4,4.2l2.7,1.6c1.1-1,2.4-1.7,3.8-2.2V0.5c0-0.4,0.2-0.7,0.6-0.7\tc2.2-0.5,4.6-0.5,6.9,0C18.8-0.2,19,0.1,19,0.5v3.1c1.4,0.5,2.7,1.2,3.8,2.2l2.7-1.6c0.3-0.2,0.7-0.1,0.9,0.1c1.6,1.7,2.8,3.7,3.5,6\tc0.1,0.3,0,0.7-0.3,0.9l-2.7,1.6C27.2,14.2,27.2,15.8,26.9,17.2L26.9,17.2z M20.1,15c0-2.8-2.3-5.1-5.1-5.1S9.9,12.2,9.9,15\ts2.3,5.1,5.1,5.1S20.1,17.8,20.1,15z",coins:"M0,23.7v2.5C0,28.3,5,30,11.3,30s11.3-1.7,11.3-3.8v-2.5c-2.4,1.7-6.8,2.5-11.3,2.5S2.4,25.5,0,23.7z M18.8,7.5\tC25,7.5,30,5.8,30,3.8S25,0,18.8,0S7.5,1.7,7.5,3.8S12.5,7.5,18.8,7.5z M0,17.6v3c0,2.1,5,3.8,11.3,3.8s11.3-1.7,11.3-3.8v-3\tc-2.4,2-6.8,3-11.3,3S2.4,19.6,0,17.6z M24.4,18.2c3.4-0.7,5.6-1.9,5.6-3.2v-2.5c-1.4,1-3.4,1.6-5.6,2V18.2z M11.3,9.4\tC5,9.4,0,11.5,0,14.1s5,4.7,11.3,4.7s11.3-2.1,11.3-4.7S17.5,9.4,11.3,9.4z M24.1,12.7C27.6,12,30,10.8,30,9.4V6.9\tc-2.1,1.5-5.7,2.3-9.4,2.4C22.3,10.2,23.6,11.3,24.1,12.7z",compass:"M13.6,13.6c-0.8,0.8-0.8,2,0,2.7c0.8,0.8,2,0.8,2.7,0c0.8-0.8,0.8-2,0-2.7C15.6,12.9,14.4,12.9,13.6,13.6z M15,0 C6.7,0,0,6.7,0,15s6.7,15,15,15s15-6.7,15-15S23.3,0,15,0z M22.6,9l-4,8.7c-0.2,0.4-0.5,0.8-1,1l-8.7,4c-1,0.5-2-0.6-1.6-1.6l4-8.7 c0.2-0.4,0.5-0.8,1-1l8.7-4C22.1,6.9,23.1,7.9,22.6,9L22.6,9z","conveyor-belt-alt":"M26.6,19.6H3.4C1.5,19.6,0,21.1,0,23s1.5,3.4,3.4,3.4h23.3c1.9,0,3.4-1.5,3.4-3.4S28.5,19.6,26.6,19.6z M4.4,24.2\t\tc-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3s1.3,0.6,1.3,1.3S5.1,24.2,4.4,24.2z M15,24.2c-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3\t\ts1.3,0.6,1.3,1.3S15.7,24.2,15,24.2z M25.6,24.2c-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3s1.3,0.6,1.3,1.3S26.3,24.2,25.6,24.2z M13.7,5.2H4.2c-0.5,0-1,0.4-1,1v9.5c0,0.6,0.5,1,1,1h9.5c0.6,0,1-0.5,1-1V6.2C14.7,5.6,14.2,5.2,13.7,5.2z M24.9,7.9h-6.8c-0.5,0-1,0.5-1,1v6.8c0,0.6,0.5,1,1,1h6.8c0.5,0,1-0.5,1-1V8.9C25.9,8.3,25.4,7.9,24.9,7.9z",database:"M28.1,4.3V7c0,2.4-5.9,4.3-13.1,4.3S1.9,9.3,1.9,7V4.3C1.9,1.9,7.8,0,15,0S28.1,1.9,28.1,4.3z M28.1,10.3v6 c0,2.4-5.9,4.3-13.1,4.3S1.9,18.7,1.9,16.3v-6c2.8,1.9,8,2.8,13.1,2.8S25.3,12.3,28.1,10.3z M28.1,19.7v6c0,2.4-5.9, 4.3-13.1,4.3 S1.9,28.1,1.9,25.7v-6c2.8,1.9,8,2.8,13.1,2.8S25.3,21.6,28.1,19.7z",exchange:"M18.5,27.8c-1.3,0-2.3-1-2.3-2.3c0-0.6,0.3-1.3,0.8-1.7l3.1-2.8H2.3c-1.3,0-2.3-1.1-2.2-2.4c0-1.2,1-2.2,2.2-2.2h23.8 c1.3,0,2.3,1,2.3,2.3c0,0.7-0.3,1.3-0.8,1.7l-7.5,6.8C19.7,27.5,19.1,27.8,18.5,27.8L18.5,27.8z M27.8,13.6H4.1 c-1.3,0-2.3-1-2.3-2.3c0-0.7,0.3-1.3,0.8-1.7l7.5-6.8C11,1.9,12.5,2,13.3,2.9c0.9,0.9,0.8,2.4-0.2,3.3l0,0L10.1,9h17.8 c1.3,0,2.3,1.1,2.3,2.4C30.1,12.6,29.1,13.6,27.8,13.6L27.8,13.6z",fire:"M16.4,1.4c0-1.4-1.8-1.9-2.6-0.8c-7.3,10.6,3.1,11.1,3.1,16.2c0,2.1-1.7,3.8-3.8,3.7c-2.1,0-3.7-1.7-3.7-3.8v-5 c0-1.3-1.6-1.9-2.4-1c-1.6,1.6-3.2,4.5-3.2,7.9C3.7,25,8.8,30,15,30s11.2-5,11.2-11.2C26.2,8.8,16.4,7.4,16.4,1.4L16.4,1.4z",fingerprint:"M15,14.4c-0.8,0-1.4,0.6-1.4,1.4c0.1,4.2-0.5,8.3-1.6,12.4c-0.2,0.6,0.1,1.8,1.4,1.8c0.6,0,1.2-0.4,1.4-1\tc0.8-2.8,1.8-7.3,1.7-13.2C16.4,15,15.8,14.4,15,14.4z M15,9.6c-3.6,0-6.1,2.8-6,5.9c0,2.8-0.2,5.6-0.8,8.4\tc-0.2,0.8,0.3,1.5,1.1,1.7c0.8,0.2,1.5-0.3,1.7-1.1c0.6-2.9,0.9-6,0.8-9c0-1.5,1.2-3.1,3.2-3.1c1.8,0,3.3,1.5,3.4,3.3\tc0,2.8-0.2,5.6-0.6,8.4c-0.1,0.8,0.4,1.5,1.2,1.6c1.2,0.2,1.6-0.9,1.6-1.2c0.5-2.9,0.7-5.9,0.7-8.9C21.1,12.4,18.3,9.7,15,9.6\tL15,9.6z M8.5,8.5C7.9,8,7,8.1,6.5,8.7c-1.5,1.8-2.3,4.2-2.3,6.6c0,2.2-0.1,4.4-0.5,6.6c-0.1,0.8,0.4,1.5,1.1,1.6\tc1.2,0.2,1.6-0.9,1.6-1.1C6.9,20,7.1,17.6,7,15.2c0-1.8,0.5-3.4,1.6-4.7C9.2,9.8,9.1,9,8.5,8.5z M14.9,4.8c-0.9,0-1.8,0.1-2.7,0.3\tc-0.8,0.2-1.2,0.9-1,1.7c0.2,0.8,0.9,1.2,1.7,1c0.6-0.2,1.3-0.2,2-0.2c4.4,0.1,8.1,3.6,8.1,7.9c0,2.2-0.1,4.5-0.3,6.7\tc-0.1,0.8,0.5,1.5,1.2,1.6c1,0.1,1.5-0.7,1.6-1.2c0.3-2.3,0.4-4.7,0.3-7C25.7,9.7,20.8,4.9,14.9,4.8L14.9,4.8z M29.7,11.9\tc-0.2-0.8-0.9-1.2-1.7-1.1c-0.8,0.2-1.2,0.9-1.1,1.7c0.3,1.3,0.3,2.2,0.3,3.6c0,0.8,0.6,1.4,1.4,1.4h0c0.8,0,1.4-0.6,1.4-1.4\tC30,14.9,30,13.6,29.7,11.9L29.7,11.9z M27.3,6.6C24.5,2.5,19.8,0.1,14.8,0C10.7,0,6.9,1.5,4.1,4.3C1.4,7-0.1,10.6,0,14.5l0,1.3\tc0,0.8,0.6,1.4,1.4,1.4c0,0,0,0,0,0c0.8,0,1.4-0.6,1.4-1.4l0-1.4c0-3.1,1.1-6,3.3-8.1c2.3-2.3,5.4-3.5,8.7-3.4\tc4.1,0.1,7.9,2.1,10.2,5.4c0.4,0.6,1.3,0.8,2,0.3C27.6,8.1,27.8,7.2,27.3,6.6L27.3,6.6z",gem:"M25.3,1.7L30,10h-5.3l-3.6-8.3H25.3z M18.6,1.7l3.6,8.3H7.8l3.6-8.3H18.6z M4.7,1.7h4.2L5.3,10H0L4.7,1.7z M0,11.7h5.2 l6.4,13.1c0.1,0.2-0.1,0.3-0.3,0.2L0,11.7z M7.7,11.7h14.6l-7.1,16.6c-0.1,0.1-0.2,0.1-0.3,0L7.7,11.7z M18.3,24.8l6.4-13.1H30 L18.6,24.9C18.5,25.1,18.3,24.9,18.3,24.8L18.3,24.8z",link:"M19.1,10.9c3.5,3.5,3.5,9.1,0,12.6c0,0,0,0,0,0l-3.9,3.9c-3.5,3.5-9.1,3.5-12.6,0c-3.5-3.5-3.5-9.1,0-12.6l2.2-2.2\tc0.6-0.6,1.6-0.2,1.6,0.6c0,1,0.2,2.1,0.6,3.1c0.1,0.3,0,0.7-0.2,1L6,18.1c-1.6,1.6-1.7,4.3-0.1,6c1.6,1.7,4.3,1.7,6,0l3.9-3.9\tc1.7-1.7,1.6-4.3,0-6c-0.2-0.2-0.4-0.4-0.6-0.5c-0.2-0.2-0.4-0.4-0.4-0.7c0-0.6,0.2-1.3,0.7-1.7l1.2-1.2c0.3-0.3,0.8-0.4,1.2-0.1\tC18.4,10.2,18.8,10.5,19.1,10.9L19.1,10.9z M27.4,2.6c-3.5-3.5-9.1-3.5-12.6,0l-3.9,3.9c0,0,0,0,0,0c-3.4,3.5-3.5,9.1,0,12.6\tc0.4,0.4,0.8,0.7,1.2,1c0.4,0.3,0.9,0.2,1.2-0.1l1.2-1.2c0.5-0.5,0.7-1.1,0.7-1.7c0-0.3-0.2-0.6-0.4-0.7c-0.2-0.1-0.4-0.3-0.6-0.5\tc-1.6-1.6-1.7-4.3,0-6l3.9-3.9c1.7-1.7,4.4-1.6,6,0c1.6,1.7,1.6,4.3-0.1,6l-0.8,0.8c-0.3,0.3-0.3,0.6-0.2,1c0.3,1,0.5,2.1,0.6,3.1\tc0,0.8,1,1.2,1.6,0.6l2.2-2.2C30.9,11.7,30.9,6.1,27.4,2.6L27.4,2.6z",retweet:"M29.6,16.6l-1.2-1.2c-0.3-0.3-0.9-0.3-1.2,0L25.7,17c-0.4,0.4-1,0.1-1-0.4V6.9c0-1.3-1-2.3-2.3-2.3H14\tc-0.5,0-0.9,0.4-0.9,0.9v1.7c0,0.5,0.4,0.9,0.9,0.9h6.3c0.5,0,0.9,0.4,0.9,0.9v7.6c0,0.5-0.6,0.7-1,0.4l-1.5-1.5\tc-0.3-0.3-0.9-0.3-1.2,0l-1.2,1.3c-0.3,0.3-0.3,0.9,0,1.2l6.1,6.1c0.3,0.3,0.9,0.3,1.2,0l6.1-6.1C29.9,17.5,29.9,17,29.6,16.6z\t M15.7,21.9H9.4c-0.5,0-0.9-0.4-0.9-0.9v-7.6c0-0.5,0.6-0.7,1-0.4l1.5,1.5c0.3,0.3,0.9,0.3,1.2,0l1.2-1.2c0.3-0.3,0.3-0.9,0-1.2\tL7.5,6C7.2,5.7,6.6,5.7,6.3,6l-6.2,6.1c-0.3,0.3-0.3,0.9,0,1.2l1.2,1.2c0.3,0.3,0.9,0.3,1.2,0L4.1,13c0.3-0.3,1-0.1,1,0.4v9.7\tc0,1.3,1.1,2.3,2.4,2.3h8.4c0.5,0,0.9-0.4,0.9-0.9v-1.7C16.6,22.3,16.2,21.9,15.7,21.9L15.7,21.9z",server:"M28.1,9.4H1.9C0.8,9.4,0,8.5,0,7.5V3.8c0-1,0.8-1.9,1.9-1.9h26.3c1,0,1.9,0.8,1.9,1.9v3.8C30,8.5,29.2,9.4,28.1,9.4z\t M25.3,4.2c-0.8,0-1.4,0.6-1.4,1.4S24.5,7,25.3,7s1.4-0.6,1.4-1.4S26.1,4.2,25.3,4.2z M21.6,4.2c-0.8,0-1.4,0.6-1.4,1.4\tS20.8,7,21.6,7S23,6.4,23,5.6S22.3,4.2,21.6,4.2z M28.1,18.8H1.9c-1,0-1.9-0.8-1.9-1.9v-3.8c0-1,0.8-1.9,1.9-1.9h26.3\tc1,0,1.9,0.8,1.9,1.9v3.8C30,17.9,29.2,18.8,28.1,18.8z M25.3,13.6c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4s1.4-0.6,1.4-1.4\tS26.1,13.6,25.3,13.6z M21.6,13.6c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4S23,15.8,23,15S22.3,13.6,21.6,13.6z M28.1,28.1H1.9\tc-1,0-1.9-0.8-1.9-1.9v-3.8c0-1,0.8-1.9,1.9-1.9h26.3c1,0,1.9,0.8,1.9,1.9v3.8C30,27.3,29.2,28.1,28.1,28.1z M25.3,23\tc-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4s1.4-0.6,1.4-1.4S26.1,23,25.3,23z M21.6,23c-0.8,0-1.4,0.6-1.4,1.4s0.6,1.4,1.4,1.4\ts1.4-0.6,1.4-1.4S22.3,23,21.6,23z","shield-check":"M15.3,30h-0.5c-0.2,0-0.4,0-0.5-0.1c-1-0.2-1.9-0.5-2.8-1c-1.7-0.9-3.3-2-4.6-3.4c-1.3-1.3-2.4-2.7-3.2-4.4\tc-0.7-1.3-1.1-2.8-1.1-4.3c0-4.1,0-8.2,0-12.3V4.4c0,0,0,0,0,0c0,0,0.1,0,0.1,0c1.1,0,2.3-0.1,3.4-0.3c1.1-0.2,2.1-0.5,3.2-0.9\tc1.4-0.5,2.7-1.2,4-2C13.9,0.9,14.5,0.5,15,0h0c0,0,0.1,0.1,0.1,0.1c1,0.8,2.1,1.4,3.2,2c1.5,0.7,2.9,1.4,4.5,1.8\tc0.8,0.2,1.7,0.4,2.5,0.4c0.6,0,1.2,0.1,1.8,0.1c0.1,0,0.3,0,0.4,0v0.2c0,4.1,0,8.2,0,12.3c0,0.3,0,0.6,0,0.9\tc-0.1,1.1-0.4,2.1-0.9,3c-0.6,1.4-1.5,2.6-2.5,3.8c-1.7,1.9-3.7,3.5-6,4.6c-0.7,0.3-1.4,0.6-2.1,0.7C15.7,29.9,15.5,30,15.3,30\tL15.3,30z M12.7,20.8c0.2,0.2,0.6,0.3,0.9,0L22.4,10c0.1-0.1,0.1-0.2,0-0.2l-0.8-0.7c-0.1-0.1-0.2-0.1-0.2,0l-8.1,8.3\tc-0.2,0.2-0.5,0.2-0.8,0.1l-3.8-2.7c-0.1-0.1-0.2,0-0.2,0l-0.8,0.9c-0.1,0.1,0,0.2,0,0.2L12.7,20.8L12.7,20.8z",vial:"M29.9,10.6L19.4,0.1c-0.2-0.2-0.5-0.2-0.7,0l-2.1,2.1c-0.2,0.2-0.2,0.5,0,0.7l0.7,0.7L2.1,18.8c-2.4,2.4-2.8,6.4-0.6,9 C2.8,29.2,4.6,30,6.4,30c1.7,0,3.3-0.6,4.6-1.9l15.4-15.4l0.7,0.7c0.2,0.2,0.5,0.2,0.7,0l2.1-2.1C30.1,11.1,30.1,10.8,29.9,10.6z M19.9,15h-9.8l9.3-9.2l4.9,4.9L19.9,15z",vials:"M3.4,6h1.1v11.3c0,2.1,1.7,3.8,3.8,3.8s3.8-1.7,3.8-3.8V6h1.1c0.2,0,0.4-0.2,0.4-0.4V3.4c0-0.2-0.2-0.4-0.4-0.4H3.4 C3.2,3,3,3.2,3,3.4v2.3C3,5.8,3.2,6,3.4,6z M6.8,6h3v4.5h-3V6z M29.3,24H0.8C0.3,24,0,24.3,0,24.8v1.5C0,26.7,0.3,27,0.8, 27h28.5 c0.4,0,0.8-0.3,0.8-0.8v-1.5C30,24.3,29.7,24,29.3,24z M16.9,6H18v11.3c0,2.1,1.7,3.8,3.8,3.8s3.8-1.7,3.8-3.8V6h1.1 C26.8,6,27,5.8,27,5.6V3.4C27,3.2,26.8,3,26.6,3h-9.8c-0.2,0-0.4,0.2-0.4,0.4v2.3C16.5,5.8,16.7,6,16.9,6z M20.3,6h3v4.5h-3V6z"}},{}],23:[function(e,t,o){o.createGroup=function(e,t){let o=[e];return Array.isArray(t)&&(o=o.concat(t)),React.DOM.g.apply(React.DOM.g,o)},o.createRect=function(e){return React.DOM.rect(e)},o.createRectImg=function(e){let t=React.DOM.image({x:e.x,y:e.y,width:e.width,height:e.height,xlinkHref:e.href}),o=React.DOM.pattern({patternUnits:"userSpaceOnUse",width:"100%",height:"100%",id:e.id},t);return React.DOM.defs(null,o)},o.createText=function(e){return React.DOM.text(e)},o.createCircle=function(e){return React.DOM.circle(e)},o.createPath=function(e){return React.DOM.path(e)},o.createPolygon=function(e){return React.DOM.polygon(e)},o.createImg=function(e){return TheGraph.SVGImage(e)},o.createCanvas=function(e){return React.DOM.canvas(e)},o.createSvg=function(e,t){let o=[e];return Array.isArray(t)&&(o=o.concat(t)),React.DOM.svg.apply(React.DOM.svg,o)},o.createAppDefs=function(){return React.DOM.defs({dangerouslySetInnerHTML:{__html:'<linearGradient id="grad1" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" style="stop-color:rgb(240,240,240);stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(255,255,255);stop-opacity:1" /></linearGradient><filter id="blur_o"><feOffset result="offOut" in="SourceGraphic" dy="1" /><feColorMatrix result="matrixOut" in="offOut" type="matrix" values="0.86 0 0 0 0 0 0.86 0 0 0 0 0 0.86 0 0 0 0 0 1 0" /><feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="3" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter><filter id="blur_o_sm"><feOffset result="offOut" in="SourceGraphic" dy="1" /><feColorMatrix result="matrixOut" in="offOut" type="matrix" values="0.86 0 0 0 0 0 0.86 0 0 0 0 0 0.86 0 0 0 0 0 1 0" /><feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="2" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter><filter id="blur_c_sm"><feOffset result="offOut" in="SourceGraphic" dy="1" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="2" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter><filter id="blur_c"><feOffset result="offOut" in="SourceGraphic" dy="1" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="3" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>'}})}},{}],24:[function(e,t,o){t.exports.register=function(e){e.TheGraph.FONT_ICON={"500px":"",check:"",checked:"","check-circle":"",close:"","close-circle":"","warning-circle":"",cog:"",cube:""}}},{}],25:[function(e,t,o){t.exports=function(e,t,o){if(Array.isArray(e)||Array.isArray(t)||"object"!=typeof e||"object"!=typeof t)return t;o=o||!1;for(let n in e)"function"==typeof e[n]||t[n]&&!o||(t[n]=e[n]);return t}},{}],26:[function(e,t,o){let n={componentWillUnmount:function(){this._ismounted=!1},showTooltip:function(e){if(!this.shouldShowTooltip())return;const t=_.get(e,"target.id","");let o=new CustomEvent("the-graph-tooltip",{detail:{nodeId:t,tooltip:this.props.label,x:e.offsetX,y:e.offsetY,isIn:this.props.isIn},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(o),this.setState({tooltipId:t})},hideTooltip:function(e){const t=_.get(e,"target.id","");if(t===this.state.tooltipId||this.state.tooltip&&this.shouldShowTooltip()){this.setState({tooltipId:null});let e=new CustomEvent("the-graph-tooltip-hide",{detail:{nodeId:t},bubbles:!0});this._ismounted&&ReactDOM.findDOMNode(this).dispatchEvent(e)}},componentDidMount:function(){if(this._ismounted=!0,navigator&&-1!==navigator.userAgent.indexOf("Firefox"))return;let e=this.getTooltipTrigger();e.addEventListener("tap",this.showTooltip),e.addEventListener("mouseenter",this.showTooltip),e.addEventListener("mouseleave",this.hideTooltip)}};t.exports={Tooltip:n}},{}],27:[function(e,t,o){let n=window.unwrap?window.unwrap:function(e){return e},r={27:function(e){e.refs.graph&&e.refs.graph.cancelPreviewEdge()}},i=[70,83,27];t.exports.register=function(e){let t=e.TheGraph;t.config.app={container:{className:"the-graph-app",name:"app"},canvas:{ref:"canvas",className:"app-canvas"},svg:{className:"app-svg",ref:"svg"},svgGroup:{className:"view"},graph:{ref:"graph"},tooltip:{ref:"tooltip"},modal:{className:"context"}},t.factories.app={createAppContainer:function(e,t){let o=[e];Array.isArray(t)&&(o=o.concat(t));return React.DOM.div.apply(React.DOM.div,o)},createAppCanvas:t.factories.createCanvas,createAppSvg:t.factories.createSvg,createAppSvgGroup:t.factories.createGroup,createAppGraph:function(e){return t.Graph(e)},createAppModalGroup:t.factories.createGroup,createAppModalBackground:function(e){return t.ModalBG(e)},createAppDefs:t.factories.createAppDefs};let o=[];window.React.Animate&&o.push(React.Animate),t.App=React.createClass({displayName:"TheGraphApp",mixins:o,getDefaultProps:function(){return{width:null,height:null,readonly:!1,nodeIcons:{},minZoom:.15,maxZoom:15,offsetX:0,offsetY:0,menus:null,showScriptEditIcon:!1,getMenuDef:null,onPanScale:null,onNodeSelection:null,onNodeRectImgDblclick:null,onEdgeSelection:null,onClickEdgeCode:null,onGroupSelection:null,onExpandIconClicked:null}},getInitialState:function(){return{x:this.props.x,y:this.props.y,scale:1,width:this.props.width,height:this.props.height,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,trackStartX:null,trackStartY:null,contextElement:null,contextType:null,offsetY:this.props.offsetY,offsetX:this.props.offsetX}},zoomFactor:0,zoomX:0,zoomY:0,onWheel:function(e){e.preventDefault(),this.zoomFactor||(this.zoomFactor=0),this.zoomFactor+=e.deltaY?e.deltaY:0-e.wheelDeltaY,this.zoomX=e.clientX-this.domNodeRect.x,this.zoomY=e.clientY-this.domNodeRect.y,requestAnimationFrame(this.scheduleWheelZoom)},scheduleWheelZoom:function(){if(isNaN(this.zoomFactor))return;let e=this.zoomFactor/-500;e=Math.min(.5,Math.max(-.5,e));let t=this.state.scale+this.state.scale*e;if(this.zoomFactor=0,t<this.state.minZoom?t=this.state.minZoom:t>this.state.maxZoom&&(t=this.state.maxZoom),t===this.state.scale)return;let o=t/this.state.scale,n=this.state.x,r=this.state.y,i=this.zoomX,a=this.zoomY,s=o*(n-i)+i,c=o*(r-a)+a;this.setState({scale:t,x:s,y:c})},lastScale:1,lastX:0,lastY:0,pinching:!1,onTrackStart:function(e){let t=document.getElementById("editor");t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.moved=!1,this.setState({trackStartX:e.pageX,trackStartY:e.pageY})},onTrack:function(e){this.movedX=e.pageX-this.state.trackStartX,this.movedY=e.pageY-this.state.trackStartY,(Math.abs(this.movedX)>=5||Math.abs(this.movedY)>=5)&&(this.moved=!0,this.setState({x:this.state.x+this.movedX,y:this.state.y+this.movedY,trackStartX:e.pageX,trackStartY:e.pageY}))},onTrackEnd:function(e){let t=document.getElementById("editor");t.removeEventListener("mousemove",this.onTrack),t.removeEventListener("mouseup",this.onTrackEnd),this.setState({trackStartX:null,trackStartY:null}),this.props.onMoved(this.state.x,this.state.y)},onPanScale:function(){this.props.onPanScale&&this.props.onPanScale(this.state.x,this.state.y,this.state.scale)},defaultGetMenuDef:function(e){if(e.type&&this.props.menus&&this.props.menus[e.type]){let t=this.props.menus[e.type];return t.callback?t.callback(t,e):t}return null},showContext:function(e){this.props.showContext&&this.props.showContext(e)},hideContext:function(e){this.setState({contextMenu:null})},triggerFit:function(e){let o=t.findFit(this.props.graph,this.props.width,this.props.height);this.setState({x:o.x,y:o.y,scale:o.scale})},focusNode:function(e){let o=t.config.focusAnimationDuration,n=t.findNodeFit(e,this.state.width,this.state.height),r={x:-(this.state.x-this.state.width/2)/this.state.scale,y:-(this.state.y-this.state.height/2)/this.state.scale},i={x:e.metadata.x,y:e.metadata.y},a=t.findAreaFit(r,i,this.state.width,this.state.height),s=Math.abs(a.scale-this.state.scale),c=Math.abs(n.scale-a.scale),p=s+c;this.animate?this.animate({x:a.x,y:a.y,scale:a.scale},o*(s/p),"in-quint",function(){this.animate({x:n.x,y:n.y,scale:n.scale},o*(c/p),"out-quint")}.bind(this)):this.setState({x:n.x,y:n.y,scale:n.scale})},edgeStart:function(e){this.refs.graph.edgeStart(e),this.hideContext()},updateDomOffset:function(){const e=ReactDOM.findDOMNode(this.refs.svg);this.domNodeRect=e.getBoundingClientRect()},componentDidMount:function(){let e=ReactDOM.findDOMNode(this.refs.svg);e.addEventListener("click",this.unselectAll),e.addEventListener("mousedown",this.onTrackStart),void 0!==e.onwheel?e.addEventListener("wheel",this.onWheel):void 0!==e.onmousewheel&&e.addEventListener("mousewheel",this.onWheel),e.addEventListener("the-graph-edge-start",this.edgeStart);let t=n(ReactDOM.findDOMNode(this.refs.canvas));this.bgContext=n(t.getContext("2d")),this.componentDidUpdate(),setTimeout(function(){this.renderGraph()}.bind(this),500)},onShowContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,o=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,o=e.touches[0].clientY),this.showContext({element:this,type:"main",x:t,y:o,graph:this.props.graph,itemKey:"graph",item:this.props.graph})},keyDown:function(e){(e.metaKey||e.ctrlKey)&&(t.metaKeyPressed=!0);let o=e.keyCode,n=r[o];if(n){let e=this.props.readonly;(!e||e&&i[o])&&n(this)}},keyUp:function(e){t.metaKeyPressed&&(t.metaKeyPressed=!1)},unselectAll:function(e){this.moved||(this.props.onNodeSelection&&this.props.onNodeSelection(e),this.props.onNodeRectImgDblclick&&this.props.onNodeRectImgDblclick(e),this.props.onEdgeSelection&&this.props.onEdgeSelection(),this.props.onGroupSelection&&this.props.onGroupSelection())},renderGraph:function(){this.refs.graph.markDirty({allNodeDirty:!0})},componentDidUpdate:function(e,t){t&&t.x===this.state.x&&t.y===this.state.y&&t.scale===this.state.scale||this.onPanScale(),t&&t.width===this.state.width&&t.height===this.state.height||this.updateDomOffset()},renderCanvas:function(e){e.clearRect(0,0,this.state.width,this.state.height);let o=this.state.scale,n=t.config.nodeSize*o,r=(this.state.x,this.state.y,Math.floor(this.state.width/n)+1),i=Math.floor(this.state.height/n)+1;Math.floor(this.state.x/n),this.state.x,Math.floor(this.state.y/n),this.state.y;for(;i--;){let t=r;for(;t--;){let o=Math.round(t*n),r=Math.round(i*n);e.strokeStyle="#f0f0f0",e.beginPath(),e.moveTo(o+n,r),e.lineTo(o,r),e.lineTo(o,r+n),e.stroke()}}},getContext:function(e,o,n){return t.Menu({menu:e,options:o,triggerHideContext:n,label:"Hello",graph:this.props.graph,node:this,ports:[],process:[],processKey:null,x:o.x,y:o.y,nodeWidth:this.props.width,nodeHeight:this.props.height,deltaX:0,deltaY:0,highlightPort:!1})},render:function(){let e=this.state.scale,o="matrix("+e+",0,0,"+e+","+this.state.x+","+this.state.y+")",n=e>t.zbpBig?"big":e>t.zbpNormal?"normal":"small",r=null,i=this.props.getMenuDef||this.defaultGetMenuDef;if(this.state.contextMenu){let e=this.state.contextMenu,t=i(e);t&&Object.keys(t).length&&(r=e.element.getContext(t,e,this.hideContext))}let a=null;if(r){let e={width:this.state.width,height:this.state.height,triggerHideContext:this.hideContext,children:r};a=[t.factories.app.createAppModalBackground(e)],this.menuShown=!0}else this.menuShown=!1;let s={graph:this.props.graph,scale:this.state.scale,app:this,moved:this.moved,library:this.props.library,nodeIcons:this.props.nodeIcons,onNodeSelection:this.props.onNodeSelection,onNodeRectImgDblclick:this.props.onNodeRectImgDblclick,onEdgeSelection:this.props.onEdgeSelection,onClickEdgeCode:this.props.onClickEdgeCode,onGroupSelection:this.props.onGroupSelection,onExpandIconClicked:this.props.onExpandIconClicked,showContext:this.showContext,allowEdgeStart:!this.props.readonly,showScriptEditIcon:this.props.showScriptEditIcon};s=t.merge(t.config.app.graph,s);let c=t.factories.app.createAppGraph.call(this,s),p=t.merge(t.config.app.svgGroup,{transform:o}),l=t.factories.app.createAppSvgGroup.call(this,p,[c]),d=t.merge(t.config.app.modal,{children:a}),u=[l,t.factories.app.createAppModalGroup.call(this,d)],f=t.merge(t.config.app.svg,{width:this.state.width,height:this.state.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"}),h=t.factories.app.createAppSvg.call(this,f,u),m=t.merge(t.config.app.canvas,{width:this.state.width,height:this.state.height}),g=[t.factories.app.createAppCanvas.call(this,m),h],v=t.merge(t.config.app.container,{style:{width:this.state.width,height:this.state.height}});return v.className+=" "+n,t.factories.app.createAppContainer.call(this,v,g)}})}},{}],28:[function(e,t,o){t.exports={applyToGraph:function(e,t,o){console.error("DEPRECATED: TheGraph.autolayout.applyAutolayout() will be removed in next version");let n,r,i=t.children.slice();for(n=0,r=i.length;n<r;n++){let t=i[n],r=e.getNode(t.id);if(t.children){let n,r=t.children;for(n in r){let i=r[n];i.id&&e.setNodeMetadata(i.id,{x:Math.round((t.x+i.x)/o.snap)*o.snap,y:Math.round((t.y+i.y)/o.snap)*o.snap})}}if(r)e.setNodeMetadata(t.id,{x:Math.round(t.x/o.snap)*o.snap,y:Math.round(t.y/o.snap)*o.snap});else{let n=t.id.split(":::"),r=n[0],i=n[1];"inport"===r&&e.inports[i]?e.setInportMetadata(i,{x:Math.round(t.x/o.snap)*o.snap,y:Math.round(t.y/o.snap)*o.snap}):"outport"===r&&e.outports[i]&&e.setOutportMetadata(i,{x:Math.round(t.x/o.snap)*o.snap,y:Math.round(t.y/o.snap)*o.snap})}}}}},{}],29:[function(e,t,o){const n=["#55dcfa","#5579fa","#f15f33","#ec3be3","#33f1b5","#1e81b0","#e28743","#eab676","#76b5c5","#873e23","#063970"];function r(e,t,o={}){e&&e instanceof Array&&t&&(this.animate=this.animate.bind(this),this.edges=e,this.runningAnimation=null,this.currentAnimation=null,this.animationTimer=0,this.animationEndTime=Number.MAX_VALUE,this.animationQueue=this.prepareAnimationData(e,t),this.ballColor=n[Math.floor(10*Math.random()%n.length)],this.onStart=o.onStart||null,this.onEnd=o.onEnd||null)}r.prototype.animate=function(){if(this.animationTimer>this.endTime)return cancelAnimationFrame(this.runningAnimation),void(this.onEnd&&this.onEnd());this.animationQueue.forEach(e=>{const{startTime:t=0,messages:o=[],started:n=!1}=e;this.animationTimer>=t&&!n&&o.forEach(t=>{const{edge:o={},duration:n=0}=t,r=`edge-${o.from.node}-${o.from.port}-${o.to.port}-${o.to.node}`,i=document.getElementById(r);if(i){const t=i.querySelectorAll(".edge-flow"),o=t[0];if(o){const r=o.cloneNode(),i=o.parentNode,a=o.getAttribute("d");if(a){const t=`<animateMotion path="${a}" begin="0s" dur="${n}s" repeatCount="1"></animateMotion>`;r.insertAdjacentHTML("beforeend",t),r.setAttribute("fill",this.ballColor),i.appendChild(r),r.classList.remove("hide"),r.querySelector("animateMotion").beginElement(),e.started=!0}t.length>100&&t[1].remove()}}})}),this.animationTimer+=60,this.runningAnimation=requestAnimationFrame(this.animate)},r.prototype.destroy=function(){},r.prototype.prepareAnimationData=function(e,t){const o=[],n={};let r=+Date.now();return this.endTime=0,Object.keys(t).forEach(i=>{t[i].messages.forEach(t=>{const i=t.source,a=t.target,s=i.timestamp,c=parseFloat(a.timestamp)-parseFloat(i.timestamp),p=e.find(e=>e.from.node===i.node_id&&e.from.port===i.port&&e.to.node===a.node_id&&e.to.port===a.port);p&&(r=Math.min(s,r),this.endTime=Math.max(this.endTime,s+c),n[s]?n[s].messages.push({edge:p,duration:c}):o.push({startTime:s,messages:[{edge:p,duration:c}]}))})}),o.forEach(function(e){e.startTime=e.startTime-r}),o.sort(function(e,t){return e.startTime<=t.startTime?-1:1}),o},r.prototype.reset=function(){this.runningAnimation&&cancelAnimationFrame(this.runningAnimation),this.animationTimer=0,this.runningAnimation=null,this.animationQueue=[]},r.prototype.setAnimationData=function(e){this.reset(),this.ballColor=n[Math.floor(10*Math.random()%n.length)],this.animationQueue=this.prepareAnimationData(this.edges,e)},t.exports=r},{}],30:[function(e,t,o){const n=e("./constants").iconSvgD.alert,r=e("./constants").iconSvgD.code;t.exports.register=function(e){let t=e.TheGraph;t.config.edge={curve:t.config.nodeSize,container:{className:"edge"},defaultColor:"#a6a6a6",backgroundPath:{className:"edge-bg"},foregroundPath:{ref:"route",className:"edge-fg stroke route"},flowPath:{className:"edge-flow hide",fill:"#55dcfa",cx:"0",cy:"0",r:"4"},autoPath:{ref:"route",className:"edge-auto stroke route"},touchPath:{className:"edge-touch",ref:"touch"},alertIcon:{className:"edge-alert",d:n,fill:"#FF6161",r:8},codeIcon:{className:"edge-code",d:r,fill:"#0084FF",r:8},portStart:{className:"edge-port edge-port-start",r:3,ref:"edgePortStart"},portEnd:{className:"edge-port edge-port-end",ref:"edgePortEnd"},port:{className:"edge-port",r:3}},t.factories.edge={createEdgeGroup:t.factories.createGroup,createEdgeBackgroundPath:t.factories.createPath,createEdgeForegroundPath:t.factories.createPath,createEdgeTouchPath:t.factories.createPath,createArrow:t.factories.createPolygon,createCircle:t.factories.createCircle,createIconSvg:t.factories.createPath},t.Edge=React.createFactory(React.createClass({displayName:"TheGraphEdge",space:{source:t.config.edge.port.r+t.config.port.size,target:2*t.config.edge.port.r+t.config.port.size},distance:t.config.edgeDistance,getInitialState:function(){return{path:void 0,ports:void 0}},componentWillMount:function(){const{angle:e,sX:t,sY:o,tX:n,tY:r,path:i,isPreview:a,updating:s}=this.props;i?this.initEdgePorts():this.setEdgePath(e,t,o,n,r,a,s)},componentDidMount:function(){const e=$(ReactDOM.findDOMNode(this));let t=this;t.handleMouseMove=t.handleMouseMove.bind(t),t.handleMouseUp=t.handleMouseUp.bind(t),this.props.isPreview||(e.on("mouseenter.edge",function(t){e.addClass("over")}),e.on("mouseleave.edge",function(t){e.removeClass("over")}),e.on("mousedown.edge",function(e){if(e.stopPropagation(),"path"!==e.target.tagName||t.state.ports.length<6)return;const o=e.target.getAttribute("class"),n=("edge-alert"===o||"edge-code"===o?e.target.parentNode.parentNode.querySelector(".edge-bg"):e.target).getBoundingClientRect();t.moveStart={x:e.clientX,y:e.clientY,domRect:n,ports:t.state.ports}}),this.$graph=$(document.querySelector(".the-graph-app")),this.$graph.on("mousemove",t.handleMouseMove),this.$graph.on("mouseup",t.handleMouseUp),e.on("click.edge",function(e){e.stopPropagation(),e.stopImmediatePropagation(),t.props.onEdgeSelection&&t.props.onEdgeSelection(t.props.edgeID,t.props.edge)}),e.on("click",".scripts",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),t.props.onClickEdgeCode){const o=e.currentTarget.getAttribute("data-direction");t.props.onClickEdgeCode(t.props.edge.from,t.props.edge.to,t.props.edge.metadata,o)}}),e.on("mousedown.edge.edgePorts",this.edgeStart)),this.props.showContext&&(e.on("contextmenu",this.showContext),e.on("press",this.showContext))},componentWillReceiveProps:function(e){const{angle:t,sX:o,sY:n,tX:r,tY:i,isPreview:a,updating:s}=e;a===this.props.isPreview&&this.props.tX===r&&this.props.tY===i&&this.props.sX===o&&this.props.sY===n||this.setEdgePath(t,o,n,r,i,a,s)},shouldComponentUpdate:function(e,t){return e.color!==this.props.color||e.size!==this.props.size||e.hidden!==this.props.hidden||e.selected!==this.props.selected||e.animated!==this.props.animated||e.route!==this.props.route||e.inScript!==this.props.inScript||e.outScript!==this.props.outScript||e.error!==this.props.error||t.path!==this.state.path},componentWillUnmount:function(){this.$graph&&this.$graph.off("mousemove",this.handleMouseMove),this.$graph&&this.$graph.off("mouseup",this.handleMouseUp)},handleMouseMove:function(e){this.moveStart&&(Math.abs(e.clientY-this.moveStart.y)>10||Math.abs(e.clientX-this.moveStart.x)>10)&&this.handleResetEdge({x:e.clientX,y:e.clientY})},handleMouseUp:function(e){if(this.moveStart){this.moveStart=null;const{from:e,to:t,metadata:o}=this.props.edge,{path:n}=this.state;this.props.onUpdatePath(e,t,Object.assign({},o,{path:n,custom:!0}))}},getPositons:function(e,t,o,n){let r=t,i=o;switch(e){case 0:r=(t+=n)+this.distance;break;case 90:i=(o-=n)-this.distance;break;case 180:r=(t-=n)-this.distance;break;case 270:i=(o+=n)+this.distance}return[{x:t,y:o},{x:r,y:i}]},updatePorts:function(e,t){const o=this.state.ports;let n="x";if((e[0].x===e[1].x&&Math.abs(t[1].y-e[0].y)<Math.abs(t[1].y-e[1].y)||e[0].y===e[1].y&&Math.abs(t[1].x-e[0].x)>=Math.abs(t[1].x-e[1].x))&&(n="y"),o[0].x!==e[0].x||o[0].y!==e[0].y)o[0]=e[0],o[1]=e[1],o[2][n]=e[1][n];else{const e=o.length-1;o[e-1]=t[1],o[e]=t[0],o[e-2][n]=t[1][n]}return o},getPorts:function(e,t){let o=[e[0],e[1]];if(e[0].x===e[1].x)if(t[1].y>=e[1].y)if(t[1].x==t[0].x){const n=e[1].y+.5*(t[1].y-e[1].y);o.push({x:e[0].x,y:n},{x:t[1].x,y:n})}else if(e[1].x>t[1].x){let n=e[0].y+.5*(t[1].y-e[0].y);n<e[1].y&&(n=e[1].y),o.push({x:e[0].x,y:n},{x:t[1].x,y:n})}else o.push({x:e[0].x,y:t[1].y});else if(t[1].x===t[0].x){const n=e[1].x+.5*(t[1].x-e[1].x);o.push({x:n,y:e[1].y},{x:n,y:t[1].y})}else if(e[1].x>=t[1].x)o.push({x:t[1].x,y:e[1].y});else{let n=e[1].x+.5*(t[0].x-e[1].x);n>t[1].x&&(n=t[1].x),o.push({x:n,y:e[1].y},{x:n,y:t[1].y})}else if(e[0].y===e[1].y)if(t[1].x>=e[1].x)if(t[1].y==t[0].y){const n=e[1].x+.5*(t[1].x-e[1].x);o.push({x:n,y:e[1].y},{x:n,y:t[1].y})}else if(e[1].y>t[1].y){let n=e[0].x+.5*(t[1].x-e[0].x);n<e[1].x&&(n=e[1].x),o.push({x:n,y:e[1].y},{x:n,y:t[1].y})}else o.push({x:t[1].x,y:e[1].y});else if(t[1].y==t[0].y){const n=e[1].y+.5*(t[1].y-e[1].y);o.push({x:e[1].x,y:n},{x:t[1].x,y:n})}else if(e[1].y>=t[1].y)o.push({x:e[1].x,y:t[1].y});else{let n=e[1].y+.5*(t[0].y-e[1].y);n>t[1].y&&(n=t[1].y),o.push({x:e[1].x,y:n},{x:t[1].x,y:n})}return o.push(t[1]),o.push(t[0]),o},getPath:function(e){let t=`M${e[0].x},${e[0].y}`;return e.slice(1).forEach(function({x:e,y:o}){t+=` L${e},${o}`}),t},getSpace:function(){const{isPreview:e,updating:o,isIn:n}=this.props,r={s:0,t:0};return e?o?n?r.t=this.space.target:(r.s=this.space.source,r.t=2*t.config.edge.port.r):(r.s=0,r.t=this.space.target):(r.s=this.space.source,r.t=this.space.target),r},getQuadrant:function(e,t){return e.x>t.x&&e.y>t.y?"4":e.x<t.x&&e.y<t.y?"2":e.x>t.x&&e.y<t.y?"1":e.x<t.x&&e.y>t.y?"3":void 0},setEdgePath:function(e,t,o,n,r,i,a){const s=this.getSpace();let{ports:c}=this.state;const p=this.getPositons(e.source,t,o,s.s),l=this.getPositons(e.target,n,r,s.t);let d=this.props.custom;const u=this.getQuadrant(l[1],p[1]);let f;const h=this.state.angle;_.isEmpty(c)||(f=this.getQuadrant(c[c.length-1],c[0])),!d||d&&(f!==u||e.source!==h.source||e.target!==h.target)?(c=this.getPorts(p,l),d=!1):c=this.updatePorts(p,l,d);const m=this.getPath(c);this.setState({angle:e,ports:c,path:m},()=>{if(!i){const{from:e,to:t,metadata:o}=this.props.edge;this.props.onUpdatePath(e,t,Object.assign({},o,{path:m,custom:d}))}})},handlePathToPorts:function(e){return e.split(" ").map(function(e){const t=e.slice(1).split(",");return{x:_.toNumber(t[0]),y:_.toNumber(t[1])}})},initEdgePorts:function(){const{path:e,angle:t}=this.props,o=this.handlePathToPorts(e);this.setState({angle:t,ports:o,path:e})},showContext:function(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,o=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,o=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"edge",x:t,y:o,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:null,item:this.props.export?this.props.export:this.props.edge})},getContext:function(e,o,n){return t.Menu({menu:e,options:o,triggerHideContext:n,label:this.props.label,iconColor:this.props.route})},handleResetEdge:function(e){const{x:t,y:o}=this.moveStart;if(Math.abs(e.x-t)>10||Math.abs(e.y-o)>10){const t=_.get(this.props,"app.state.scale"),{angle:o}=this.state,n=_.cloneDeep(this.moveStart.ports),r=n.length-2;let i=n[2].y==n[3].y?"y":"x",a=n[2][i]+(e[i]-this.moveStart[i])/t;if(n[0].x===n[1].x&&Math.abs(n[r].y-n[0].y)>=Math.abs(n[r].y-n[1].y)||n[0].y===n[1].y&&Math.abs(n[r].x-n[0].x)>=Math.abs(n[r].x-n[1].x))if(180===Math.abs(o.target-o.source)){const e=Math.min(n[1][i],n[r][i]),t=Math.max(n[1][i],n[r][i]);a<e&&(a=e),a>t&&(a=t)}else a<n[1][i]&&(a=n[1][i]);else 90===Math.abs(o.target-o.source)&&a>n[r][i]&&(a=n[r][i]);n[2][i]=a,n[3][i]=a;const s=this.getPath(n);this.setState({path:s,ports:n})}},edgeStart:function(e){e.stopPropagation(),e.stopImmediatePropagation();const o=e.target.getAttribute("class"),n=o.indexOf("edge-port-start")>-1,r=o.indexOf("edge-port-end")>-1;if(n||r){const{graph:o,edge:r,edgeID:i}=this.props,a=n?r.to:r.from,s=o.getNode(a.node),c=s.metadata.def.ports.find(function(e){return e.display&&e.uuid==a.port}),{from:p,to:l,metadata:d}=r;d.turned=null;const u=n?-t.config.edge.port.r:t.config.edge.port.r,f=new CustomEvent("the-graph-edge-start",{detail:{node:s,port:{process:s.id,port:c.uuid,type:c.type,subType:c.subType,autoReceive:c.autoReceive},isIn:n,offsetX:e.offsetX+u,offsetY:e.offsetY,metadata:d,nodeType:s.metadata.def.type,updating:{from:p,to:l,edgeID:i},highlightVerified:!1},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(f)}return!1},getEndPoints:function(e){const{ports:o}=this.state,n=o.length-1,r=o[n].x,i=o[n].y;switch(e){case 0:return`${r},${i-t.config.edge.port.r} ${r},${i+t.config.edge.port.r} ${r-2*t.config.edge.port.r},${i}`;case 90:return`${r-t.config.edge.port.r},${i} ${r+t.config.edge.port.r},${i} ${r},${i+2*t.config.edge.port.r}`;case 180:return`${r},${i-t.config.edge.port.r} ${r},${i+t.config.edge.port.r} ${r+2*t.config.edge.port.r},${i}`;case 270:return`${r-t.config.edge.port.r},${i} ${r+t.config.edge.port.r},${i} ${r},${i-2*t.config.edge.port.r}`}},getScriptIconTransform:function(e,t,o,n){switch(e){case 0:return`translate(${t+n}, ${o-n})`;case 90:return`translate(${t-n}, ${o-3*n})`;case 180:return`translate(${t-3*n}, ${o-n})`;case 270:return`translate(${t-n}, ${o+n})`}},getErrorPosition:function(){const{ports:e}=this.state;let t;if(e.length%2==0){return{x:e[t=e.length/2-1].x+(e[t+1].x-e[t].x)/2,y:e[t].y+(e[t+1].y-e[t].y)/2}}return e[t=Math.floor(e.length/2)]},render:function(){let{edgeID:e,label:o,route:n,stroke:r,color:i,error:a,size:s,isPreview:c,updating:p,angle:l,selected:d,animated:u,hidden:f,isAuto:h,showScriptEditIcon:m,inScript:g,outScript:v}=this.props;const{ports:y,path:b}=this.state,w=y.length-1,x=y[0].x,S=y[0].y,C=y[w].x,I=y[w].y;let _,E={id:e,className:"edge"+(d?" selected":"")+(u?" animated":"")+(f?" hidden":""),title:o};if(E=t.merge(t.config.edge.container,E),b){let e=t.merge(t.config.edge.touchPath,{strokeWidth:s+4,d:b}),o=t.factories.edge.createEdgeTouchPath(e);if(h){let e=t.config.edge.autoPath.className+n,i=t.merge(t.config.edge.foregroundPath,{d:b,className:e,stroke:r||t.config.edge.defaultStroke});_=[t.factories.edge.createEdgeForegroundPath(i),o]}else{let e=t.merge(t.config.edge.backgroundPath,{strokeWidth:s+2,d:b}),r=t.factories.edge.createEdgeBackgroundPath(e),d=t.config.edge.foregroundPath.className+n,u=t.merge(t.config.edge.foregroundPath,{strokeWidth:s,d:b,className:d,stroke:i||t.config.edge.defaultColor});if(_=[r,t.factories.edge.createEdgeForegroundPath(u),t.factories.createCircle.call(this,t.merge(t.config.edge.flowPath,{d:b})),o],!c||p){const e=t.merge(t.config.edge.portStart,{cx:x,cy:S,fill:i||t.config.edge.defaultColor}),o=t.factories.edge.createCircle.call(this,e),n=t.merge(t.config.edge.portEnd,{points:this.getEndPoints(l.target),fill:i||t.config.edge.defaultColor}),r=[o,t.factories.edge.createArrow.call(this,n)],a=t.factories.edge.createEdgeGroup.call(this,{className:"edge-ports"},r);_.push(a)}if(!c){const e=t.config.edge.codeIcon.r,o=t.factories.createCircle.call(this,{className:"icon-bg",cx:e,cy:e,r:e,fill:"#fff"});if(a){const n=this.getErrorPosition(),r=t.factories.edge.createIconSvg.call(this,t.config.edge.alertIcon),i=t.factories.node.createNodeGroup.call(this,{className:"edge-icon edge-icon-alert",transform:`translate(${n.x-e}, ${n.y-e})`},[o,r]);_.push(i)}if(m){const n=t.factories.edge.createIconSvg.call(this,t.config.edge.codeIcon),r={className:`scripts edge-icon${v?" block":""}`,transform:this.getScriptIconTransform(l.source,x,S,e),"data-direction":"out"},i={className:`scripts edge-icon${g?" block":""}`,transform:this.getScriptIconTransform(l.target,C,I,e),"data-direction":"in"},a=[o,n],s=t.factories.node.createNodeGroup.call(this,r,a),c=t.factories.node.createNodeGroup.call(this,i,a);_.push(s,c)}}}}return t.factories.edge.createEdgeGroup(E,_)}}))}},{"./constants":22}],31:[function(e,t,o){let n=e("./constants").nodeStyles;t.exports.register=function(e){let t=e.TheGraph;t.config.graph={container:{},groupsGroup:{className:"groups"},edgesGroup:{className:"edges"},iipsGroup:{className:"iips"},nodesGroup:{className:"nodes"},inportsGroup:{className:"ex-inports"},outportsGroup:{className:"ex-outports"},node:{},iip:{},inportEdge:{},inportNode:{},outportEdge:{},outportNode:{},nodeGroup:{},edgePreview:{key:"edge-preview",label:""}},t.factories.graph={createGraphContainerGroup:t.factories.createGroup,createGraphGroupsGroup:t.factories.createGroup,createGraphEdgesGroup:t.factories.createGroup,createGraphIIPGroup:t.factories.createGroup,createGraphNodesGroup:t.factories.createGroup,createGraphInportsGroup:t.factories.createGroup,createGraphOutportsGroup:t.factories.createGroup,createGraphNode:function(e){return t.Node(e)},createGraphEdge:function(e){return t.Edge(e)},createGraphIIP:function(e){return t.IIP(e)},createGraphGroup:function(e){return t.Group(e)},createGraphEdgePreview:function(e){return t.Edge(e)}},t.Graph=React.createFactory(React.createClass({displayName:"TheGraphGraph",mixins:[],getDefaultProps:function(){return{library:{},graph:null,app:null,showScriptEditIcon:!1,offsetX:0,offsetY:0,nodeIcons:{}}},getInitialState:function(){return{displaySelectionGroup:!0,edgePreview:null,edgePreviewX:0,edgePreviewY:0,forceSelection:!1,selectedNodes:[],errorNodes:[],selectedEdges:[],animatedEdges:[],offsetX:this.props.offsetX,offsetY:this.props.offsetY}},componentDidMount:function(){this._ismounted=!0,this.subscribeGraph(null,this.props.graph),this.editor=document.getElementById("editor"),ReactDOM.findDOMNode(this).addEventListener("the-graph-node-remove",this.removeNode)},componentWillUnmount:function(){this._ismounted=!1},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.moved||(this.subscribeGraph(this.props.graph,e.graph),this.markDirty({id:_.get(window,"__graph__.currentNodeId",[]),allNodeDirty:_.get(window,"__graph__.allNodeDirty",!1)}),_.set(window,"__graph__.currentNodeId",[]),_.set(window,"__graph__.allNodeDirty",!1))},subscribeGraph:function(e,t){e&&(e.removeListener("addEdge",this.resetPortRoute),e.removeListener("changeEdge",this.resetPortRoute),e.removeListener("removeEdge",this.resetPortRoute),e.removeListener("removeInitial",this.resetPortRoute),e.removeListener("changeNode",this.onChangeNode),e.removeListener("changeInport",this.onChangeInport),e.removeListener("changeOutport",this.onChangeOutport),e.removeListener("endTransaction",this.onEndTransaction)),t&&(t.on("addEdge",this.resetPortRoute),t.on("changeEdge",this.resetPortRoute),t.on("removeEdge",this.resetPortRoute),t.on("removeInitial",this.resetPortRoute),t.on("changeNode",this.onChangeNode),t.on("changeInport",this.onChangeInport),t.on("changeOutport",this.onChangeOutport),t.on("endTransaction",this.onEndTransaction))},onChangeNode:function(e,t){"movenode"!==_.get(this.props.graph,"transaction.id")&&delete this.portInfo[e.id];const o=[e.id].concat(this.getRelatedNodeIds(e.id));this.markDirty({id:[...o]},t)},onChangeInport:function(e,t,o,n){this.markDirty()},onChangeOutport:function(e,t,o,n){this.markDirty()},currentNodeId:[],onEndTransaction:function(e){delete this.currentNodeId,this.markDirty({allNodeDirty:!0})},edgePreview:null,edgeStart:function(e){const{port:t,highlightVerified:o}=e.detail;if(this.state.edgePreview){if(!o)return;this.currentNodeId.push(e.detail.node.id);let n=this.state.edgePreview;if(n.from&&n.from.process===t.process||n.to&&n.to.process===t.process)return;if(n.isIn===e.detail.isIn)return;const r=n.isIn?_.get(n,"updating.from"):_.get(n,"updating.to");return r&&r.node==t.process&&r.port==t.port?void this.cancelPreviewEdge():(e.detail.isIn?n.to=t:n.from=t,n.metadata={},this.currentNodeId.push(e.detail.node.id),this.addEdge(n),this.addNodeRalation([...this.currentNodeId]),void this.cancelPreviewEdge())}if(e.detail.isIn&&!e.detail.updating)return;let n;this.currentNodeId=[e.detail.node.id],(n=e.detail.isIn?{to:t}:{from:t}).isIn=e.detail.isIn,n.updating=e.detail.updating,n.metadata=e.detail.metadata||{route:e.detail.route},n.type=e.detail.port.type,n.subType=e.detail.port.subType,n.nodeType=e.detail.nodeType,this.renderPreviewEdge(e),this.editor.addEventListener("mousemove",this.renderPreviewEdge),this.editor.addEventListener("mouseup",this.cancelPreviewEdge),this.setState({edgePreview:n})},cancelPreviewEdge:function(e){this.editor.removeEventListener("mousemove",this.renderPreviewEdge),this.editor.removeEventListener("mouseup",this.cancelPreviewEdge),this.state.edgePreview&&(_.set(window,"__graph__.currentNodeId",[]),_.set(window,"__graph__.allNodeDirty",!0),this.setState({edgePreview:null}),this.markDirty({allNodeDirty:!0}))},renderPreviewEdge:function(e){let t=e.offsetX||e.detail.offsetX||0,o=e.offsetY||e.detail.offsetY||0,n=this.props.app.state.scale;this.setState({edgePreviewX:(t-this.props.app.state.x)/n,edgePreviewY:(o-this.props.app.state.y)/n}),this.markDirty({allNodeDirty:!0})},__nodeRelated__:{},addNodeRalation:function(e=[]){_.isEmpty(e)||(this.__nodeRelated__[e[0]]=this.__nodeRelated__[e[0]]||[],this.__nodeRelated__[e[0]].push(e[1]),this.__nodeRelated__[e[1]]=this.__nodeRelated__[e[1]]||[],this.__nodeRelated__[e[1]].push(e[0]))},getRelatedNodeIds:function(e){return _.get(this.__nodeRelated__,`${e}`,[])},addEdge:function(e){if(this.props.graph.addEdge(e.from.process,e.from.port,e.to.process,e.to.port,e.metadata),e.updating){const{from:t,to:o}=e.updating;this.props.graph.removeEdge(t.node,t.port,o.node,o.port)}},setEdgeMetadata:function(e,t,o){this.props.graph.setEdgeMetadata(e.node,e.port,t.node,t.port,o)},moveGroup:function(e,o,n){let r=this.props.graph,i=e.length;for(let a=0;a<i;a++){let i=r.getNode(e[a]);if(i)if(void 0!==o)r.setNodeMetadata(i.id,{x:i.metadata.x+o,y:i.metadata.y+n});else{let e=parseFloat(t.config.nodeHeight)/20;r.setNodeMetadata(i.id,{x:Math.round(i.metadata.x/e)*e,y:Math.round(i.metadata.y/e)*e})}}this.markDirty({id:e})},handlePortsMaxCount:function(e,o){const n=e.def.ports;let r=Math.max(_.filter(n,function(e){return"in"==e.ioType&&0!==e.y}).length,_.filter(n,function(t){return"out"==t.ioType&&t.y!==e.height}).length);const i=t.config.maxPortCount*o,a=t.config.nodeHeight*o;if(t.config.autoSizeNode&&r>i){let o=r-i;e.height=a+o*t.config.nodeHeightIncrement}else r<=i&&e.height>a&&(e.height=a)},getComponentInfo:function(e){let o={name:e.label,icon:"cube",inports:[],outports:[]};const n=_.has(e,"size")?_.toNumber(e.size):1;e.width=t.config.nodeWidth*n,e.height=t.config.nodeHeight*n,this.handlePortsMaxCount(e,n);const r=e.width,i=e.height;e.def.ports.forEach(function(e){void 0===e.angle&&("in"===e.ioType?void 0===e.x||0===e.x?e.angle=180:0===e.y&&(e.angle=90):"out"===e.ioType&&(void 0===e.x||e.x===r?e.angle=0:e.y===i&&(e.angle=90)))});const a=_.filter(e.def.ports,e=>"in"===e.ioType&&e.display),s=_.filter(e.def.ports,e=>"out"===e.ioType&&e.display),c=_.sortBy(_.remove(a,{angle:90}),e=>e.x),p=_.sortBy(_.remove(a,{angle:180}),e=>e.y).concat(a),l=_.sortBy(_.remove(s,{angle:270}),e=>e.x),d=_.sortBy(_.remove(s,{angle:0}),e=>e.y).concat(s);if(!_.isEmpty(c)){const e=c.length;c.forEach((t,n)=>{const i=r/(e+1)*(n+1);o.inports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:i,y:0,angle:t.angle})})}if(!_.isEmpty(p)){const e=p.length;p.forEach((t,n)=>{const r=i/(e+1)*(n+1);o.inports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:0,y:r,angle:t.angle})})}if(!_.isEmpty(l)){const e=l.length;l.forEach((t,n)=>{const a=r/(e+1)*(n+1),s=i;o.outports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:a,y:s,angle:t.angle})})}if(!_.isEmpty(d)){const e=d.length;d.forEach((t,n)=>{const a=r,s=i/(e+1)*(n+1);o.outports.push({name:t.uuid,description:t.description?t.description.zh_CN:t.uuid,type:t.type,subType:t.subType,autoReceive:t.autoReceive,x:a,y:s,angle:t.angle})})}return o},portInfo:{},getPorts:function(e,t,o){let n=e.getNode(t),r=this.portInfo[t];if(!r){let e={},i={};if(o&&this.props.library){let t,o,r,a=this.getComponentInfo(n.metadata);if(!a)return{inports:e,outports:i};for(t=0,r=a.outports.length;t<r;t++)(o=a.outports[t]).name&&(i[o.name]={label:o.name,description:o.description,type:o.type,subType:o.subType,x:o.x,y:o.y,angle:o.angle});for(t=0,r=a.inports.length;t<r;t++)(o=a.inports[t]).name&&(e[o.name]={label:o.name,description:o.description,type:o.type,subType:o.subType,autoReceive:o.autoReceive,x:o.x,y:o.y,angle:o.angle})}r={inports:e,outports:i},this.portInfo[t]=r}return r},getNodeOutport:function(e,o,n,r,i){let a=this.getPorts(e,o,i);a.outports[n]||(a.outports[n]={label:n,x:t.config.nodeWidth/2,y:t.config.nodeHeight},this.dirty=!0);let s=a.outports[n];return void 0!==r&&(s.route=r),s},getNodeInport:function(e,o,n,r,i){let a=this.getPorts(e,o,i);a.inports[n]||(a.inports[n]={label:n,x:t.config.nodeWidth/2,y:0},this.dirty=!0);let s=a.inports[n];return void 0!==r&&(s.route=r),s},resetPortRoute:function(e){const t=[];if(e.from&&e.from.node){let o=this.portInfo[e.from.node];if(o){o.dirty=!0;let n=o.outports[e.from.port];n&&(n.route=null),t.push(e.from.node)}}if(e.to&&e.to.node){let o=this.portInfo[e.to.node];if(o){o.dirty=!0;let n=o.inports[e.to.port];n&&(n.route=null),t.push(e.to.node)}}this.currentNodeId=t,this.markDirty({id:t})},graphOutports:{},getGraphOutport:function(e){let o=this.graphOutports[e];return o||((o={inports:{},outports:{}}).inports[e]={label:e,type:"all",route:5,x:0,y:t.config.nodeHeight/2},this.graphOutports[e]=o),o},graphInports:{},getGraphInport:function(e){let o=this.graphInports[e];return o||((o={inports:{},outports:{}}).outports[e]={label:e,type:"all",route:2,x:t.config.nodeWidth,y:t.config.nodeHeight/2},this.graphInports[e]=o),o},getScripts:function(e,t,o,n){let r=e.properties.scripts;if(r){const e=[t,o,n];for(;null!=r&&e.length>0;)r=r[e.shift()];return r}return""},setSelectedNodes:function(e){this.setState({selectedNodes:e}),this.markDirty()},setErrorNodes:function(e){this.setState({errorNodes:e}),this.markDirty()},setSelectedEdges:function(e){this.setState({selectedEdges:e}),this.markDirty()},setAnimatedEdges:function(e){this.setState({animatedEdges:e}),this.markDirty()},updateIcon:function(e,t){console.error("DEPRECATED: updateIcon() will be removed in next version of the-graph. Pass nodeIcons through props instead"),this.props.nodeIcons[e]=t,this.markDirty()},dirty:!1,libraryDirty:!1,__currentNodeIds:[],__allNodeDirty:!0,markDirty:function(e){let t=_.get(e,"id",[]);this.__currentNodeIds=Array.isArray(t)?t:[t],this.__allNodeDirty=_.get(e,"allNodeDirty",!1),e&&e.libraryDirty&&(this.libraryDirty=!0),window.requestAnimationFrame(this.triggerRender)},triggerRender:function(e){this._ismounted&&(this.dirty||(this.dirty=!0,this.forceUpdate()))},shouldComponentUpdate:function(){return this.dirty},render:function(){this.dirty=!1;let e=this,o=this.props.graph,r=[],i=this.state.edgePreview;this.libraryDirty&&(this.libraryDirty=!1,this.portInfo={});let a=null;i&&i.type&&(a={type:i.type,subType:i.subType,isIn:!i.isIn,from:i.from,to:i.to,fromNodeType:i.nodeType,updating:i.updating});let s=o.nodes.map(function(i){if(!i.metadata)throw new Error("Component "+i.component+" is not in library");let s=i.id;i.metadata||(i.metadata={}),void 0===i.metadata.x&&(i.metadata.x=0),void 0===i.metadata.y&&(i.metadata.y=0),i.metadata.width&&i.metadata.height||(i.metadata.width=t.config.nodeWidth,i.metadata.height=t.config.nodeHeight);const c=_.has(i.metadata,"size")?_.toNumber(i.metadata.size):1,p=e.getPorts(o,s,i.component);let l=i.metadata.icon||"cube",d="icon";!_.isEmpty(l)&&l.indexOf("studio")>-1&&(d="image");let u=!0===e.state.selectedNodes[s];u&&r.push(s);let f=i.metadata.nodeStyle?n[i.metadata.nodeStyle].bg:"rgba(255,255,255,1)",h={key:s,nodeID:s,x:i.metadata.x,y:i.metadata.y,dirty:e.__currentNodeIds.indexOf(s)>-1||e.__allNodeDirty,label:i.metadata.label,sublabel:i.metadata.sublabel||i.component,width:i.metadata.width,height:i.metadata.height,size:c,app:e.props.app,scale:e.props.scale,graphView:e,graph:o,node:i,icon:l,iconType:d,color:i.metadata.color||f,screenshot_index:i.metadata.screenshot_index,ports:p,onNodeSelection:e.props.onNodeSelection,onNodeRectImgDblclick:e.props.onNodeRectImgDblclick,selected:u,error:!0===e.state.errorNodes[s],showContext:e.props.showContext,highlightPort:a,allowEdgeStart:e.props.allowEdgeStart,onExpandIconClicked:e.props.onExpandIconClicked};return h=t.merge(t.config.graph.node,h),t.factories.graph.createGraphNode.call(this,h)}),c=o.edges.map(function(n){let r=o.getNode(n.from.node),a=o.getNode(n.to.node);if(!r||!a)return;let s=e.getNodeOutport(o,n.from.node,n.from.port,0,r.component),c=e.getNodeInport(o,n.to.node,n.to.port,0,a.component);s.type!=c.type?n.metadata.error={type:"type",from:s.type,to:c.type}:s.subType!=c.subType&&"all"!=s.subType&&"all"!=c.subType?n.metadata.error={type:"subType",from:s.subType,to:c.subType}:delete n.metadata.error;let p=r.metadata.label+"() "+n.from.port.toUpperCase()+(n.from.hasOwnProperty("index")?"["+n.from.index+"]":"")+" -> "+n.to.port.toUpperCase()+(n.to.hasOwnProperty("index")?"["+n.to.index+"]":"")+" "+a.metadata.label+"()",l="edge-"+n.from.node+"-"+n.from.port+(n.from.hasOwnProperty("index")?"["+n.from.index+"]":"")+"-"+n.to.port+(n.to.hasOwnProperty("index")?"["+n.to.index+"]":"")+"-"+n.to.node,d={key:l,edgeID:l,graph:o,edge:n,app:e.props.app,sX:r.metadata.x+s.x,sY:r.metadata.y+s.y,tX:a.metadata.x+c.x,tY:a.metadata.y+c.y,path:_.get(n,"metadata.path"),custom:_.get(n,"metadata.custom"),angle:{source:s.angle,target:c.angle},label:p,route:0,error:n.metadata.error,isAuto:n.metadata.auto,color:_.get(n,"metadata.color"),size:_.get(n,"metadata.size")||1,inScript:!_.isEmpty(e.getScripts(o,n.to.node,n.to.port,"beforeEnter")),outScript:!_.isEmpty(e.getScripts(o,n.from.node,n.from.port,"afterLeave")),hidden:i&&i.updating&&l==i.updating.edgeID,onEdgeSelection:e.props.onEdgeSelection,onClickEdgeCode:e.props.onClickEdgeCode,selected:-1!==e.state.selectedEdges.indexOf(n),animated:-1!==e.state.animatedEdges.indexOf(n),showContext:e.props.showContext,showScriptEditIcon:e.props.showScriptEditIcon,onUpdatePath:e.setEdgeMetadata};return d=t.merge(t.config.graph.edge,d),t.factories.graph.createGraphEdge.call(this,d)}),p=o.initializers.map(function(n){let r=o.getNode(n.to.node);if(!r)return;let i=e.getNodeInport(o,n.to.node,n.to.port,0,r.component),a=r.metadata.x,s=r.metadata.y+i.y,c=n.from.data,p=typeof c,l={graph:o,label:!0===c||!1===c||"number"===p||"string"===p?c:p,x:a,y:s};return l=t.merge(t.config.graph.iip,l),t.factories.graph.createGraphIIP.call(this,l)}),l=Object.keys(o.inports).map(function(n){let r=o.inports[n],i=n,a=r.process,s=r.port;r.metadata||(r.metadata={x:0,y:0});let p=r.metadata;p.x||(p.x=0),p.y||(p.y=0),p.width||(p.width=t.config.nodeWidth),p.height||(p.height=t.config.nodeHeight);let l=e.portInfo[a];if(!l)return void console.warn("Node "+a+" not found for graph inport "+i);let d=l.inports[s];if(!d)return void console.warn("Port "+a+"."+s+" not found for graph inport "+i);let u=o.getNode(a);if(!u)return void console.warn("Node "+a+" not found for graph inport "+i);let f={key:"inport.node."+n,export:r,exportKey:n,x:p.x,y:p.y,width:p.width,height:p.height,label:i,app:e.props.app,graphView:e,graph:o,node:{},ports:e.getGraphInport(n),isIn:!0,icon:p.icon?p.icon:"sign-in",showContext:e.props.showContext};f=t.merge(t.config.graph.inportNode,f);let h={key:"inport.edge."+n,export:r,exportKey:n,graph:o,app:e.props.app,edge:{},route:0,isIn:!0,label:"export in "+i.toUpperCase()+" -> "+s.toUpperCase()+" "+u.metadata.label,sX:f.x+t.config.nodeWidth,sY:f.y+t.config.nodeHeight/2,tX:u.metadata.x+d.x,tY:u.metadata.y+d.y,showContext:e.props.showContext,allowEdgeStart:e.props.allowEdgeStart};return h=t.merge(t.config.graph.inportEdge,h),c.unshift(t.factories.graph.createGraphEdge.call(this,h)),t.factories.graph.createGraphNode.call(this,f)}),d=Object.keys(o.outports).map(function(n){let r=o.outports[n],i=n,a=r.process,s=r.port;r.metadata||(r.metadata={x:0,y:0});let p=r.metadata;p.x||(p.x=0),p.y||(p.y=0),p.width||(p.width=t.config.nodeWidth),p.height||(p.height=t.config.nodeHeight);let l=e.portInfo[a];if(!l)return void console.warn("Node "+a+" not found for graph outport "+i);let d=l.outports[s];if(!d)return void console.warn("Port "+a+"."+s+" not found for graph outport "+i);let u=o.getNode(a);if(!u)return void console.warn("Node "+a+" not found for graph outport "+i);let f={key:"outport.node."+n,export:r,exportKey:n,x:p.x,y:p.y,width:p.width,height:p.height,label:i,app:e.props.app,graphView:e,graph:o,node:{},ports:e.getGraphOutport(n),isIn:!1,icon:p.icon?p.icon:"sign-out",showContext:e.props.showContext};f=t.merge(t.config.graph.outportNode,f);let h={key:"outport.edge."+n,export:r,exportKey:n,graph:o,app:e.props.app,edge:{},route:p.route?p.route:4,isIn:!1,label:u.metadata.label+" "+s.toUpperCase()+" -> "+i.toUpperCase()+" export out",sX:u.metadata.x+d.x,sY:u.metadata.y+d.y,tX:f.x,tY:f.y+t.config.nodeHeight/2,showContext:e.props.showContext,allowEdgeStart:e.props.allowEdgeStart};return h=t.merge(t.config.graph.outportEdge,h),c.unshift(t.factories.graph.createGraphEdge.call(this,h)),t.factories.graph.createGraphNode.call(this,f)}),u=o.groups.map(function(n){if(n.nodes.length<1)return;let r=t.findMinMax(o,n.nodes);if(!r)return;let i={key:"group."+n.name,graph:o,item:n,app:e.props.app,minX:r.minX,minY:r.minY,maxX:r.maxX,maxY:r.maxY,scale:e.props.scale,label:n.metadata.name||"",nodes:n.nodes,groupId:n.name,triggerMoveGroup:e.moveGroup,showContext:e.props.showContext,onGroupSelection:e.props.onGroupSelection};return i=t.merge(t.config.graph.nodeGroup,i),t.factories.graph.createGraphGroup.call(this,i)});if(this.state.displaySelectionGroup&&r.length>=2){let n=t.findMinMax(o,r);if(n){let i={name:"selection",nodes:r,metadata:{color:1}},a={graph:o,app:e.props.app,item:i,minX:n.minX,minY:n.minY,maxX:n.maxX,maxY:n.maxY,scale:e.props.scale,color:i.metadata.color,triggerMoveGroup:e.moveGroup,showContext:e.props.showContext};a=t.merge(t.config.graph.selectionGroup,a);let s=t.factories.graph.createGraphGroup.call(this,a);u.push(s)}}if(i){let e;if(i.from){let t=o.getNode(i.from.process),n=this.getNodeOutport(o,i.from.process,i.from.port);e={sX:t.metadata.x+n.x,sY:t.metadata.y+n.y,tX:this.state.edgePreviewX,tY:this.state.edgePreviewY,angle:{source:n.angle},route:i.metadata.route,updating:i.updating,isIn:i.isIn,isPreview:!0}}else{let t=o.getNode(i.to.process),n=this.getNodeInport(o,i.to.process,i.to.port);e={sX:this.state.edgePreviewX,sY:this.state.edgePreviewY,tX:t.metadata.x+n.x,tY:t.metadata.y+n.y,angle:{target:n.angle},route:i.metadata.route,updating:i.updating,isIn:i.isIn,isPreview:!0}}e=t.merge(t.config.graph.edgePreview,e);let n=t.factories.graph.createGraphEdgePreview.call(this,e);c.push(n)}let f=t.merge(t.config.graph.groupsGroup,{children:u}),h=t.factories.graph.createGraphGroupsGroup.call(this,f),m=t.merge(t.config.graph.edgesGroup,{children:c}),g=t.factories.graph.createGraphEdgesGroup.call(this,m),v=t.merge(t.config.graph.iipsGroup,{children:p}),y=t.factories.graph.createGraphIIPGroup.call(this,v),b=t.merge(t.config.graph.nodesGroup,{children:s}),w=t.factories.graph.createGraphNodesGroup.call(this,b),x=t.merge(t.config.graph.inportsGroup,{children:l}),S=t.factories.graph.createGraphInportsGroup.call(this,x),C=t.merge(t.config.graph.outportsGroup,{children:d}),I=[h,g,y,w,S,t.factories.graph.createGraphGroupsGroup.call(this,C)],E=this.state.forceSelection||r.length>0?" selection":"",N=t.merge(t.config.graph.container,{className:"graph"+E});return t.factories.graph.createGraphContainerGroup.call(this,N,I)}}))}},{"./constants":22}],32:[function(e,t,o){t.exports.register=function(e){let t=e.TheGraph;t.config.group={container:{className:"group"},boxRect:{rx:t.config.nodeRadius,ry:t.config.nodeRadius},labelText:{className:"group-label"},descriptionText:{className:"group-description"}},t.factories.group={createGroupGroup:t.factories.createGroup,createGroupBoxRect:t.factories.createRect,createGroupLabelText:t.factories.createText,createGroupDescriptionText:t.factories.createText},t.Group=React.createFactory(React.createClass({displayName:"TheGraphGroup",getInitialState:function(){return{moving:!1,lastTrackX:null,lastTrackY:null}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.onTrackStart),this.props.onGroupSelection&&e.addEventListener("click",this.onGroupSelection)},onGroupSelection:function(e){e.stopPropagation(),this.props.onGroupSelection(this.props.groupId)},onTrackStart:function(e){e.stopPropagation(),this.setState({moving:!0}),this.setState({lastTrackX:e.pageX,lastTrackY:e.pageY});let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.graph.startTransaction("movegroup"),!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,o=e.pageY,n=t-this.state.lastTrackX,r=o-this.state.lastTrackY,i=Math.round(n/this.props.scale),a=Math.round(r/this.props.scale);this.setState({lastTrackX:t,lastTrackY:o}),this.props.triggerMoveGroup(this.props.item.nodes,i,a)},onTrackEnd:function(e){this.setState({moving:!1}),e.stopPropagation(),this.props.triggerMoveGroup(this.props.item.nodes);let t=document.getElementById("editor");t.removeEventListener("mousemove",this.onTrack),t.removeEventListener("mouseup",this.onTrackEnd),this.setState({lastTrackX:null,lastTrackY:null}),this.props.graph.endTransaction("movegroup")},render:function(){let e=this.props.minX-28,o=this.props.minY-28,n=this.props.color?this.props.color:0,r={x:e,y:o,width:this.props.maxX-e+14,height:this.props.maxY-o+14,className:"group-box color"+n};r=t.merge(t.config.group.boxRect,r);let i=t.factories.group.createGroupBoxRect.call(this,r),a={x:e+t.config.nodeRadius+3,y:o+14,children:this.props.label};a=t.merge(t.config.group.labelText,a);let s=[i,t.factories.group.createGroupLabelText.call(this,a)],c=t.merge(t.config.group.container,{id:this.props.groupId});return t.factories.group.createGroupGroup.call(this,c,s)}}))}},{}],33:[function(e,t,o){t.exports.register=function(e){let t=e.TheGraph;t.config.iip={container:{className:"iip"},path:{className:"iip-path"},text:{className:"iip-info",height:5,halign:"right"}},t.factories.iip={createIIPContainer:t.factories.createGroup,createIIPPath:t.factories.createPath,createIIPText:function(e){return t.TextBG(e)}};t.IIP=React.createFactory(React.createClass({displayName:"TheGraphIIP",shouldComponentUpdate:function(e,t){return e.x!==this.props.x||e.y!==this.props.y||e.label!==this.props.label},render:function(){let e=this.props.x,o=this.props.y,n=["M",e,o,"L",e-10,o].join(" "),r=this.props.label+"";r.length>12&&(r=r.slice(0,9)+"...");let i=t.merge(t.config.iip.path,{d:n}),a=t.factories.iip.createIIPPath.call(this,i),s=t.merge(t.config.iip.text,{x:e-10,y:o,text:r}),c=[a,t.factories.iip.createIIPText.call(this,s)],p=t.merge(t.config.iip.container,{title:this.props.label});return t.factories.iip.createIIPContainer.call(this,p,c)}}))}},{}],34:[function(e,t,o){function n(e){let t=[];return e.nodes.forEach(function(o){let n={name:o.component,icon:"cog",description:"",inports:[],outports:[]};Object.keys(e.inports).forEach(function(t){let r=e.inports[t];if(r.process===o.id){for(let e=0;e<n.inports.length;e++)if(n.inports[e].name===r.port)return;n.inports.push({name:r.port,type:"all"})}}),Object.keys(e.outports).forEach(function(t){let r=e.outports[t];if(r.process===o.id){for(let e=0;e<n.outports.length;e++)if(n.outports[e].name===r.port)return;n.outports.push({name:r.port,type:"all"})}}),e.initializers.forEach(function(e){if(e.to.node===o.id){for(let t=0;t<n.inports.length;t++)if(n.inports[t].name===e.to.port)return;n.inports.push({name:e.to.port,type:"all"})}}),e.edges.forEach(function(e){let t;if(e.from.node===o.id){for(t=0;t<n.outports.length;t++)if(n.outports[t].name===e.from.port)return;n.outports.push({name:e.from.port,type:"all"})}if(e.to.node===o.id){for(t=0;t<n.inports.length;t++)if(n.inports[t].name===e.to.port)return;n.inports.push({name:e.to.port,type:"all"})}}),t.push(n)}),t}t.exports={mergeComponentDefinition:function(e,t){if(e===t)return t;let o,n,r,i,a,s=e.inports,c=t.inports;if(s!==c)for(o=0,r=s.length;o<r;o++){let e=s[o];for(a=!1,n=0,i=c.length;n<i;n++){let t=c[n];e.name===t.name&&(a=!0)}a||c.push(e)}let p=e.outports,l=t.outports;if(p!==l)for(o=0,r=p.length;o<r;o++){let e=p[o];for(a=!1,n=0,i=l.length;n<i;n++){let t=l[n];e.name===t.name&&(a=!0)}a||l.push(e)}return"cog"!==t.icon?e.icon=t.icon:t.icon=e.icon,t.iconsvg=e.iconsvg,t},componentsFromGraph:n,libraryFromGraph:function(e){let t={};return n(e).forEach(function(e){t[e.name]=e}),t}}},{}],35:[function(e,t,o){let n=e("./constants").iconSvgD;t.exports.register=function(e){let t=e.TheGraph;const o=function(e,t){const o={light:!0,text:"#555"};if(!e)return o;let n=null,r=1;var i;if(0==e.indexOf("#")&&(n=(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null),e.indexOf("rgb")>-1){const t=e.indexOf("(")+1,o=e.indexOf(")");(n=e.slice(t,o).split(",").map(e=>Number(e.trim()))).length>3&&(r=n.pop(3))}return(n.findIndex(e=>e<160)>-1||r<.4)&&(t||(o.text="#fff"),o.light=!1),o};t.config.node={snap:t.config.nodeSize,container:{},background:{className:"node-bg"},border:{className:"node-border drag",rx:t.config.nodeRadius,ry:t.config.nodeRadius},innerRect:{className:"node-rect drag",rx:t.config.nodeRadius,ry:t.config.nodeRadius},icon:{ref:"icon",className:"icon node-icon drag the-graph-var-icon"},iconsvg:{className:"icon-svg node-icon drag"},runningIcon:{ref:"running-icon",className:"icon node-icon drag the-graph-spin"},successIcon:{ref:"success-icon",className:"icon node-icon drag the-graph-success-icon"},errorIcon:{ref:"error-icon",className:"icon node-icon drag the-graph-error-icon"},warnIcon:{ref:"warn-icon",className:"icon node-icon drag the-graph-warn-icon"},inports:{className:"inports"},outports:{className:"outports"},labelBackground:{className:"node-label-bg"},labelRect:{className:"text-bg-rect"},labelText:{className:"node-label"},sublabelBackground:{className:"node-sublabel-bg"},sublabelRect:{className:"text-bg-rect"},sublabelText:{className:"node-sublabel"}},t.factories.node={createNodeGroup:t.factories.createGroup,createNodeBackgroundRect:t.factories.createRect,createNodeBorderRect:t.factories.createRect,createNodeInnerRect:t.factories.createRect,createNodeInnerRectImg:t.factories.createRectImg,createNodeIconText:t.factories.createText,createNodeIconSVGGroup:t.factories.createGroup,createNodeIconSVG:t.factories.createPath,createNodeInportsGroup:t.factories.createGroup,createNodeOutportsGroup:t.factories.createGroup,createNodeLabelGroup:t.factories.createGroup,createNodeLabelRect:t.factories.createRect,createNodeLabelText:t.factories.createText,createNodeSublabelGroup:t.factories.createGroup,createNodeSublabelRect:t.factories.createRect,createNodeSublabelText:t.factories.createText,createNodePort:function(e){return t.Port(e)}},t.Node=React.createFactory(React.createClass({displayName:"TheGraphNode",gutter:{.5:6,1:8,2:12},labelHeight:{.5:6,1:30,2:45},fontSize:{.5:12,1:12,2:14},getInitialState:function(){const{color:e,size:t}=this.props,n=o(e,t<1);return{labelSize:this.fontSize[t],lastTrackX:null,lastTrackY:null,lastNodeData:{},nodeColor:n}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this),t=e.querySelector(".node-rect");e.addEventListener("mousedown",this.onTrackStart),this.props.onNodeSelection&&e.addEventListener("click",this.onNodeSelection),t&&this.props.onNodeRectImgDblclick&&t.addEventListener("dblclick",this.onNodeRectImgDblclick),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext)),"image"==this.props.iconType&&this.getIconImageUrl(this.props.icon),this.props.preview&&this.updatePreview(this.props.preview),this.isCheckingUrl=!1,this.screenShotKeyToCheck=[]},componentWillReceiveProps(e){if(e.screenshot_index!==this.state.lastNodeData.screenshot_index)if(this.state.lastNodeData.screenshot_index=e.screenshot_index,e.screenshot_index){let t="studio/"+window.appConfig.userId+"/logs/"+window.appConfig.appId+"/screenshots_thumbnail/"+this.props.nodeID+"/"+e.screenshot_index+".png";this.updateScreenShotUrl(t)}else this.screenshotSignedUrl=null;if("image"==e.iconType&&e.icon!=this.props.icon&&(this.iconUrl=null,this.getIconImageUrl(e.icon)),e.preview!==this.props.preview&&this.updatePreview(e.preview),e.scale!==this.props.scale||e.size!==this.props.size){let t=this.state.labelSize;t=e.scale>=1.5?this.fontSize[e.size]-2:this.fontSize[e.size],this.setState({labelSize:t})}if(e.color!==this.props.color){const t=o(e.color,this.props.size<1);this.setState({nodeColor:t})}},updatePreview:function(e){e?e.lastIndexOf("/")==e.length-1?window.appService.getContents(e).then(e=>{const t=_.find(e.catalog,e=>"png"==e.type||"jpg"==e.type||"jpeg"==e.type);t&&window.appDataStore.head(t.id).then(()=>{window.appDataStore.url(t.id).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})}):(e.indexOf(",")>0&&(e=e.split(",")[0]),window.appDataStore.head(e).then(t=>{0==t.ContentType.indexOf("image")&&window.appDataStore.url(e).then(e=>{e.success&&this.setState({preview:e.data})})}).catch(()=>{})):this.setState({preview:null})},updateScreenShotUrl:function(e){this.isCheckingUrl?this.screenShotKeyToCheck.push(e):window.appDataStore.head(e).then(()=>{window.appDataStore.url(e).then(e=>{_.isEmpty(this.screenShotKeyToCheck)?(this.isCheckingUrl=!1,e.success&&(this.screenshotSignedUrl=e.data,this.forceUpdate())):this.updateScreenShotUrl(this.screenShotKeyToCheck[this.screenShotKeyToCheck.length-1])})}).catch(()=>{})},getIconImageUrl:function(e){window.appDataStore.url(e).then(e=>{e.success&&(this.iconUrl=e.data,this.forceUpdate())})},doCancel:function(e){e.stopPropagation(),e.stopImmediatePropagation()},onNodeSelection:function(e){e.stopPropagation(),e.stopImmediatePropagation();let o=t.metaKeyPressed||"touch"===e.pointerType;this.props.onNodeSelection(e,this.props.nodeID,this.props.node,o)},onNodeRectImgDblclick:function(e){e.stopPropagation(),e.stopImmediatePropagation(),this.screenshotSignedUrl&&this.props.onNodeRectImgDblclick(e,this.props.nodeID,this.screenshotSignedUrl)},onTrackStart:function(e){e.stopPropagation();let t=document.getElementById("editor");return t.addEventListener("mousemove",this.onTrack),t.addEventListener("mouseup",this.onTrackEnd),this.props.export?this.props.graph.startTransaction("moveexport"):this.props.graph.startTransaction("movenode"),this.lastTrackX=e.pageX,this.lastTrackY=e.pageY,!1},onTrack:function(e){e.stopPropagation();let t=e.pageX,o=e.pageY,n=t-this.lastTrackX,r=o-this.lastTrackY;this.lastTrackX=t,this.lastTrackY=o;let i=this.props.app.state.scale,a=Math.round(n/i),s=Math.round(r/i);if(this.props.export){let e={x:this.props.export.metadata.x+a,y:this.props.export.metadata.y+s};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:this.props.node.metadata.x+a,y:this.props.node.metadata.y+s})},onTrackEnd:function(e){let o=document.getElementById("editor");o.removeEventListener("mousemove",this.onTrack),o.removeEventListener("mouseup",this.onTrackEnd);const{movementX:n,movementY:r}=e;if(0!==n&&0!==r){let e=!0,o=parseFloat(t.config.nodeHeight)/20;if(e){if(this.props.export){let e={x:Math.round(this.props.export.metadata.x/o)*o,y:Math.round(this.props.export.metadata.y/o)*o};this.props.isIn?this.props.graph.setInportMetadata(this.props.exportKey,e):this.props.graph.setOutportMetadata(this.props.exportKey,e)}else this.props.graph.setNodeMetadata(this.props.nodeID,{x:Math.round(this.props.node.metadata.x/o)*o,y:Math.round(this.props.node.metadata.y/o)*o})}}this.props.export?this.props.graph.endTransaction("moveexport"):this.props.graph.endTransaction("movenode")},showContext:function(e){e.preventDefault(),e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,o=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,o=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.export?this.props.isIn?"graphInport":"graphOutport":"node",x:t,y:o,graph:this.props.graph,itemKey:this.props.export?this.props.exportKey:this.props.nodeID,item:this.props.export?this.props.export:this.props.node})},getContext:function(e,o,n){if(this.props.export)return t.Menu({menu:e,options:o,triggerHideContext:n,label:this.props.exportKey});let r=o.x,i=o.y,a=this.props.app.state.scale,s=this.props.app.state.x,c=this.props.app.state.y,p=(this.props.x+this.props.width/2)*a+s-r,l=(this.props.y+this.props.height/2)*a+c-i,d=this.props.ports,u=this.props.nodeID,f=this.props.highlightPort;return this.props.graphView.state.edgePreview?this.props.graphView.state.edgePreview.isIn?t.NodeMenuPorts({ports:d.outports,triggerHideContext:n,isIn:!1,scale:a,processKey:u,deltaX:p,deltaY:l,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:f}):t.NodeMenuPorts({ports:d.inports,triggerHideContext:n,isIn:!0,scale:a,processKey:u,deltaX:p,deltaY:l,translateX:r,translateY:i,nodeWidth:this.props.width,nodeHeight:this.props.height,highlightPort:f}):t.NodeMenu({menu:e,options:o,triggerHideContext:n,label:this.props.label,graph:this.props.graph,graphView:this.props.graphView,node:this,icon:this.props.icon,ports:d,process:this.props.node,processKey:u,x:r,y:i,nodeWidth:this.props.width,nodeHeight:this.props.height,deltaX:p,deltaY:l,highlightPort:f})},shouldComponentUpdate:function(e,t){return e.dirty&&(e.x!==this.props.x||e.y!==this.props.y||e.icon!==this.props.icon||e.label!==this.props.label||e.sublabel!==this.props.sublabel||e.ports!==this.props.ports||e.selected!==this.props.selected||e.error!==this.props.error||e.highlightPort!==this.props.highlightPort||t.preview!==this.state.preview||!0===e.ports.dirty)||t.nodeColor.text!==this.state.nodeColor.text||t.nodeColor.light!==this.state.nodeColor.light||t.labelSize!==this.state.labelSize},renderIcon:function(){const{lastNodeData:e={},preview:o}=this.state,{width:r,height:i,scale:a,size:s}=this.props;if("image"==this.props.iconType||o&&a>=2)e.iconContent=null,e.iconOptions=null;else if("icon"==this.props.iconType){let o=t.merge({},{d:n[this.props.icon],fill:"#7285a8"});const a=this.gutter[`${s}`],c=30;let p=(r-c*s)/2,l=a+(i-a-this.labelHeight[`${s}`]-c*s)/2,d=t.merge(t.config.node.iconsvg,{transform:"translate("+p+","+l+") scale("+s+")"});if(!e.iconContent||!_.isEqual(e.iconSVGOptions,o)||!_.isEqual(e.iconSvgGroupOptions,d)){let n=t.factories.node.createNodeIconSVG.call(this,o);e.iconContent=t.factories.node.createNodeIconSVGGroup.call(this,d,[n]),e.iconSVGOptions=o,e.iconSvgGroupOptions=d}}else if(!e.iconContent||!_.isEqual(e.iconOptions,iconOptions)){let o=t.FONT_ICON[this.props.icon];o||(o=t.FONT_ICON.cube);let n=t.merge(t.config.node.icon,{x:this.props.height/2,y:this.props.height/2,children:o});e.iconContent=t.factories.node.createNodeIconText.call(this,n),e.iconOptions=n}const c=r-this.gutter[`${s}`]-10,p=i-this.labelHeight[`${s}`]-10;if(e.statusIconX!==c||e.statusIconY!==p){const o=t.merge(t.config.node.runningIcon,{children:t.FONT_ICON.cog}),n=t.factories.node.createNodeIconText.call(this,o),r=t.merge(t.config.node.successIcon,{children:t.FONT_ICON.checked}),i=t.factories.node.createNodeIconText.call(this,r),a=t.merge(t.config.node.errorIcon,{children:t.FONT_ICON["close-circle"]}),s=t.factories.node.createNodeIconText.call(this,a),l=t.merge(t.config.node.warnIcon,{children:t.FONT_ICON["warning-circle"]}),d=t.factories.node.createNodeIconText.call(this,l);e.statusIconX=c,e.statusIconY=p,e.statusIconGroup=t.factories.createGroup.call(this,{className:"icon-status",transform:`translate(${c}, ${p})`,children:[n,i,s,d]})}return e},renderLabel:function(){const{lastNodeData:e={},labelSize:o,nodeColor:n}=this.state;let{labelGroup:r}=e;const{label:i,width:a,height:s,size:c}=this.props,p=s-this.labelHeight[`${c}`],l=c>=1?n.text:"#555";if(e.label!==i||e.labelSize!==o||e.labelY!==p||e.labelColor!==l){const n=Math.floor((a-10)/o*2),d=c<2?o:Math.floor(1.4*o),u=c<1?s+this.gutter[`${c}`]/2+o:p+this.labelHeight[`${c}`]/2+o/3;let f=i;c>=1&&function(e){let t=0;for(let o=0;o<e.length;o++){let n=e.charCodeAt(o);n>=1&&n<=126||65376<=n&&n<=65439?t++:t+=2}return t}(i)>n&&(f=function(e,t){let o=0,n=[],r="";const i=t-3;for(let a=0;a<e.length&&!(n.length>1);a++){let s=e.charCodeAt(a);s>=1&&s<=126||65376<=s&&s<=65439?o++:o+=2,r+=e[a],1==n.length&&o>=i&&a<e.length-1?(n.push(r+"..."),r="",o=0):Math.floor(o/t)>=1&&(n.push(r),r="",o=0)}return""!=r&&n.push(r),n}(i,n-1).map(function(e,t){return React.createElement("tspan",{x:a/2,y:t?u+d/2:u-d/2},e)}));let h=t.merge(t.config.node.labelText,{x:a/2,y:u,children:f,fill:l,style:{"font-size":o+"px"}}),m=t.factories.node.createNodeLabelText.call(this,h);r=t.factories.node.createNodeLabelGroup.call(this,t.config.node.labelBackground,[m]),e.label=i,e.labelSize=o,e.labelY=p,e.labelColor=l,e.labelGroup=r}return{label:e.label,labelRect:e.labelRect,labelGroup:e.labelGroup,sublabelRect:e.sublabelRect,sublabelGroup:e.sublabelGroup}},renderRects:function(){const{lastNodeData:e={},preview:o}=this.state,{width:n,height:r,color:i,icon:a,scale:s,size:c}=this.props,p=this.gutter[`${c}`],l=n-2*p,d=r-p-this.labelHeight[`${c}`];if(!e.borderRect||e.width!==n||e.height!==r||e.color!==i){let o=t.merge(t.config.node.border,{width:n,height:r,fill:i||"#fff"});e.color=i,e.width=n,e.height=r,e.borderRect=t.factories.node.createNodeBorderRect.call(this,o)}if(e.innerWidth!==l||e.innerHeight!==d||e.icon!==a){let n="";this.screenshotSignedUrl?n=this.screenshotSignedUrl:o&&s>=2?n=o:"image"==this.props.iconType&&(n=this.iconUrl);let r=t.merge(t.config.node.innerRect,{x:p,y:p,width:l,height:d}),i={x:p,y:p,width:l,height:d,id:"raduisImage_"+this.props.nodeID,href:n};const c=t.merge(t.config.node.innerRect,{className:"node-rect-img",x:p,y:p,width:l,height:d,stroke:"none",fill:"url(#raduisImage_"+this.props.nodeID+")"});"icon"==this.props.iconType?(e.icon=a,e.innerImg=null,e.innerImgRect=null):(e.icon=o&&s>=2?"preview":a,e.innerImg=t.factories.node.createNodeInnerRectImg.call(this,i),e.innerImgRect=t.factories.node.createNodeInnerRect.call(this,c)),e.innerRect=t.factories.node.createNodeInnerRect.call(this,r)}return e},renderPorts:function(){const{lastNodeData:e={}}=this.state;let o,n,{x:r,y:i,width:a,height:s,app:c,graph:p,node:l,ports:d,nodeID:u,showContext:f,highlightPort:h}=this.props,m=u,g=void 0!==this.props.export,v=d.inports;n=(o=Object.keys(v)).length;let y=o.map(function(e){let o=v[e],n={app:c,graph:p,node:l,key:m+".in."+o.label,label:o.description,processKey:m,isIn:!0,isExport:g,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:o.x,y:o.y,siblings:v,port:{process:m,port:o.label,type:o.type,subType:o.subType,angle:o.angle,autoReceive:o.autoReceive},highlightPort:h,route:o.route,showContext:f,allowEdgeStart:this.props.allowEdgeStart};return p.edges.find(e=>e.metadata.error&&e.to.node==m&&e.to.port==o.label)&&(n.className="alert"),t.factories.node.createNodePort(n)}.bind(this)),b=t.merge(t.config.node.inports,{children:y});e.highlightPort=h,e.showContext=f,e.inports=v,e.inportsGroup=t.factories.node.createNodeInportsGroup.call(this,b);let w=this.props.ports.outports;n=(o=Object.keys(w)).length;let x=o.map(function(e){let o=w[e],n={app:c,graph:p,node:l,key:m+".out."+o.label,label:o.description,processKey:m,isIn:!1,isExport:g,nodeX:r,nodeY:i,nodeWidth:a,nodeHeight:s,x:o.x,y:o.y,siblings:w,port:{process:m,port:o.label,type:o.type,subType:o.subType,angle:o.angle},highlightPort:h,route:o.route,showContext:f,allowEdgeStart:this.props.allowEdgeStart};return t.factories.node.createNodePort(n)}.bind(this)),S=t.merge(t.config.node.outports,{children:x});return e.outports=w,e.outportsGroup=t.factories.node.createNodeOutportsGroup.call(this,S),e},render:function(){this.props.ports.dirty&&(this.props.ports.dirty=!1);let e=this.props.x,o=this.props.y,n=this.props.width,r=this.props.height;const{inportsGroup:i,outportsGroup:a}=this.renderPorts(),{iconContent:s,statusIconGroup:c}=this.renderIcon(),{borderRect:p,innerImgRect:l,innerRect:d,innerImg:u}=this.renderRects(),{label:f,labelGroup:h}=this.renderLabel();let m=[p,d,l,u,c,i,a,h];this.screenshotSignedUrl||m.push(s),this.state.lastNodeData.width=n,this.state.lastNodeData.height=r;let g={id:this.props.nodeID,className:"node drag "+this.props.node.metadata.def.theme+" "+(this.props.selected?" selected":"")+(this.props.error?" error":""),name:this.props.nodeID,key:this.props.nodeID,title:f,transform:"translate("+e+","+o+")"};return g=t.merge(t.config.node.container,g),t.factories.node.createNodeGroup.call(this,g,m)}}))}},{"./constants":22}],36:[function(e,t,o){t.exports.register=function(e){let t=e.TheGraph,o=function(){return(new Date).getTime()};t.config.port={container:{className:"port arrow"},backgroundCircle:{className:"port-circle-bg"},arc:{className:"port-arc"},line:{ref:"route",className:"port-line"},innerCircle:{ref:"circleSmall"},highlightCircle:{ref:"circleHighlight"},text:{ref:"label",className:"port-label drag"},diamond:{className:"port-diamond",points:"-4,0 0,-4 4,0, 0,4",fill:"#fff",strokeWidth:1},size:4},t.factories.port={createPortGroup:t.factories.createGroup,createPortBackgroundCircle:t.factories.createCircle,createPortArc:t.factories.createPath,createPortInnerCircle:t.factories.createCircle,createPortHighlightCircle:t.factories.createCircle,createPortLabelText:t.factories.createText,createArrow:t.factories.createPolygon},t.Port=React.createFactory(React.createClass({displayName:"TheGraphPort",defaultProps:{allowEdgeStart:!0},space:t.config.nodeRadius,threshold:t.config.edgeDistance,size:t.config.port.size,getInitialState:function(){const{x:e,y:t,isIn:o,port:n}=this.props;let r=n.angle;return r||(r=o?180:0),{moving:!1,startEvent:void 0,x:e,y:t,angle:r,highlightVerified:void 0,highlightVerifiedLastModified:void 0}},componentDidMount:function(){let e=ReactDOM.findDOMNode(this);e.addEventListener("mousedown",this.edgeStart),e.addEventListener("mouseup",this.edgeStart),e.addEventListener("mouseenter",this.handleMouseEnter),e.addEventListener("mouseleave",this.handleMouseLeave),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.$graph=$(document.querySelector(".the-graph-app")),this.props.showContext&&(e.addEventListener("contextmenu",this.showContext),e.addEventListener("press",this.showContext));const{x:t,y:o,angle:n}=this.state;this.handlePortChange(this.props.port.port,{x:t,y:o,angle:n})},componentWillReceiveProps:function(e){let{x:t,y:o,port:n}=e;t===this.props.x&&o===this.props.y||this.setState({x:t,y:o},()=>this.handlePortChange(n.port,{x:t,y:o}))},shouldComponentUpdate:function(e,t){return e.highlightPort!==this.props.highlightPort||t.highlightVerified!==this.state.highlightVerified||t.highlightVerifiedLastModified!==this.state.highlightVerifiedLastModified||t.x!==this.state.x||t.y!==this.state.y||t.angle!==this.state.angle||t.tooltip!==this.state.tooltip},componentWillUnmount:function(){this.$graph&&this.$graph.off("mousemove",this.handleMouseMove),this.$graph&&this.$graph.off("mouseup",this.handleMouseUp)},handleMouseEnter:function(){if(_.get(this.props,"app.state.scale")<t.zbpBig&&!this.state.highlightVerified){const e=this;this.timer=setTimeout(function(){e.setState({tooltip:!0})},600)}},handleMouseLeave:function(){const{tooltip:e}=this.state;this.timer&&clearTimeout(this.timer),e&&this.setState({tooltip:!1})},showContext:function(e){if(this.props.isExport)return;if(e&&e.target===ReactDOM.findDOMNode(this.refs.label))return;e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventTap&&e.preventTap();let t=e.x||e.clientX||0,o=e.y||e.clientY||0;e.touches&&e.touches.length&&(t=e.touches[0].clientX,o=e.touches[0].clientY),this.props.showContext({element:this,type:this.props.isIn?"nodeInport":"nodeOutport",x:t,y:o,graph:this.props.graph,itemKey:this.props.label,item:this.props.port})},getContext:function(e,o,n){return t.Menu({menu:e,options:o,label:this.props.label,triggerHideContext:n})},handleMouseMove:function(e){const{isIn:t,nodeWidth:o,nodeHeight:n,siblings:r,port:i}=this.props;let{active:a,movable:s,drawing:c,x:p,y:l,startEvent:d,startPort:u}=this.state;const f=_.get(this.props,"app.state.scale"),h=(e.clientX-d.clientX)/f,m=(e.clientY-d.clientY)/f;if(a&&(c||s||t||!(p===o&&h>=this.threshold||0===p&&h+this.threshold<=0||0===l&&m+this.threshold<=0||l===n&&m>=this.threshold)?c||s||!((0===p||p===o)&&Math.abs(m)>=2*this.size||(0===l||l===n)&&Math.abs(h)>=2*this.size)||this.setState({movable:!0,active:!1}):this.setState({drawing:!0,active:!1},()=>{this.onTriggerEdgeEvent(d)})),!s)return;const g=n-this.space,v=o-this.space;let y,b,w;if(0===p||p===o){const e=_.filter(r,{x:p});w=(y=n/((b=e.length)+1))*b,(l=u.y+m)<y&&this.handlePortChange(i.port,{y:y}),l>w&&this.handlePortChange(i.port,{y:w});const t=_.find(e,e=>Math.abs(l-e.y)<this.size&&e.label!==i.port);t&&((l=t.y)>this.state.y?t.y-=y:t.y+=y,this.handlePortChange(t.label,{y:t.y}),this.handlePortChange(i.port,{y:l})),l<0&&(l=0),l>n&&(l=n)}if(0===l||l===n){const e=_.filter(r,{y:l});w=(y=o/((b=e.length)+1))*b,(p=u.x+h)<y&&this.handlePortChange(i.port,{x:y}),p>w&&this.handlePortChange(i.port,{x:w});const t=_.find(e,e=>Math.abs(p-e.x)<this.size&&e.label!==i.port);t&&((p=t.x)>this.state.x?t.x-=y:t.x+=y,this.handlePortChange(t.label,{x:t.x}),this.handlePortChange(i.port,{x:p})),p<0&&(p=0),p>o&&(p=o)}t?l>0&&l<=this.space&&h>=0&&m<=0?this.handleUpdateAngle({key:"y",val:0,size:o,angle:90},{key:"x",val:0,size:n},"x"):p>0&&p<=this.space&&h<=0&&m>=0&&this.handleUpdateAngle({key:"x",val:0,size:n,angle:180},{key:"y",val:0,size:o},"y"):l<n&&l>=g&&h<=0&&m>=0?this.handleUpdateAngle({key:"y",val:n,size:o,angle:270},{key:"x",val:o,size:n},"x"):p<o&&p>=v&&h>=0&&m<=0&&this.handleUpdateAngle({key:"x",val:o,size:n,angle:0},{key:"y",val:n,size:o},"y"),this.setState({x:p,y:l})},handleUpdateAngle:function(e,t,o){const{siblings:n,port:r,isIn:i}=this.props,a=_.sortBy(_.filter(n,{[`${e.key}`]:e.val}),e=>e[`${t.key}`]),s=_.sortBy(_.filter(n,{[`${t.key}`]:t.val}),t=>t[`${e.key}`]),c=_.remove(s,{label:r.port})[0];c[`${e.key}`]=e.val,i?a.unshift(c):a.push(c);const p=e.size/(a.length+1),l=t.size/(s.length+1),d=this;!_.isEmpty(a)&&a.forEach(function(o,n){d.handlePortChange(o.label,{[`${e.key}`]:e.val,[`${t.key}`]:p*(n+1),angle:e.angle})}),!_.isEmpty(s)&&s.forEach(function(t,o){d.handlePortChange(t.label,{[`${e.key}`]:l*(o+1)})}),this.setState({[`${e.key}`]:e.val,[`${o}`]:p,angle:e.angle},()=>{this.handleMouseUp()})},handlePortChange:function(e,t){const{graph:o,node:n,processKey:r}=this.props,i=_.get(n,"metadata"),a=_.get(i,"def.ports").map(function(o){return o.uuid===e?{...o,...t}:o});o.setNodeMetadata(r,{def:{...i.def,ports:a}})},handleMouseUp:function(){const{x:e,y:t}=this.props;this.$graph.off("mousemove",this.handleMouseMove),this.$graph.off("mouseup",this.handleMouseUp),this.setState({x:e,y:t,active:!1,movable:!1,drawing:!1,startPort:void 0,startEvent:void 0})},onTriggerEdgeEvent:function(e){const{isExport:t,allowEdgeStart:o,node:n,isIn:r,port:i,route:a}=this.props,{highlightVerified:s}=this.state;if(t||!o)return;if(e&&e.target===ReactDOM.findDOMNode(this.refs.label))return;let c=new CustomEvent("the-graph-edge-start",{detail:{node:n,isIn:r,port:i,route:a,offsetX:e.offsetX,offsetY:e.offsetY,nodeType:n.metadata.def.type,highlightVerified:s},bubbles:!0});ReactDOM.findDOMNode(this).dispatchEvent(c)},edgeStart:function(e){return"mousedown"===e.type?(e.stopPropagation(),void this.setState({active:!0,startEvent:{clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,target:e.target},startPort:{x:this.state.x,y:this.state.y}},()=>{this.$graph.on("mousemove",this.handleMouseMove),this.$graph.on("mouseup",this.handleMouseUp)})):("mouseup"===e.type&&(this.state.movable?this.handleMouseUp():this.onTriggerEdgeEvent(e)),!1)},render:function(){let{label:e,isIn:n,highlightPort:r,port:i,node:a,graph:s,className:c}=this.props;const{x:p,y:l,tooltip:d,angle:u}=this.state;let f,h;if(r&&!i.autoReceive){if(void 0===this.state.highlightVerified||o()-this.state.highlightVerifiedLastModified>1e3){let e=!1,t=!1;r.from&&r.from.process!==a.id&&r.isIn===n&&(_.findIndex(s.edges,e=>e.from.node==r.from.process&&e.from.port==r.from.port&&e.to.node==i.process&&e.to.port==i.port)>-1&&(e=!0),(!e||_.get(r,"updating.to.node")==a.id&&_.get(r,"updating.to.port")==i.port)&&(t=!0)),!r.to||r.to.process===a.id||r.isIn||n||(!e||_.get(r,"updating.from.node")==a.id&&_.get(r,"updating.from.port")==i.port)&&(t=!0),this.setState({highlightVerified:t,highlightVerifiedLastModified:o()})}this.state.highlightVerified&&(h={className:"port-circle-highlight-gray",r:6},r.type!==i.type||r.subType&&i.subType&&r.subType!==i.subType&&"all"!==r.subType&&"all"!==i.subType||(h.className="port-circle-highlight"),h=t.merge(t.config.port.highlightCircle,h),f=t.factories.port.createPortHighlightCircle.call(this,h))}let m={};if(e&&e.length>7){let t=30/(4*e.length)*6;m.fontSize=t+"px"}let g={};180===u?(g.x=5,m.textAnchor="start",d&&e.length>0&&(m.transform="scale(2)",g.x=-5,m.textAnchor="end",m.visibility="visible")):0===u?(g.x=-5,m.textAnchor="end",d&&e.length>0&&(m.transform="scale(2)",g.x=5,m.textAnchor="start",m.visibility="visible")):90===u?(g.y=8,d&&e.length>0&&(m.transform="scale(2)",g.y=-5,m.visibility="visible")):270===u&&(g.y=-8,d&&e.length>0&&(m.transform="scale(2)",g.y=5,m.visibility="visible")),g=t.merge(t.config.port.text,Object.assign(g,{style:m,children:e}));let v=t.factories.port.createPortLabelText.call(this,g);const y=t.merge(t.config.port.diamond,{fill:n?"#fff":"#e0e0e0"});let b=[v,t.factories.edge.createArrow(y)];if(n&&i.autoReceive){let e=t.merge(t.config.port.line,{d:"M-10,0 H0,0"}),o=t.factories.port.createPortArc(e);b.unshift(o)}f&&b.unshift(f);let w=t.merge(t.config.port.container,{title:e,transform:"translate("+p+","+l+")",id:i.process+"-"+i.port});return c&&(w.className+=` ${c}`),t.factories.port.createPortGroup.call(this,w,b)}}))}},{}],37:[function(e,t,o){let n=e("./factories.js"),r=e("./merge.js"),i={container:{},rect:{className:"tooltip-bg",x:-4,y:-9,rx:3,ry:3,height:18},text:{className:"tooltip-label",ref:"label"}},a={createTooltipGroup:n.createGroup,createTooltipRect:n.createRect,createTooltipText:n.createText},s=React.createFactory(React.createClass({displayName:"TheGraphTooltip",render:function(){let e=6*function(e){let t=0;for(let o=0;o<e.length;o++)null!=e[o].match(/[^\x00-\xff]/gi)?t+=2:t+=1;return t}(this.props.label)+8,t=r(i.rect,{width:e}),o=a.createTooltipRect.call(this,t),n=r(i.text,{children:this.props.label}),s=[o,a.createTooltipText.call(this,n)],c={className:"tooltip"+(this.props.visible?"":" hidden"),transform:"translate("+this.props.x+","+this.props.y+")"};return c=r(i.container,c),a.createTooltipGroup.call(this,c,s)}}));t.exports={config:i,factories:a,Tooltip:s}},{"./factories.js":23,"./merge.js":25}],38:[function(e,t,o){t.exports.register=function(e){let t=e.TheGraph,o={nodeSize:12,nodeRadius:5,nodeSide:56,contextPortSize:36,zbpBig:1.2,zbpNormal:.4,zbpSmall:.01,config:{nodeSize:12,nodeWidth:90,nodeRadius:5,nodeHeight:90,autoSizeNode:!0,maxPortCount:6,edgeDistance:16,nodeHeightIncrement:12,focusAnimationDuration:1500}};for(let e in o)t[e]=o[e];"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame),t.findMinMax=function(e,t){let o,n;if(void 0===t&&(t=e.nodes.map(function(e){return e.id}),o=e.inports,n=e.outports),t.length<1)return;let r,a,s=1/0,c=1/0,p=-1/0,l=-1/0,d=t.length;for(let o=0;o<d;o++){let n=t[o],r=e.getNode(n);if(!r||!r.metadata)continue;r.metadata.x<s&&(s=r.metadata.x),r.metadata.y<c&&(c=r.metadata.y);let i=r.metadata.x+r.metadata.width,a=r.metadata.y+r.metadata.height;i>p&&(p=i),a>l&&(l=a)}if(o)for(d=(r=Object.keys(o)).length,i=0;i<d;i++)(a=o[r[i]]).metadata&&(a.metadata.x<s&&(s=a.metadata.x),a.metadata.y<c&&(c=a.metadata.y),a.metadata.x>p&&(p=a.metadata.x),a.metadata.y>l&&(l=a.metadata.y));if(n)for(d=(r=Object.keys(n)).length,i=0;i<d;i++)(a=n[r[i]]).metadata&&(a.metadata.x<s&&(s=a.metadata.x),a.metadata.y<c&&(c=a.metadata.y),a.metadata.x>p&&(p=a.metadata.x),a.metadata.y>l&&(l=a.metadata.y));return isFinite(s)&&isFinite(c)&&isFinite(p)&&isFinite(l)?{minX:s,minY:c,maxX:p,maxY:l}:null},t.findFit=function(e,t,o){return{x:0,y:0,scale:1}},t.findAreaFit=function(e,o,n,r){let i={minX:e.x<o.x?e.x:o.x,minY:e.y<o.y?e.y:o.y,maxX:e.x>o.x?e.x:o.x,maxY:e.y>o.y?e.y:o.y};i.minX-=t.config.nodeSize,i.minY-=t.config.nodeSize,i.maxX+=2*t.config.nodeSize,i.maxY+=2*t.config.nodeSize;let a,s,c,p=i.maxX-i.minX,l=i.maxY-i.minY,d=n/p,u=r/l;return d<u?(a=d,s=0-i.minX*a,c=0-i.minY*a+(r-l*a)/2):(a=u,s=0-i.minX*a+(n-p*a)/2,c=0-i.minY*a),{x:s,y:c,scale:a}},t.findNodeFit=function(e,o,n){let r,i,a,s=e.metadata.x-t.config.nodeSize,c=e.metadata.y-t.config.nodeSize,p=e.metadata.x+2*t.config.nodeSize-s,l=e.metadata.y+2*t.config.nodeSize-c,d=o/p,u=n/l;return d<u?(i=0-s*(r=d),a=0-c*r+(n-l*r)/2):(i=0-s*(r=u)+(o-p*r)/2,a=0-c*r),{x:i,y:a,scale:r}},t.SVGImage=React.createFactory(React.createClass({displayName:"TheGraphSVGImage",render:function(){let e="<image ";return e=(e=(e=(e=(e=e+'xlink:href="'+this.props.src+'"')+'x="'+this.props.x+'"')+'y="'+this.props.y+'"')+'width="'+this.props.width+'"')+'height="'+this.props.height+'"',e+="/>",React.DOM.g({className:this.props.className,dangerouslySetInnerHTML:{__html:e}})}})),t.TextBG=React.createFactory(React.createClass({displayName:"TheGraphTextBG",render:function(){let e=this.props.text;e||(e="");let t=this.props.height,o=e.length*this.props.height*2/3,n=this.props.height/2,r="start",i=this.props.x,a=this.props.y-t/2;return"center"===this.props.halign&&(i-=o/2,r="middle"),"right"===this.props.halign&&(i-=o,r="end"),React.DOM.g({className:this.props.className?this.props.className:"text-bg"},React.DOM.rect({className:"text-bg-rect",x:i,y:a,rx:n,ry:n,height:1.1*t,width:o}),React.DOM.text({className:this.props.textClassName?this.props.textClassName:"text-bg-text",x:this.props.x,y:this.props.y,children:e}))}})),t.getOffset=function(e){let t=function(e){let o,n={top:0,left:0};return e?(n.top+=e.offsetTop||0,n.left+=e.offsetLeft||0,o=t(e.offsetParent),n.top+=o.top,n.left+=o.left,n):n};try{return t(e)}catch(e){return t()}}}},{}]},{},[1])(1)}),"suanpan"===window.appConfig.ossType&&(window.appConfig.signature=ALY.util.crypto.hmac(window.appConfig.oss.ossAccessSecret,window.appConfig.userId,"base64","sha1"),window.appConfig.signVersion="v1"),(app=angular.module("app",["angularBootstrapNavTree","ngAnimate","ngMessages","ngSanitize","ui.bootstrap","ui.select","ui.router","ui.bootstrap.contextMenu","ui.codemirror","ui.colorpicker","toaster","as.sortable","app.tpls","ngCookies"])).constant("APPMENU",{predict:{name:"工业程序",icon:"icongongyechengxu",route:"app.predict",description:"数据 + 算法 + 硬件 + 可视化，全混合流计算技术",userConfig:"predictDirs",componentType:"service, dashboard",visible:!0},algo:{name:"AI开发",icon:"iconAIkaifa",route:"app.exp",description:"为机器学习和深度学习提供从数据处理、模型训练到服务部署的一站式服务",userConfig:"appDirs",componentType:"algo,model",visible:!0},processMining:{name:"流程挖掘",icon:"iconliuchengwajue",route:"app.predict",description:"通过从事件日志中提取出知识，从而去发现、监控和改进实际业务过程",userConfig:"pmDirs",componentType:"pm",visible:!1},edge:{name:"边缘计算",icon:"iconbianyuanjisuan",route:"predict",description:"基于容易编排，采用网络、计算、存储、应用核心能力为一体的开放平台",subMenu:[{id:"project",name:"项目"},{id:"hardware",name:"接入设备"}],userConfig:"edgeDirs",componentType:"edge",visible:!0},mechanism:{name:"机理开发",icon:"iconjilikaifa",route:"app.predict",description:"将专家经验沉淀为决策模型，接入实时数据，构建决策引擎",componentType:"mechanism",visible:!0},rpa:{name:"RPA开发",icon:"iconRPAkaifa",route:"app.exp",description:"将重复性劳动进行自动化出来，在业务流程上实现自动化智能升级",userConfig:"rpaDirs",componentType:"rpa",visible:!0}}),app.constant("COMPONENT_TYPES",[{name:"算法组件",type:"algo",visible:!0},{name:"服务组件",type:"service",visible:!0},{name:"前面板组件",type:"dashboard",visible:window.appConfig.dashboard},{name:"RPA组件",type:"rpa",visible:!0},{name:"RTO组件",type:"rto",visible:!0}]),app.constant("USER_CONFIG",{publicDirId:1,myDirId:2,appDirs:[{id:1,label:"分享给我的项目",folder:!0,children:[]},{id:2,label:"我的项目",folder:!0,children:[]}],componentDirs:[{id:1,label:"分享给我的组件",folder:!0,children:[]},{id:2,label:"我的组件",folder:!0,children:[]}]}),app.constant("nodeTabIcon",{overview:"icongailan",params:"iconshezhi-copy",fields:"iconziduan",tune:"iconzhihangtiaoyou",test:"iconziduan",debug:"iconziduan"}),app.constant("pageSizeOption",[{name:"12 条/页",value:12},{name:"24 条/页",value:24},{name:"48 条/页",value:48},{name:"72 条/页",value:72},{name:"96 条/页",value:96},{name:"120 条/页",value:120}]),app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$urlRouterProvider","$uiRouterProvider","$locationProvider",function(e,t,o,n,r,i,a){app.controller=e.register,app.directive=t.directive,app.filter=o.register,app.factory=n.factory,app.service=n.service,app.constant=n.constant,app.value=n.value,r.otherwise("/web"),i.plugin(window["@uirouter/dsr"].DSRPlugin),i.plugin(window["@uirouter/sticky-states"].StickyStatesPlugin),a.html5Mode({enabled:!0,requireBase:!0}),moment.locale("zh-cn",{relativeTime:{s:"%d 秒"}}),moment.relativeTimeThreshold("s",50),moment.relativeTimeThreshold("ss",51),window.spInstance=window.sp&&window.sp({dashboardPlugins:!0})}]).run(["$rootScope","$timeout","$state","$stateParams","applyFn","APPMENU","$window","nodeService","statisticsService","$location",function(e,t,o,n,r,i,a,s,c,p){e.pageLoading=!0,e.sidebarCollapsed=!0,e.$state=o,e.$stateParams=n,e.applyFn=r,e.global={},e.appConfig=window.appConfig,e.removedNodes=[],e.appMenu=i,e.appConfig._context,window.appConfig.env,e.landingCollapsed=!1;const l=_.split(p.path(),"/");(l.indexOf("app")>0||l.indexOf("service")>0||l.indexOf("component")>0)&&(e.landingCollapsed=!0);const d=document.getElementById("container");let u;function f(e,t,o){e.removeEventListener(t,o),e.addEventListener(t,o)}window.goto=function(r,i,a){if(u=t(function(){e.landingCollapsed=!a,a?d.style.zIndex=1001:r||i||(d.style.zIndex=1),t.cancel(u)}),"customize"==r)o.go("app."+r,{componentId:i});else if(r){const e=_.get(appConfig.appMenu,`${r}.route`);o.go("app."+e,{type:r,id:i||"",refresh:n.refresh+1})}},e.log=function(){switch(arguments.length){case 0:return;case 1:arguments[0];break;case 2:arguments[0],arguments[1];break;case 3:arguments[0],arguments[1],arguments[2]}},e.copyNode=function(e,t){let o=n.type;a.localStorage.copiedNode=JSON.stringify({metadata:angular.copy(e),componentId:t,type:o})},e.pasteNode=function(){if(a.localStorage.copiedNode){let e=JSON.parse(a.localStorage.copiedNode);e.type===n.type&&s.pasteNode(e.metadata,e.componentId)}},f(window,"load",c.trackLoginEvent.bind(c)),f(window,"unload",c.trackLogoutEvent.bind(c)),f(window,"error",c.trackErrorEvent.bind(c))}]),app.run(["appService","appDataStoreService","common","componentService","componentLogService","hardwareService","instantNodeLogService","logService","loopService","nodeService","ossService","predictService","userService","uiService","$timeout","$rootScope","$state","$stateParams","$transitions","eventService",function(e,t,o,n,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b){const w={};y.onSuccess({},function(e){const t=e.to();Object.keys(w).forEach(e=>{e.indexOf(t.name)>-1&&w[e].callback.call(w[e].context,t,v,w[e].options)}),b.emit(b.EVENTS.sp.ng.transition.success,e)}),window.SuanpanAPI={common:{goto:function(e,t,o){if(h(function(){m.landingCollapsed=!o}),"customize"==e)g.go("app."+e,{componentId:t});else if(e){const o=_.get(appConfig.appMenu,`${e}.route`);g.go("app."+o,{type:e,id:t||"",refresh:v.refresh+1})}},registerState:function(e,t,o,n){w[e]||(w[e]=[]),w[e].push({callback:t,context:o,options:n})}},commonService:{uuid:o.uuid,getImportPath:o.getImportPath,...o},appService:e,appDataStoreService:t,componentService:n,componentLogService:r,eventService:b,hardwareService:i,instantNodeLogService:a,logService:s,loopService:c,nodeService:p,ossService:l,predictService:d,uiService:f,userService:u}}]),app.factory("applyFn",["$rootScope",function(e){return function(t,o){t=angular.isFunction(t)?t:angular.noop,o=o&&o.$apply?o:e,t(),o.$$phase||o.$apply()}}]),app.directive("spInput",["$timeout",function(e){return{restrict:"AE",require:"?ngModel",scope:{setFocus:"="},link:function(t,o,n,r){t.setFocus&&(o.bind("focus",function(){let t=this;e(function(){t.select()})}),e(function(){o[0].focus()})),void 0!==n.type&&"number"===n.type&&r&&(r.$formatters.push(function(e){return _.isNull(e)?null:Number(e)}),r.$parsers.push(function(e){return _.isNull(e)?null:Number(e)}))}}}]).directive("indeterminate",function(){return{restrict:"A",link:function(e,t,o){let n=e.$watch(o.indeterminate,function(e){t[0].indeterminate=e});e.$on("$destroy",function(){n()})}}}),app.constant("APP_STATUS",{AppRunning:"1",AppStopped:"2",AppSuccess:"3",AppFailed:"4",AppStarting:"5",AppStopping:"6",AppDead:"7",AppCron:"8",AppWaiting:"9",AppUnknown:"0"}),app.constant("PARAM_TYPES",{string:{label:"单行文本框"},password:{label:"密码输入框"},storage_path:{label:"文件"},multi_string:{label:"多行文本框"},float:{label:"标签"},checkbox:{label:"复选框"},table_select:{label:"表选择"},file_select:{label:"文件选择"},formula_editor:{label:"编辑公式"},key_value:{label:"输入键值对"},partition_select:{label:"分区选择"},select:{label:"单选下拉"},multiselect:{label:"多选下拉"},colselect:{label:"字段选择",placeholder:"输入或者选择字段"},upload_file:{label:"上传文件"}}),app.constant("layoutPaths",{images:{root:"./images/",logo:"./images/logo/",profile:"./images/profile/",type:"./images/types/"}}),app.run(["componentService",function(e){}]),app.run(["toaster",function(e){window.navigator.onLine||e.pop("error","网络异常，请查看网络后重新打开"),window.addEventListener("online",function(){e.pop("success","网络已连接")}),window.addEventListener("offline",function(){e.pop("error","网络异常，请查看网络后重新打开")})}]),app.factory("redirectInterceptor",[function(){return{response:function(e){return"string"==typeof e.data&&e.data.indexOf("<title>登录</title>")>0&&location.reload(),e}}}]),app.config(["$httpProvider",function(e){e.interceptors.push("redirectInterceptor")}]),function(){let e,t=[].indexOf||function(e){for(let t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};(e=angular.module("angularBootstrapNavTree",[])).directive("abnTree",["$timeout","nodeService","$state","toaster","$rootScope","componentService","$stateParams","common",function(e,o,n,r,i,a,s,c){return{restrict:"E",templateUrl:"/tpl/blocks/nav_tree.html",replace:!0,scope:{treeData:"=",isCard:"=",contextType:"@",onSelect:"&",initialSelection:"@",expandedKeys:"=",treeControl:"="},link:function(p,l,d){let u,f,h,m,g,v,y,b,w,x,S;if(p.searched_rows=[],u=function(e){},null==d.iconExpand&&(d.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==d.iconCollapse&&(d.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==d.iconLeaf&&(d.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),null==d.expandLevel&&(d.expandLevel="3"),h=parseInt(d.expandLevel,10),!p.treeData)return;if(null==p.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");p.treeData=[treeData]}g=function(e){let t,o,n,r,i,a;for(t=function(o,n){let r,i,a,s,c;if(e(o,n),null!=o.children){for(c=[],i=0,a=(s=o.children).length;i<a;i++)r=s[i],c.push(t(r,n+1));return c}},a=[],n=0,r=(i=p.treeData).length;n<r;n++)o=i[n],a.push(t(o,1));return a},x=null,w=function(t){if(!t)return null!=x&&(x.selected=!1),void(x=null);if(t!==x){if(null!=x&&(x.selected=!1),t.selected=!0,x=t,f(t),null!=t.onSelect)return e(function(){return t.onSelect(t)});if(null!=p.onSelect)return e(function(){return p.onSelect({branch:t})})}},p.user_clicks_branch=function(e){if(e.folder){if(e.expanded=!e.expanded,p.expandedKeys){const t=_.findIndex(p.expandedKeys,e.id);e.expanded&&-1==t?p.expandedKeys.push(e.id):!e.expanded&&t>-1&&p.expandedKeys.splice(t,1)}if("components"==p.contextType)return}if(e!==x)return w(e)},v=function(e){let t;return t=void 0,e.parent_uid&&g(function(o){if(o.uid===e.parent_uid)return t=o}),t},m=function(e,t){let o;if(null!=(o=v(e)))return t(o),m(o,t)},f=function(e){return m(e,function(e){return e.expanded=!0})},p.tree_rows=[],p.isApp=n.includes("app.exp")||n.includes("app.predict"),b=function(){let e,o,n,r,i,a,s=[];for(g(function(e,t){if(!e.uid)return e.uid=""+Math.random()}),g(function(e){let t,o,n,r,i;if(angular.isArray(e.children)){for(i=[],o=0,n=(r=e.children).length;o<n;o++)t=r[o],i.push(t.parent_uid=e.uid);return i}}),p.tree_rows=[],g(function(e){let t,o;return e.children?e.children.length>0?(o=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){let n,r,i,a;for(a=[],n=0,r=(i=e.children).length;n<r;n++)t=i[n],a.push(o(t));return a}()):void 0:e.children=[]}),e=function(o,n,r){let i,a,c,l,u,f,h,m="components"===p.contextType&&!n.folder&&"my_component"!==n.type&&!n.usable;if(null==n.expanded&&(n.expanded=!1),null==n.classes&&(n.classes=[]),n.folder||n.children&&0!==n.children.length?n.expanded?(c=d.iconCollapse,s.push(n.id)):c=d.iconExpand:(c=n.icon||d.iconLeaf,t.call(n.classes,"leaf")<0&&n.classes.push("leaf")),n.selected&&(x=n),p.tree_rows.push({level:o,branch:n,id:n.id,label:n.label,classes:n.classes,tree_icon:c,folder:n.folder||!1,menuOptions:n.menu||null,disabled:m,selected:n.selected,visible:!1!==r&&(!n.folder||!1!==n.visible)}),null!=n.children){for(h=[],l=0,u=(f=n.children).length;l<u;l++)i=f[l],a=!1!==r&&n.expanded,h.push(e(o+1,i,a));return h}},a=[],n=0,r=(i=p.treeData).length;n<r;n++)o=i[n],a.push(e(1,o,o.visible));return a},p.$watch("treeData",b,!0),null!=d.initialSelection&&g(function(t){if(t.id==d.initialSelection)return e(function(){return w(t)})}),y=p.treeData.length,g(function(e,t){return e.level=t,e.expanded=e.level<h});const C="components"==p.contextType?angular.element("#app"):angular.element(".sp-app-dirs"),I=C.find("#simulator"),E=angular.element(".sp-app-aside"),N=C.find("#dragger");let T;return p.onmousedown=function(t,l){if(3==t.which||l.disabled||l.folder&&-1===l.classes.indexOf("droppable"))return;let d="components"==p.contextType&&E.offset().left+E.width();const u=angular.element(t.currentTarget);let f=(new Date).getTime(),h=l.type,m=l.folder,g=l.id,v=l.icon,y=l.componentId,b=l.componentType,w=l.label;if(l.branch&&(h=l.branch.type,w=l.branch.label,g=l.branch.id,y=l.branch.componentId,v=l.branch.icon,b=l.branch.componentType),"my_component"===h||"public_component"===h||"hufu_component"===h||"device_component"===h||m){if(!n.includes("app.customize")&&i.readOnly)return angular.element(".sp-app-actions .sp-alert").addClass("flash"),void e(function(){angular.element(".sp-app-actions .sp-alert").removeClass("flash")},3e3);let p=t.pageX,v=t.pageY;const x=angular.element(".navi");let S=136,E=x.height(),$=S+E;C.on("mousemove.abn.drag",function(e){if(!l.disabled&&(!T&&(e.pageX-p>=8||Math.abs(e.pageY-v)>=8)&&(T=m?N:I),T&&T.is(":hidden")&&(T.find(".tree-node-label").text(w),T.show()),T&&(m?T.offset({top:e.pageY-15,left:e.pageX<d?e.pageX-80:d-80}):n.includes("app.customize")?T.offset({top:e.pageY-45,left:e.pageX<d?e.pageX-45:d-90}):T.offset({top:e.pageY-45,left:e.pageX-45}),n.includes("app.customize")||e.pageX<d))){const t=x.scrollTop();e.pageY<S&&e.pageX<d?x.scrollTop(t-10):e.pageY>$&&e.pageX<d&&x.scrollTop(t+10)}}),C.find(".abn-tree .droppable").on("mouseenter.abn.drag",function(e){const t=angular.element(e.currentTarget),o=_.toNumber(u.attr("the-id")),n=_.toNumber(t.attr("the-id"));T&&(!m||m&&o!==n)&&t.addClass("row-highlight")}).on("mouseleave.abn.drag",function(e){T&&angular.element(e.currentTarget).removeClass("row-highlight")}).on("mouseup.abn.drag",function(e){if(!T)return;const t=angular.element(e.currentTarget);t.removeClass("row-highlight");const o=_.toNumber(u.attr("the-id")),n=_.toNumber(t.attr("the-id"));if(o&&n)if(m&&n!=o&&n!==l.branch.parentId){const e=c.getDirMap(i.userConfig.componentDirs),t=e[e[g].parentId],o=e[n],a=_.remove(t.children,function(e){return e.id==g})[0];a.parentId=n,o.children.push(a),i.saveConfig().then(function(e){i.$broadcast("node.list.reload"),r.pop("success","移动文件夹成功")},function(e){r.pop("error","移动文件夹失败, 网络错误")})}else m||a.changeDir(o,n).then(function(e){i.$broadcast("node.list.reload"),r.pop("success","移动组件成功")},function(e){r.pop("error","移动组件失败: "+e.msg)});else r.pop("error","移动组件失败")}),C.on("mouseup.abn.drag",function(e){if(e.stopPropagation(),C.off(".abn.drag"),C.find(".abn-tree .droppable").off(".abn.drag"),T&&(T.hide(),T=null),n.includes("app.customize")||e.pageX<d){if(n.includes("app.customize")&&!m){if(s.componentId==g)return;(new Date).getTime()-f<=500&&n.go("app.customize",{componentId:g})}}else e.pageX>d&&("public_component"===h?o.addPublicRemoteNode(y,e.pageX,e.pageY,h):"my_component"===h?"dashboard"===b?o.addRemoteDashboardNode(y,e.pageX,e.pageY,h):o.addRemoteNode(y,e.pageX,e.pageY,h):"hufu_component"!==h&&"device_component"!==h||o.addExternalNode(l.branch,e.pageX,e.pageY,h))})}},null!=p.treeControl&&angular.isObject(p.treeControl)?((S=p.treeControl).expand_all=function(){return g(function(e,t){return e.expanded=!0})},S.collapse_all=function(){return g(function(e,t){return e.expanded=!1})},S.get_first_branch=function(){if((y=p.treeData.length)>0)return p.treeData[0]},S.select_first_branch=function(){let e;return e=S.get_first_branch(),S.select_branch(e)},S.get_selected_branch=function(){return x},S.get_parent_branch=function(e){return v(e)},S.select_branch=function(e){return w(e),e},S.get_children=function(e){return e.children},S.select_parent_branch=function(e){let t;if(null==e&&(e=S.get_selected_branch()),null!=e&&null!=(t=S.get_parent_branch(e)))return S.select_branch(t),t},S.add_branch=function(e,t){return null!=e?(e.children.push(t),e.expanded=!0):p.treeData.push(t),t},S.add_root_branch=function(e){return S.add_branch(null,e),e},S.expand_branch=function(e){if(null==e&&(e=S.get_selected_branch()),null!=e)return e.expanded=!0,e},S.collapse_branch=function(e){if(null==e&&(e=x),null!=e)return e.expanded=!1,e},S.get_siblings=function(e){let t,o;if(null==e&&(e=x),null!=e)return o=(t=S.get_parent_branch(e))?t.children:p.treeData},S.get_next_sibling=function(e){let t,o;if(null==e&&(e=x),null!=e&&(o=S.get_siblings(e),y=o.length,(t=o.indexOf(e))<y))return o[t+1]},S.get_prev_sibling=function(e){let t,o;if(null==e&&(e=x),o=S.get_siblings(e),y=o.length,(t=o.indexOf(e))>0)return o[t-1]},S.select_next_sibling=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=S.get_next_sibling(e)))return S.select_branch(t)},S.select_prev_sibling=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=S.get_prev_sibling(e)))return S.select_branch(t)},S.get_first_child=function(e){let t;if(null==e&&(e=x),null!=e&&(null!=(t=e.children)?t.length:void 0)>0)return e.children[0]},S.get_closest_ancestor_next_sibling=function(e){let t,o;return null!=(t=S.get_next_sibling(e))?t:(o=S.get_parent_branch(e),S.get_closest_ancestor_next_sibling(o))},S.get_next_branch=function(e){let t;if(null==e&&(e=x),null!=e)return null!=(t=S.get_first_child(e))?t:t=S.get_closest_ancestor_next_sibling(e)},S.select_next_branch=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=S.get_next_branch(e)))return S.select_branch(t),t},S.last_descendant=function(e){let t;return 0===(y=e.children.length)?e:(t=e.children[y-1],S.last_descendant(t))},S.get_prev_branch=function(e){let t,o;if(null==e&&(e=x),null!=e)return null!=(o=S.get_prev_sibling(e))?S.last_descendant(o):t=S.get_parent_branch(e)},S.select_prev_branch=function(e){let t;if(null==e&&(e=x),null!=e&&null!=(t=S.get_prev_branch(e)))return S.select_branch(t),t}):void 0}}}])}.call(this),angular.module("app").directive("logview",["$state","$parse","logService",function(e,t,o){return{restrict:"EA",templateUrl:"/tpl/blocks/logview.html",scope:{logNodeId:"@"},link:function(n,r,i){let a=t(i.logId)(n.$parent),s=0,c=r.find(".logview-content"),p=!1,l=0,d=0,u=function(){p||(0===l||e.includes("app.exp.run")||e.includes("app.exp.history")||e.includes("app.predict.run"))&&o.getLog(a,s).then(function(e){if(!p){if(l++,"reload"===e)return 0,s=0,d=0,c.html(""),void setTimeout(function(){u()},1e3);if(e){"minio"===window.appConfig.ossType&&e.text&&(e.text=e.text.substr(d),d+=e.text.length);let t=!0;c.scrollTop()+c.height()+10<c.get(0).scrollHeight&&(t=!1),s=e.nextLogPosition;let o=e.text.split("\n"),n="",r=0;for(let e=0;e<o.length;e++)n+=o[e]+"\n",(++r>=5||e===o.length-1)&&(c.append("<div>"+n.substr(0,n.length-1)+"</div>"),n="",r=0,c.children().length>=200&&c.find(":first-child").remove());t&&c.animate({scrollTop:c.get(0).scrollHeight},500)}setTimeout(function(){u()},1e3)}})};u(),n.$on("$destroy",function(){p=!0})}}}]),angular.module("app").directive("numberOnly",[function(){return{require:"ngModel",link:function(e,t,o,n){n.$parsers.push(function(e){return e+""})}}}]).directive("onFinishRender",["$timeout",function(e){return{restrict:"A",link:function(t,o,n){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),angular.module("app").directive("labelEditor",["$timeout","$parse",function(e,t){return{restrict:"AE",templateUrl:"/tpl/blocks/label_editor.html",replace:!0,scope:{required:"=",title:"="},link:function(t,o,n){t.editing=!1,t.onClick=function(){t.editing=!0,e(function(){o.find("input")[0].focus()})},t.onKeyup=function(e){13==e.keyCode&&(t.editing=!1)}}}}]).directive("inputKeyValue",["$timeout","$parse",function(e,t){return{restrict:"AE",template:'<div class="sp-keyvalue"><button type="button" class="btn btn-xs btn-primary" ng-disabled="readOnly" ng-click="addKeyValue()"><i class="iconfont iconadd"></i></button><div><div class="input-group" ng-if="list" ng-repeat="item in list"><input type="text" class="form-control" ng-model="item.key" placeholder="键" ng-disabled="readOnly" ng-change="handleChange()" /><input type="text" class="form-control" ng-model="item.value" placeholder="值" ng-disabled="readOnly" ng-change="handleChange()" /><button type="button" class="btn-dashed danger input-group-addon" ng-disabled="readOnly" ng-click="removeKeyValue($index)"><i class="iconfont iconminus"></i></button></div></div></div>',replace:!0,scope:{data:"="},link:function(e,t,o){let n=_.isEmpty(e.data)?{"":""}:JSON.parse(e.data);e.list=_.keys(n).map(function(e){return{key:e,value:n[e]}}),e.removeKeyValue=function(t){e.list.splice(t,1)},e.addKeyValue=function(){e.list.push({key:"",value:""})},e.handleChange=function(){let t={};_.forEach(e.list,function(e){t[e.key]=e.value}),e.data=JSON.stringify(t)}}}}]).directive("startingHtml",[function(){return{template:"<div class='toaster-starting'>{{directiveData.title}}{{dynamicDirectiveData}}<span class='dotting'></span></div>"}}]).directive("whenScrolled",function(){return function(e,t,o){let n=t[0];t.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight&&e.$apply(o.whenScrolled)})}}).directive("proportion",function(){return{restrict:"E",replace:!0,template:'<div class="proportion-chart"><span ng-repeat="(key, val) in data" style="width: {{ val > 0 ? val * 100 : 0 }}%">{{w}}</span></div>',scope:{data:"="}}}).directive("selectLine",function(){return function(e,t){t.bind("focus",function(){this.select()})}}).directive("echartBar",function(){return{restrict:"E",replace:!0,template:'<div class="proportion-bar" id="proportion-bar"></div>',scope:!0,link:function(e,t,o){let n=document.getElementById("proportion-bar"),r=echarts.init(n),i=_.keys(e.barData),a=_.values(e.barData);r.setOption({xAxis:{type:"category",data:i},yAxis:{type:"value"},grid:{top:20,right:10,bottom:10,left:10,containLabel:!0},series:{type:"bar",barWidth:"40%",itemStyle:{color:"rgba(0,0,0,0)",borderColor:"#8800ff",borderWidth:"2px",barBorderRadius:[6,6,0,0]},data:a}})}}}).directive("abnTreeTooltip",["$timeout",function(e){return{restrict:"AE",template:'<div class="abn-tree-row-tooltip" ng-style="tooltipStyle">{{tooltipContent}}</div>',replace:!0,scope:{name:"=",disabled:"=",size:"@",onChange:"&"},link:function(t,o,n){let r;t.tooltipStyle={};angular.element(".navi").on("mouseenter",".abn-tree .leaf a",function(o){o.stopPropagation();const n=o.currentTarget.querySelector(".tree-label").innerText;if(function(e){for(var t,o=0,n=0;n<e.length;n++)(t=e.charCodeAt(n))<127?o++:o+=128<=t&&t<=2047?2:2048<=t&&t<=65535?3:4;return o}(n)>18){var i=o.clientX,a=o.clientY-50-40;t.tooltipContent=n,r||(r=e(function(){t.tooltipStyle.top=a,t.tooltipStyle.left=i,t.tooltipStyle.opacity=1},1e3))}}),angular.element(".navi").on("mouseleave",".abn-tree .leaf a",function(o){o.stopPropagation(),r&&(e.cancel(r),r=null,t.tooltipStyle.opacity=0,t.$apply())})}}}]).directive("spSwitch",["$timeout","$parse",function(e,t){return{restrict:"AE",templateUrl:"/tpl/blocks/sp_switch.html",replace:!0,scope:{disabled:"=",checked:"=",size:"@",onClick:"&",onChange:"&"},link:function(e,t,o){e.className=e.size?"sp-switch-"+e.size:"",t.on("click","input",function(t){e.checked=t.target.checked,e.onClick&&e.onClick()}),t.on("change","input",function(){e.onChange&&e.onChange()})}}}]).directive("spAlert",["$timeout",function(e){return{restrict:"AE",template:'<div class="sp-alert" ng-hide="!alertData || !alertData.message" ng-class="getClass()"><i class="iconfont iconjingshi"></i>{{alertData.message}}</div>',replace:!0,scope:{size:"@",alertData:"=",fadeOut:"=",delaySeconds:"="},link:function(t,o,n){t.$watch("alertData",function(o){o&&t.fadeOut&&e(function(){t.alertData.message=null},1e3*(t.delaySeconds||1))}),t.getClass=function(){let e=[];const o=_.get(t.alertData,"type");return o?e.push("sp-alert-"+o):e.push("sp-alert-info"),t.size&&e.push("sp-alert-"+t.size),e.join(" ")}}}}]).directive("spChecked",[function(){return{restrict:"AE",template:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg"> <circle fill="none" stroke-linecap="round" ></circle> <polyline fill="none" stroke-linejoin="round" stroke-linecap="round" /></svg>',scope:{size:"=",r:"=",stroke:"=",strokeWidth:"=",loading:"="},link:function(e,t,o){let n=.8;const r=e.size/2,i=e.size/2;e.circum=2*e.r*Math.PI,e.dasharray=e.circum+" "+e.circum;const a=t.children("svg"),s=angular.element(a.find("circle")[0]),c=angular.element(a.find("polyline")[0]);a.attr("width",e.size),a.attr("height",e.size),s.attr("cx",r),s.attr("cy",i),s.attr("r",e.r),s.attr("stroke-width",e.strokeWidth),s.attr("stroke-dasharray",e.dasharray),s.attr("stroke-dashoffset",e.circum-n*e.circum),c.attr("stroke-width",e.strokeWidth);let p=1;const l=[[r-e.r/3,i-e.r/6],[r,i+e.r/4],[r+4*e.r/5,i-2*e.r/3]];c.attr("points",l.map(e=>e.join(",")).join(" "));const d=Math.sqrt(Math.pow(l[1][0]-l[0][0],2)+Math.pow(l[1][1]-l[0][1],2))+Math.sqrt(Math.pow(l[2][0]-l[1][0],2)+Math.pow(l[2][1]-l[1][1],2));let u;function f(){u=requestAnimationFrame(function(){s.attr("stroke-dashoffset",e.circum-n*e.circum),window.cancelAnimationFrame(u),u=null,n<.8?(n+=.02,f()):(n=0,function e(){u=requestAnimationFrame(function(){c.attr("stroke-dashoffset",d-p*d),window.cancelAnimationFrame(u),u=null,p<1?(p+=.05,e()):p=0})}())})}c.attr("stroke-dasharray",d+" "+d),c.attr("stroke-dashoffset",d-p*d),e.$watch("loading",function(t){t&&(n=0,p=0,s.attr("stroke-dashoffset",e.circum-n*e.circum),c.attr("stroke-dashoffset",d-p*d),f())})}}}]).directive("scrolledBottom",function(){return function(e,t,o){var n=t[0];t.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight&&e.$apply(o.scrolledBottom)})}}).directive("spIconpicker",["toaster","appDataStoreService","$stateParams","format","$timeout",function(e,t,o,n,r){return{restrict:"AE",template:'<div class="sp-iconpicker-wrapper"><div class="sp-iconpicker" uib-dropdown> <button type="button" ng-disabled="disabled" class="sp-iconpicker-toggle" uib-dropdown-toggle><i ng-if="!iconUrl" class="iconfont" ng-class="getIcon()"></i>{{log(iconUrl)}}<span ng-if="iconUrl" class="sp-iconpicker-image-wrapper"><img class="sp-iconpicker-image" ng-src="{{::iconUrl}}" /></span></button><ul class="dropdown-menu" uib-dropdown-menu><li class="dropdown-item" ng-repeat="item in builtIn"><a ng-click="onChange(item);"><i class="iconfont icon{{::item}}"></i></a></li><li class="dropdown-item" ng-repeat="item in iconImages"><a ng-if="item" ng-click="onChange(item.key);"><img class="sp-iconpicker-image" ng-src="{{::item.url}}" /></a></li></ul></div><span class="sp-iconpicker-custom" ng-class="{disabled: disabled}" ng-click="onClickCustom()"><input class="sp-iconpicker-input" type="file" multiple="multiple" ng-disabled="disabled" />自定义</span></div>',replace:!0,scope:{selectedIcon:"=",builtIn:"=",iconImages:"=",disabled:"=",onChange:"=",onUploadSuccess:"="},link:function(r,i,a){const s=i.find(".sp-iconpicker-input"),c=o.componentId?"studio/{{userId}}/component/{{componentId}}/icons/":"studio/{{userId}}/{{appId}}/icons/",p=n(c);r.getIcon=function(){return"icon"+r.selectedIcon},r.$watch("selectedIcon",function(e){r.iconUrl=null,_.isString(e)&&e.indexOf("studio/")>-1&&t.url(e).then(function(e){r.iconUrl=e.data})}),r.onClickCustom=function(){s[0].click()},s.on("change",function(o){const n=_.values(o.target.files),i=n.length;let a=0;const s=function(e){a<i?c(n[a]):(i==a&&e&&r.onChange(p+e),r.onUploadSuccess())},c=function(o){a++,-1==o.type.indexOf("image/")?(e.pop("error",o.name+"不是图片！"),a<i&&c(n[a])):o.size>81920?e.pop("error",o.name+" 上传失败，图片大于80K"):t.upload(p+o.name,o,function(e){},function(t){e.pop("error",o.name+" 上传失败"),s()},function(t){e.pop("success",o.name+" 上传成功"),s(o.name)})};c(n[a])})}}}]),angular.module("app").directive("spUploader",["appDataStoreService","format","$stateParams","common",function(e,t,o,n){return{restrict:"EA",templateUrl:"/tpl/blocks/spuploader.html",scope:{title:"=",controlInstUuid:"=",type:"=",out:"=",fileName:"=",nodeType:"=",separator:"=",btnDisabled:"=",fileUploading:"=",fileUploadFailed:"=",allFileUploadFinish:"=",fileUploadSuccess:"=",fileUploadPath:"=",readOnly:"=",singleFile:"=",uuidFile:"="},link:function(r,i,a){const s=_.cloneDeep({title:r.title,type:r.type,controlInstUuid:r.controlInstUuid,out:r.out,separator:r.separator,fileName:r.fileName});let c=null,p=null,l=0,d=10;const u={"{{userId}}":window.appConfig.userId,"{{appId}}":o.id,"{{nodeId}}":o.nodeId};function f(){r.files=[],r.title=s.title,r.type=s.type,r.controlInstUuid=s.controlInstUuid,r.out=s.out,r.separator=s.separator,r.fileName=s.fileName,l=0,p=t(r.fileUploadPath,u)}function h(e){if(c=_.values(e.target.files),r.total=c.length,r.total){for(r.$apply(function(){r.files=_.values(c).map(function(e){return{name:e.name,size:e.size,type:e.type}})}),l=0;l<Math.min(d,r.total);l++)g(c[l],l);l--}e.target.value=""}r.files=[],r.total=0,r.accept=a.accept||"*",angular.element(".btn-uploader").on("click",".input-upload",f),angular.element(".btn-uploader").on("change",".input-upload",h);const m=function(){++l<r.total?g(c[l],l):r.allFileUploadFinish&&r.allFileUploadFinish(r.fileUploadPath,r.controlInstUuid)};let g=function(t,o){let i=t.name.lastIndexOf("."),a="";i>0&&(a=t.name.slice(i+1).toLowerCase());let s=t.name;if(_.isEmpty(t.webkitRelativePath)||(s=t.webkitRelativePath),function(e,t){switch(r.type){case"txt":case"csv":return e==r.type;case"excel":return e.indexOf("xls")>-1;case"images":case"image":return 0===t.indexOf("image/");default:return!0}}(a,t.type)){let c=s;"21"==r.nodeType&&("csv"==r.type||"txt"==r.type?c="data."+r.type:"excel"==r.type&&(c="data."+a)),r.uuidFile&&(c=a?c.slice(0,i)+"-"+n.uuid()+"."+a:c+"-"+n.uuid()),r.fileName&&(c=r.fileName);let l=p+c;e.upload(l,t,function(e){let t=Math.round(e.loaded/e.total*100)+"%";r.$apply(function(){r.files[o].msg=t})},function(e){r.$apply(function(){r.files[o].status="failed",r.files[o].msg="上传失败"}),r.fileUploadFailed&&r.fileUploadFailed(s),m()},function(e){r.$apply(function(){r.files[o].status="success",r.files[o].msg="上传成功"}),r.fileUploadSuccess&&r.fileUploadSuccess(l),m()}).then(function(e){},function(e){r.$apply(function(){r.files[o].status="error",r.files[o].msg=_.get(e,"msg")}),m()})}else r.$apply(function(){r.files[o].msg="类型不匹配",r.files[o].status="error"}),m()};r.$on("$destroy",function(){angular.element(".btn-uploader").off("click",".input-upload",f),angular.element(".btn-uploader").off("change",".input-upload",h)})}}}]),angular.module("app").directive("spResizeTrigger",[function(){return{restrict:"EA",template:'<span class="sp-resize-trigger" ng-class="className"></span>',replace:!0,scope:{className:"@",dragArrow:"@"},link:function(e,t,o){const n=o.dragArrow;let r=!1,i=null,a=null;const s=angular.element("#edit"),c=angular.element(t).parents(".sp-resizable");let p,l,d,u,f,h,m,g,v,y,b,w;e.getClass=function(){return o.className},t.on("mousedown",function(e){return r=!0,"vertical"!=n?(i=e.clientX,p=s.width(),l=s.offset().left,f=angular.element(".sp-toggle"),d=angular.element(".sp-app-aside"),u=angular.element(".sp-app-right")):(i=e.clientY,g=angular.element(e.target),h=g.prev(),m=g.next(),v=h.height(),y=m.height(),w=c.height()),!1}),s.on("mouseup",function(e){r=!1,"vertical"!=n?(i=e.clientX,f=null):i=e.clientY}),s.on("mousemove",function(e){var t;if(r)if(a=e.clientX,"left"==n)(t=p+l-a)>=250&&a>d.width()+d.offset().left+92&&(f.css({right:t+16+"px"}),c.width(t));else if("right"==n)(t=a-l)>=250&&a<u.offset().left-92&&c.width(t);else if("vertical"==n&&(b=e.clientY-i,v+b>84&&y-b>40)){const e=((v+b)/w*100).toFixed(2)+"%",t=((y-b)/w*100).toFixed(2)+"%";h.css("height",e),m.css("height",t),g.css("top",e)}})}}}]),(app=angular.module("app")).constant("app",{version:"0.6.0"}).constant("NODEICONS",["cube","microchip","flask","globe","chart-area","strikethrough","shekel-sign","random","signature","adjust","atlas","blanket","bong","burn","chart-line","clone","cloud-upload-alt","code-branch","code-commit","cog","coins","compass","conveyor-belt","database","exchange","fingerprint","fire","gem","link","retweet","server","shield-check","vial","vials"]).config(["$stateProvider",function(e){let t="app.exp";const o=_.find(appConfig.appMenu,function(e){return _.has(e,"route")&&e.visible});o&&(t="app."+o.route),e.state("app",{url:"/web",deepStateRedirect:{default:{state:t,params:{type:null,id:null}},params:!0},resolve:{userConfig:["userService","$q",function(e,t){const o=t.defer();return e.getConfig().then(function(e){o.resolve(e)}),o.promise}]},views:{"comps@app":{templateUrl:"/tpl/app/sp_app_comps.html",controller:"compsController"},"nodes@app":{templateUrl:"/tpl/app/sp_app_nodes.html",controller:"nodesController"},"":{templateUrl:"/tpl/sp_app.html",controller:["$scope","$state","$stateParams","$timeout","appDataStoreService","$rootScope","userService","$q","common","$transitions","userConfig","componentService","nodeService","enabledUser","scriptService","hardwareService","remoteService","toaster","loopService","$uibModal","NODEICONS","format",function(e,t,o,n,r,i,a,s,c,p,l,d,u,f,h,m,g,v,y,b,w,x){window.userConfig=i.userConfig=l,window.logout=i.logout=function(){g.post("/logout").then(function(e){if(e.success){var t=encodeURIComponent(location.protocol+"//"+location.host);switch(window.appConfig.getUserIdMethod){case"xuelang":var o=window.appConfig.loginHost+"/login?callback="+t;location.href=o;break;case"xuelangUserCenterV2":o=window.appConfig.loginHost+"/logout?callback="+t;location.href=o;break;case"xuelangUserCenterV3":o=window.appConfig.loginHost+"/api/logout";location.href=o;break;default:location.href="/"}}else err.msg},function(e){e.msg})},window.reactInit(),i.pageLoading=!1,i.sidebarCollapsed=!0,i.tagModel={},i.fullScreenImage={isFullScreen:!1,onShowScreenImage:function(e,t){e.stopPropagation(),_.isEmpty(t)||(i.fullScreenImage.isFullScreen=!0,i.fullScreenImage.src=t,n(function(){angular.element(".fullScreen").css("z-index",2e3)}))},onFullScreenExit:function(e){e.stopPropagation(),i.fullScreenImage.isFullScreen=!1}},e.onChangeLang=function(){if("en"===e.langConfig.code){e.langConfig={code:"zh-CN",text:"English Edition"};let t=document.getElementById(":1.container");if(t){let o=t.contentDocument.getElementById(":1.restore");o&&(o.click(),$cookies.put("sp_langCode",e.langConfig.code),$cookies.put("sp_langText",e.langConfig.text))}}else{e.langConfig={code:"en",text:"切换至中文版"};let t=document.getElementById(":0.targetLanguage");if(t){let o=t.childNodes[0];o&&(o.value="en",o.dispatchEvent(new CustomEvent("change")),$cookies.put("sp_langCode",e.langConfig.code),$cookies.put("sp_langText",e.langConfig.text))}}},e.componentAble="0"==window.appConfig.disableComponent,e.resetTabInfo=function(e,t){let o=_.filter(_.values(e),function(e){return e.isRequired&&!e.hidden}),n=_.filter(_.keys(t),function(e){return t[e].required});if(_.isEmpty(n)&&!_.isEmpty(o)||!_.isEmpty(n)&&_.isEmpty(o)){let e=_.map(o,"controlInstUuid");for(let o in t){let n=t[o].controls;if(!_.isEmpty(n)){let r=_.findIndex(n,function(t){return _.indexOf(e,t.uuid)>-1});t[o].required=r>-1}}}},e._dropdown={open:!1,menu:[],fetching:!1,handleGetList:function(){let e=this;m.post("list",{hwtype:"board"}).then(function(t){t.success?(e.fetching=!1,e.menu=_.map(t.data,function(e){return{id:e.id,name:(e.name||e.id)+"("+e.ip+")",ip:e.ip,state:e.state}})):e.fetching=!1},function(t){e.fetching=!1})}};let S=function(e,t){let o=0,n=e.length,r=function(i){o++;let a=i.getAttribute("xlink:href"),s=i.getAttribute("width"),c=i.getAttribute("height"),p=new Image;p.setAttribute("crossOrigin","anonymous"),p.onload=function(){let a=function(e,t,o){let n=document.createElement("canvas");return n.width=t,n.height=o,n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,o),n.toDataURL("image/png")}(p,s,c);i.setAttribute("xlink:href",a),o<n?r(e[o]):t()},p.src=a+"&timeout="+(new Date).getTime()};n?r(e[o]):t()};let C;i.screenshots=function(e,o,n){$("#screenShot").remove();let a=$("#editor").html();$("#editor").append(a).children(".the-graph-app:last").attr("id","screenShot");let s=$("#screenShot .app-svg .view"),c="dark"==i.current_bg?"#464856":"#f1f1f1";s.parent().attr("style","background-color: "+c),s.find(".node-rect").attr("fill","#f6f6f6"),s.find(".node-label").attr("text-anchor","middle"),s.find(".port-label").attr("display","none"),s.find(".group-box").attr({fill:"rgba(255, 239, 138, 0.2)",stroke:"rgba(228, 215, 59, 0.8)"}),s.find(".node-icon.icon").attr({fill:"none",display:"none"}),s.find(".edge-icon:not(.block)").attr({display:"none"}),s.find(".edge").each(function(e,t){$(t).children().attr("fill","none").end().find(".stroke").attr("stroke","#a6a6a6")}),s.siblings(".tooltip").find(".tooltip-bg").attr("fill","none");let p=s.find("image");S(p,function(e,o,n){let i="studio/"+window.appConfig.userId+"/"+t.params.id+(e?"/"+e:"/screen_shot.png"),a=document.getElementById("screenShot"),s=a.offsetWidth,c=a.offsetHeight,p=a.querySelector(".view"),l=p.getBBox(),d=l.width,u=l.height,f=l.x,h=l.y,m=p.getAttribute("transform"),g=m.indexOf("(")+1,v=m.indexOf(","),y=Number(m.slice(g,v));if(d>s||u>c){let e=y,t=y;d>s&&(e=s/d),u>c&&(t=c/u),y=e<t?e:t}let b="matrix("+y+",0,0,"+y+","+-f*y+","+-h*y+")";p.setAttribute("transform",b);const w=function(e){Math.round(e.loaded/e.total*100)},x=function(e){},S=function(e){n&&n()};let C=Math.ceil(d*y),I=Math.ceil(u*y),_=a.querySelector(".app-svg"),E=new XMLSerializer,N="data:image/svg+xml,"+encodeURIComponent(E.serializeToString(_)),T=new Image;T.src=N,T.crossOrigin="anonymous",T.width=C,T.height=I,T.onload=function(){let e=document.createElement("canvas");e.width=C,e.height=I,e.getContext("2d").drawImage(T,0,0),a.remove(),e.toBlob(function(e){r.upload(i,e,w,x,S)})},o&&o()}.bind(this,e,o,n))},e.enable=f,e.doCreateComponent=function(e,o){o.stopPropagation(),d.create("未命名组件",void 0,e).then(function(e){d.setPermission(e.id).then(function(o){t.go("app.customize",{componentId:e.id})},function(o){t.go("app.customize",{componentId:e.id})}),t.includes("app.customize")&&i.$broadcast("node.list.reload")})},i.saveConfig=function(){let t=s.defer(),o=c.getDirList(e.userConfig.appDirs);angular.forEach(o,function(e){angular.forEach(e,function(t,o){["id","label","folder","children"].indexOf(o)<0&&delete e[o]})});let n=c.getDirList(e.userConfig.componentDirs);angular.forEach(n,function(e){angular.forEach(e,function(t,o){["id","label","folder","children"].indexOf(o)<0&&delete e[o]})});let r=angular.copy(e.userConfig);return a.saveConfig(r).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},i.addFolder=function(e,t){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/addFolder.html",controller:["$scope","$rootScope","toaster","common",function(o,n,r,i){o.title="新增文件夹",o.name="新文件夹",o.ok=function(){if(o.loading)return;let a;if(o.loading=!0,"app"===t?a=i.getDirMap(o.userConfig.appDirs):"component"===t?a=i.getDirMap(o.userConfig.componentDirs):"predict"===t?a=i.getDirMap(o.userConfig.predictDirs):"rpa"===t&&(a=i.getDirMap(o.userConfig.rpaDirs)),!a)return o.loading=!1,void r.pop("error","新增文件夹失败");let s=3;for(let e in a)s<parseInt(e,10)&&(s=parseInt(e,10));let c=s+1,p=a[e];p.children||(p.children=[]),p.children.push({id:c,label:o.name,folder:!0,children:[]}),o.saveConfig().then(function(e){"app"===t?n.$broadcast("app.list.reload",{}):"component"===t?n.$broadcast("node.list.reload"):"predict"===t?n.$broadcast("predict.list.reload",{}):"rpa"===t&&n.$broadcast("rpa.list.reload",{}),C.close(),r.pop("success","新增文件夹成功")},function(e){r.pop("error","新增文件夹失败, 网络错误")}).finally(function(){o.loading=!1})},o.cancel=function(){C.close()},o.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.removeFolder=function(e,o,n,r,i){C=b.open({templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$rootScope","common","componentService","toaster",function(a,s,c,p,l){a.alertTitle=i?"删除文件夹":"批量删除",a.alertIcon="iconfont iconjinggao text-danger";const d=c.getDirMap(a.userConfig[o+"Dirs"]),u=_.get(d[e],"parentId"),f=d[u],h=c.getDirMap(r),m=h[e];if(_.isEmpty(m))return void l.pop("error","该文件夹不存在");const g=_.filter(m.children,function(e){return!e.folder}),v=_.filter(m.children,function(e){return e.folder}),y=_.isEmpty(v)||-1==_.findIndex(v,function(e){return e.children.length});a.alertBody=i?y?"删除文件夹 ‘"+n+"’ 吗?":"文件夹 ‘"+n+"’ 中有非空目录，请先删除！":"文件夹 ‘"+n+"’ 中没有可删除的组件。",g.length&&(a.alertBody=i?"文件夹 ‘"+n+"’ 不为空，请先删除其中的组件！":"批量删除文件夹 ‘"+n+"’ 中的组件",a.moreLabel="全部组件：",a.more={hide:!1,toggle:!1},a.selected={all:!1},a.siblings=m&&_.filter(m.children,function(e){return!e.folder}),a.onChangeAll=function(){_.forEach(a.siblings,function(e){e.selected=a.selected.all})});const b=function(){angular.forEach(f.children,function(t,o){t.id===e&&f.children.splice(o,1)}),a.saveConfig().then(function(e){s.$broadcast("node.list.reload"),C&&C.close(),l.pop("success","文件夹 ‘"+n+"’ 已被删除")},function(e){l.pop("error","文件夹 ‘"+n+"’ 删除失败, 网络错误"),C&&C.close()}).finally(function(){a.loading=!1})};a.ok=function(){const e=a.siblings&&_.filter(a.siblings,{selected:!0});if(_.isEmpty(e))_.isEmpty(g)&&y&&i?b():y||C.close();else{if(a.loading)return;a.loading=!0,p.removeList(e).then(function(e){const o=_.filter(e,{removed:!1}),r=_.filter(e,{removed:!0}),c=_.findIndex(r,{id:t.params.componentId})>-1;if(c){let e=_.find(a.siblings,function(e){return!e.selected});e||(e=u&&h[u]&&_.find(h[u].children,function(e){return!e.folder})),t.go("app.customize",{componentId:e.id})}l.pop("success","组件 "+_.map(r,"label").join("、")+" 已被删除"),_.isEmpty(o)?y&&i?b():(i&&l.pop("warning","文件夹 ‘"+n+"’ 中有非空目录，请先删除！"),!c&&s.$broadcast("node.list.reload")):l.pop("error","组件 "+_.map(o,"label").join("、")+" 删除失败"),C.close()}).finally(function(){a.loading=!1})}},a.cancel=function(){C.close()},a.$on("modal.closing",function(e,t){C=void 0})}],size:"sm",appendTo:""})},i.renameFolder=function(e,t,o){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/rename.html",controller:["$scope","toaster",function(n,r){n.renameTitle="重命名文件夹",n.renameNameTitle="名称",n.renameName=o,n.ok=function(){if(n.renameLoading)return;let o;return n.renameLoading=!0,"app"===t?o=c.getDirMap(n.userConfig.appDirs):"component"===t?o=c.getDirMap(n.userConfig.componentDirs):"predict"===t?o=c.getDirMap(n.userConfig.predictDirs):"rpa"===t&&(o=c.getDirMap(n.userConfig.rpaDirs)),n.renameName?o&&o[e]?(o[e].label=n.renameName,void n.saveConfig().then(function(e){"app"===t?i.$broadcast("app.list.reload",{}):"component"===t?i.$broadcast("node.list.reload"):"predict"===t?i.$broadcast("predict.list.reload",{}):"rpa"===t&&i.$broadcast("rpa.list.reload",{}),C.close(),r.pop("success","重命名文件夹成功")},function(e){r.pop("error","重命名文件夹失败, 网络错误")}).finally(function(){n.renameLoading=!1})):(n.renameLoading=!1,void r.pop("error","重命名文件夹失败")):(n.renameLoading=!1,void r.pop("error","重命名文件夹失败: 名称不能为空"))},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.removeMultiNodes=function(e,t){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(o,n,r,a){o.alertTitle="删除节点",o.alertIcon="iconfont iconjinggao text-danger";const s=_.map(e,"metadata.label");o.alertBody='确定删除节点 "'+s.join("；")+'" 吗?',o.ok=function(){o.loading||(o.loading=!0,o.alertBody="正在删除",_.forEach(e,function(e){r.removeNode(e.id),i.removedNodes.push(angular.copy(e))}),C.close(),n.go(t))},o.cancel=function(){C.close()},o.$on("modal.closing",function(){C=void 0})}],size:"sm",appendTo:""})},i.removeNode=function(e,t){const o=h.idNodeDeletable(e.id);C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(n,r,a,s){n.alertTitle="删除节点",n.alertIcon="iconfont iconjinggao text-danger",n.alertBody=o?'确定删除节点 "'+e.metadata.label+'" 吗?':'节点 "'+e.metadata.label+'" 的连线有自定义脚本，确定删除吗?',n.ok=function(){!o&&h.removeScriptByNode(e.id),a.removeNode(e.id),i.removedNodes.push(angular.copy(e)),t&&r.go(t),C.close()},n.cancel=function(){C.close()},n.$on("modal.closing",function(){C=void 0})}],size:"sm",appendTo:""})},i.removeGroup=function(e,t){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService","toaster",function(o,n,r,i){o.alertTitle="删除组合",o.alertIcon="iconfont iconjinggao text-danger",o.alertBody="确定删除组合 “"+e.metadata.name+"” 及其中的所有节点和连线吗？删除后不可恢复！",o.ok=function(){r.removeGroup(e.name),_.forEach(e.nodes,function(e){r.removeNode(e)}),t&&n.go(t),C.close()},o.cancel=function(){C.close()},o.$on("modal.closing",function(){C=void 0})}],size:"sm",appendTo:""})},i.removeEdge=function(e,o){h.isEdgeDeletable(e)?C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$state","nodeService",function(t,n,r){t.alertTitle="删除连线",t.alertIcon="iconfont iconjinggao text-danger",t.alertBody="该连线包含自定义脚本，确定删除吗?",t.ok=function(){t.loading||(t.loading=!0,h.removeScriptByEdge(e),r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),o&&n.go(o))},t.cancel=function(){C.close()},t.$on("modal.closing",function(){C=void 0})}],size:"sm",appendTo:""}):(h.removeScriptByEdge(e),u.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),o&&t.go(o))},i.handleResetContext=function(e,o,n){if(!n&&i.appConfig._context==appConfig.env||_.get(i.appConfig,"_board.id")==_.get(n,"id"))return;const r="app."+_.split(e,".")[1];if(n){if(e.indexOf("app.predict.run")>-1)return void v.pop("info","请先释放再切换到边缘端");i.appConfig._context="hardware"}else i.appConfig._context=appConfig.env;i.appConfig._board=n,t.go(r,{type:o.type,id:o.id,refresh:o.refresh+1})},i.showRunHistory=function(t){e.alert="",C=b.open({animation:!0,windowClass:"modal-bottom-sheet",templateUrl:"/tpl/custom/popup/runHistory.html",controller:["$scope","appService",function(e,o){e.data=[];let n=40;e.loadMore=function(){n<40||o.listCron(t,40,e.data.length).then(function(t){if(t&&t.list){if(0===(n=t.list.length))return;for(let e=0;e<t.list.length;e++)t.list[e].cron_config=JSON.parse(t.list[e].cron_config);e.data=e.data.concat(t.list)}})},e.loadMore(),e.cancel=function(){C.close()}}]})},i.runSchedule=function(e,t){let o=u.getNode(t).metadata.label;C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/schedule.html",controller:["$scope","$state","$rootScope","nodeService","appService","toaster",function(n,r,i,a,s,c){const p=function(e){switch(e){case"day":return{startHour:0,startMinute:0};case"week":case"month":return{startHour:0,startMinute:0,targetDays:""};case"minute":return{startHour:0,startMinute:0,endHour:23,endMinute:59,intervalMinute:5};case"hour":return{startHour:0,startMinute:0,endHour:23,endMinute:59,intervalHour:1}}};let l=function(){return moment().toISOString()};n.updateStartEffectTime=function(){moment(n.cronConfig.startEffectTime).unix()<moment().unix()&&(n.startEffectTime=new Date(l())),n.minDate=new Date(l())},n.format="yyyy/MM/dd",n.altInputFormats=["yyyy/MM/dd"],n.startOpend=!1,n.cronConfig=a.getCronConfig()||{period:"day",runType:"runStart",startEffectTime:l(),endEffectTime:moment().add(1,"year").toISOString(),config:p("day")},n.startEffectTime=new Date(n.cronConfig.startEffectTime),n.endEffectTime=new Date(n.cronConfig.endEffectTime),n.cronConfig.nodeId=t,n.updateStartEffectTime(),n.dateOptions={minDate:n.minDate},n.$watch("cronConfig.period",function(e,t){e!==t&&(n.cronConfig.config=p(e))}),n.a={},n.a.nodeLabel=o,n.a.monthDayList=[{name:"1号",value:1},{name:"2号",value:2},{name:"3号",value:3},{name:"4号",value:4},{name:"5号",value:5},{name:"6号",value:6},{name:"7号",value:7},{name:"8号",value:8},{name:"9号",value:9},{name:"10号",value:10},{name:"11号",value:11},{name:"12号",value:12},{name:"13号",value:13},{name:"14号",value:14},{name:"15号",value:15},{name:"16号",value:16},{name:"17号",value:17},{name:"18号",value:18},{name:"19号",value:19},{name:"20号",value:20},{name:"21号",value:21},{name:"22号",value:22},{name:"23号",value:23},{name:"24号",value:24},{name:"25号",value:25},{name:"26号",value:26},{name:"27号",value:27},{name:"28号",value:28},{name:"29号",value:29},{name:"30号",value:30},{name:"31号",value:31}],n.a.weekDayList=[{name:"星期一",value:1},{name:"星期二",value:2},{name:"星期三",value:3},{name:"星期四",value:4},{name:"星期五",value:5},{name:"星期六",value:6},{name:"星期日",value:7}],n.a.minuteList=[{name:"5分钟",value:5},{name:"10分钟",value:10},{name:"15分钟",value:15},{name:"20分钟",value:20},{name:"25分钟",value:25},{name:"30分钟",value:30},{name:"35分钟",value:35},{name:"40分钟",value:40},{name:"45分钟",value:45},{name:"50分钟",value:50},{name:"55分钟",value:55}],n.a.hourList=[{name:"1小时",value:1},{name:"2小时",value:2},{name:"3小时",value:3},{name:"4小时",value:4},{name:"5小时",value:5},{name:"6小时",value:6},{name:"7小时",value:7},{name:"8小时",value:8},{name:"9小时",value:9},{name:"10小时",value:10},{name:"11小时",value:11},{name:"12小时",value:12},{name:"13小时",value:13},{name:"14小时",value:14},{name:"15小时",value:15},{name:"16小时",value:16},{name:"17小时",value:17},{name:"18小时",value:18},{name:"19小时",value:19},{name:"20小时",value:20},{name:"21小时",value:21},{name:"22小时",value:22},{name:"23小时",value:23}],n.a.startHourList=[{name:"00",value:0},{name:"01",value:1},{name:"02",value:2},{name:"03",value:3},{name:"04",value:4},{name:"05",value:5},{name:"06",value:6},{name:"07",value:7},{name:"08",value:8},{name:"09",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12},{name:"13",value:13},{name:"14",value:14},{name:"15",value:15},{name:"16",value:16},{name:"17",value:17},{name:"18",value:18},{name:"19",value:19},{name:"20",value:20},{name:"21",value:21},{name:"22",value:22},{name:"23",value:23}],n.a.startMinuteList=[{name:"00",value:0},{name:"01",value:1},{name:"02",value:2},{name:"03",value:3},{name:"04",value:4},{name:"05",value:5},{name:"06",value:6},{name:"07",value:7},{name:"08",value:8},{name:"09",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12},{name:"13",value:13},{name:"14",value:14},{name:"15",value:15},{name:"16",value:16},{name:"17",value:17},{name:"18",value:18},{name:"19",value:19},{name:"20",value:20},{name:"21",value:21},{name:"22",value:22},{name:"23",value:23},{name:"24",value:24},{name:"25",value:25},{name:"26",value:26},{name:"27",value:27},{name:"28",value:28},{name:"29",value:29},{name:"30",value:30},{name:"31",value:31},{name:"32",value:32},{name:"33",value:33},{name:"34",value:34},{name:"35",value:35},{name:"36",value:36},{name:"37",value:37},{name:"38",value:38},{name:"39",value:39},{name:"40",value:40},{name:"41",value:41},{name:"42",value:42},{name:"43",value:43},{name:"44",value:44},{name:"45",value:45},{name:"46",value:46},{name:"47",value:47},{name:"48",value:48},{name:"49",value:49},{name:"50",value:50},{name:"51",value:51},{name:"52",value:52},{name:"53",value:53},{name:"54",value:54},{name:"55",value:55},{name:"56",value:56},{name:"57",value:57},{name:"58",value:58},{name:"59",value:59}],n.ok=function(){n.loading||(n.loading=!0,n.updateStartEffectTime(),n.cronConfig.startEffectTime=moment(n.cronConfig.startEffectTime).toISOString(),n.cronConfig.endEffectTime=moment(n.cronConfig.endEffectTime).toISOString(),n.cronConfig,a.setCronConfig(n.cronConfig),i.doSave().then(function(t){s.startCron(e,angular.copy(n.cronConfig)).then(function(e){C.close(),c.pop("success","定时任务提交成功"),r.go("app.exp.cron")},function(e){c.pop("error","定时任务提交失败, "+e.msg)})},function(e){c.pop("error","定时任务提交失败, 网络错误")}).finally(function(){n.loading=!1}))},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0})}],size:"md"})},i.exportComponent=function(e,t){const o=function(e){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","appDataStoreService",function(o,n){o.alertTitle="导出组件",o.alertIcon="iconfont iconxunwen text-primary",o.alertBody='组件 "'+t+'"已导出至云端，是否需要下载到本地?',o.confirmTitle="下载",n.url(e).then(function(e){o.download=e.data}),o.cancel=function(){C.close()},o.$on("modal.closing",function(e,t){C=void 0})}],size:"sm",appendTo:""})};d.export(e).then(function(e){y.fetchJob({title:"正在导出",type:"export"},e.job.id,d.getJob,o)},function(e){v.pop("error","导出失败")})},i.importComponent=function(e,t,o){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/import.html",controller:["$scope","$rootScope","common","toaster","componentService","$stateParams","$state",function(n,r,i,a,s,c,p){n.importTitle="导入组件",n.importNameLabel="组件名称",n.importPath=i.getImportPath(appConfig.userId),n.imported={name:t||"未命名组件",componentId:e||"",dataPath:""},e&&(n.warn={message:"导入后将覆盖现有组件"}),n.onFileUpload=function(e){n.imported.dataPath=e};n.ok=function(){n.imported.loading||(n.imported.loading=!0,s.import(n.imported.name,n.imported.componentId,o,n.imported.dataPath).then(function(t){y.fetchJob({title:"正在导入",type:"import",asyncable:!0},t.job.id,s.getJob).then(function(t){!function(t){s.switch(t.compId,t.importFolderName).then(function(t){t.success&&(a.pop("success","导入组件成功"),y.fetchJob({title:"切换数据",type:"switch"},t.job.id,s.getJob,function(){e?e==c.componentId&&p.go("app.customize",{componentId:e,refresh:c.refresh+1}):r.$broadcast("node.list.reload")}),C.close())})}(t)},function(e){a.pop("error","导入失败：",e.msg)})},function(e){a.pop("error","导入组件失败")}).finally(function(){n.imported.loading=!1}))},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.createComponent=function(e,t){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/create.html",controller:["$scope","$state","$rootScope","toaster","componentService","USER_CONFIG","COMPONENT_TYPES",function(o,n,r,i,a,s,c){o.createTitle="创建组件",o.createNameTitle="组件名称",o.created={name:"未命名组件",dir:e||s.myDirId,type:t},o.componentTypes=c.filter(e=>e.visible),"customize"==t&&(o.created.type=_.get(r.currentApp,"appType")||"algo"),"predict"==o.created.type&&(o.created.type="service"),o.ok=function(){o.createLoading||(o.createLoading=!0,a.create(o.created.name,o.created.dir,o.created.type).then(function(e){i.pop("success","组件 “"+o.created.name+"” 创建成功"),a.setPermission(e.id).then(function(t){n.go("app.customize",{componentId:e.id},{reload:!0})},function(t){n.go("app.customize",{componentId:e.id},{reload:!0})}),n.includes("app.customize")&&r.$broadcast("node.list.reload"),C.close()},function(e){i.pop("error","创建失败: "+e.msg)}).finally(function(){o.createLoading=!1}))},o.cancel=function(){C.close()},o.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.exportModel=function(e,t,o,n){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/export.html",controller:["$scope","$state","ossService","$rootScope","toaster","componentService","ccc",function(r,i,a,s,c,p,l){r.loading=!0,r.componentName="",r.componentNameDisabled=!1;let d="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+o+"/metadata";a.getObject(window.appConfig.oss.bucket,d,null,!0).then(function(e){let t=JSON.parse(l.d(e));p.get(parseInt(t.exportComponentId)).then(function(e){if(r.loading=!1,e.success){let o=e.componentInfo;r.componentName=o.name,r.componentNameDisabled=!0,r.componentModelVersion=t.exportModelVersion}},function(e){r.loading=!1,r.componentName=n+"_导出模型_"+moment().format("L")})},function(e){r.loading=!1,r.componentName=n+"_导出模型_"+moment().format("L")}),r.ok=function(){if(r.loading)return;r.loading=!0;let n=!_.isNumber(r.componentModelVersion);p.exportModel(e,t,o,r.componentName,n).then(function(e){r.loading=!1,c.pop("success","模型导出成功"),C.close(),s.$broadcast("node.list.reload")},function(e){r.loading=!1;const t=e.msg||e.message;c.pop("error","模型导出失败: "+t)})},r.cancel=function(){C.close()},r.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})};let I=null;i.openAppScriptEditor=function(e){I&&(I.close(),I=null),I=b.open({templateUrl:"/tpl/custom/popup/appScriptEditor.html",controller:["$scope","$stateParams","nodeService","toaster","scriptService",function(t,o,n,r,i){const a=n.getGraph();t.editorOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript"};let s=null;t.codeEditors={},t.$watch(function(){return i.getAppLogs(o.id)},function(e){t.scriptLog=e}),t.readOnly=e,t.handleSelectPort=function(e){const{id:o,nodeId:n,direction:r}=e,a=i.getScriptsByNode({node:n,port:o.split("-")[1]},r);s&&(t.currentNode=e,s.getDoc().setValue(a))},t.nodeTree=a.nodes.filter(({metadata:e})=>e.def.ports&&e.def.ports.length).map(({id:e,metadata:o})=>({id:e,label:o.label,expanded:!0,visible:!0,usable:!0,children:o.def.ports.map(({uuid:o,description:n,ioType:r})=>({id:`${e}-${o}`,label:`${o}(${_.get(n,"zh_CN","")})`,onSelect:t.handleSelectPort,nodeId:e,direction:r,usable:!0,visible:!0}))})),t.nodeTree.unshift({id:i.APP_GLOBAL_SCRIPT_NODEID,label:"全局",expanded:!0,visible:!0,children:[{id:`${i.APP_GLOBAL_SCRIPT_NODEID}-${i.APP_GLOBAL_SCRIPT_PORTID}`,label:"全局脚本",onSelect:t.handleSelectPort,nodeId:i.APP_GLOBAL_SCRIPT_NODEID,direction:i.APP_GLOBAL_SCRIPT_KEYWORD,visible:!0,usable:!0}]}),t.codemirrorLoaded=function(e){s=e,e.on("change",function(e){i.setScript(t.currentNode.nodeId,t.currentNode.id.split("-")[1],t.currentNode.direction,e.getValue())})},t.toggleScriptBlock=function(e){$(e.currentTarget).toggleClass("collasped")};const c=function(e){27===e.keyCode&&(t.scriptFullScreen=!1,$(document).off("keydown",c))};t.previewerOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript",readOnly:!0},t.packedScript="",t.codePreviewerLoaded=function(e){t.codePreviewer=e},t.handleToggleFullscreen=function(){t.scriptFullScreen=!t.scriptFullScreen,t.scriptFullScreen?(r.pop("info","按 Esc 键退出全屏编辑"),$(document).on("keydown",c)):$(document).off("keydown",c)},t.handlePreviewScripts=function(e){e.stopPropagation(),t.showCodePreviewer=!t.showCodePreviewer,setTimeout(function(){t.codePreviewer&&(t.packedScript=i.packScripts(a),t.codePreviewer.getDoc().setValue(t.packedScript),t.codePreviewer.execCommand("selectAll"),t.codePreviewer.execCommand("indentAuto"),t.codePreviewer.setCursor(0))},500)},t.handleSaveScripts=function(e){e.stopPropagation(),i.saveAppScripts()},t.handleShowLog=function(e){e.stopPropagation(),t.showLog=!t.showLog},t.cancel=function(){I.close()},t.$on("modal.closing",function(e,t){I=void 0})}],size:"lg",appendTo:"",backdrop:!1,keyboard:!1})},i.openEdgeScriptEditor=function({from:e,to:t,metadata:o,direction:n},r){C&&C.close(),(C=b.open({templateUrl:"/tpl/custom/popup/edgeScriptEditor.html",controller:["$scope","toaster","scriptService","$uibModalInstance","$stateParams",function(r,i,a,s,c){let p=null;r.editorOptions={lineWrapping:!0,lineNumbers:!1,theme:"material-darker",mode:"javascript",autofocus:!r.readOnly};const l=n===a.DIRECTION.IN?t:e,d=u.getNode(l.node);r.editorTitle=`<${d.metadata.label}>-<${l.port}>-<${a.getKeyword(n)}>`,r.script=a.getOldEdgeScripts(o.script)||a.getScriptsByNode(l,n),r.scriptFullScreen=!1,r.funcNames=a.getSupportedFunctions(),n===a.DIRECTION.IN?r.funcNames=r.funcNames.filter(e=>"afterLeave"!==e):r.funcNames=r.funcNames.filter(e=>"beforeEnter"!==e),r.$watch(function(){return a.getLogsByEdge(c.id,{from:e,to:t})},function(e){r.scriptLog=e}),r.codemirrorLoaded=function(e){p=e;const t=e.getDoc();setTimeout(function(){t.setValue(r.script)},500)};let f=null;const h=function(e){27===e.keyCode&&(r.scriptFullScreen=!1,$(document).off("keydown",h),f&&(f.appendChild(document.querySelector("ui-draggable-modal")),f=null))};r.handleToggleFullscreen=function(){r.scriptFullScreen=!r.scriptFullScreen;const e=document.querySelector("ui-draggable-modal");r.scriptFullScreen?(i.pop("info","按 Esc 键退出全屏编辑"),$(document).on("keydown",h),e&&(f=e.parentNode,document.body.appendChild(e))):($(document).off("keydown",h),f&&(f.appendChild(e),f=null))},r.handleAddFunction=function(e,t){e.preventDefault(),e.stopPropagation(),r.dropdownOpen=!1,r.script+=a.getFunctionBlock(t)},r.handleSaveScripts=function(e){a.saveEdgeScripts(l,n,p.getValue())},r.cancel=function(){s.close(!0)},r.$on("modal.closing",function(e,t){if($(".full-screen").remove(),!t)return e.preventDefault(),!1;C=void 0})}],size:"md",appendTo:"",backdrop:!1,windowClass:"edge-script-editor-modal-window",keyboard:!1})).rendered.then(function(){setTimeout(function(){const e=$(".edge-script-editor-log-content");e&&e[0].lastChild&&e.scrollTop(e[0].lastChild.offsetTop)},500)})},i.removeComponent=function(e,o,n){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","componentService",function(r,a){r.alertTitle="删除组件",r.alertIcon="iconfont iconjinggao text-danger",r.alertBody="删除组件 ‘"+e.label+"’ 吗？",r.moreLabel="删除同级目录的其他组件",r.selected={all:!1},r.siblings=_.filter(o,function(t){return t.id!=e.id&&!t.folder}),e.selected=!0,r.onChangeAll=function(){_.forEach(r.siblings,function(e){e.selected=r.selected.all})},r.ok=function(){if(!r.loading)if(r.loading=!0,_.isEmpty(o))a.del(e.id).then(function(t){v.pop("success","组件 "+e.label+" 已删除"),i.$broadcast("node.list.reload"),C.close()},function(t){v.pop("error","组件 "+e.label+" 删除失败")}).finally(function(){r.loading=!1});else{const o=_.filter(r.siblings,{selected:!0});o.unshift(e),a.removeList(o).then(function(o){const a=_.filter(o,{removed:!1}),s=_.filter(o,{removed:!0});if(v.pop("success","组件 "+_.map(s,"label").join("、")+" 已被删除"),_.isEmpty(a)||v.pop("error","组件 "+_.map(a,"label").join("、")+" 删除失败"),t.params.componentId==e.id){let e=_.filter(r.siblings,function(e){return!e.selected});_.isEmpty(e)||(n=e[0]),t.go("app.customize",{componentId:n.id},{reload:!0})}i.$broadcast("node.list.reload"),C.close()}).finally(function(){r.loading=!1})}},r.cancel=function(){e.selected=!1,C.close()},r.$on("modal.closing",function(e,t){C=void 0})}],size:"sm",appendTo:""})},i.shareComponent=function(e,t){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/share.html",controller:["$scope","toaster","componentService","$http",function(o,n,r,i){o.shareTitle="组件分享",o.shareNameTitle="组件名称",o.shareDescriptionTitle="组件描述",o.shareName=t,o.targetUser={id:"",username:""},o.userList=[],o.dropdownToggle=!1,o.activeType={name:"用户ID",value:"id"},o.userTypes=[{name:"用户ID",value:"id"},{name:"用户名",value:"username"}];const a=window.appConfig.loginHost+"/api/user/findByUsernameLike";let s,c;o.onClickUserListItem=function(e){o.targetUser=e,o.userList=[]},o.onClickType=function(e){o.dropdownToggle=!o.dropdownToggle,o.activeType=e},o.onChangeTargetUser=function(e){s=e.target.value.trim(),"username"==o.activeType.value?(c&&(clearTimeout(c),c=null),c=setTimeout(function(){i({method:"GET",url:a,params:{username:s}}).then(function(e){200===e.status&&(o.userList=_.get(e,"data.data"))},function(e){n.pop("warning",_.get(e,"data.message")+" 请选择“用户ID”输入"),o.activeType={name:"用户ID",value:"id"},o.targetUser={id:"",username:""}})},400)):o.targetUser.id=s},o.ok=function(){o.shareLoading||(o.shareLoading=!0,r.share(e,o.shareName,o.targetUser.id).then(function(e){C.close(),n.pop("success","分享成功")},function(e){n.pop("error","分享失败: "+e.msg)}).finally(function(){o.shareLoading=!1}))},o.cancel=function(){C.close()},o.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.node2component=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/node2component.html",controller:["$scope","$state","$stateParams","toaster","componentService",function(n,r,i,a,s){n.title="从节点创建组件",n.nameTitle="组件名称",n.name=t,n.ok=function(){if(n.loading)return;n.loading=!0;let t=i.type;"predict"===t&&(t="service"),s.create(n.name,void 0,t,o,e).then(function(e){C.close(),a.pop("success","创建成功"),s.setPermission(e.id).then(function(t){r.go("app.customize",{componentId:e.id},{reload:!0})},function(t){r.go("app.customize",{componentId:e.id},{reload:!0})})},function(e){a.pop("error","创建失败: "+e.msg)}).finally(function(){n.loading=!1})},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.duplicateComponent=function(e){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/duplicate.html",controller:["$scope","$rootScope","toaster","componentService","appDataStoreService","statisticsService",function(t,o,n,r,i,a){t.duplicateTitle="复制组件",t.duplicateNameTitle="组件名称",t.duplicateName=e.label,t.ok=function(){if(t.duplicateLoading)return;t.duplicateLoading=!0;let a=["studio",window.appConfig.userId,"component",e.id].join("/");i.sync(a,"upload").then(function(o){return r.duplicate(e.id,t.duplicateName)}).then(function(e){let t=["studio",window.appConfig.userId,"component",e.id].join("/");return i.sync(t,"download")}).then(function(e){C.close(),n.pop("success","复制成功"),o.$broadcast("node.list.reload")},function(e){n.pop("error","复制失败: "+e.msg)}).finally(function(){t.duplicateLoading=!1})},t.cancel=function(){C.close()},t.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.duplicateAppFromTemplate=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/duplateAppFromTemplate.html",controller:["$scope","$rootScope","toaster","appService","statisticsService",function(n,i,a,s,c){n.duplicateTitle="从模板创建项目",n.duplicateNameTitle="项目名称",n.duplicateName=t,n.duplicateDescriptionTitle="项目描述",n.duplicateDescription=o,n.ok=function(){n.duplicateLoading||(n.duplicateLoading=!0,s.duplicatePublic(e,n.duplicateName,n.duplicateDescription,"algo").then(function(e){let t=["studio",window.appConfig.userId,e.id].join("/");return r.sync(t,"download")}).then(function(e){C.close(),a.pop("success","创建成功"),i.$broadcast("app.list.reload",{})}).catch(function(e){a.pop("error","创建失败: "+e.msg)}).finally(function(){n.duplicateLoading=!1}))},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0})}],size:"md",appendTo:""})},i.changeParentDir=function(e){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/edit_dirs.html",controller:["$scope","$rootScope","componentService","common","toaster",function(t,o,n,r,i){t.modalTitle=(e.folder?"移动文件夹 ":"移动组件 ")+e.label+" 至";let a=e.folder?e.id:e.dir||2;t.my_treedata=o.userConfig.componentDirs;const s=r.getDirMap(t.userConfig.componentDirs),c=s[a];t.parentId=e.folder?c.parentId:e.dir||2,t.targetDir=null,t.onSelect=function(e){t.targetDir=e},t.ok=function(){if(e.folder){const n=_.remove(s[c.parentId].children,function(t){return t.id==e.id})[0];n.parentId=t.targetDir.id,s[t.targetDir.id].children.push(n),o.saveConfig().then(function(e){o.$broadcast("node.list.reload"),i.pop("success","移动文件夹成功")},function(e){i.pop("error","移动文件夹失败, 网络错误")}).finally(function(){C.close()})}else n.changeDir(e.id,t.targetDir.id).then(function(e){o.$broadcast("node.list.reload"),i.pop("success","移动组件成功")},function(e){i.pop("error","移动组件失败: "+e.msg)}).finally(function(){C.close()})},t.cancel=function(){C.close()},t.$on("modal.closing",function(e,t){C=void 0})}]})},i.showChart=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/chart.html",controller:["$scope","appDataStoreService",function(n,r){n.popupTitle="分析报告",n.popupLoading=!1;let i=["studio",window.appConfig.userId,e,t,o,"visual","part-00000"].join("/");r.url(i).then(function(e){e.success&&(n.chartUrl="/visual_iframe?data="+encodeURIComponent(e.data))}),n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0}),n.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showColumn=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/column.html",controller:["$scope","tableService","nodeService",function(n,r,i){n.popupTitle="字段选择",n.popupHasFooter=!0,n.popupLoading=!0;let a,s,c=function(e){n.popupLoading=!1,n.popupNotice=e},p=i.getNode(t);for(let e in p.metadata.def.params){let t=p.metadata.def.params[e];if(t.controlInstUuid===o){a=t;break}}_.isEmpty(a.value)||(s=_.map(a.value.split(","),function(e){return e})),r.getUpstreamTableName(e,t,o).then(function(e){let t=e.propertyName,o=e.value;t&&o?r.getTableMeta(o,t).then(function(e){n.popupLoading=!1;let o=e,r=0;if(o){if("tableName"==t&&(o=e.data.tableColumns,!_.isEmpty(s)))for(let e=0;e<o.length;e++){let t=_.indexOf(s,o[e].name)>-1;t&&r++,o[e].selected=t}if("dataName"==t&&(o=_.map(o,function(e){let t=_.indexOf(s,e)>-1;return t&&r++,{name:e,selected:t}})),n.tableColumnArr=o,n.totalSelectedNum=r,n.tableColumnObj={},n.tableColumnNumObj={},"dataName"==t&&(n.tableColumnObj.string=n.tableColumnArr,n.tableColumnNumObj.string=r),"tableName"==t)for(let e=0;e<o.length;e++){let t=o[e],r=t.type.toLowerCase();n.tableColumnObj[r]||(n.tableColumnObj[r]=[],n.tableColumnNumObj[r]=0),n.tableColumnObj[r].push(t),t.selected&&(n.tableColumnNumObj[r]+=1)}n.toggleColType=function(e,t){let o=n.tableColumnObj[t];if(e){for(let e=0;e<o.length;e++)o[e].selected=!1;n.tableColumnNumObj[t]=0,n.totalSelectedNum-=o.length}else{for(let e=0;e<o.length;e++)o[e].selected=!0;n.tableColumnNumObj[t]=o.length,n.totalSelectedNum+=o.length}},n.toggleSelectAll=function(e){if(e){for(let e in n.tableColumnObj)_.forEach(n.tableColumnObj[e],function(e){e.selected=!1}),n.tableColumnNumObj[e]=0;n.totalSelectedNum=0}else{for(let e in n.tableColumnObj)_.forEach(n.tableColumnObj[e],function(e){e.selected=!0}),n.tableColumnNumObj[e]=n.tableColumnObj[e].length;n.totalSelectedNum=o.length}},n.popupConfirm=function(){let e=[];for(let t=0;t<o.length;t++)o[t].selected&&e.push(o[t].name);a.value=e.join(","),n.ok()}}else c("未获取到数据")},function(e){console.error(e),c("未获取到数据")}):c("未获取到数据")},function(e){_.isString(e)?c(e):c("未获取到数据")}),n.ok=function(){C.close()},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0}),n.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showTable=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/table.html",controller:["$scope","tableService",function(n,r){n.popupTitle="数据探查",n.popupLoading=!0,n.popupHasFooter=!0,n.isTable=!0,n.tableColumnWidth=68,n.widthUp=function(){n.tableColumnWidth>=200||(n.tableColumnWidth+=5)},n.widthDown=function(){n.tableColumnWidth<=68||(n.tableColumnWidth-=5)},n.tableDownload=function(){let r="";n.tableSchema.forEach(function(e){r+=e.name+","}),r+="\n";for(let e=0;e<n.tableData.length;e++){for(let t in n.tableData[e])if(t>0){let o=n.tableData[e][t].toString(),i=_.replace(o,/\"/g,'""');r+=(i='"'+i+'"')+"\t,"}r+="\n"}let i="data:text/csv;charset=utf-8,"+encodeURIComponent(r),a=document.createElement("a");a.href=i,a.download=e+"-"+t+"-"+o+".csv",document.body.appendChild(a),a.click(),document.body.removeChild(a)},r.getNodeTableName(e,t,o).then(function(e){r.getTableMeta(e.value,e.propertyName).then(function(e){n.popupLoading=!1,n.tableData=e.data.table_data.data,n.tableSchema=e.data.table_data.schema.map(function(e){return{name:e,exp_w:0}}),n.exp_w=0;for(let e=0;e<n.tableData.length;e++)n.tableData[e].unshift(e);n.order=function(e,t){n.sortIndex=e,n.sortType=t,"asc"===t?n.tableData.sort(function(t,o){return parseFloat(t[e])-parseFloat(o[e])}):n.tableData.sort(function(t,o){return parseFloat(o[e])-parseFloat(t[e])})};let t=!1,o={};n.changeWidthStart=function(e,r){t=!0,o.index=r,o.start=e.pageX-n.tableSchema[o.index].exp_w},n.changeWidth=function(e){if(t){let t=e.pageX-o.start;t>=0&&(n.tableSchema[o.index].exp_w=t,n.exp_w=n.tableSchema.map(function(e){return e.exp_w}).reduce(function(e,t,o,n){return e+t}))}},n.changeWidthEnd=function(e){t=!1,o={}}},function(e){n.popupLoading=!1,n.popupNotice="未获取到数据"})},function(e){n.popupLoading=!1,n.popupNotice="未获取到数据表"}),n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0}),n.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showRapidminer=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/rapidminer.html",controller:["$scope","$q",function(n,i){let a;n.popupTitle="数据质量分析",n.popupLoading=!0,n.popupHasFooter=!0,n.isTable=!0,n.tableColumnWidth=150;let s="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+o+"/data/data.json",c="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+o+"/data/data.csv";i.all([r.get(c),r.get(s)]).then(function(e){n.popupLoading=!1,n.exp_w=0;let t=_.compact(e[0].split("\n")),o=t.length,r=e[1];try{r=JSON.parse(e[1])}catch(e){}n.csv_title=o?t[0].split(",").map(function(e){let t=e.trim(),o=r.columnDetail[t];if(o){let e=o.valueCounts;delete o.valueCounts;let n=r.numericSummary[t];return{name:t,detail:o,menuOption:[{text:"详情",click:function(r){!function(e,t,o,n){a=b.open({animation:!0,templateUrl:"/tpl/custom/popup/rapidminer_detail.html",controller:["$scope",function(r){r.popupTitle=e,r.popupLoading=!1,r.popupHasFooter=!0,r.columnDetail=t,r.barData=o,r.numericSummary=n,r.cancel=function(){a.close()},r.$on("modal.closing",function(e,t){a=void 0}),r.$on("$destroy",function(){})}],size:"md",appendTo:""})}(t,o,e,n)}}]}}return{name:t,detail:o}}):[],n.csv_data=o?t.slice(1).map(function(e){return e.split(",")}):[],n.csv_len=n.csv_title.length},function(e){n.popupLoading=!1,n.popupNotice="未获取到数据表"}),n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0}),n.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showFormulaEidtor=function(e){C=b.open({backdrop:"static",animation:!0,templateUrl:"/tpl/custom/popup/formulaEditor.html",controller:["$scope","$stateParams","nodeService",function(t,o,n){t.popupTitle="编辑公式",t.inputAttr="输出1",t.popupHasFooter=!0,t.popupLoading=!1;let r=n.getNode(o.nodeId);const i=function(e){let t=_.cloneDeep(e);switch(t.typeLabel=t.type,t.labelClass="",e.type.toUpperCase()){case"STRING":t.typeLabel="文本",t.labelClass="string-label";break;case"ARRAY":t.typeLabel="数组",t.labelClass="array-label";break;case"NUMBER":t.typeLabel="数字",t.labelClass="number-label";break;case"DATE":t.typeLabel="时间戳",t.labelClass="time-label";break;case"JSON":t.typeLabel="JSON",t.labelClass="json-label"}return t};let a=_.get(r,"metadata.def.ports"),s=[];a.forEach(e=>{if("in"===e.ioType){let t=_.get(e,"description.zh_CN","");const o={id:e.uuid,name:t,type:e.subType||""},n=i(o);s.push(n)}}),t.currFieldList=s,t.editorOptions={placeholder:"请在此输入公式...",matchBrackets:!0,autoCloseBrackets:!0,indentUnit:0,smartIndent:!1,lineWrapping:!0,autofocus:!0};let c=function(e){const t=_.get(r,"metadata.def.params"),o=Object.keys(t);let n="";return o.forEach(o=>{t[o].controlInstUuid&&t[o].controlInstUuid===e&&(n=t[o])}),n}(e);c&&(c=i(c)),t.initFormular=c,t.codemirrorLoaded=function(e){t._editor=e;let o=e.getDoc();setTimeout(()=>{const e=t.initFormular.value;e&&""!==e&&o.replaceRange(e,{line:0,char:0},void 0,"setInitValue")},0);e.setOption("hintOptions",{hint:function(){const t=e,o=e.constructor,n=t.getCursor(),r=t.getLine(n.line),i=n.ch,a=i,s=["AND","IF","OR"],c=r.split("");let p=i;for(let e=i-1;e>=0&&/\w/.test(c[e]);e-=1)p=e;let l="";p<i&&(l=r.slice(p,i));const d=[];""!==l&&function(e,t){e.forEach(e=>{t&&0===e.lastIndexOf(t.toUpperCase(),0)&&d.push(e)})}(s,l);const u=l.split("").length;return{list:d,from:o.Pos(n.line,a-u),to:o.Pos(n.line,i)}},completeSingle:!1});e.on("change",function(t,n){if(t.closeHint(),n.origin)if("setInitValue"===n.origin){e.focus(),n.text.forEach((e,o)=>{s.forEach(n=>{(function(e,t){let o=[],n=e.indexOf(t);for(;n>-1;)o.push(n),n=e.indexOf(t,n+1);return o})(e,n.id).forEach(e=>{const r={line:o,ch:e},i=n.id.length,a={line:o,ch:e+i},s=document.createElement("span");s.innerHTML=n.name,s.className="cm-field-name",t.markText(r,a,{selectRight:!0,atomic:!0,replacedWith:s})})})})}else if(/custom_add-field-/.test(n.origin)){const e=n.origin.replace("custom_add-field-",""),o={line:n.from.line,ch:n.from.ch},r=n.text[0].split("").length,i={line:n.from.line,ch:n.from.ch+r},a=document.createElement("span");a.innerHTML=e,a.className="cm-field-name",t.markText(o,i,{selectRight:!0,atomic:!0,replacedWith:a})}else if("complete"===n.origin){let e=o.getCursor();o.replaceRange("()",e,void 0,"custom_add-formular");const t={line:e.line,ch:e.ch+1};o.setCursor(t)}else/custom_add-formular/.test(n.origin)||t.showHint()}),e.constructor.defineSimpleMode("simplemode",{start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/IF|AND|OR/,token:"keyword"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\/(?:[^\\]|\\.)*?\//,token:"variable-3"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/[a-zA-Z$][\w$]*/,token:"variable"}]}),e.setOption("mode","simplemode")},t.operatorList=[{name:"函数分隔符",label:"."},{name:"参数引号",label:'""'},{name:"加",label:"+"},{name:"减",label:"-"},{name:"乘",label:"*"},{name:"除",label:"/"},{name:"大于",label:">"},{name:"小于",label:"<"},{name:"等于",label:"=="},{name:"不等于",label:"!="},{name:"大于等于",label:">="},{name:"小于等于",label:"<="}],t.handleClickAddOperator=function(e){if(t._editor){let o=t._editor.getDoc(),n=o.getCursor();o.replaceRange(e.label,n,void 0,"custom_add-operator");let r=e.label.split("").length;"参数引号"===e.name&&(r=1);const i={line:n.line,ch:n.ch+r};t._editor.focus(),o.setCursor(i)}},t.formularList=[{label:"常用函数",expand:!0,children:[{label:"IF",format:"IF(A,B,C)",description:"表示如果满足条件A，那么返回B，否则返回C"},{label:"SWITCH",format:"SWITCH(逻辑表达式1, A, 逻辑表达式2, B, ..., OTHERS, N)",description:"表示如果满足逻辑表达式1，那么返回A；如果满足逻辑表达式2, 那么返回B；...同上；否则返回N。"},{label:"ARRAY",format:"ARRAY(A,B,C)",description:"返回[A,B,C]"},{label:"DICT",format:"DICT(A)",description:"返回[A,B,C]"},{label:"JSON",format:"JSON(A,B,C)",description:""},{label:"DF",format:"DF(A,B,C)",description:""},{label:"JSON2DF",format:"JSON2DF(A)",description:""},{label:"DF2ECHARTS",format:"DF2ECHARTS(A)",description:""},{label:"CHAIN",format:"CHAIN(A,B,C)",description:""},{label:"ZIP",format:"ZIP(A,B,C)",description:""}]},{label:"逻辑函数",expand:!0,children:[{label:"AND",format:"AND(逻辑表达式1,逻辑表达式2,...)",description:"如果所有参数都为真，AND函数返回布尔值true，否则返回布尔值 false"},{label:"OR",format:"OR(逻辑表达式1,逻辑表达式2,...)",description:"如果任意参数为真，OR 函数返回布尔值true；如果所有参数为假，返回布尔值false。"}]},{label:"数学函数",expand:!0,children:[{label:"MAX",format:"MAX(变量1,变量2,...)",description:"如果所有参数都为数字，MAX 函数返回最大值。"},{label:"MIN",format:"MIN(变量1,变量2,...)",description:"如果任意参数为数字，MIN 函数返回最小值。"},{label:"SUM",format:"SUM(变量1,变量2,...)",description:"SUM 函数返回所有值的和。"},{label:"LEN",format:"LEN(变量)",description:"LEN 函数返回变量的长度。"}]}],t.handleClickTreeLabel=function(e){t.formularList[e].expand=!t.formularList[e].expand},t.selecFormular={format:"",description:""},t.handleTreeSelect=function(e){if(t._editor){let o=t._editor.getDoc(),n=o.getCursor(),r=`${e.label}()`,i={line:n.line,ch:n.ch+e.label.split("").length+1};o.replaceRange(r,n,void 0,"custom_add-formular"),t._editor.focus(),o.setCursor(i)}},t.handleTreeHover=function(e){t.selecFormular=e},t.handleClickAddField=function(e){if(t._editor){let o=t._editor.getDoc(),n=o.getCursor();o.replaceRange(e.id,n,void 0,`custom_add-field-${e.name}`);const r={line:n.line,ch:n.ch+e.id.split("").length};t._editor.focus(),o.setCursor(r)}},t.ok=function(){let o=t._editor.getValue();!function(e,t){const o=_.cloneDeep(r.metadata.def.params);Object.keys(o).forEach(n=>{o[n].controlInstUuid&&o[n].controlInstUuid===e&&(r.metadata.def.params[n].value=t)})}(e,o),C.close()},t.cancel=function(){C.close()},t.$on("modal.closing",function(e,t){C=void 0}),t.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.showFiles=function(e,t,o){C=b.open({animation:!0,templateUrl:"/tpl/custom/popup/files.html",controller:["$scope","$rootScope","$stateParams","downloadFile","appService","appDataStoreService","common","format",function(n,r,i,a,s,c,p,l){let d,f;n.popupTitle=t?"选择文件":"查看文件",n.popupLoading=!0,n.popupHasFooter=!0,n.NextMarker=void 0,n.maxKeys=40,n.checkAll=!1,n.filesRemovable=!1,n.removing=!1,n.fileSelect=!_.isEmpty(t);const h={},m={"{{userId}}":r.appConfig.userId,"{{appId}}":i.id,"{{nodeId}}":i.nodeId},g=function(e){return new Promise(function(t,o){if(f=e,!_.isEmpty(h[f]))return n.filesRemovable=!1,n.data=_.forEach(h[f].prefixes.concat(h[f].catalog),function(e){e.checked=!1}),n.total=n.data.length,n.popupLoading=!1,void t(null);n.popupLoading=!0,s.getContents(e).then(function(e){if(n.popupLoading=!1,n.data=[],n.total=0,_.isEmpty(e.catalog)&&_.isEmpty(e.prefixes))n.popupNotice="暂无数据";else{let t=e.prefixes.concat(e.catalog);n.total=t.length}t(e)},function(e){n.popupLoading=!1,n.popupNotice="未获取到数据表"})})};let v,y,w;if(t){const e=u.getNode(i.nodeId);_.forEach(e.metadata.def.params,function(e){_.get(e,"controlInstUuid")===t&&(v=e),_.has(e,"fileType")&&(y=e)}),w=v.value&&_.map(v.value.split(","),function(e){return l(e,m)})}if(d=e||(y?_.get(y,"value"):p.getUploadNodeDataPath(o||"out1")),f=l(d,m),_.isEmpty(f))n.popupLoading=!1,n.popupNotice="未获取到数据";else{let e=f;n.loaded=!1,n.loading=!1,n.data=[],n.fetchMore=function(){n.loading||n.loaded||(n.loading=!0,s.getContents(f,n.NextMarker,n.maxKeys,n.checkAll).then(function(e){e.NextMarker||(n.loaded=!0),_.isEmpty(w)||_.forEach(e.catalog,function(e){e.checked=w.indexOf(e.id)>-1});let t=e.prefixes.concat(e.catalog);_.isEmpty(h[f])&&(h[f]={prefixes:[],catalog:[]});let o=h[f];h[f]={prefixes:o.prefixes.concat(e.prefixes),catalog:o.catalog.concat(e.catalog)},n.data=n.data.concat(t),n.NextMarker=e.NextMarker}).finally(function(){n.loading=!1}))},g(f).then(function(t){n.filesBreadcrumbs[0].id=e,n.filesBreadcrumbs[0].prefixes=_.get(t,"prefixes.length",0),n.filesBreadcrumbs[0].catalog=_.get(t,"catalog.length",0),n.fetchMore()})}n.filesBreadcrumbs=[{id:0,label:"全部文件夹"}],n.getFileIcon=function(e){switch(e){case"png":case"gif":case"jpg":case"jpeg":case"bmp":return"icon-file-image";case"folder":return"icon-folder";case"txt":return"icon-file-text";case"json":return"icon-code";case"pdf":return"icon-file-pdf";case"xls":case"xlsx":return"icon-file-excel";default:return"icon-file"}};n.onFileItem=function(e){let t=function(e){let t;return n.data.forEach(function(o){e===o.id&&(t=o)}),t}(e);if(t.isFolder)n.checkAll=!1,n.filesRemovable=!1,n.active=null,n.fileChecked=!1,_.isEmpty(h[e])?g(e).then(function(e){n.filesBreadcrumbs.push({id:t.id,label:t.label,prefixes:e.prefixes.length,catalog:e.catalog.length}),n.loaded=!1,n.fetchMore()}):(n.data=_.forEach(h[e].prefixes.concat(h[e].catalog),function(e){e.checked=!1}),n.total=n.data.length,n.filesBreadcrumbs.push({id:t.id,label:t.label,prefixes:h[e].prefixes.length,catalog:h[e].catalog.length}));else{n.isFetching=!0,n.active=e,n.fileChecked=!0,n.fileActive={alt:t.label},c.url(e).then(function(e){e.success&&(n.fileActive.src=e.data)});let o=["png","gif","jpg","jpeg","bmp"];c.head(e).then(function(r){0==r.ContentType.indexOf("image")||o.indexOf(t.type)>-1?(n.fileActive.type="image",n.isFetching=!1):0==r.ContentType.indexOf("text")||"application/json"==r.ContentType||"json"==t.type||"csv"==t.type?(n.fileActive.type=t.type,0==r.ContentLength?(n.isFetching=!1,n.fileActive.info="该文件为空"):!r.ContentLength||_.toNumber(r.ContentLength)<=5242880?c.get(e).then(function(e){if(n.isFetching=!1,"application/json"==r.ContentType||"json"==n.fileActive.type){let t=e;try{t=JSON.parse(e)}catch(e){}n.fileActive.body=JSON.stringify(t,null,2)}else if("csv"==t.type){let t=",";-1==e.indexOf(",")&&(t=" ");const o=_.map(_.slice(_.compact(e.split(/\r\n|\n/)),0,101),function(e){return _.split(e,t)});n.fileActive.body=o}else n.fileActive.body=e},function(e){n.isFetching=!1}):(n.isFetching=!1,n.fileActive.info="文件超过5M不支持预览")):(n.isFetching=!1,n.fileActive.info="暂不支持该文件查看")},function(e){})}},n.onFileCheckAll=function(e){n.checkAll=e.target.checked,n.filesRemovable=n.checkAll,_.forEach(n.data,function(e){e.checked=n.checkAll})},n.onFileChecked=function(e,t){e.stopPropagation();let o=_.find(n.data,{id:t});o.checked=!o.checked,n.filesRemovable=_.findIndex(n.data,{checked:!0})>-1};let x=!1;n.onCancelRemoveHandler=function(){x=!0};let S=function(e,t){let o=_.slice(n.filesBreadcrumbs,-1)[0],r=e.length,i=0,a=function(s){let p=s.id,l=s.isFolder;c.remove(p).then(function(s){if(i++,_.remove(n.data,{id:p}),n.total-=1,h[p]&&delete h[p],l?(o.prefixes-=1,_.has(h[o.id],"prefixes")&&_.remove(h[o.id].prefixes,{id:p})):(o.catalog-=1,_.has(h[o.id],"catalog")&&_.remove(h[o.id].catalog,{id:p})),x)return n.removing=!1,void(n.filesRemovable=!0);if(i<r)a(e[i]);else{let e=t?null:_.filter(n.data,"checked");if(n.checkAll&&!_.isEmpty(e))S(e);else if(t||(n.checkAll=!1,n.removing=!1),!n.total&&n.filesBreadcrumbs.length>1){let e=n.filesBreadcrumbs.slice(-2),t=e[1].id,o=e[0].id;"local"==window.appConfig.appDataStoreType&&c.remove(t.slice(0,-1)),n.filesBreadcrumbs[n.filesBreadcrumbs.length-2].prefixes-=1,delete h[t],_.remove(h[o].prefixes,{id:t}),n.onFilesBreadcrumbsBack()}}})};a(e[i])};n.onRemoveFiles=function(e,t,o){e.stopPropagation(),b.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","$uibModalInstance",function(e,n){e.alertTitle="删除",e.alertIcon="iconfont iconjinggao text-danger",e.alertBody=t&&o?'是否删除文件 "'+o+'"？':"是否删除已选中的文件或文件夹？",e.ok=function(){n.close(!0)},e.cancel=function(){n.dismiss("cancel")}}],size:"sm"}).result.then(function(e){let o=null;t?o=_.filter(n.data,{id:t}):(n.filesRemovable=!1,n.removing=!0,x=!1,o=_.filter(n.data,"checked")),S(o,t)},function(e){})},n.onFilesDownload=function(e,t,o){e.stopPropagation(),t&&o&&a.download(t,o)},n.onFilesBreadcrumbs=function(e){if(n.checkAll=!1,n.active=null,n.fileChecked=!1,null!=e){let t=_.findIndex(n.filesBreadcrumbs,{id:e});n.filesBreadcrumbs=n.filesBreadcrumbs.slice(0,t+1),n.data=_.forEach(h[e].prefixes.concat(h[e].catalog),function(e){e.checked=!1}),n.total=n.data.length}},n.onFilesBreadcrumbsBack=function(){n.checkAll=!1,n.active=null,n.fileChecked=!1,n.filesBreadcrumbs.pop();let e=n.filesBreadcrumbs.slice(-1)[0].id;n.data=_.forEach(h[e].prefixes.concat(h[e].catalog),function(e){e.checked=!1}),n.total=n.data.length},n.onClickImage=function(e){r.fullScreenImage.onShowScreenImage(e,n.fileActive.src)};n.onFileNext=function(e,t){if(!(e===(n.data[0].id&&"38"===t)||e===n.data[n.data.length-1].id&&"40"===t||"40"!=t&&"38"!=t)){let o=function(e,t){let o;for(let r=0;r<n.data.length;r++)n.data[r].id==e&&(38==t&&(o=n.data[r-1].id),40==t&&(o=n.data[r+1].id));return o}(e,t);n.onFileItem(o)}},n.ok=function(){let e=_.filter(n.data,function(e){return!e.isFolder&&e.checked});e=_.map(e,function(e){return e.id}).join(","),v.value=e,u.changeNode(i.nodeId),C.close()},n.cancel=function(){C.close()},n.$on("modal.closing",function(e,t){C=void 0}),n.$on("$destroy",function(){})}],size:"lg",appendTo:""})},i.onAsideToggle=function(e){let t;if("predict"===i.currentApp.type&&i.currentApp.dashboard){if(t=angular.element(".front-panel"),"right"==e){const e=angular.element(".sp-toggle");e.hasClass("right-hidden")?e.removeClass("right-hidden"):e.addClass("right-hidden")}n(function(){i.$broadcast("canvasresizer.update")},300)}else t=angular.element("#edit");t.hasClass(e+"-hidden")?t.removeClass(e+"-hidden"):t.addClass(e+"-hidden"),u.resetCanvas()},e.togglePredictDashboard=function(t){e.currentApp.screenshot.loading||(t?i.$broadcast("predict.predict",t):i.$broadcast("predict.dashboard",t))},window.addEventListener("keyup",function(t){if("Digit1"===t.code&&t.altKey&&"predict"===i.currentApp.type)e.togglePredictDashboard(!i.currentApp.dashboard);else if(("Digit2"===t.code||"Digit3"===t.code)&&t.altKey){var o="";"Digit2"===t.code&&(o="left"),"Digit3"===t.code&&(o="right"),o&&i.onAsideToggle(o)}e.$apply()});const E={lastSaved:"上次修改是在",saved:"最近保存 ",success:"保存成功"},N=function(e,t){const o=moment();let n;switch(e){case"lastSaved":return n=moment(t).diff(o,"days")<-30?moment(t).format("YYYY年MM月DD日"):moment(t).diff(o,"hours")+o.hours()<0?moment(t).format("MM月DD日"):moment(t).fromNow(),E[e]+n+"进行的";case"saved":return n=moment(t).format("HH:mm"),E[e]+n;default:return E[e]}};let T;i.$on("app-saved",function(e,t){i.saveStatus=t,t&&(i.saveStatus.msg=N(t.status,t.timestamp),T&&(n.cancel(T),T=null),"success"==t.status&&(T=n(function(){i.saveStatus.status="saved",i.saveStatus.msg=N(t.status,t.timestamp)},2e3)))}),i.iconList={icons:w,images:null},i.getImages=function(){const t=o.componentId?"studio/{{userId}}/component/{{componentId}}/icons/":"studio/{{userId}}/{{appId}}/icons/",n=x(t);appService.getContents(n).then(function(t){const o=[],n=t.catalog.length;let i=0;const a=function(s){r.url(s.id).then(function(e){o.push({key:s.id,url:e.data})}).finally(function(){++i<n?a(t.catalog[i]):e.iconList.images=o})};n&&a(t.catalog[i])})},i.getImages(),p.onStart({},function(e){C&&(C.close(),C=void 0)}),t.defaultErrorHandler(function(e,t,o){}),e.$on("$destroy",function(){i.fullScreenImage=void 0,T&&(n.cancel(T),T=void 0)})}]}}})}]).run(["$rootScope","toaster","app","$transitions",function(e,t,o,n){o.toaster=t,window.onbeforeunload=function(){},n.onSuccess({},function(t){e.previousState=t.from().name,e.currentState=t.to().name})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize",{url:"/component/:componentId",params:{refresh:0},resolve:{compInfo:["componentService","$stateParams","pageLoading","$q","$state","toaster",function(e,t,o,n,r,i){let a=n.defer();return t.componentId?e.getPermission(t.componentId).then(function(n){!n||"read"!==n.result||r.transition.to().$$state().includes["app.customize.read"]?!n||"write"!==n.result||r.transition.to().$$state().includes["app.customize.edit"]?e.get(t.componentId).then(function(e){a.resolve(e.componentInfo),o.show()},function(e){i.pop("warning","获取组件信息失败: "+e.msg),r.go("app.customize",{componentId:"",refresh:t.refresh+1})}):r.go("app.customize.edit",{componentId:t.componentId,refresh:t.refresh+1}):r.go("app.customize.read",{componentId:t.componentId,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg),r.go("app.customize",{componentId:"",refresh:t.refresh+1})}):e.list(null,1).then(function(o){o.list&&o.list.length>0?r.go("app.customize",{componentId:o.list[0].id,refresh:t.refresh+1}):e.create("未命名组件",void 0).then(function(e){r.go("app.customize",{componentId:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}),a.promise}]},deepStateRedirect:{default:"app.customize.read",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","pageLoading","nodeService","compInfo","$rootScope","$timeout","common",function(e,t,o,n,r,i,a,s,c){a.getImages();let p=$("#editor");r.init(p,null,function(){a.pageLoading=!1,n.hide()}),i.data||console.error("no data"),"string"==typeof i.data&&(i.data=JSON.parse(i.data)),a.$broadcast("toggle.customize",{id:i.id,dir:i.dir}),a.nodeId=r.addCustomNode(i.name,i.data),a.compInfo=angular.copy(i),delete a.compInfo.data,a.node=r.getNode(a.nodeId),a.controlList=[],a.paramsModel=r.getParamsModel(i.data.def.params);const l=a.$on("ngRepeatFinished",function(){const e=document.getElementById(i.id.toString());if(!e)return;const t=angular.element(e).offset().top,o=angular.element(".navi");(t<o.offset().top||t>o.height()+o.offset().top)&&o.scrollTop(e.offsetTop-o.height()/2)});a.change=function(t){e.controlList=[];let o={},n=function(){for(let t in e.paramsModel.port){let n=e.paramsModel.port[t];for(let e in n)o[n[e]]?(n.error_duplicate||(n.error_duplicate={}),n.error_duplicate[e]=!0):(n.error_duplicate&&n.error_duplicate[e]&&delete n.error_duplicate[e],n.error_duplicate&&c.isEmpty(n.error_duplicate)&&delete n.error_duplicate),o[n[e]]={type:"port",id:t,sub:e}}},r=function(){for(let t in e.paramsModel.control)e.paramsModel.control[t].value&&(e.controlList.push(e.paramsModel.control[t].value),o[e.paramsModel.control[t].value]?e.paramsModel.control[t].error_duplicate=!0:delete e.paramsModel.control[t].error_duplicate,o[e.paramsModel.control[t].value]={type:"control",id:t})};"control"===t&&(n(),r()),"port"===t&&(r(),n())},s(function(){e.change("control")}),r.setExpandIconClickedHandler(function(e,n){t.go("app.composite",{componentId:o.componentId})}),e.$on("$destroy",function(){a.nodeId=void 0,a.node=void 0,a.paramsModel=void 0,a.controlList=void 0,a.change=void 0,a.compInfo=void 0,r.setExpandIconClickedHandler(null),l()})}]},"page-panel@app.customize":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","componentService","toaster",function(e,t,o,n,r,i,a,s,c){o.componentId=o.node.component,o.nodeTabInfo=o.node.metadata.ui.tabs}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.edit",{url:"/edit",deepStateRedirect:{default:"app.customize.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","nodeService","toaster","componentService",function(e,t,o,n,r,i){let a,s=o.save=function(){a&&(clearTimeout(a),a=void 0),a=setTimeout(function(){let a=n.getCustomizeNodeMetadata(o.nodeId,o.paramsModel);i.save(t.componentId,a).then(function(){},function(t){t&&"未授权"===t.msg&&e.reload(),r.pop("error","保存组件失败: "+t.msg)})},500)};o.$watch("node",function(){s()},!0),o.$watch("paramsModel",function(){s()},!0),n.setGraphChangeHandler(function(){s()}),o.$on("$destroy",function(){n.setGraphChangeHandler(null),a&&(clearTimeout(a),a=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html",controller:["$scope","$rootScope","$state",function(e,t,o){e.onFinish=function(){if(_.isEmpty(t.currentApp)){const o=_.find(Object.keys(e.appConfig.appMenu),function(o){return _.has(e.appConfig.appMenu[o],"componentType")&&_.get(e.appConfig.appMenu[o],"componentType").indexOf(t.compInfo.type)>-1});o&&window.onExpandList("/"+o)}else o.go("app."+t.currentApp.type,{type:t.currentApp.appType,id:t.currentApp.id})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.edit.setting",{deepStateRedirect:{default:"app.customize.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.customize":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.customize.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.customize.edit.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.edit.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.edit.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.read",{deepStateRedirect:{default:"app.customize.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope",function(e,t,o,n){n.readOnly=!0,o.$on("$destroy",function(){n.readOnly=void 0})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.read.middle.html",controller:["$scope","$rootScope","componentService","toaster","$stateParams","$state",function(e,t,o,n,r,i){e.requireEdit=function(){o.setPermission(r.componentId).then(function(e){i.reload("app.customize")},function(e){n.pop("error","请求失败: "+e.msg)})},t.stateAlert={type:"info",message:"当前状态仅支持查看，请在“编辑”状态下进行编辑"},e.onFinish=function(){if(_.isEmpty(t.currentApp)){const o=_.find(Object.keys(e.appConfig.appMenu),function(o){return _.has(e.appConfig.appMenu[o],"componentType")&&_.get(e.appConfig.appMenu[o],"componentType").indexOf(t.compInfo.type)>-1});o&&window.onExpandList("/"+o)}else i.go("app."+t.currentApp.type,{type:t.currentApp.appType,id:t.currentApp.id})},e.$on("$destroy",function(){t.stateAlert=null})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.customize.read.setting",{deepStateRedirect:{default:"app.customize.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.customize":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.customize.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.customize.read.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.read.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.customize.read.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite",{url:"/composite/:componentId",params:{refresh:0},resolve:{compInfo:["componentService","$stateParams","pageLoading","$q","$state","toaster",function(e,t,o,n,r,i){let a=n.defer();return t.componentId?e.getPermission(t.componentId).then(function(n){!n||"read"!==n.result||r.transition.to().$$state().includes["app.composite.read"]?!n||"write"!==n.result||r.transition.to().$$state().includes["app.composite.edit"]?e.get(t.componentId).then(function(e){a.resolve(e.componentInfo),o.show()},function(e){i.pop("warning","获取组件信息失败: "+e.msg),r.go("app.composite",{componentId:"",refresh:t.refresh+1})}):r.go("app.composite.edit",{componentId:t.componentId,refresh:t.refresh+1}):r.go("app.composite.read",{componentId:t.componentId,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}):e.list(null,1).then(function(o){o.list&&o.list.length>0?r.go("app.composite",{componentId:o.list[0].id,refresh:t.refresh+1}):e.create("未命名组件",void 0).then(function(e){r.go("app.composite",{componentId:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取组件信息失败: "+e.msg)})},function(e){i.pop("error","获取组件信息失败: "+e.msg)}),a.promise}]},deepStateRedirect:{default:"app.composite.read",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","pageLoading","nodeService","compInfo","$rootScope","$timeout","common",function(e,t,o,n,r,i,a,s,c){i.data||console.error("no data"),"string"==typeof i.data&&(i.data=JSON.parse(i.data));let p=$("#editor");r.init(p,i.data.def.composite,function(){n.hide(),a.$broadcast("editor.ready")}),a.compInfo=angular.copy(i),delete a.compInfo.data,a.compMetadata=angular.copy(i.data),delete a.compMetadata.def.composite,a.$$phase||a.$digest(),e.$on("$destroy",function(){a.compInfo=void 0,a.compMetadata=void 0})}]},"page-panel@app.composite":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","componentService","toaster",function(e,t,o,n,r,i,a,s,c){}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit",{url:"/edit",deepStateRedirect:{default:"app.composite.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","componentService","toaster","$q",function(e,t,o,n,r,i,a,s){let c,p=n.save=function(){let o=s.defer();return c&&(clearTimeout(c),c=void 0),c=setTimeout(function(){c=void 0;let o=angular.copy(n.compMetadata);o.def.composite=r.getGraphJson(),i.save(t.componentId,o).then(function(e,t){},function(t){t&&"未授权"===t.msg&&e.reload(),a.pop("error","保存组件失败: "+t.msg)})},500),o.promise};o.$watch("compMetadata",function(){p()},!0),r.setGraphChangeHandler(function(){p()}),r.setNodeSelectionHandler(function(t,o,n,r){o?e.go("app.composite.edit.node",{nodeId:o}):e.go("app.composite.edit")}),r.setEdgeSelectionHandler(function(t,o){t?e.go("app.composite.edit.edge",{edgeId:t}):e.go("app.composite.edit.setting")}),o.$on("$destroy",function(){r.setNodeSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),n.save=void 0,c&&(clearTimeout(c),c=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html",controller:["$scope","$rootScope",function(e,t){}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.node",{url:"/:nodeId",params:{},deepStateRedirect:{default:"app.composite.edit.node.setting",params:!0},views:{"page-panel@app.composite":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService",function(e,t,o,n,r,i,a,s){let c=$("#editor #"+t.nodeId);c&&0!==c.length?(o.nodeId=t.nodeId,o.node=a.getNode(o.nodeId),o.nodeTabInfo=o.node.metadata.ui?o.node.metadata.ui.tabs:{},o.componentId=o.node.component,o.logId=s.getLogId(window.appConfig.userId,t.id,t.nodeId),o.$watch("node",function(e,t){e!==t&&o.save()},!0),$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),n.removeNode(o.node,"app.composite.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copiedNode=angular.copy(o.node.metadata),n.copiedComp=angular.copy(o.node.component));break;case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copiedNode&&a.pasteNode(n.copiedNode,o.node.component))}}),c.addClass("selected"),o.$on("$destroy",function(){c.removeClass("selected"),$(document).off("keydown.node.edit")})):e.go("app.composite.edit")}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.customize.edit.middle.html"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.node.setting",{deepStateRedirect:{default:"app.composite.edit.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.composite.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.composite.edit.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.composite.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.composite.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.composite.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.edit.setting",{deepStateRedirect:{default:"app.composite.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.composite":{templateUrl:"/tpl/custom/panels/index.html",controller:"compositeSettingController"}}}).state("app.composite.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.composite.edit.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.edit.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.edit.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.read",{deepStateRedirect:{default:"app.composite.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window",function(e,t,o,n,r,i,a){e.requireEdit=function(){n.setPermission(r.id).then(function(e){i.reload("app.composite")},function(e){o.pop("error","请求失败: "+e.msg)})},t.stateAlert={type:"info",message:"当前状态仅支持查看，请在“编辑”状态下进行编辑"},e.$on("$destroy",function(){t.stateAlert=null})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.composite.read.setting",{deepStateRedirect:{default:"app.composite.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.composite":{templateUrl:"/tpl/custom/panels/index.html",controller:"compositeSettingController"}}}).state("app.composite.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_customize.html",controller:"editComponentController"}}}).state("app.composite.read.setting.fields",{params:{controlId:""},data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.read.setting.params",{params:{controlId:""},data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}}).state("app.composite.read.setting.tune",{params:{controlId:""},data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"},"edit-second":{templateUrl:"/tpl/custom/edit_control.html",controller:"editControlController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp",{url:"/app/:type/:id",params:{refresh:0},resolve:{appInfo:["appService","$stateParams","rpaService","$q","$state","toaster","pageLoading",function(e,t,o,n,r,i,a){const s=n.defer(),c=t.type||"algo",p=function(o){e.get(o).then(function(e){s.resolve(e.appInfo)},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})},l=function(e){t.nodeId?r.go(e+".node",{type:c,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):r.go(e,{type:c,id:t.id,refresh:t.refresh+1})};if(a.show(),t.id)if(r.transition.to().$$state().includes["app.exp.history"])p(t.id);else{let n=e;"rpa"===c&&(n=o),n.getNetworkStatus(t.id).then(function(o){if(o&&o.map){if("1"===o.map.status||"5"===o.map.status||"6"===o.map.status||"9"===o.map.status)return r.transition.to().$$state().includes["app.exp.run"]?void p(t.id):void l("app.exp.run");if("8"===o.map.status)return r.transition.to().$$state().includes["app.exp.cron"]?void p(t.id):void l("app.exp.cron")}e.getPermission(t.id).then(function(o){if(!o||"write"!==o.result||r.transition.to().$$state().includes["app.exp.edit"]){if(o&&"read"===o.result){if(r.transition.to().$$state().includes["app.exp.edit"])return void e.setPermission(t.id).then(function(e){p(t.id)},function(e){l("app.exp.read")});if(!r.transition.to().$$state().includes["app.exp.read"])return void l("app.exp.read")}p(t.id)}else l("app.exp.edit")},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})},function(e){i.pop("error","获取项目信息失败: "+e.msg),r.go("app.exp",{type:c,id:"",refresh:t.refresh+1})})}else{const o=function(){e.create("未命名项目",null,c).then(function(e){r.go("app.exp",{type:c,id:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取项目信息失败: "+e.msg)})};e.list(30,c).then(function(n){if(n&&n.list&&n.list.length>0){let i=0;const a=function(s){i++,e.head(s.id).then(function(e){r.go("app.exp",{type:c,id:s.id,refresh:t.refresh+1})},function(e){i<n.list.length?a(n.list[i]):o()})};a(n.list[i])}else o()},function(e){i.pop("error","获取项目信息失败: "+e.msg)})}return s.promise}]},deepStateRedirect:{default:"app.exp.edit",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","$state","$stateParams","appInfo","pageLoading","nodeService","$rootScope","logService","toaster",function(e,t,o,n,r,i,a,s,c){window.appConfig.appId=o.id;const p=_.get(a.appConfig,"appMenu");if(a.currentApp={type:_.split(t.$current.name,".")[1],appType:o.type,id:o.id,icon:p[o.type].icon,name:p[o.type].name},a.$broadcast("toggle.app",o.type),!_.isEmpty(n.data)){const e=_.get(JSON.parse(n.data),"timestamp"),t=e?{status:"lastSaved",timestamp:e}:null;a.$broadcast("app-saved",t)}a.getImages();const l=$("#editor");i.init(l,n.data,function(){r.hide(),a.landingCollapsed&&(document.getElementById("container").style.zIndex=1),a.$broadcast("editor.ready")}),a.appInfo=angular.copy(n),a.appLogId=s.getAppLogId(window.appConfig.userId,o.id),delete a.appInfo.data,a.$$phase||a.$digest(),a.runStartStop=function(){a.stateAlert=null,a.doSave().then(function(){const e=i.onValidated();e&&"error"===e.status?a.stateAlert={type:"danger",fadeOut:!0,message:e.message}:t.go("app.exp.prepare",{type:o.type,runType:"runStartStop"})},function(e){"网络错误"===e.msg&&c.pop("warning","请检查网络，稍后重试")})},e.$on("$destroy",function(){a.appInfo=void 0,a.appLogId=void 0,window.appConfig.appId=void 0,a.runStartStop=void 0})}]},"page-panel@app.exp":{template:"<div ui-view='panel'></div>"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit",{deepStateRedirect:{default:"app.exp.edit.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","rpaService","appService","toaster","$q",function(e,t,o,n,r,i,a,s,c){let p,l=$("#editor");o.$on("editor.ready",function(){l=$("#editor")});let d=t.type||"algo",u=a;"rpa"===d&&(u=i);let f,h=0,m=function(){l&&l.length?(r.showAllScreenshots(),u.getNetworkStatus(t.id).then(function(e){if(!e||!e.map)return;let t=e.map;for(let e in t){if(!e.startsWith("node.status."))continue;let o=e.replace("node.status.",""),n=t[e],r=$("#"+o);switch(n){case"4":r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").show();break;case"3":r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").show(),r.find(".the-graph-error-icon").hide();break;case"1":break;default:r.find(".the-graph-spin").hide(),r.find(".the-graph-success-icon").hide(),r.find(".the-graph-error-icon").hide()}}e.msg&&e.msg[h]&&(s.pop("info",e.msg[h]),h+=1)})):p=window.setTimeout(m,1e3)};m(),n.doSave=function(o){let i=c.defer(),p=r.getGraphJson();const l=(new Date).getTime();return p.timestamp=l,a.save(t.id,p).then(function(){o?s.pop("success","保存成功"):n.$broadcast("app-saved",{status:"success",timestamp:l}),i.resolve()},function(o){s.pop("error","保存项目失败: "+o.msg),"正在被其他客户端编辑"===o.msg&&e.go("app.exp.read",{type:d,id:t.id,refresh:t.refresh+1}),i.reject(o)}),i.promise};let g,v=n.save=function(){f||(f=setTimeout(function(){n.doSave(),clearTimeout(f),f=void 0},1e3))};r.setGraphChangeHandler(function(){v();const e=r.getGraph();_.isEmpty(e.properties.preview)?g||(g=window.setTimeout(function(){n.screenshots("screen_shot.png"),window.clearTimeout(g),g=void 0},1e4)):g&&(window.clearTimeout(g),g=void 0)}),r.setEdgeSelectionHandler(function(t,o){t?e.go("app.exp.edit.edge",{edgeId:t}):e.go("app.exp.edit.setting")}),r.setGroupSelectionHandler(function(t){t&&e.go("app.exp.edit.group",{groupId:t})}),r.setNodeSelectionHandler(function(t,o,r,i){if(t.ctrlKey||t.metaKey)if(o)if(e.includes("app.exp.edit.multi")){let t=e.params.nodes.indexOf(o);-1===t?(e.params.nodes.push(o),n.$broadcast("multi.nodes.add",{nodeId:o})):1===e.params.nodes.length?e.go("app.exp.edit"):(e.params.nodes.splice(t,1),n.$broadcast("multi.nodes.remove",{nodeId:o}))}else e.includes("app.exp.edit.node")?e.params.nodeId!==o?e.go("app.exp.edit.multi",{nodes:[e.params.nodeId,o]}):e.go("app.exp.edit.node",{nodeId:o}):o?e.go("app.exp.edit.node",{nodeId:o}):e.go("app.exp.edit");else e.go("app.exp.edit");else o?e.go("app.exp.edit.node",{nodeId:o}):e.go("app.exp.edit")}),r.setNodeRectImgDblclickHandler.call(this,function(e,o,r){if("dblclick"==e.type&&o&&r){let e="studio/"+window.appConfig.userId+"/logs/"+t.id+"/screenshots/"+o+"/";n.showFiles(e)}}),$(document).on("keydown.edit",function(e){let t=$(e.target);if(!(t.is("input")||t.is("textarea")||t.is(".form-control")))switch(e.keyCode){case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copiedNode&&r.pasteNode(n.copiedNode,n.copiedComp));break;case 90:if((e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.removedNodes.length)){let e=n.removedNodes.pop(),t=e.metadata,o=r.getNodeOriginalPosision(t.x,t.y);switch(t.type){case"public_component":r.addPublicRemoteNode(e.component,o.x,o.y,t.type);break;case"my_component":r.addRemoteNode(e.component,o.x,o.y,t.type);break;case"hufu_component":r.addHufuNode(e.component,t.label,t.icon,o.x,o.y,t.type)}}}}),o.$on("$destroy",function(){window.clearTimeout(p),window.clearTimeout(g),r.setNodeSelectionHandler(null),r.setGroupSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),r.setNodeRectImgDblclickHandler(null),$(document).off("keydown.edit"),n.removedNodes=[],n.save=void 0,n.doSave=void 0,f&&(clearTimeout(f),f=void 0)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.middle.html"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.setting",{deepStateRedirect:{default:"app.exp.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.node",{url:"/:nodeId",params:{},deepStateRedirect:{default:"app.exp.edit.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService","logService","appService","toaster",function(e,t,o,n,r,i,a,s){let c=null;if(_.isEmpty(t.nodeId)||(c=$("#editor #"+t.nodeId)),!c||0===c.length)return void e.go("app.exp.edit");o.nodeId=t.nodeId,o.node=r.getNode(o.nodeId),o.nodeTabInfo=o.node.metadata.ui?o.node.metadata.ui.tabs:{},o.componentId=o.node.component,o.logId=i.getLogId(window.appConfig.userId,t.id,t.nodeId),n.nodeCompType=o.node.metadata.def.type,n.$broadcast("toggle.node",o.node),o.resetTabInfo(o.node.metadata.def.params,o.nodeTabInfo),998===n.nodeCompType&&(o.appList=[],a.list(9999,"algo").then(function(e){e&&e.list&&(o.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){s.pop("error","获取项目列表失败: "+e.msg)})),o.updateCompositeAppId=function(e){o.node.metadata.def.compositeParams=[],o.node.metadata.def.ports=[],o.node.metadata.def.compositeApp=_.find(o.appList,{id:e}),a.get(e).then(function(e){o.node.metadata.def.ports=[],o.node.metadata.def.composite=JSON.parse(e.appInfo.data),r.collectCompositePorts(o.node.metadata.def.composite,o.node.metadata.def.ports),r.changeNode(t.nodeId),o.save()},function(e){s.pop("error","获取项目信息失败: "+e.msg)})},o.node,o.$watch("node",function(e,t){e!==t&&o.save()},!0),$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),n.removeNode(o.node,"app.exp.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copiedNode=angular.copy(o.node.metadata),o.node.metadata.def.compositeAppId&&(delete n.copiedNode.initCoord,delete n.copiedNode.def.composite,delete n.copiedNode.def.compositeAppId,delete n.copiedNode.def.compositeParams),n.copiedComp=angular.copy(o.node.component));break;case 37:o.node.metadata.x-=1,r.changeNode(o.nodeId);break;case 38:o.node.metadata.y-=1,r.changeNode(o.nodeId);break;case 39:o.node.metadata.x+=1,r.changeNode(o.nodeId);break;case 40:o.node.metadata.y+=1,r.changeNode(o.nodeId)}}),c.addClass("selected");let p=r.hightEdges(t.nodeId);o.$on("$destroy",function(){n.nodeCompType=void 0,c.removeClass("selected"),$(p).removeClass("active"),$(document).off("keydown.node.edit"),n.$broadcast("toggle.node",null)})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.node.middle.html",controller:["$scope","$stateParams","$rootScope","appService","nodeService","$state","toaster",function(e,t,o,n,r,i,a){e.a={},e.doRun=function(e,t){const n="runStartStop"==e&&t;o.stateAlert=null,o.doSave().then(function(){const a=r.onValidated(n);a&&"error"===a.status?o.stateAlert={type:"danger",fadeOut:!0,message:a.message}:i.go("app.exp.prepare.node",{nodeId:t,runType:e,targetNodeId:t})},function(e){"网络错误"===e.msg&&a.pop("warning","请检查网络，稍后重试")})},e.doExpand=function(){const e=r.getNode(t.nodeId);if("composite"!==e.component){const o=_.get(e,"metadata.def.compositeAppId");if(!o)return void a.pop("warning","该组件缺少运行的项目");n.get(o).then(function(o){e.metadata.def.composite=JSON.parse(o.appInfo.data),r.collectCompositePorts(e.metadata.def.composite,e.metadata.def.ports),r.changeNode(t.nodeId)},function(e){a.pop("error","获取项目信息失败: "+e.msg)}).finally(function(){r.expandGroup(e),requestAnimationFrame(function(){i.go("app.exp.edit.group",{groupId:t.nodeId})})})}else r.expandGroup(e),i.go("app.exp.edit.group",{groupId:t.nodeId})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.node.setting",{deepStateRedirect:{default:"app.exp.edit.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.multi",{url:"/nodes",params:{nodes:null},deepStateRedirect:{default:"app.exp.edit.multi.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService",function(e,t,o,n,r,i,a){if(!t.nodes||!t.nodes.length)return void e.go("app.exp.edit");o.getMultiNodes=function(){return _.map(t.nodes,function(e){return a.getNode(e)})};$(document).on("keydown.node.edit",function(e){let t=$(e.target);var r;if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation();const t=o.getMultiNodes();n.removeMultiNodes(t,"app.exp.edit");break;case 67:(e.ctrlKey||e.metaKey)&&e.stopPropagation();break;case 37:case 38:case 39:case 40:r=e.keyCode,_.forEach(o.nodes,function(e){switch(r){case 37:e.metadata.x-=10,a.changeNode(e.id);break;case 38:e.metadata.y-=10,a.changeNode(e.id);break;case 39:e.metadata.x+=10,a.changeNode(e.id);break;case 40:e.metadata.y+=10,a.changeNode(e.id)}})}});for(let e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).addClass("selected")}o.$on("multi.nodes.add",function(e,t){$("#editor #"+t.nodeId).addClass("selected")}),o.$on("multi.nodes.remove",function(e,t){$("#editor #"+t.nodeId).removeClass("selected")}),o.$on("$destroy",function(){for(let e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).removeClass("selected")}$(document).off("keydown.node.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.multi.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,o,n,r,i,a){e.a={},e.a.doGroup=function(){let e=a.uuid();r.addGroup(e,o.nodes,{name:"未命名组合",component:"composite",data:{}}),i.go("app.exp.edit.group",{groupId:e})};let s=function(){if(o.nodes){for(let n=0;n<o.nodes.length;n++){if(r.whichGroup(o.nodes[n]).length)return e.a.canotGroup=!0,void(t.$$phase||t.$apply())}e.a.canotGroup=!1,t.$$phase||t.$apply()}};s(),e.$on("multi.nodes.add",function(e,t){s()}),e.$on("multi.nodes.remove",function(e,t){s()}),e.$on("$destroy",function(){})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.multi.setting",{deepStateRedirect:{default:"app.exp.edit.multi.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.edit.multi":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.multi.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_multi_edit.html",controller:"expMultiSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.edge",{params:{edgeId:null},deepStateRedirect:{default:"app.exp.edit.edge.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","nodeService",function(e,t,o,n){let r=$("#"+t.edgeId);if(!r||0===r.length)return void e.go("app.exp.edit");r.addClass("selected"),r.parent().append(r);let i=t.edgeId.split("-");o.edge=n.getEdge(i[1],i[2],i[4],i[3]),_.get(o.edge,"metadata.color")||_.set(o.edge,"metadata.color","#a6a6a6"),_.get(o.edge,"metadata.size")||_.set(o.edge,"metadata.size",1);const{from:a,to:s,metadata:c}=o.edge;o.$watch("edge.metadata.color",function(e){n.setEdgeMetadata(a.node,a.port,s.node,s.port,c)}),o.onChangeSize=function(){n.setEdgeMetadata(a.node,a.port,s.node,s.port,c)},$(document).on("keydown.edge.edit",function(t){let n=$(t.target);if(!n.is("input")&&!n.is("textarea"))switch(t.keyCode){case 46:case 8:t.stopPropagation(),o.removeEdge(o.edge,_.get(e,"current.name").split(".edge")[0])}}),o.$on("$destroy",function(){r.removeClass("selected"),$(document).off("keydown.edge.edit")})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.edge.setting",{deepStateRedirect:{default:"app.exp.edit.edge.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.edit.edge":{templateUrl:"/tpl/custom/panels/index.html",controller:["$state","$stateParams","$scope","$timeout","$rootScope","common","nodeService",function(e,t,o,n,r,i,a){o.tabs=angular.copy(e.current.data.tabs),o.currentTab={},o.$on("$destroy",function(){})}]}}}).state("app.exp.edit.edge.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_edge.html",controller:["$state","$scope",function(e,t){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.group",{url:"/group/:groupId",params:{nodes:null},deepStateRedirect:{default:"app.exp.edit.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService",function(e,t,o,n,r){n.group=r.getGroup(t.groupId);let i=$("#editor #"+t.groupId);o.nodeTabInfo={params:{controls:[],tabName:{en_US:"Parameters Setting",zh:"参数设置",zh_CN:"参数设置"}}},n.nodeCompType="group",i.addClass("selection");let a=r.getGroupConnections(r.getGraph().toJSON(),o.group);r.collectGroupInport(a.inConnections,[]),r.collectGroupOutport(a.outConnections,[]),$(document).on("keydown.group.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),n.removeGroup(n.group,"app.exp")}}),o.$on("$destroy",function(){n.nodeCompType=void 0,n.group=void 0,i.removeClass("selection"),$(document).off("keydown.group.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.edit.group.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,o,n,r,i,a){e.unGroup=function(){r.removeGroup(o.groupId),i.go("app.exp")};let s=function(){e.a={},r.getChildGroup(o.groupId).length&&(e.a.canotFold=!0)};r.getGraph()?s():e.$on("editor.ready",function(){s()}),e.doFold=function(){r.foldGroup(o.groupId),requestAnimationFrame(function(){i.go("app.exp.edit.node",{nodeId:o.groupId})})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.edit.group.setting",{deepStateRedirect:{default:"app.exp.edit.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"}]},views:{"panel@app.exp.edit.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.edit.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.edit.group.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.cron",{deepStateRedirect:{default:"app.exp.cron.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","nodeService","$state",function(e,t,o,n,r,i,a){e.stop=function(){n.stopCron(r.id,i.getCronConfig()).then(function(e){o.pop("success","停止定时运行成功"),a.reload()},function(e){o.pop("error","停止定时运行失败: "+e.msg)})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.cron.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.cron.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.cron.setting",{deepStateRedirect:{default:"app.exp.cron.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.cron.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.cron.node.setting",{deepStateRedirect:{default:"app.exp.cron.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.cron.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.cron.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.cron.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.cron.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.cron.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.history",{url:"/history",deepStateRedirect:{default:"app.exp.history.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.history.middle.html",controller:["$scope","$rootScope","$state",function(e,t,o){e.backToApp=function(e){let t=e.split("_");o.go("app.exp.edit",{id:t[0]},{reload:!0})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.history.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.history.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.history.setting",{deepStateRedirect:{default:"app.exp.history.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.history.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.history.node.setting",{deepStateRedirect:{default:"app.exp.history.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.history.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.history.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.history.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.history.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.history.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.run",{deepStateRedirect:{default:"app.exp.run.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","rpaService",function(e,t,o,n,r,i){let a="algo"===r.type?n:i;e.stop=function(){a.stop(r.id).then(function(e){},function(e){o.pop("error","停止运行失败: "+e.msg)})},t.stateAlert={type:"danger",message:"项目运行期间请勿编辑"},e.$on("$destroy",function(){t.stateAlert=null})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.run.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.run.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.run.group",{url:"/:groupId",params:{groupId:null},deepStateRedirect:{default:"app.exp.run.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readGroupController"}}}).state("app.exp.run.setting",{deepStateRedirect:{default:"app.exp.run.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.run.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.run.node.setting",{deepStateRedirect:{default:"app.exp.run.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.run.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.run.group.setting",{deepStateRedirect:{default:"app.exp.run.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.run.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.run.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.run.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.run.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.run.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.run.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.prepare",{params:{runType:"",targetNodeId:""},deepStateRedirect:{default:"app.exp.prepare.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.run.middle.html",controller:"prepareController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.prepare.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.prepare.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.prepare.setting",{deepStateRedirect:{default:"app.exp.prepare.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.prepare.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.prepare.node.setting",{deepStateRedirect:{default:"app.exp.prepare.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.prepare.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.prepare.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.prepare.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.prepare.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.prepare.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.read",{deepStateRedirect:{default:"app.exp.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.exp.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window",function(e,t,o,n,r,i,a){e.requireEdit=function(){n.setPermission(r.id).then(function(e){i.reload("app.exp")},function(e){o.pop("error","请求失败: "+e.msg)})},t.stateAlert={type:"info",message:"当前状态仅支持查看，请在“编辑”状态下进行编辑"},e.$on("$destroy",function(){t.stateAlert=null})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.exp.read.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.exp.read.node.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.exp.read.group",{url:"/group/:groupId",params:{groupId:null},deepStateRedirect:{default:"app.exp.read.group.setting",params:!0},views:{"page-panel@app.exp":{template:"<div ui-view='panel'></div>",controller:"readGroupController"}}}).state("app.exp.read.setting",{deepStateRedirect:{default:"app.exp.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.exp":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.exp.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.exp.read.node.setting",{deepStateRedirect:{default:"app.exp.read.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.exp.read.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.read.group.setting",{deepStateRedirect:{default:"app.exp.read.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.exp.read.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.exp.read.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.exp.read.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.exp.read.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.read.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.exp.read.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").constant("frontPanelI18n",{zh_CN:{styleManager:{properties:{width:"宽度",height:"高度",left:"X",top:"Y",background:"背景","background-color":"背景颜色",border:"边框","font-size":"字号","font-weight":"加粗",color:"字体颜色","text-align":"对齐方式"}}}}).config(["$stateProvider",function(e){e.state("app.predict",{url:"/service/:type/:id",params:{refresh:0},resolve:{appInfo:["appService","$stateParams","hardwareService","$q","$state","toaster","$rootScope","predictService","pageLoading","APP_STATUS",function(e,t,o,n,r,i,a,s,c,p){const l=n.defer(),d=t.type||"predict",u=function(o){e.get(o).then(function(e){l.resolve(e.appInfo)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})})},f=function(e){t.nodeId?r.go(e+".node",{type:d,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):r.go(e,{type:d,id:t.id,refresh:t.refresh+1})},h=function(o){if(o&&o.map&&(o.map.status===p.AppRunning||o.map.status===p.AppStarting||o.map.status===p.AppStopping||o.map.status===p.AppWaiting))return r.transition.to().$$state().includes["app.predict.run"]?void u(t.id):void f("app.predict.run",t.id,t.nodeId);e.getPermission(t.id).then(function(o){if(o&&"write"===o.result){if(!r.transition.to().$$state().includes["app.predict.edit"])return void f("app.predict.edit")}else if(o&&"read"===o.result){if(r.transition.to().$$state().includes["app.predict.edit"])return void e.setPermission(t.id).then(function(e){u(t.id)},function(e){f("app.predict.read")});if(!r.transition.to().$$state().includes["app.predict.read"])return void f("app.predict.read")}u(t.id)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})})};if(c.show(),t.id)a.appConfig._board?o.post("status",{id:t.id,boardId:a.appConfig._board.id}).then(function(e){h(e)},function(e){i.pop("error","获取服务信息失败: "+e.msg),a.appConfig._board=null,r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})}):s.getNetworkStatus(t.id).then(function(e){h(e)},function(e){i.pop("error","获取服务信息失败: "+e.msg),r.go("app.predict",{type:d,id:"",refresh:t.refresh+1})});else{const o=function(){e.create("未命名项目",null,d).then(function(e){r.go("app.predict",{type:d,id:e.id,refresh:t.refresh+1})},function(e){i.pop("error","获取项目信息失败: "+e.msg)})};e.list(30,d).then(function(n){if(n&&n.list&&n.list.length>0){let i=0;const a=function(s){i++,e.head(s.id).then(function(e){r.go("app.predict",{type:d,id:s.id,refresh:t.refresh+1})},function(e){i<n.list.length?a(n.list[i]):o()})};a(n.list[i])}else o()},function(e){i.pop("error","获取项目信息失败: "+e.msg)})}return l.promise}]},deepStateRedirect:{default:"app.predict.edit",params:!0},views:{"edit@app":{templateUrl:"/tpl/exp.html",controller:["$scope","APPMENU","$state","$stateParams","appInfo","pageLoading","nodeService","$rootScope","logService","appDataStoreService","dashboardAssetService","appService","$timeout",function(e,t,o,n,r,i,a,s,c,p,l,d,u){_.get(s.currentApp,"id")!==n.id&&"predict"===n.type&&s.appConfig._board&&(s.appConfig._context=appConfig.env,s.appConfig._board=null);const f=_.get(s.appConfig,"appMenu")||t;if(window.appConfig.appId=n.id,s.currentApp={type:_.split(o.$current.name,".")[1],appType:n.type,id:n.id,icon:f[n.type].icon,name:f[n.type].name,screenshot:{loading:!1}},s.getImages(),s.$broadcast("toggle.app",n.type),!_.isEmpty(r.data)){const e=_.get(JSON.parse(r.data),"timestamp"),t=e?{status:"lastSaved",timestamp:e}:null;s.$broadcast("app-saved",t)}function h(e){let t="screen_shot.png";const o=a.getGraph(),r=_.get(o.properties,"preview");if("graph"!=e||"preview"!=r&&"dashboard"!=r){if("dashboard"==e&&"preview"==r)t="screen_shot_dashboard.png";else if("dashboard"==e&&"graph"==r)return s.currentApp.screenshot[e]=null,void(s.currentApp.screenshot.loading=!1)}else t="screen_shot_graph.png";const i="studio/"+window.appConfig.userId+"/"+n.id+"/"+t;s.currentApp.screenshot.loading=!0,d.getImgUrl(i).then(function(t){s.currentApp.screenshot[e]=t},function(t){s.currentApp.screenshot[e]=null}).finally(function(){s.currentApp.screenshot.loading=!1})}e.selectedNodeId=n.nodeId;let m=$("#editor"),g=null;a.init(m,r.data,function(){i.hide(),s.landingCollapsed&&(document.getElementById("container").style.zIndex=1),s.$broadcast("editor.ready")}),s.appInfo=angular.copy(r);const v=s.appConfig._board?s.appConfig._board.id:null;let y;if(s.appLogId=c.getAppLogId(window.appConfig.userId,n.id,null,v),delete s.appInfo.data,s.$$phase||s.$digest(),window.spFPanelWrapper){const t=window.spFPanelWrapper.grapesjs;let n=Object.keys(t.plugins.getAll()).reverse();t.plugins.add("plugin-asset-oss",(t,o)=>{const n=t.AssetManager,r=function(e){const t=(e.dataTransfer?e.dataTransfer.files:e.target.files)[0],o=this,r={key:"loading",src:"./images/loading.gif",name:`${t.name}(上传中...)`};t&&(this.onUploadStart(),n.add(r),l.uploadImage(t).then(e=>{n.remove(r.src),e&&e.src?o.onUploadResponse({data:e}):o.onUploadError("上传失败")},e=>{n.remove(r.src),o.onUploadError(e)}))};e.imageList=[];const i=function(){l.listImages().then(function(t){e.imageList=e.imageList.concat(t),n.getAll().reset(e.imageList),n.render()},function(e){})},a=function(e){const t=e.attributes;t.key&&"loading"===t.key||l.deleteImage(e.attributes).then(function(){},function(e){console.warn("remote asset remove failed",e)})};!function(){const o=n.getConfig();let s=_.assign(o,{uploadFile:r,stylePrefix:"am-"});n.init(s),n.AssetsView().template=function(t){const o=t.pfx,r=(t.ppfx,$(`\n                      <div class="${o}assets-cont">\n                        <div class="imagelist-search-group" style="display: table;">\n                          <div class="imagelist-search-group-addon" style="display: table-row; padding-left: 5px; padding-right: 5px;">\n                            <div style="display: table-cell; width: 220px; padding-right: 10px;">\n                              <input type="text" placeholder="按资源名称搜索" class="imagelist-search-input" style="width: 100%; height: 28px; border:none; outline: none; background-color: rgba(0,0,0,0.2); padding-left: 5px;"/>\n                            </div>\n                            <div style="display: table-cell; width: 60px; padding-left: 5px; padding-right: 5px;">\n                              <button class="gjs-btn-prim gjs-btn--full imagelist-search-clear">清空</button>\n                            </div>\n                            <div style="display: table-cell; width: 60px; padding-left: 5px; padding-right: 5px;">\n                              <button class="gjs-btn-prim gjs-btn--full imagelist-search-confirm">搜索</button>\n                            </div>\n                          </div>\n                        </div>\n                        <div class="${o}assets" data-el="assets"></div>\n                        <div style="clear:both"></div>\n                      </div>\n                    `)),a=r.find(`.${o}assets`)[0];let s="";return r.find(`.${o}assets`).on("scroll",function(e){a.scrollHeight===a.clientHeight+a.scrollTop&&(s||i())}),r.find(".imagelist-search-clear").on("click",function(){r.find(".imagelist-search-input").val(""),l.reset(),s="",e.imageList=[],i()}),r.find(".imagelist-search-confirm").on("click",function(){s=r.find(".imagelist-search-input").val(),l.search(s).then(function(t){e.imageList=t,n.getAll().reset(e.imageList),n.render()},function(e){})}),r[0]},t.on("asset:remove",a),i()}()}),n.push("plugin-asset-oss"),-1==n.indexOf("grapesjs-custom-code")&&n.push("grapesjs-custom-code");const r=function(){(g=window.spFPanelWrapper.init({container:"#gjs",colorPicker:{appendTo:"body"},plugins:window.spFPanelWrapper.plugins.concat(n),layerManager:{appendTo:"#layers"},blockManager:{appendTo:"#blocks"},styleManager:{appendTo:"#styles",clearProperties:1},storageManager:{type:"sp-storage",autosave:1,autoload:0},traitManager:{appendTo:"#traits"},canvas:{styles:["/common_static/css/fontawesome.5.1.0.css","/common_static/fontFamily/index.css",window.appConfig.suanpanSdkAllCSSPath],scripts:[window.appConfig.suanpanSdkAllPath]},panels:{defaults:[{id:"layers",el:"#layers-container",resizable:{tc:0,cr:1,bc:0,keyWidth:"flex-basis"}},{id:"styles",el:"#style-container",resizable:{tc:0,cr:0,cl:1,bc:0,keyWidth:"flex-basis"}}]}})).Panels.removeButton("options","sw-visibility"),g.Panels.removeButton("views","open-tm"),g.stopCommand("sw-visibility"),g.Panels.addButton("options",{id:"canvas-clear",className:"iconfont icontrash",command:function(e){s.readOnly?g.Modal.open({title:"提示",content:"请在编辑状态下进行操作！"}):confirm("清空画布后，画布中的所有前面板组件将全部被清除。")&&e.runCommand("core:canvas-clear")},attributes:{title:"清空画布","data-tooltip-pos":"bottom"}}),g.on("block:drag:start",function(e){s.readOnly&&g.Modal.open({title:"提示",content:"请在编辑状态下进行操作！"})}),g.StorageManager.add("sp-storage",{load(e,t,o){t(a.getDashboardConfig())},store(t,o,n){if(a.setDashboardConfig(t),e.save){if(t["gjs-components"]){let e=JSON.parse(t["gjs-components"]),o={};a.getGraph().nodes.forEach(function(e){22===e.metadata.def.type&&(o[e.metadata.def.dashboardId]=e.id)});let n=function(e){e.forEach(function(e){if(e.attributes){let t=e.attributes.id;if(e.attributes.sp){let n=e.attributes.sp;if(!o[t]){const e=n.metadata;e.def.dashboardId=t,a.addDashboardNode(e)}delete o[t]}else o[t]&&(a.removeNode(o[t],!0),delete o[t])}e.components&&e.components.length&&n(e.components)})};n(e),Object.keys(o).forEach(function(e){let t=o[e];a.removeNode(t)})}e.save&&e.save()}o()}});a.setGraphAddNodeHandler(function(e,t){!function(e,t,o){if(e){let n=t.BlockManager.get(e).attributes.content;!_.isString(n)&&n.content&&(n=n.content);const r=t.addComponents(n);o&&r[0].set(o)}}(e,g,t)}),a.setGraphDeleteNodeHandler(function(e){!function(e,t){let o=t.DomComponents.componentsById[e];o=_.isArray(o)?o:[o],t.select(null),o.forEach(e=>{if(e&&e.get("removable")){if(e){const t=e.collection;e.trigger("component:destroy"),t&&t.remove(e)}}else console.warn("The element is not removable",e)})}(e,g)}),a.setEdgeIconClickHandler(function(t,o,n,r="in"){e.openEdgeScriptEditor({from:t,to:o,metadata:n,direction:r})}),e.$on("toggle.node",function(t,o){o&&(e.selectedNodeId=o.id)}),g.on("component:selected",function(t){const o=t.ccid,n=a.getDashboardNode(o);e.selectedNodeId=n?n.id:null}),g.load(),e.onDashboardSelectedComponent=function(e){if(!_.isEmpty(e)){const t=a.getNode(e),o=_.get(t,"metadata.def.dashboardId");if(o){const e=g.getComponents();e.length&&e.models.forEach(function(e){e.ccid===o?g.selectAdd(e):g.selectRemove(e)})}}},h("dashboard")};appConfig.dashboard&&(s.appConfig.pluginLoaded?r():(s.currentApp.screenshot.loading=!0,async_load(s.appConfig.dashboardPluginPath,function(){s.appConfig.pluginLoaded=!0,r()}))),e.$on("predict.dashboard",function(t,n){s.currentApp.dashboard=n,g.getSelectedAll().forEach(function(e){g.selectRemove(e)}),h("dashboard"),e.selectedNodeId&&(o.includes("app.predict.edit")?o.go("app.predict.edit.node",{nodeId:e.selectedNodeId}):o.includes("app.predict.run")?o.go("app.predict.run.node",{nodeId:e.selectedNodeId}):o.includes("app.predict.read")&&o.go("app.predict.read.node",{nodeId:e.selectedNodeId}))}),s.$on("canvasresizer.update",function(){const e=_.find(g.getModel().get("modules"),{name:"CanvasResizer"});e&&(e.rendered?e.setCanvasTransform():y=u(function(){e&&e.render(),u.cancel(y),y=void 0},300))}),e.$on("predict.predict",function(t,n){h("graph"),s.currentApp.dashboard=n,s.$broadcast("canvasresizer.update"),e.selectedNodeId&&(e.onDashboardSelectedComponent(e.selectedNodeId),e.selectedNodeId=null,o.includes("app.predict.edit.node")?o.go("app.predict.edit.setting"):o.includes("app.predict.run.node")?o.go("app.predict.run.setting"):o.includes("app.predict.read.node")&&o.go("app.predict.read.setting"))})}e.$on("$destroy",function(){window.appConfig.appId=void 0,s.appInfo=void 0,s.appLogId=void 0,y&&(u.cancel(y),y=void 0),g&&g.destroy()})}]},"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","toaster","hardwareService",function(e,t,o,n,r,i){let a=n.appConfig._board,s=null,c=null;if("predict"===t.type&&a){let o=function(o,i){i||(r.clear(s),s=null,c&&(clearTimeout(c),c=null),n.handleResetContext(e.current.name,t,null))},p=function(){c&&(clearTimeout(c),c=null),i.post("get",{hwtype:"board",boardId:a.id}).then(function(e){e.success&&("online"!==_.get(e,"data.state")?_.isEmpty(s)&&(s=r.pop({type:"error",title:"板子已掉线",body:"点击回到 "+n.appConfig.env+"。",showCloseButton:!1,tapToDismiss:!0,timeout:0,clickHandler:o})):s&&(r.pop("success","板子已连线！"),r.clear(s),s=null)),c=setTimeout(p,3e3)},function(e){c=setTimeout(p,3e3)})};p()}o.$on("$destroy",function(){a=void 0,c&&(clearTimeout(c),c=void 0)})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit",{deepStateRedirect:{default:"app.predict.edit.setting",params:!0},resolve:{},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:["$state","$stateParams","$scope","$rootScope","nodeService","appService","$q","toaster","appDataStoreService",function(e,t,o,n,r,i,a,s,c){let p,l=$("#editor");o.$on("editor.ready",function(){l=$("#editor")}),n.doSave=function(o){let c=a.defer(),p=r.getGraphJson();const l=(new Date).getTime();return p.timestamp=l,i.save(t.id,p).then(function(){o?s.pop("success","保存成功"):n.$broadcast("app-saved",{status:"success",timestamp:l}),c.resolve()},function(o){s.pop("error","保存项目失败: "+o.msg),"正在被其他客户端编辑"===o.msg&&e.go("app.predict.read",{type:t.type||"predict",id:t.id,refresh:t.refresh+1}),c.reject(o)}),c.promise};let d;const u=n.save=function(){d||(d=setTimeout(function(){n.doSave(),clearTimeout(d),d=void 0},1e3)),p||(p=window.setTimeout(function(){let e="studio/"+window.appConfig.userId+"/"+t.id+"/",o="screen_shot.png";const i=r.getGraph(),a=_.get(i.properties,"preview");n.currentApp.dashboard?("preview"===a&&(o="screen_shot_dashboard.png"),window.spFPanelWrapper.getScreenshot({allowTaint:!1,useCORS:!0,scale:.5}).then(function(t){if("toBlob"in t)try{t.toBlob(function(t){t&&c.upload(e+o,t,function(e){},function(e){},function(){"preview"!==a&&n.onAppImageUploaded("dashboard")})})}catch(e){}})):("preview"===a||"dashboard"===a?o="screen_shot_graph.png":n.onAppImageUploaded("graph"),n.screenshots(o)),window.clearTimeout(p),p=null},1e4))};r.setGraphChangeHandler(function(){u()}),r.setNodeSelectionHandler(function(t,o,i,a){if(t.ctrlKey||t.metaKey)if(o)if(e.includes("app.predict.edit.multi")){const t=e.params.nodes.indexOf(o);-1===t?(e.params.nodes.push(o),n.$broadcast("multi.nodes.add",{nodeId:o})):1===e.params.nodes.length?e.go("app.predict.edit"):(e.params.nodes.splice(t,1),n.$broadcast("multi.nodes.remove",{nodeId:o}))}else e.includes("app.predict.edit.node")?e.params.nodeId!==o?e.go("app.predict.edit.multi",{nodes:[e.params.nodeId,o]}):e.go("app.predict.edit.node",{nodeId:o}):o?e.go("app.predict.edit.node",{nodeId:o}):e.go("app.predict.edit");else e.go("app.predict.edit");else o?(eventService.emit(eventService.EVENTS.sp.node.select,[o,r.getNode(o)]),e.go("app.predict.edit.node",{nodeId:o})):(eventService.emit(eventService.EVENTS.sp.node.deselect),e.go("app.predict.edit"))}),r.setEdgeSelectionHandler(function(t,o){t?e.go("app.predict.edit.edge",{edgeId:t}):e.go("app.predict.edit.setting")}),r.setGroupSelectionHandler(function(t){t&&e.go("app.predict.edit.group",{groupId:t})}),$(document).on("keydown.edit",function(e){let t=$(e.target);if(!(t.is("input")||t.is("textarea")||t.is(".form-control")))switch(e.keyCode){case 86:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copiedNode&&r.pasteNode(n.copiedNode,n.copiedComp));break;case 90:if((e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.removedNodes.length)){let e=n.removedNodes.pop(),t=e.metadata,o=r.getNodeOriginalPosision(t.x,t.y);switch(t.type){case"public_component":r.addPublicRemoteNode(e.component,o.x,o.y,t.type);break;case"my_component":r.addRemoteNode(e.component,o.x,o.y,t.type);break;case"hufu_component":r.addHufuNode(e.component,t.label,t.icon,o.x,o.y,t.type)}}}}),o.$on("$destroy",function(){window.clearTimeout(d),window.clearTimeout(p),r.setNodeSelectionHandler(null),r.setEdgeSelectionHandler(null),r.setGraphChangeHandler(null),n.removedNodes=[],n.save=void 0,n.doSave=void 0,$(document).off("keydown.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.middle.html",controller:["$scope","$state","$stateParams","toaster","appService","nodeService","$rootScope",function(e,t,o,n,r,i,a){e.deploy=function(){a.stateAlert=null,a.doSave().then(function(e){const o=i.onValidated();o&&"error"===o.status?a.stateAlert={type:"danger",fadeOut:!0,message:o.message}:t.params.nodeId?t.go("app.predict.prepare.node",{nodeId:t.params.nodeId}):t.go("app.predict.prepare")},function(e){"网络错误"===e.msg&&n.pop("warning","请检查网络，稍后重试")})},e.doExpand=function(){const e=i.getNode(t.params.nodeId),a=_.get(e,"metadata.def.compositeAppId");a?r.get(a).then(function(t){e.metadata.def.composite=JSON.parse(t.appInfo.data),i.collectCompositePorts(e.metadata.def.composite,e.metadata.def.ports),i.changeNode(o.nodeId)},function(e){n.pop("error","获取项目信息失败: "+e.msg)}).finally(function(){i.expandGroup(e),requestAnimationFrame(function(){t.go("app.predict.edit.group",{groupId:t.params.nodeId})})}):n.pop("warning","该组件缺少运行的项目")}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.setting",{deepStateRedirect:{default:"app.predict.edit.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.edit.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.edit.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService","logService",function(e,t,o,n,r,i){let a=$("#editor .nodes #"+t.nodeId);if(!a||0===a.length)return void e.go("app.predict.edit");o.nodeId=t.nodeId,o.node=r.getNode(o.nodeId),n.$broadcast("toggle.node",o.node),o.nodeTabInfo=o.node.metadata.ui.tabs,o.componentId=o.node.component,n.nodeCompType=o.node.metadata.def.type;let s=n.appConfig._board?n.appConfig._board.id:null;o.logId=i.getLogId(window.appConfig.userId,t.id,t.nodeId,s),o.resetTabInfo(o.node.metadata.def.params,o.nodeTabInfo),998===n.nodeCompType&&(o.appList=[],appService.list(9999,"predict").then(function(e){e&&e.list&&(o.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){toaster.pop("error","获取项目列表失败: "+e.msg)})),o.updateCompositeAppId=function(e){o.node.metadata.def.compositeParams=[],o.node.metadata.def.ports=[],o.node.metadata.def.compositeApp=_.find(o.appList,{id:e}),appService.get(e).then(function(e){o.node.metadata.def.ports=[],o.node.metadata.def.composite=JSON.parse(e.appInfo.data),r.collectCompositePorts(o.node.metadata.def.composite,o.node.metadata.def.ports),r.changeNode(t.nodeId),o.save()},function(e){toaster.pop("error","获取项目信息失败: "+e.msg)})},o.$watch("node",function(e,t){e!==t&&o.save()},!0),o.node,$(document).on("keydown.node.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),n.removeNode(o.node,"app.predict.edit");break;case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),"dashboard"==o.node.component?n.copiedNode=null:(n.copiedNode=angular.copy(o.node.metadata),n.copiedComp=angular.copy(o.node.component),_.has(n.copiedNode,"apiName")&&delete n.copiedNode.apiName));break;case 37:o.node.metadata.x-=1,r.changeNode(o.nodeId);break;case 38:o.node.metadata.y-=1,r.changeNode(o.nodeId);break;case 39:o.node.metadata.x+=1,r.changeNode(o.nodeId);break;case 40:o.node.metadata.y+=1,r.changeNode(o.nodeId)}}),a.addClass("selected");let c=r.hightEdges(t.nodeId);o.$on("$destroy",function(){a.removeClass("selected"),$(document).off("keydown.node.edit"),$(c).removeClass("active"),n.nodeCompType=void 0,n.$broadcast("toggle.node",null)})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.node.setting",{deepStateRedirect:{default:"app.predict.edit.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.predict.edit.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.edit.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.edit.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.edit.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.multi",{url:"/nodes",params:{nodes:null},deepStateRedirect:{default:"app.predict.edit.multi.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","nodeService",function(e,t,o,n,r){if(!t.nodes||!t.nodes.length)return void e.go("app.predict.edit");o.getMultiNodes=function(){return _.map(t.nodes,function(e){return r.getNode(e)})};$(document).on("keydown.node.edit",function(e){var t,i=$(e.target);if(!i.is("input")&&!i.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation();const i=o.getMultiNodes();n.removeMultiNodes(i,"app.predict.edit");break;case 67:(e.ctrlKey||e.metaKey)&&e.stopPropagation();break;case 37:case 38:case 39:case 40:t=e.keyCode,_.forEach(o.nodes,function(e){switch(t){case 37:e.metadata.x-=10,r.changeNode(e.id);break;case 38:e.metadata.y-=10,r.changeNode(e.id);break;case 39:e.metadata.x+=10,r.changeNode(e.id);break;case 40:e.metadata.y+=10,r.changeNode(e.id)}})}});for(var i=0;i<t.nodes.length;i++){$("#editor #"+t.nodes[i]).addClass("selected")}o.$on("multi.nodes.add",function(e,t){$("#editor #"+t.nodeId).addClass("selected")}),o.$on("multi.nodes.remove",function(e,t){$("#editor #"+t.nodeId).removeClass("selected")}),o.$on("$destroy",function(){for(var e=0;e<t.nodes.length;e++){$("#editor #"+t.nodes[e]).removeClass("selected")}$(document).off("keydown.node.edit")})}]},"footer-middle@app":{template:""}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.multi.setting",{deepStateRedirect:{default:"app.predict.edit.multi.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.predict.edit.multi":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.multi.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_multi_edit.html",controller:"expMultiSettingOverviewController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.edge",{params:{edgeId:null},deepStateRedirect:{default:"app.predict.edit.edge.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","nodeService",function(e,t,o,n){let r=$("#"+t.edgeId);if(!r||0===r.length)return void e.go("app.predict.edit");r.addClass("selected"),r.parent().append(r);let i=t.edgeId.split("-");o.edge=n.getEdge(i[1],i[2],i[4],i[3]),_.get(o.edge,"metadata.color")||_.set(o.edge,"metadata.color","#a6a6a6"),_.get(o.edge,"metadata.size")||_.set(o.edge,"metadata.size",1);const{from:a,to:s,metadata:c}=o.edge;o.$watch("edge.metadata.color",function(e){n.setEdgeMetadata(a.node,a.port,s.node,s.port,c)}),o.onChangeSize=function(){n.setEdgeMetadata(a.node,a.port,s.node,s.port,c)},o.fromPort=n.getPort(i[1],i[2]),o.toPort=n.getPort(i[4],i[3]),o.subTypeMismatch=o.fromPort.subType!=o.toPort.subType,$(document).on("keydown.edge.edit",function(t){let n=$(t.target);if(!n.is("input")&&!n.is("textarea"))switch(t.keyCode){case 46:case 8:t.stopPropagation(),o.removeEdge(o.edge,_.get(e,"current.name").split(".edge")[0])}}),o.$on("$destroy",function(){r.removeClass("selected"),$(document).off("keydown.edge.edit")})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.edge.setting",{deepStateRedirect:{default:"app.predict.edit.edge.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"}]},views:{"panel@app.predict.edit.edge":{templateUrl:"/tpl/custom/panels/index.html",controller:["$state","$scope",function(e,t){t.tabs=angular.copy(e.current.data.tabs),t.currentTab={},t.$on("$destroy",function(){})}]}}}).state("app.predict.edit.edge.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_edge.html",controller:["$state","$scope",function(e,t){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN")}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.prepare",{deepStateRedirect:{default:"app.predict.prepare.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.middle.html",controller:"prepareController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.prepare.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.prepare.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.prepare.setting",{deepStateRedirect:{default:"app.predict.prepare.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.prepare.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.prepare.node.setting",{deepStateRedirect:{default:"app.predict.prepare.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"},{name:{zh_CN:"测试"},type:"test",url:".test"}]},views:{"panel@app.predict.prepare.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.prepare.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.prepare.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.prepare.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.prepare.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.prepare.node.setting.test",{url:"/test",data:{type:"test"},views:{tab:{templateUrl:"/tpl/custom/tabs/tab_test.html",controller:"predictNodeSettingTestController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.group",{url:"/group/:groupId",params:{nodes:null},deepStateRedirect:{default:"app.predict.edit.group.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService",function(e,t,o,n,r,i,a){n.group=a.getGroup(t.groupId),n.group;let s=$("#editor #"+t.groupId);o.nodeTabInfo={params:{controls:[],tabName:{en_US:"Parameters Setting",zh:"参数设置",zh_CN:"参数设置"}}},n.nodeCompType="group",s.addClass("selection");let c=a.getGroupConnections(a.getGraph().toJSON(),o.group);a.collectGroupInport(c.inConnections,[]),a.collectGroupOutport(c.outConnections,[]),$(document).on("keydown.group.edit",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 46:case 8:e.stopPropagation(),n.removeGroup(n.group,"app.predict")}}),o.$on("$destroy",function(){n.nodeCompType=void 0,s.removeClass("selection"),$(document).off("keydown.group.edit")})}]},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.edit.group.middle.html",controller:["$scope","$rootScope","$stateParams","appService","nodeService","$state","common",function(e,t,o,n,r,i,a){let s=function(){e.a={},r.getChildGroup(o.groupId).length&&(e.a.canotFold=!0)};r.getGraph()?s():e.$on("editor.ready",function(){s()}),e.doFold=function(){r.foldGroup(o.groupId),requestAnimationFrame(function(){i.go("app.predict.edit.node",{nodeId:o.groupId})})}}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.edit.group.setting",{deepStateRedirect:{default:"app.predict.edit.group.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"}]},views:{"panel@app.predict.edit.group":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.edit.group.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_group.html",controller:"expGroupSettingOverviewController"}}}).state("app.predict.edit.group.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.read",{deepStateRedirect:{default:"app.predict.read.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.read.middle.html",controller:["$scope","$rootScope","toaster","appService","$stateParams","$state","$window","enabledUser",function(e,t,o,n,r,i,a){e.requireEdit=function(){n.setPermission(r.id).then(function(e){r.nodeId?i.go("app.predict.edit.node",{nodeId:r.nodeId}):i.go("app.predict.edit")},function(e){o.pop("error","请求失败: "+e.msg)})},t.stateAlert={type:"info",message:"当前状态仅支持查看，请在“编辑”状态下进行编辑"},e.$on("$destroy",function(){t.stateAlert=null})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.read.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.read.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.read.setting",{deepStateRedirect:{default:"app.predict.read.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.read.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.read.node.setting",{deepStateRedirect:{default:"app.predict.read.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"}]},views:{"panel@app.predict.read.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.read.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.read.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.read.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.read.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.run",{deepStateRedirect:{default:"app.predict.run.setting",params:!0},views:{"header@app":{templateUrl:"/tpl/blocks/header_edit.html",controller:"readController"},"footer-middle@app":{templateUrl:"/tpl/custom/footer/app.predict.run.middle.html",controller:["$scope","$rootScope","toaster","$stateParams","$timeout","predictService","nodeService","APP_STATUS","instantNodeLogService","eventService",function(e,t,o,n,r,i,a,s,c,p){const l=n.id,d=function(){t.sockets&&t.sockets[l]&&(t.sockets[l].disconnect(),t.sockets[l]=null)};let u=function(){let e=o.pop({type:"info",title:"正在删除临时文件",timeout:0});hardwareService.post("storage.remove",{boardId:t.appConfig._board.id,appId:l,keys:["tmp"]}).then(function(t){o.clear(e),e=void 0,o.pop("success","删除完成")})};t.release=function(){return t.appConfig._board?hardwareService.post("app/release",{boardId:t.appConfig._board.id,appId:l}).then(function(e){r(u,8e3)}):(d(),i.release(l))},t.showFlowAnimation=!1,t.toggleDataFlowAnimation=function(){t.showFlowAnimation=!t.showFlowAnimation,c.toggleAnimation(t.showFlowAnimation)},e.$on("$destroy",function(){d(),delete t.release,delete t.toggleDataFlowAnimation,delete t.showFlowAnimation})}]}}})}]),angular.module("app").config(["$stateProvider",function(e){e.state("app.predict.run.node",{url:"/:nodeId",params:{nodeId:null},deepStateRedirect:{default:"app.predict.run.node.setting",params:!0},views:{"page-panel@app.predict":{template:"<div ui-view='panel'></div>",controller:"readNodeController"}}}).state("app.predict.run.setting",{deepStateRedirect:{default:"app.predict.run.setting.overview",params:!0},data:{info:{type:"setting"},tabs:[{name:{zh_CN:"项目属性"},type:"overview",url:".overview"}]},views:{"panel@app.predict":{templateUrl:"/tpl/custom/panels/index.html",controller:"expSettingController"}}}).state("app.predict.run.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview.html",controller:"expSettingOverviewController"}}}).state("app.predict.run.node.setting",{deepStateRedirect:{default:"app.predict.run.node.setting.overview",params:!0},sticky:!0,data:{info:{type:"setting"},tabs:[{name:{zh_CN:"概览"},type:"overview",url:".overview"},{type:"params",url:".params"},{type:"fields",url:".fields"},{type:"tune",url:".tune"},{name:{zh_CN:"调试日志"},type:"debug",url:".debug",icon:"iconziduan"},{name:{zh_CN:"测试"},type:"test",url:".test"}]},views:{"panel@app.predict.run.node":{templateUrl:"/tpl/custom/panels/index.html",controller:"nodeSettingController"}}}).state("app.predict.run.node.setting.overview",{data:{type:"overview"},views:{tab:{templateUrl:"/tpl/custom/tabs/overview_node_edit.html",controller:"expNodeSettingOverviewController"}}}).state("app.predict.run.node.setting.fields",{data:{type:"fields"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.params",{data:{type:"params"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.tune",{data:{type:"tune"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.debug",{data:{type:"debug"},views:{tab:{templateUrl:"/tpl/custom/tabs/controlList.html",controller:"controlListController"}}}).state("app.predict.run.node.setting.test",{url:"/test",data:{type:"test"},views:{tab:{templateUrl:"/tpl/custom/tabs/tab_test.html",controller:"predictNodeSettingTestController"}}})}]),(app=angular.module("app")).filter("moment",function(){return function(e,t){return moment(e).isValid()?moment(e).format(t):"-"}}),app.filter("duration",function(){return function(e,t){return t?moment.duration(moment(t).valueOf()-moment(e).valueOf(),"milliseconds").format("h小时mm分钟ss秒"):"-"}}),app.filter("portState",function(){return function(e,t){return e.filter(function(e){return"all"===e.state||e.state===t})}}),app.filter("runStatusColor",function(){return function(e){switch(e){case"running":return"#1976d2";case"success":return"#388e3c";case"failed":case"stopped":return"#d32f2f";case"outdated":return"#512da8";case"userResourceLimit":case"systemResourceLimit":return"#d32f2f";default:return"#000"}}}),app.filter("runStatus",function(){return function(e){switch(e){case"running":return"运行中";case"success":return"成功";case"failed":return"失败";case"stopped":return"停止";case"outdated":return"已过期";case"userResourceLimit":return"用户资源不足";case"systemResourceLimit":return"系统资源不足";default:return"-"}}}),app.filter("runType",function(){return function(e){switch(e){case"runStart":return"从此处开始运行";case"runStop":return"运行到此处";case"runStartStop":return"运行该节点";default:return e}}}),app.filter("limitLength",function(){return function(e,t){return e&&"string"==typeof e?(t=t||12,e.length>t?e.substr(0,t)+"...":e):e}}),app.filter("sortByNum",function(){return function(e){return e.sort(function(e,t){return e.index>t.index})}}),app.filter("sortByZindex",function(){return function(e){return e.sort(function(e,t){return parseInt(e.css.zIndex)>parseInt(t.css.zIndex)})}}),app.filter("parseRotate",function(){return function(e){if(!(e=parseInt(e)))return 0;if(e<0){let t=function(e){return(e+=360)<0?t(e):e};e=t(e)}return Math.round(e%360)}}),app.filter("xss",function(){return function(e){if(!(e=parseInt(e)))return 0;if(e<0){let t=function(e){return(e+=360)<0?t(e):e};e=t(e)}return Math.round(e%360)}}),app.filter("page",function(){return function(e,t,o){if(!e||!t)return;let n=(t-1)*o,r=n+o;return e.slice(n,r)}}),app.filter("tag",function(){return function(e,t){return e&&t?"all"==t?e:e.filter(function(e){return e.tags&&-1!=e.tags.indexOf(t)}):e}}),app.filter("size",function(){return function(e,t){if(!e)return;if(0===(e=parseInt(e)))return"0 B";let o=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,o)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][o]}}),app.filter("cut",function(){return function(e,t,o,n){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;let r=0,i=0;for(;i<e.length&&!(r>o);i++){let t=e.charCodeAt(i);t>=1&&t<=126||65376<=t&&t<=65439?r++:r+=2}if(e=e.substr(0,i-1),t){let t=e.lastIndexOf(" ");-1!==t&&("."!==e.charAt(t-1)&&","!==e.charAt(t-1)||(t-=1),e=e.substr(0,t))}return e+(n||" …")}}),app.filter("trustAsResourceUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),app.filter("profilePicture",["layoutPaths",function(e){return function(t,o,n){return o=o||"profile",n=n||"png",e.images[o]+t+"."+n}}]),angular.module("app").constant("SUBTYPES",[{name:"所有类型",value:"all"},{name:"数字",value:"number"},{name:"布尔值",value:"bool"},{name:"字符串",value:"string"},{name:"JSON",value:"json"},{name:"文件",value:"file"},{name:"文件夹",value:"folder"},{name:"Npy文件",value:"npy"},{name:"模型",value:"model"},{name:"图片",value:"image"},{name:"Csv文件",value:"csv"},{name:"数据库表",value:"table"},{name:"h5文件",value:"hdf5"},{name:"Parquet文件",value:"parquet"},{name:"Sqlite数据文件",value:"sqlite"}]).controller("controlListController",["$scope","$stateParams","$state","toaster","nodeService","$parse","$rootScope","common","$timeout","$q","tableService","PARAM_TYPES",function(e,t,o,n,r,i,a,s,c,p,l,d){e.currentTab.type=o.current.data.type,e.tabInfo=e.nodeTabInfo[o.current.data.type],e.currentTab.title=_.get(e.nodeTabInfo[e.currentTab.type],"tabName.zh_CN"),e.nodeId=t.nodeId,e.tabInfo||o.go("app.predict.edit.node.setting",{nodeId:t.nodeId});let u=o.current.data.type;if(o.current.name.indexOf("customize")>-1&&("fields"==u||"params"==u||"tune"==u)&&(a.secondEditor=!0),e.controlListScope={},e.model={},e.globalVarModel={},o.includes("app.customize"))for(let t=0;t<e.tabInfo.controls.length;t++){let o=e.tabInfo.controls[t];e.model[o.uuid]=a.paramsModel.control[o.uuid]}else if("group"===a.nodeCompType||[998,999].includes(a.nodeCompType)){let t;$(".edit_tools").on("mouseenter.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideDown().end().siblings().children(".btn-collapse-list").slideUp()}).on("mouseleave.toggle.groupControl",".btn-collapse .dropdown-menu > li",function(){$(this).children(".btn-collapse-list").slideUp()}),"group"===a.nodeCompType?(e.group.metadata.params||(e.group.metadata.params=[]),t=e.group.metadata.params):998!==a.nodeCompType&&999!==a.nodeCompType||(e.node.metadata.def.compositeParams||(e.node.metadata.def.compositeParams=[]),t=e.node.metadata.def.compositeParams);const o=function(o,n){const r={id:n,label:o.metadata.label,controls:[]};e.groupNodes.push(r),Object.keys(o.metadata.ui.tabs).forEach(function(e){o.metadata.ui.tabs[e].controls.forEach(function(e){r.controls.push(e)})});for(let r=0;r<t.length;r++){let i=t[r];if(i.nodeId===n){for(let t in o.metadata.def.params){let n=o.metadata.def.params[t];if(n.controlInstUuid===i.controlId){e.model[i.controlId]={meta:n};break}}break}}},n=function(){if(e.groupNodes=[],"group"===a.nodeCompType)e.tabInfo.controls=r.genGroupTabInfo(t),e.group.nodes.forEach(function(e){const t=r.getNode(e);o(t,e)});else if(998===a.nodeCompType||999===a.nodeCompType){if(!e.node.metadata.def.composite)return;if(998===a.nodeCompType&&e.node.metadata.def.composite.properties.globalVars){let t={id:"global",label:"全局变量",controls:[]};e.node.metadata.def.composite.properties.globalVars.forEach(function(o){e.globalVarModel[o.id]=o,t.controls.push(o)}),e.groupNodes.push(t)}e.tabInfo.controls=r.genCompositeTabInfo(t,e.node.metadata.def.composite.processes,e.node.metadata.def.composite.properties.globalVars),Object.keys(e.node.metadata.def.composite.processes).forEach(function(t){const n=e.node.metadata.def.composite.processes[t];o(n,t)})}};e.addGroupGlobalVar=function(o){for(let e=0;e<t.length;e++){if(t[e].id===o.id)return}t.push({type:"global",id:o.id}),n(),e.save()},e.removeGroupGlobalVar=function(o){for(let e=0;e<t.length;e++){if(t[e].id===o){t.splice(e,1);break}}n(),e.save()},e.addGroupControl=function(o,r){for(let e=0;e<t.length;e++){let n=t[e];if(n.nodeId===o&&n.controlId===r)return}t.push({nodeId:o,controlId:r}),n(),e.save()},e.removeGroupControl=function(o){for(let e=0;e<t.length;e++){if(t[e].controlId===o){t.splice(e,1);break}}n(),e.save()},n()}else for(let t=0;t<e.tabInfo.controls.length;t++){let o=e.tabInfo.controls[t],n=!1;for(let t in e.node.metadata.def.params){let r=e.node.metadata.def.params[t];if(r.controlInstUuid===o.uuid){e.model[o.uuid]={meta:r},n=!0;break}}n||o.uuid}e.checkExists=function(t){if(o.includes("app.customize"))return!0;try{if(t.relations&&t.relations.hide&&t.relations.hide.enabled){let t=t.relations.hide,o=e.node.metadata.def.params[t.key].value;switch(t.operator){case"==":return o===t.value;case"!=":return o!==t.value;case">":return o>t.value;case"<":return o<t.value;case">=":return o>=t.value;case"<=":return o<=t.value}}}catch(e){}return!0},e.removeControl=function(n){for(let t=0;t<e.tabInfo.controls.length;t++)e.tabInfo.controls[t].uuid===n&&e.tabInfo.controls.splice(t,1);delete a.paramsModel.control[n],delete e.model[n],t.controlId===n&&o.go("app.customize.setting",{controlId:null})},e.arrayToString=function(e){return e&&e.length?e.join(","):""},e.addControl=function(t){if("upload_file"==t&&_.findIndex(_.values(e.tabInfo.controls),{type:"upload_file"})>-1)return n.pop("warning","每个组件中只能有一个文件上传参数"),null;let r=s.uuid(),i={uuid:r,type:t,label:{zh_CN:d[t]&&d[t].label||"标签"},placeholder:{zh_CN:d[t]&&d[t].placeholder||"占位提示文本"},tooltip:{zh_CN:d[t]&&d[t].tooltip||""},relations:{}};"select"!=t&&"multiselect"!=t||(i.options=[]),e.tabInfo.controls.push(i);const c={};"upload_file"==t&&(c.outPortUuid="out1",c.fileType="files"),a.paramsModel.control[r]={meta:c},o.go(".",{controlId:r})},e.a={},e.a.openMenu=!1,$(document).on("click.toggle.controlList.menu",function(t){e.a.openMenu=!1,a.$$phase||a.$apply()}),e.appId=t.id,e.nodeId=t.nodeId,e.fileUploadPath=function(e){return s.getUploadDataPath(e)},e.onAllFileUploadFinish=function(t,o){const n=_.find(e.node.metadata.def.params,{controlInstUuid:o}),r=_.find(e.node.metadata.def.params,{propertyName:"dataName",defOutPortUuid:n.outPortUuid});n.value=t,r.value=t},e.onCheckedFileChange=function(){r.changeNode(e.nodeId)},e.$on("$destroy",function(){$(document).off("click.toggle.controlList.menu"),$(".edit_tools").off("mouseenter.toggle.groupControl").off("mouseleave.toggle.groupControl")})}]).controller("editControlController",["$scope","$stateParams","$state","xssList","nodeService","$rootScope",function(e,t,o,n,r,i){if(e.tabInfo=e.nodeTabInfo[o.current.data.type],e.outportPropertyList=["tableName","partitionName","modelName","visualName","dataName"],e.inportList=_.filter(_.keys(e.paramsModel.port),function(e){return 0==e.indexOf("in")}),e.outportList=_.filter(_.keys(e.paramsModel.port),function(e){return 0==e.indexOf("out")}),t.controlId){for(let o=0;o<e.tabInfo.controls.length;o++){let n=e.tabInfo.controls[o];n.uuid===t.controlId&&(e.control=n)}let o=e.paramsModel.control[t.controlId];o&&"colselect"==e.control.type?_.hasIn(o,"inport")||_.isEmpty(e.inportList)||(o.inport=e.inportList[0]):!o||"table_select"!=e.control.type&&"partition_select"!=e.control.type&&"upload_file"!=e.control.type&&"file_select"!=e.control.type||(_.hasIn(o,"outport")||_.isEmpty(e.outportList)||(o.outport=e.outportList[0]),_.hasIn(o,"meta.defOutPortUuid")||_.isEmpty(e.outportList)||"upload_file"!=e.control.type&&"file_select"!=e.control.type||(o.meta.outPortUuid=e.outportList[0]))}else e.tabInfo.controls.length>0&&o.go(".",{controlId:e.tabInfo.controls[0].uuid});e.addOption=function(e){e.options.push({name:{zh_CN:""},value:""})},e.removeOption=function(e,t){e.options.splice(t,1)},e.a={},e.a.chooseControl=!1,e.a.chooseOperator=!1,$(document).on("click.toggle.choose",function(t){e.a.chooseControl=!1,e.a.chooseOperator=!1,i.$$phase||i.$apply()}),e.$on("$destroy",function(){$(document).off("click.toggle.choose")})}]).controller("editComponentController",["$scope","$stateParams","$state","SUBTYPES","nodeService","$sce","$rootScope","common","ossService","componentService","toaster",function(e,t,o,n,r,i,a,s,c,p,l){if(e.currentTab.type=o.current.data.type,e.currentTab.title=_.get(_.find(e.tabs,{type:e.currentTab.type}),"name.zh_CN"),_.forEach(e.node.metadata.def.actionList,function(e){_.isEmpty(e.url)&&(e.port||e.absolute)&&(e.url="{{protocol}}//"+(appConfig.proxyHost?"{{proxyHost}}":"{{host}}")+"/"+(e.absolute?"proxy":"proxr")+"/{{userId}}/{{appId}}/{{nodeId}}/"+e.port+"/")}),e.componentInfo=e.node.metadata,_.has(e.componentInfo,"icon")||(e.componentInfo.icon="cube"),_.has(e.componentInfo,"def.description.zh_CN")){const t=s.handleLinkInDesc(e.componentInfo.def.description.zh_CN);e.componentDescription=i.trustAsHtml(t)}else e.componentDescription=i.trustAsHtml("");let d;_.has(e.node,"metadata")&&!_.has(e.node,"metadata.color")&&(e.node.metadata.color=s.getInitedNodeColor(_.get(e.node.metadata,"nodeStyle"))),e.$watch("node.metadata.color",function(t){r.changeNode(e.nodeId)}),_.forEach(e.componentInfo.def.ports,function(e){_.isEmpty(e.subType)&&(e.subType="all"),_.isEmpty(e.type)&&(e.type="data")}),e.dataTypes=[{type:"",title:"无",state:"all"},{type:"table",title:"数据表",state:"all"},{type:"model",title:"模型",state:"all"},{type:"visual",title:"可视化数据",state:"out"},{type:"data",title:"非结构化数据",state:"all"},{type:"system",title:"系统事件",state:"in"}],e.subTypes=n,e.changeNodeName=function(o){_.isEmpty(o)?l.pop("warning","组件名称不能为空"):(e.node.metadata.label=o,r.changeNode(e.nodeId),p.changeName(t.componentId,o).then(function(e){a.$broadcast("node.list.reload")},function(e){l.pop("error","修改组件名称失败: "+e.msg)}))},e.stringToArray=function(e){return e?JSON.parse(e):[]},e.nodeTagsValid={validated:!0,tags:[]},e.tags=e.stringToArray(e.compInfo.tags),e.changeNodeTags=function(o){o||(o=[]);let n={},r=[];e.nodeTagsValid.validated=!0,e.nodeTagsValid.tags=[],o.forEach(function(t){let o=(t+"").trim();if(_.isEmpty(o)||!/^[a-z][A-Za-z0-9\:\.\_\-]+$/.test(o))return e.nodeTagsValid.validated=!1,void e.nodeTagsValid.tags.push(t);n[o]=1});for(let e in n)r.push(e);e.compInfo.tags=JSON.stringify(r),_.isEqual(e.tags,r)||(e.tags=r),a.$broadcast("node.tags.changed",{nodeId:t.componentId,tags:e.compInfo.tags}),d&&(clearTimeout(d),d=void 0),d=setTimeout(function(){d=void 0,p.changeTags(t.componentId,e.compInfo.tags).then(function(){},function(e){l.pop("error","更新组件标签失败: "+e.msg)})},500)},a.secondEditor=!1,e.changeNodeIcon=function(t){e.node.metadata.icon=t,r.changeNode(e.nodeId)},e.changePortSubType=function(t,o){let n=e.compInfo.tags,r=[],i=[],a={};n&&(r=JSON.parse(n)),r.forEach(function(e){0!==e.indexOf("in:")&&0!==e.indexOf("out:")&&i.push(e)}),e.componentInfo.def.ports.forEach(function(e){_.isEmpty(e.type)||_.isEmpty(e.subType)?delete e.autoReceive:e.display&&(a[e.ioType+":"+e.type+"."+e.subType]=1)});for(let e in a)i.push(e);e.changeNodeTags(i)},e.changeVisibility=function(t){o.includes("app.customize")&&(a.change(t),e.changePortSubType())},e.addPort=function(t){let o=0,n="in"==t?"输入数据":"输出数据";e.componentInfo.def.ports.forEach(function(e){e.ioType===t&&o++});let r=t+(o+1);e.componentInfo.def.ports.push({uuid:r,description:{en_US:"input data",zh_CN:n},display:!0,ioType:t,type:"data",subType:"all"}),e.paramsModel.port[r]={data:t+"putData"+(o+1)},a.change("port")},e.deletePort=function(t){let o=t.ioType;if(1==_.filter(e.componentInfo.def.ports,{ioType:o}).length)return;let n=s.getIndexFromPortUuid(t.uuid);e.componentInfo.def.ports.forEach(function(t,r){if(t.ioType===o){s.getIndexFromPortUuid(t.uuid)===n&&e.componentInfo.def.ports.splice(r,1)}}),e.componentInfo.def.ports.forEach(function(e,t){if(e.ioType===o){let t=s.getIndexFromPortUuid(e.uuid);t>n&&(e.uuid=o+(t-1))}})},e.changePortType=function(e,t,o,n,r,i){switch("system"===i.type&&(i.display=!1,i.subType=void 0,i.autoReceive=void 0),e){case"":case"system":o[n]={};break;case"table":o[n]={table:t+"Table"+(r+1),partition:t+"Partition"+(r+1)};break;case"model":o[n]={model:t+"Model"+(r+1)};break;case"visual":o[n]={visual:t+"Visual"+(r+1)};break;case"data":o[n]={data:t+"Data"+(r+1)}}},e.port_errors={},e.changeTargetPort=function(t,o,n){e.port_errors[t+"_"+n]=void 0;const i=r.getPort(o.targetNode,o.targetPort);i?(o.type=i.type,o.description=angular.copy(i.description),e.compMetadata.def.params={},r.genParamsFromPorts(e.compMetadata.def.ports,e.compMetadata.def.params)):e.port_errors[t+"_"+n]="节点或端口未找到"},e.componentTypeList=[{name:{zh_CN:"算法组件"},value:"algo"},{name:{zh_CN:"服务组件"},value:"service"},{name:{zh_CN:"模型组件"},value:"model"},{name:{zh_CN:"RPA组件"},value:"rpa"},{name:{zh_CN:"前面板组件"},value:"dashboard"},{name:{zh_CN:"RTO组件"},value:"rto"}];const u=function(t){"algo"===t?e.typeList=[{name:{zh_CN:"Spark Java"},value:7},{name:{zh_CN:"Spark Python"},value:2},{name:{zh_CN:"ODPS Python"},value:3},{name:{zh_CN:"ODPS MR"},value:4},{name:{zh_CN:"Python"},value:5},{name:{zh_CN:"Java"},value:6},{name:{zh_CN:"Runtime"},value:12},{name:{zh_CN:"SupRuntime"},value:13},{name:{zh_CN:"Data File"},value:21},{name:{zh_CN:"Composite"},value:999},{name:{zh_CN:"Composite App"},value:998},{name:{zh_CN:"Spark Java (deprecated)"},value:1}]:"service"===t?e.typeList=[{name:{zh_CN:"Runtime"},value:12},{name:{zh_CN:"SupRuntime"},value:13},{name:{zh_CN:"DashboardPage"},value:23},{name:{zh_CN:"Send File"},value:31},{name:{zh_CN:"Web Input"},value:10002},{name:{zh_CN:"Web Output"},value:10003},{name:{zh_CN:"Hardware"},value:50},{name:{zh_CN:"Hardware Network"},value:51},{name:{zh_CN:"Composite App"},value:998}]:"model"===t?e.typeList=[{name:{zh_CN:"model"},value:10001}]:"dashboard"===t?e.typeList=[{name:{zh_CN:"dashboard"},value:22}]:"rpa"===t?e.typeList=[{name:{zh_CN:"通用"},value:501},{name:{zh_CN:"Office Excel"},value:502},{name:{zh_CN:"浏览器"},value:503},{name:{zh_CN:"流程控制"},value:504},{name:{zh_CN:"系统"},value:505},{name:{zh_CN:"文件处理"},value:506}]:"rto"===t&&(e.typeList=[{name:{zh_CN:"RTO"},value:601}]);let o=!1;for(let t=0;t<e.typeList.length;t++)e.typeList[t].value==e.componentInfo.def.type&&(o=!0);o||(e.componentInfo.def.type=e.typeList[0].value)};e.$watch("compInfo.type",function(e,t){e!==t&&u(e)}),e.changeCodeType=function(){r.changeNode(e.nodeId)},u(e.compInfo.type),e.$watch("componentInfo.def.ports",function(t,o){r.changeNode(e.nodeId)},!0),e.uploadCode=function(){let o,n=e.codeFile;e.codeFile=void 0,e.b.uploadingStatus="正在上传",o=1===e.b.uploadMode?s.getUploadPath(window.appConfig.userId,t.componentId,e.componentInfo.def.type):e.componentInfo.def.codePath||s.getUploadPath(window.appConfig.userId,t.componentId,e.componentInfo.def.type),c.upload(o,n,function(t){e.b.uploadingStatus="正在上传 "+Math.round(t.loaded/t.total*100)+"%",a.$$phase||e.$digest()},function(t){e.b.uploadingStatus="上传失败",e.target.value="",a.$$phase||e.$digest()},function(t){e.componentInfo.def.codePath=o,e.b.uploadingStatus="已上传",e.target.value="",a.$$phase||a.$apply()}).then(function(){},function(){e.b.uploadingStatus="上传失败",a.$$phase||e.$digest()})},$("#upload_code").on("change",function(t){e.codeFile=t.target.files[0],e.target=t.target,a.$$phase||e.$digest()});const f=s.getUploadPyLibPath(window.appConfig.userId,t.componentId);$("#upload_py_lib").on("change",function(t){let o=t.target.files[0];e.uploadingPyLibStatus="正在上传";c.upload(f,o,function(t){e.uploadingPyLibStatus="正在上传 "+Math.round(t.loaded/t.total*100)+"%",a.$$phase||e.$digest()},function(t){e.uploadingPyLibStatus="上传失败",a.$$phase||e.$digest()},function(t){e.componentInfo.def.pyLibPath=f,e.uploadingPyLibStatus="已上传",a.$$phase||a.$apply()}).then(function(){},function(){e.uploadingPyLibStatus="上传失败",a.$$phase||e.$digest()})})}]).controller("publishController",["$scope","$stateParams","$state",function(e,t,o){e.$on("$destroy",function(){})}]).controller("nodeSettingController",["$state","$stateParams","$scope","nodeTabIcon",function(e,t,o,n){o.tabs=[];for(let t=0;t<e.current.data.tabs.length;t++){let r=angular.copy(e.current.data.tabs[t]);if(r.icon=_.get(n,r.type),o.nodeTabInfo&&o.nodeTabInfo[r.type])if(e.includes("app.customize")||"group"===o.nodeCompType||998===o.nodeCompType||999===o.nodeCompType)r.name=o.nodeTabInfo[r.type].tabName,o.tabs.push(r);else{const e=_.map(o.nodeTabInfo[r.type].controls,"uuid"),t=!_.isEmpty(e)&&_.filter(o.node.metadata.def.params,function(t){return _.indexOf(e,t.controlInstUuid)>-1&&!t.hidden});o.nodeTabInfo[r.type].controls&&!_.isEmpty(t)&&(r.name=o.nodeTabInfo[r.type].tabName,o.nodeTabInfo[r.type].required&&(r.required=!0),o.tabs.push(r))}"test"===r.type&&10002===o.nodeCompType&&e.includes("app.predict.run")&&o.tabs.push(r),"overview"!==r.type&&"debug"!==r.type||o.tabs.push(r)}o.currentTab={},o.$on("$destroy",function(){})}]).controller("compositeSettingController",["$state","$stateParams","$scope","$timeout","$rootScope","common","nodeService",function(e,t,o,n,r,i,a){o.tabs=[];for(let t=0;t<e.current.data.tabs.length;t++){let n=angular.copy(e.current.data.tabs[t]);"overview"===n.type&&o.tabs.push(n)}o.currentTab={},o.node={metadata:o.compMetadata},o.$on("$destroy",function(){})}]).controller("expSettingController",["$state","$scope","$rootScope","common","nodeTabIcon",function(e,t,o,n,r){t.tabs=_.map(e.current.data.tabs,function(e){return Object.assign({},e,{icon:_.get(r,e.type)})}),t.currentTab={},o.secondEditor=!1}]).controller("expSettingOverviewController",["$scope","$stateParams","$state","appService","$rootScope","toaster","nodeService","$sce","common",function(e,t,o,n,r,i,a,s,c){if(e.currentTab.type=o.current.data.type,e.currentTab.title=_.get(_.find(e.tabs,{type:e.currentTab.type}),"name.zh_CN"),e.appInfo.description){const t=c.handleLinkInDesc(e.appInfo.description);e.appDescription=s.trustAsHtml(t)}else e.appDescription=s.trustAsHtml("");const p=a.getGraph();let l;o.includes("app.predict")&&(p.properties.predictConfig||(p.properties.predictConfig={isolationMode:"v2"}),p.properties.predictConfig.isolationMode||(p.properties.predictConfig.isolationMode="v1"),e.predictConfig=p.properties.predictConfig),p.properties.globalVars||(p.properties.globalVars=[{id:c.uuid()},{id:c.uuid()},{id:c.uuid()}]),e.globalVars=p.properties.globalVars,e.onUpdateName=function(e){_.isEmpty(e)?i.pop("warning","项目名称不能为空"):n.changeName(t.id,e).then(function(){window.updateAppName(t.type,t.id,e)},function(e){i.pop("error","修改名称失败: "+e.msg)})},e.changeDescription=function(){l&&(clearTimeout(l),l=void 0),l=setTimeout(function(){l=void 0,n.changeDescription(t.id,e.appInfo.description).then(function(){},function(e){i.pop("error","修改描述失败: "+e.msg)})},500)},r.onAppImageUploaded=function(e){e.indexOf("studio/")>-1?p.properties.preview="preview":p.properties.preview=e,r.doSave()},e.deployTargetList=[{name:"在线部署",value:"web"},{name:"边缘部署",value:"edge"}];const d="hardware"==r.appConfig._context?"http://"+r.appConfig._board.ip:window.appConfig.suanpanWebHost||location.origin;e.dashboard_url=d+"/dashboard/"+window.appConfig.userId+"/"+t.id,e.$on("$destroy",function(){})}]).controller("expGroupSettingOverviewController",["$state","$stateParams","$scope","nodeService",function(e,t,o,n){o.currentTab.type=e.current.data.type,o.currentTab.title=_.get(_.find(o.tabs,{type:o.currentTab.type}),"name.zh_CN"),o.$watch("group.metadata.name",function(e,o){n.changeGraph(t.groupId)})}]).controller("expNodeSettingOverviewController",["$state","$stateParams","$scope","common","nodeService","SUBTYPES","$sce","$rootScope","format","$uibModal",function(e,t,o,n,r,i,a,s,c,p){o.currentTab.type=e.current.data.type,o.currentTab.title=_.get(_.find(o.tabs,{type:o.currentTab.type}),"name.zh_CN"),o.changeNodeIcon=function(e){o.node.metadata.icon=e,r.changeNode(o.nodeId)},!_.has(o.node,"metadata.icon")&&_.set(o.node,"metadata.icon","cube");const l=r.getGraph();if(o.showNodeInfo="false"!=localStorage.detailCollapsed,o.onClickDetailToggle=function(){o.showNodeInfo=!o.showNodeInfo,localStorage.detailCollapsed=o.showNodeInfo},o.node&&o.node.metadata&&o.node.metadata.def.description){const e=n.handleLinkInDesc(o.node.metadata.def.description.zh_CN);o.nodeDescription=a.trustAsHtml(e)}else o.nodeDescription=a.trustAsHtml("");if(_.has(o.node,"metadata")&&!_.has(o.node,"metadata.color")&&(o.node.metadata.color=n.getInitedNodeColor(_.get(o.node.metadata,"nodeStyle"))),_.has(o.node,"metadata")&&!_.has(o.node,"metadata.size")&&(o.node.metadata.size="1"),998===s.nodeCompType&&(o.appList=[],appService.list(9999,t.type).then(function(e){e&&e.list&&(o.appList=_.filter(e.list,function(e){return e.id!=t.id}))},function(e){toaster.pop("error","获取项目列表失败: "+e.msg)})),_.forEach(_.get(o.node,"metadata.def.ports"),function(e){_.isEmpty(e.subType)&&(e.subType="all"),_.isEmpty(e.type)&&(e.type="data")}),o.webInputOrigin="hardware"==s.appConfig._context?location.protocol+"//"+s.appConfig._board.ip:location.protocol+"//"+o.appConfig.predictHost,o.subTypes=i,o.outputTypeArr=r.getNodeOutputTypeArr(t.nodeId),o.node&&21===o.node.metadata.def.type){o.localDataSeparator=[{name:{zh_CN:"英文逗号"},value:","},{name:{zh_CN:"空格"},value:" "}];const e=function(){let e=_.find(o.outputTypeArr,function(e){return"dataName"==e.propertyName});if(e){if(e.subType){const t=_.split(e.subType,".")[1];return"image"==t||"images"==t?"images":t}return"files"}};o.localData={meta:{type:e(),separator:",",file:""},files:[]},o.appId=t.id,o.nodeId=t.nodeId,o.fileUploadPath=n.getUploadNodeDataPath("out1"),o.onAllFileUploadFinish=function(e){o.node.metadata.def.params.outputData1.value=e}}o.$watch("node.metadata.label",function(e,t){e!==t&&r.changeNode(o.nodeId)}),o.$watch("node.metadata.color",function(e,t){e!==t&&r.changeNode(o.nodeId)}),o.$watch("node.metadata.size",function(e,t){e!==t&&r.changeNode(o.nodeId)}),o.goResult=function(t,o){switch(t){case"visualName":e.go("app.exp.edit.node.popup.chart",{portId:o})}},o.dataTypes=[{type:"",title:"无",state:"all"},{type:"table",title:"数据表",state:"all"},{type:"model",title:"模型",state:"all"},{type:"visual",title:"可视化数据",state:"out"},{type:"data",title:"非结构化数据",state:"all"},{type:"system",title:"系统事件",state:"in"}],o.addNotebookPort=function(e,t){let n=0,r="in"==e?"输入数据":"输出数据";o.node.metadata.def.ports.forEach(function(t){t.ioType===e&&n++}),o.node.metadata.def.ports.push({uuid:e+(n+1),description:{en_US:"input data",zh_CN:r},display:!0,ioType:e,type:"data",subType:"all"}),o.changeNotebookPortType(t)};const d=function(e,t){const i="def"+_.capitalize(e.ioType)+"PortUuid";let a=n.getIndexFromPortUuid(e.uuid);const s=o.node.metadata.def.params;o.node.metadata.def.ports.forEach(function(t,r){t.ioType===e.ioType&&(n.getIndexFromPortUuid(t.uuid)===a&&(o.node.metadata.def.ports.splice(r,1),_.forEach(_.keys(s),function(e){s[e].propertyName&&s[e][i]==t.uuid&&delete s[e]})))}),o.node.metadata.def.ports.forEach(function(o,c){if(o.ioType===e.ioType){let c=n.getIndexFromPortUuid(o.uuid);if(c>a){const n=e.ioType+(c-1);_.forEach(_.keys(s),function(e){s[e].propertyName&&s[e][i]==o.uuid&&(s[e][i]=n)}),o.uuid=n,r.updateEdges(e.ioType,t,c,o.uuid)}}}),o.changeNotebookPortType(t)},u=function(e,t){let o=p.open({animation:!0,templateUrl:"/tpl/custom/popup/alert.html",controller:["$scope","nodeService",function(n,r){n.alertTitle=t.title,n.alertIcon="iconfont iconjinggao text-danger",n.alertBody=t.body,n.ok=function(){_.forEach(e,function(e){r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)}),t.onOk(),o.close()},n.cancel=function(){"onCancel"in t&&t.onCancel(),o.close()},n.$on("modal.closing",function(){o=void 0})}],size:"sm",appendTo:""})},f=function(e,t){let o;if("out"===e.ioType){const n=r.getDownstreamNodeByPort(t,e.uuid);o=_.map(n,function(o){return r.getEdge(t,e.uuid,o.node,o.port)})}else if("in"===e.ioType){const n=r.getUpstreamNodeByPort(t,e.uuid);_.isEmpty(n)||(o=[r.getEdge(n.node,n.port,t,e.uuid)])}return o};o.deleteNotebookPort=function(e,t){const o=f(e,t);_.isEmpty(o)?d(e,t):u(o,{title:"删除端口",body:"端口"+e.uuid+"上有 "+o.length+" 条连线，确定全部删除吗?",onOk:function(){d(e,t)}})},o.changeNotebookPortType=function(e){const t=function(e){return e.replace("in","").replace("out","")},n=o.node.metadata.def.params,i=o.node.metadata.def.ports,a=[];for(let e in n)_.has(n[e],"propertyName")&&a.push({key:e,propertyName:_.get(n[e],"propertyName"),portUuid:n[e].defInPortUuid||n[e].defOutPortUuid});i.forEach(function(o){if("system"===o.type){const t=f(o,e);_.isEmpty(t)||_.forEach(t,function(e){r.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)})}if("system"===o.type)return o.display=!1,o.subType=void 0,void(o.autoReceive=void 0);if(_.isEmpty(o.type)||_.isEmpty(o.subType))return void delete o.autoReceive;if(_.isEmpty(o.type))return;let i="def"+_.capitalize(o.ioType)+"PortUuid";const s=_.findIndex(a,{portUuid:o.uuid});if(-1==s){let e={type:"string",propertyName:o.type+"Name"};if(e[i]=o.uuid,n[o.ioType+"put"+_.capitalize(o.type)+t(o.uuid)]=e,"table"===o.type){let r=_.clone(e);r.propertyName="partitionName",n[o.ioType+"putPartition"+t(o.uuid)]=r}}else{if("tableName"==a[s].propertyName&&"table"!=o.type){const e=_.findIndex(a,{portUuid:o.uuid,propertyName:"partitionName"});e>-1&&delete n[a[e].key]}if("tableName"!=a[s].propertyName&&"table"==o.type){const e=o.ioType+"putPartition"+t(o.uuid);n[e]={type:"string",propertyName:"partitionName"},n[e][i]=o.uuid}n[a[s].key].propertyName=o.type+"Name"}}),r.changeNode(e),r.analyzeGraph(),setTimeout(function(){r.hightEdges(e)},100)};const h=function(e,t){"in"==e.ioType&&e.display&&(e.autoReceive=!1),o.changeNotebookPortType(t)};o.onClickPortDisplay=function(e,t){const o=f(e,t);_.isEmpty(o)||e.display?h(e,t):u(o,{title:"端口隐藏",body:"端口"+e.uuid+"上有 "+o.length+" 条连线，隐藏端口将会删除连线。确定要隐藏吗?",onOk:function(){h(e,t)},onCancel:function(){e.display=!e.display}})},o.changeApiName=function(){if(o.node.metadata.apiName)if(/^[a-zA-Z0-9]{1}[a-zA-Z0-9\-\_]*[a-zA-Z0-9]$/.test(o.node.metadata.apiName))if(o.node.metadata.apiName.length>40)o.apiNameError="长度不能大于40";else{for(let e=0;e<l.nodes.length;e++){let t=l.nodes[e];if(t.id!==o.node.id&&t.metadata.apiName===o.node.metadata.apiName)return void(o.apiNameError="项目中 api 名称冲突")}o.apiNameError="",o.save&&o.save()}else o.apiNameError="只能为字符、数字、连字符和下划线, 长度大于1";else o.apiNameError="不能为空"},o.getProxyUrl=function(e,t,o,n){const r=n?n.ip:"",i=_.isEmpty(appConfig.proxyHost)?location.host:appConfig.proxyHost,a=_.isEmpty(r)?i:r,s=n?"http:":location.protocol;if(!_.isEmpty(e.url)){const n={"{{protocol}}":s,"{{proxyHost}}":a,"{{host}}":a,"{{userId}}":appConfig.userId,"{{appId}}":t,"{{nodeId}}":o};return c(e.url,n)}return e.url="{{protocol}}//"+(appConfig.proxyHost?"{{proxyHost}}":"{{host}}")+"/"+(e.absolute?"proxy":"proxr")+"/{{userId}}/{{appId}}/{{nodeId}}/"+e.port+"/",location.protocol+"//"+(appConfig.proxyHost||location.host)+"/"+(e.absolute?"proxy":"proxr")+"/"+appConfig.userId+"/"+t+"/"+o+"/"+e.port+"/"};const m={0:"未知状态",1:"正在运行中",2:"已停止",3:"已成功",4:"已失败",5:"启动中",6:"停止中",7:"已失败",8:"定时运行",9:"等待资源中"};o.openLink=function(n,r,i,a,c){n.preventDefault();const l=_.get(s.currentApp,"node.status."+t.nodeId);if(!e.includes("app.predict.run")&&!e.includes("app.exp.run")){const t=e.includes("app.predict")?"请先部署项目！":"请先运行该节点！";return void(o.actionAlert={type:"danger",message:t})}if(e.includes("app.predict.run")&&"3"!==l)return void(o.actionAlert={type:"danger",message:"该节点"+m[l]||"未知状态"});if(e.includes("app.exp.run")&&"1"!==l)return void(o.actionAlert={type:"danger",message:"该节点"+m[l]||"未知状态"});const d=o.getProxyUrl(r,i,a.id,c),u=d.split("//")[0];if(601===a.metadata.def.type)eventService.emit("rto:setting:params",[{...r,url:d},i,a,c]);else{if(r.isModal&&u===location.protocol){let e=p.open({animation:!0,windowClass:"iframe-modal",template:'<div class="sp-modal-iframe"><div class="sp-modal-header"><div class="sp-modal-title">{{title}}</div><div class="sp-modal-actions"><i class="iconfont" ng-class="fullscreen ? \'icon-fullscreen-exit\' : \'icon-fullscreen\'" title="{{fullscreen ? \'还原\' : \'最大化\'}}" ng-click="maximize(!fullscreen)"></i><i class="iconfont icon-close" title="关闭" ng-click="cancel()"></i></div></div><iframe style="width: 100%; height: calc(100% - 30px); border: none; outline: none;" src="'+d+'"></iframe></div>',size:"lg",controller:["$scope",function(t){t.fullscreen=!1,t.title=a.metadata.label,t.maximize=function(e){const o=$(".iframe-modal");t.fullscreen=e,e?o.addClass("iframe-modal-fullscreen"):o.removeClass("iframe-modal-fullscreen")},t.cancel=function(){e.close()},t.$on("modal.closing",function(t,o){e=void 0})}]});return}window.open(d)}}}]).controller("tableSelectController",["$state","$stateParams","$scope","$timeout","$rootScope","common","tableService","$q",function(e,t,o,n,r,i,a,s){let c;o.onTableSelect=function(e){e&&(o.refreshingMeta=!0,a.getTableMeta(e).then(function(e){o.controlListScope.selectedTableDef=e.data,o.controlListScope.selectedTableDef}).finally(function(){o.refreshingMeta=!1}))},o.listTable=function(e){o.controlListScope.selectedTableDef=void 0,!e||e.length<2||(c&&n.cancel(c),c=n(function(){o.refreshing=!0,a.listTable(e).then(function(e){o.tableList=e.data}).finally(function(){o.refreshing=!1,c=void 0})},500))},$(document).on("click.close.tableSelction.menu",function(e){o.openTableList=!1,r.$$phase||r.$apply()}),o.$on("$destroy",function(){$(document).off("click.close.tableSelction.menu")})}]).controller("partitionSelectController",["$scope","$rootScope",function(e,t){$(document).on("click.close.partitionSelction.menu",function(o){e.openPartitionList=!1,t.$$phase||t.$apply()}),e.$on("$destroy",function(){$(document).off("click.close.partitionSelction.menu")})}]).controller("expMultiSettingOverviewController",["$state","$stateParams","$scope",function(e,t,o){o.currentTab.type=e.current.data.type,o.currentTab.title=_.get(_.find(o.tabs,{type:o.currentTab.type}),"name.zh_CN")}]),angular.module("app").constant("compTabs",[{id:"shared",name:"分享的组件",dir:1,icon:"iconfenxiang1",service:"list",componentType:"my_component",editable:!0,enable:!0},{id:"public",name:"内置组件",icon:"iconneizhizujian",service:"public",componentType:"public_component",enable:!0},{id:"my",name:"我的组件",dir:2,icon:"iconzujian",service:"list",componentType:"my_component",editable:!0,enable:!0},{id:"hufu",name:"数据",icon:"iconyunshujuku",enable:appConfig.services.hufu,path:"/proxy/hufu-web/datatag/suanpan/module/group",algoComponentId:1876,predictComponentId:1874},{id:"device",name:"设备",icon:"iconshebei",enable:appConfig.services.device,path:"/changqing/device/listDevicePonitMxg",params:{pageNumber:1,pageSize:30},algoComponentId:null,predictComponentId:11330},{id:"recommend",name:"推荐",icon:"iconshoucang",enable:!0}]).controller("compsController",["$state","$stateParams","$scope","$rootScope","USER_CONFIG","componentService","toaster","compTabs","$q","enabledUser","APPMENU","common",function(e,t,o,n,r,i,a,s,c,p,l,d){const u=_.get(n.appConfig,"appMenu")||l,f="card"==localStorage.navTreeStyle;o.tabs=s,o.current={tab:_.find(s,{id:e.includes("app.customize")?"my":"public"}),type:t.type,node:null,isCard:f,expandedDir:[]},e.includes("app.customize")&&(o.current.component={id:t.componentId},o.current.type="customize"),o.onToggleStyle=function(e){localStorage.navTreeStyle=e&&"card",o.current.isCard=e},o.search={keyword:""},o.treeControls={};let h=n.tagModel,m={};h.list=[];let g=_.get(u[_.get(o.current,"type")],"componentType");const v={};_.keys(u,function(e){v[e]=null});const y={list:_.clone(v),public:_.clone(v)};let b=null;const w={shared:_.get(r,"publicDirId"),my:_.get(r,"myDirId"),sharedAllDir:[]},x={shared:_.find(o.userConfig.componentDirs,{id:w.shared}).children,my:_.find(o.userConfig.componentDirs,{id:w.my}).children,public:null},S=function(){const e=d.getDirList(x.shared,w.shared);w.sharedAllDir=_.map(e,"id"),w.sharedAllDir.unshift(w.shared)};S();const C={list:function(){o.loading=!0,i.list(g).then(function(e){if(e.success){y.list[o.current.type]=e.list,b=_.cloneDeep(e.list);var t=P(x[o.current.tab.id]),n=_.get(o.current,"tab.id"),r=A(n);t=_.concat(t,r),o.search.keyword&&(o.search.emptyResult=-1==_.findIndex(t,{visible:!0})),o.my_treedata=t,o.loading=!1}},function(e){a.pop("error","加载组件列表失败: "+e.msg),o.my_treedata=[]})},public:function(){o.loading=!0,i.listPublic(g).then(function(e){if(e.success){y.public[o.current.type]=e.list,b=_.cloneDeep(e.list),x.public=e.dirs;var t=P(e.dirs);o.search.keyword&&(o.search.emptyResult=-1==_.findIndex(t,{visible:!0})),o.my_treedata=t,o.loading=!1}},function(e){a.pop("error","加载组件列表失败: "+e.msg),o.my_treedata=[]})}},I={pageNumber:1,list:[]},E=3,N={algo:"iconfont iconcube",service:"iconfont iconcube",model:"iconfont icongem",dashboard:"iconfont iconchart-area"};let T="predict"===o.current.type?"service":o.current.type;function $(e,t){let o=[];return e%E==0&&o.push("mg-l-xs"),e<E&&o.push("first-row"),e===t-1&&(o.push("last"),o.push("mg-r-"+(E-1-e%E))),o}function k(e,t){const n=e.length,r=_.map(e,function(e,r){const i=$(r,n),a={id:e.id,label:e.name,componentId:e.id,tags:e.tags,icon:N[e.type],type:t||_.get(o.current,"tab.componentType"),componentType:e.type,dir:e.dir,classes:i,visible:!0,selected:"customize"==o.current.type&&o.current.component.id==e.id,usable:!0};let s;if(!_.isEmpty(e.tags)){try{s=JSON.parse(e.tags)}catch(e){}_.forEach(s,function(e){const t=0===e.indexOf("in:"),o=0===e.indexOf("out:");if(t||o){const o=t?3:4;var n=e.substr(o).split(".");if(!_.isEmpty(n)){const e=n.slice(1).join(".");_.isEmpty(e)||(m[e]=1)}}else m[e]=1})}return o.current.tab.editable&&B(a,"component",T),a});return h.list=_.keys(m),r}function P(e){return _.map(e,function(e){let t=_.indexOf(o.current.expandedDir,e.id)>-1,n=!0,r=[];_.isEmpty(e.children)||(r=P(e.children));const i=_.remove(b,function(t){return o.search.keyword?t.dir==e.id&&(_.toLower(t.name).indexOf(_.toLower(o.search.keyword))>-1||t.id==o.search.keyword):t.dir==e.id}),a=k(i);let s;!_.isEmpty(r)&&-1!=_.findIndex(r,{visible:!0})||!_.isEmpty(i)||"customize"===o.current.type&&_.isEmpty(o.search.keyword)||(n=!1),r=_.concat(r,a),(!_.isEmpty(o.search.keyword)&&!_.isEmpty(i)||_.findIndex(r,{expanded:!0})>-1||_.findIndex(r,{selected:!0})>-1)&&(t=!0),"my_component"===_.get(o.current,"tab.componentType")&&(s=["droppable"]);const c=_.assign({},e,{children:r,classes:s,expanded:t,visible:n});return o.current.tab.editable&&B(c,"component",T),c})}function A(e){return k(_.remove(b,function(t){return"shared"===e?o.search.keyword?t.dir==w[e]&&(t.name.indexOf(o.search.keyword)>-1||t.id==o.search.keyword):t.dir==w[e]:"my"===e?o.search.keyword?(t.dir==w[e]||-1==_.indexOf(w.sharedAllDir,t.dir))&&(t.name.indexOf(o.search.keyword)>-1||t.id==o.search.keyword):t.dir==w[e]||-1==_.indexOf(w.sharedAllDir,t.dir):void 0}))}function O(e,t,n){return _.filter(y[n][o.current.type],function(o){let n;try{n=JSON.parse(o.tags)}catch(e){}const r=_.filter(n,function(e){return 0===e.indexOf(t+":")});if(_.isEmpty(r))return!1;const i=t.length+1;return _.findIndex(r,function(t){const o=t.slice(i).split("."),n=o[0],r=o.slice(1).join(".");return _.findIndex(e,function({type:e,subType:t}){return e==n&&(t==r||"all"==t||"all"==r)})>-1})>-1})}const M=12;let L=M;const R={inport:[],outport:[]},D=function(e){return{id:e+"-show-more",label:"加载更多",icon:"iconfont iconxiala",classes:["show-more"],usable:!0,showMore:!0,visible:!0}};function U(e){const t=_.findIndex(o.my_treedata,{id:e}),n=R[e].slice(0,L);if(R[e].length>L){const t=D(e);n.push(t)}o.my_treedata[t].children=n,o.loading=!1}function z(){L=M,o.my_treedata=[{id:"inport",label:"输入推荐",folder:!0,expanded:!0,visible:!0,children:[],prefetch:!0},{id:"outport",label:"输出推荐",folder:!0,expanded:!0,visible:!0,children:[],prefetch:!0}];const e=_.filter(_.get(o.current,"node.metadata.def.ports"),{display:!0});if(R.inport=[],R.outport=[],!_.isEmpty(e)){const t=function(e){return{type:e.type,subType:e.subType}},n=_.map(_.filter(e,{ioType:"in"}),t),r=_.map(_.filter(e,{ioType:"out"}),t);if(!_.isEmpty(n)){const e=k(O(n,"out","public"),"public_component"),t=k(O(n,"out","list"),"my_component");let r=_.concat(e,t);o.search.keyword&&(r=_.filter(r,function(e){return _.toLower(e.label).indexOf(_.toLower(o.search.keyword))>-1||e.id==o.search.keyword}),o.search.emptyResult=0==r.length),R.inport=r}if(!_.isEmpty(r)){const e=k(O(r,"in","public"),"public_component"),t=k(O(r,"in","list"),"my_component");let n=_.concat(e,t);o.search.keyword&&(n=_.filter(n,function(e){return _.toLower(e.label).indexOf(_.toLower(o.search.keyword))>-1||e.id==o.search.keyword}),o.search.emptyResult=0==n.length),R.outport=n}U("inport"),U("outport")}o.loading=!1}function j(){o.loading=!0;const e=o.current.type,t=!_.isEmpty(y.list[e]),n=!_.isEmpty(y.public[e]);if(t||n){const o=[];t&&o.push(i.list(g)),n&&o.push(i.listPublic(g)),c.all(o).then(function(o){o.length>1?(y.list[e]=o[0].list,y.public[e]=o[1].list,x.public=o[1].dirs):t?y.list[e]=o[0].list:n&&(y.public[e]=o[0].list,x.public=o[0].dirs),z()},function(e){a.pop("error","加载组件列表失败: "+e.msg)})}else z()}function G(e,t){const n=_.get(o.appConfig,"services."+e+".url"),r=_.get(o.appConfig,"services."+e+".path")||_.get(o.current.tab,"path"),s=_.clone(_.get(o.current.tab,"params"));"device"===e&&s&&(s.pageNumber=I.pageNumber,o.search.keyword&&(s.pageNumber=1,isNaN(Number(o.search.keyword))?s.deviceName=o.search.keyword:s.deviceId=o.search.keyword)),n&&r&&i.getExternal(n+r,s).then(function(n){let r=function(e,t){const n=_.get(o.current.tab,o.current.type+"ComponentId");let r,i,a=_.get(window.appConfig.services,t+"."+o.current.type+"ComponentId");a=a||n;const s=function(e){return r=0,i=_.filter(e,function(e){return!e.folder}).length,_.map(e,function(e){if(e.folder){let n=e.children,r=!0;return o.search.keyword&&(n=_.filter(n,function(e){return _.toLower(e.label).indexOf(_.toLower(o.search.keyword))>-1||e.id==o.search.keyword})),_.isEmpty(n)?r=!1:n=s(e.children),_.assign({},e,{id:t+"-"+e.id,expanded:!0,visible:r,children:n})}{const o=$(r,i);return r++,_.assign({},e,{icon:"iconfont iconcube",componentId:a||t+"-"+e.id,type:t+"_component",label:"device"==t?e.deviceName:e.label,classes:o,usable:!0,visible:!0})}})};let c=s(e);return"device"!=t&&o.search.keyword&&(c=_.filter(c,function(e){return e.folder||_.toLower(e.label).indexOf(_.toLower(o.search.keyword))>-1||e.id==o.search.keyword})),c}("device"===e?n.data.result:n.data,e);o.search.keyword&&(I.searchKey=o.search.keyword,o.search.emptyResult=0==_.filter(r,{visible:!0}).length),"device"===e&&(I.pageNumber=n.data.pageNumber+1,I.list=t?_.concat(I.list,r):r,(r=_.clone(I.list)).length>=s.pageSize&&r.push(D("device"))),o.my_treedata=r,o.loading=!1},function(e){a.pop("error","加载数据失败: "+e.msg),o.my_treedata=[],o.loading=!1})}o.onAbnTreeRowSelected=function(e){if(e.showMore){o.loading=!0;const t=e.id.split("-")[0];if("device"===t)G(_.get(o.current,"tab.id"),!0);else L+=M,U(t)}};var B=function(t,n,r){t.folder?1===t.id?t.menu=[]:2===t.id&&o.componentAble?t.menu=[{text:"新建文件夹",enabled:p,click:function(e){o.addFolder(e.row.id,n)}}]:(t.menu=[{text:"重命名",enabled:p,click:function(e){o.renameFolder(e.row.id,n,e.row.label)}},{text:"customize"==o.current.type?"删除":"批量删除",enabled:p,click:function(e){o.removeFolder(e.row.id,n,e.row.label,o.my_treedata,"customize"==o.current.type)}}],o.componentAble&&("customize"==o.current.type&&(t.menu.push(null),t.menu.push({text:"新建文件夹",enabled:p,click:function(e){o.addFolder(e.row.id,n)}}),t.menu.push({text:"移动",enabled:p,click:function(e){o.changeParentDir(e.row.branch)}})),t.menu.push(null),t.menu.push({text:"新建组件",enabled:p,click:function(e){o.createComponent(e.row.id,r)}}),t.menu.push({text:"导入组件",enabled:p,click:function(e){o.importComponent(null,null,e.row.id)}}))):(t.menu=[{text:"复制",enabled:p,click:function(e){o.duplicateComponent(e.row.branch)}},{text:"删除",enabled:p,click:function(t){let n=null,r=null;if("customize"===o.current.type){n=o.treeControls.get_siblings(t.row.branch);const s=_.findIndex(n,{id:_.toNumber(e.params.componentId)});if(e.params.componentId==t.row.id){var i=_.filter(n,{folder:!0}),a=!_.isEmpty(i)&&_.filter(o.treeControls.get_children(i[0]),function(e){return!e.folder});r=_.isEmpty(a)?o.treeControls.get_first_branch():a[0]}else s>-1&&(n[s].selected=!1)}o.removeComponent(t.row.branch,n,r)}},{text:"分享",enabled:p,click:function(e){o.shareComponent(e.row.id,e.row.label)}}],t.menu.push(null),t.menu.push({text:"导出",enabled:p,click:function(e){o.exportComponent(e.row.id,e.row.label)}}),t.menu.push({text:"导入",enabled:p,click:function(e){o.importComponent(e.row.id,e.row.label)}}),o.componentAble&&t.menu.unshift({text:"编辑",enabled:p,click:function(t){o.treeControls.select_branch(t.row.branch),i.setPermission(t.row.id).then(function(o){e.go("app.customize",{componentId:t.row.id})},function(e){a.pop("error","请求失败: "+e.msg)})}}),"customize"==o.current.type&&(t.menu.push(null),t.menu.push({text:"移动",enabled:p,click:function(e){o.changeParentDir(e.row.branch)}})))};function F(e){o.loading=!0;const t=_.get(o.current,"tab.service");var n=_.get(o.current,"tab.id");if("recommend"==n)j();else if("hufu"==n||"device"==n)G(n);else if(b=_.cloneDeep(_.get(y[t],o.current.type)),(e||_.isEmpty(b))&&t)C[t]();else if(t){var r=P(x[n]);if("list"===t){var i=A(n);r=_.concat(r,i)}o.search.keyword&&(o.search.emptyResult=-1==_.findIndex(r,{visible:!0})),o.my_treedata=r,o.loading=!1}}o.my_treedata=[],o.handleChangeTab=function(e){o.current.tab=e,F()},o.handleSearchKeyup=function(e){13!=e.keyCode&&"click"!=e.type||(o.search.emptyResult=!1,F())},o.$watch("current.type",function(e,t){T="predict"===e?"service":e,g=_.get(u[e],"componentType"),F(!0)}),o.$on("toggle.app",function(e,t){t!==o.current.type&&("customize"!=o.current.type&&"customize"!=t&&(o.current.expandedDir=[]),o.current.type=t)}),o.$on("toggle.node",function(e,t){o.current.node=t,"recommend"==_.get(o.current,"tab.id")&&j()}),o.$on("toggle.customize",function(e,t){"customize"!=o.current.type&&(o.current.type="customize",o.current.tab=_.find(s,{id:"my"})),o.current.component=t}),o.$on("node.list.reload",function(e,t){x.shared=_.find(o.userConfig.componentDirs,{id:w.shared}).children,x.my=_.find(o.userConfig.componentDirs,{id:w.my}).children,S(),F(!0)}),o.$on("$destroy",function(){})}]),angular.module("app").controller("nodesController",["$state","$scope","nodeService",function(e,t,o){t.searchKey="",t.$on("editor.ready",function(){const e=o.getGraph();t.nodes=_.get(e,"nodes")}),t.$on("toggle.node",function(e,o){_.forEach(t.nodes,function(e){e.active=e.id==_.get(o,"id")})}),t.handleClick=function(t){const n=_.slice(_.get(e,"current.name").split("."),0,3).join(".");e.go(n+".node",{nodeId:t.id}),function(e){var t,n,r=o.getPosition(),i=document.querySelector(".app-svg"),a=i.clientWidth,s=i.clientHeight,c=r.x,p=r.y,l=r.scale,d=e.metadata.x,u=e.metadata.y,f=e.metadata.width,h=e.metadata.height;n=p+u*l<0||p+u*l>s-h?s/2-u-h/2:p,c===(t=c+d*l<0||c+d*l>a-f?a/2-d-f/2:c)&&p===n||o.setPosition(t,n)}(t)},t.menuOptions=[{text:"复制",click:function(e,t,o,n,r){const i=e.node;"dashboard"===i.component?$rootScope.copiedNode=null:($rootScope.copiedNode=angular.copy(i.metadata),$rootScope.copiedComp=angular.copy(i.component),_.has($rootScope.copiedNode,"apiName")&&delete $rootScope.copiedNode.apiName)}},{text:"删除",click:function(e,t,o,n,r){$rootScope.removeNode(e.node,"app.predict.edit")}},{text:"属性",click:function(t,o,n,r,i){const a=_.get(t,"node.metadata.ui.tabs.params.controls",[]);_.isEmpty(a)?e.go("app.predict.edit.node.setting.overview",{nodeId:t.node.id}):e.go("app.predict.edit.node.setting.params",{nodeId:t.node.id})}}]}]),angular.module("app").controller("readController",["$state","$stateParams","$scope","$rootScope","nodeService","hardwareService","APP_STATUS","common","appService","predictService","rpaService","toaster","$window","scriptService","eventService","instantNodeLogService",function(e,t,o,n,r,i,a,s,c,p,l,d,u,f,h,m){n.readOnly=!0,n.sockets=n.sockets||{},n.scriptLogs=n.scriptLogs||{};const g=function(){n.sockets[t.id]||(n.sockets[t.id]=f.connect(t.id)),n.appSocket||(n.appSocket=window.io(`${location.protocol}//${window.appConfig.predictHost}/master`,{path:`/socket/${t.id}`}),n.appSocket.on("process error",function(e){!function(e){const{data:{node_id:t=""}={}}=e,o=r.getNode(t),n=$(`#${t}`);n.find(".the-graph-spin").hide(),n.find(".the-graph-success-icon").hide(),n.find(".the-graph-error-icon").show(),o&&d.pop("error",`节点 ${o.metadata.label} 运行出错，查看日志获取详细信息`)}(e)})),m.connect()};r.setGroupSelectionHandler(function(t){t&&(e.includes("app.exp.read")?e.go("app.exp.read.group",{groupId:t}):e.includes("app.exp.run")&&e.go("app.exp.run.group",{groupId:t}))}),r.setNodeSelectionHandler(function(t,o,n,i){o?(h.emit(h.EVENTS.sp.node.select,[o,r.getNode(o)]),e.includes("app.exp.read")?e.go("app.exp.read.node",{nodeId:o}):e.includes("app.exp.run")?e.go("app.exp.run.node",{nodeId:o}):e.includes("app.exp.prepare")?e.go("app.exp.prepare.node",{nodeId:o}):e.includes("app.exp.history")?e.go("app.exp.history.node",{nodeId:o}):e.includes("app.exp.cron")?e.go("app.exp.cron.node",{nodeId:o}):e.includes("app.predict.read")?e.go("app.predict.read.node",{nodeId:o}):e.includes("app.predict.run")?e.go("app.predict.run.node",{nodeId:o}):e.includes("app.predict.prepare")&&e.go("app.predict.prepare.node",{nodeId:o})):(h.emit(h.EVENTS.sp.node.deselect),e.includes("app.exp.read")?e.go("app.exp.read.setting.overview",{nodeId:o}):e.includes("app.exp.run")?e.go("app.exp.run.setting.overview",{nodeId:o}):e.includes("app.exp.prepare")?e.go("app.exp.prepare.setting.overview",{nodeId:o}):e.includes("app.exp.history")?e.go("app.exp.history.setting.overview",{nodeId:o}):e.includes("app.exp.cron")?e.go("app.exp.cron.setting.overview",{nodeId:o}):e.includes("app.predict.read")?e.go("app.predict.read.setting.overview",{nodeId:o}):e.includes("app.predict.run")?e.go("app.predict.run.setting.overview",{nodeId:o}):e.includes("app.predict.prepare")&&e.go("app.predict.prepare.setting.overview",{nodeId:o}))}),r.setNodeRectImgDblclickHandler.call(this,function(e,o,r){if("dblclick"==e.type&&o&&r){let e="studio/"+window.appConfig.userId+"/logs/"+t.id+"/screenshots/"+o+"/";n.showFiles(e)}});let v,y,b,w,x=$("#editor");o.$on("editor.ready",function(){x=$("#editor")});let S=!1,C={};const I=window.appConfig.statusTimeout||2e3,E=function(o){t.nodeId?e.go(o+".node",{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1}):e.go(o,{type:t.type,id:t.id,refresh:t.refresh+1})};let N=c;"predict"===t.type?N=p:"rpa"===t.type&&(N=l);let T=0,k=function(o){if(!o||!o.map){if(e.includes("app.exp.run")||e.includes("app.predict.run")){const t=e.includes("app.exp.run")?"运行失败":"部署失败";d.pop("error",t),e.reload()}return}o.msg&&o.msg[T]&&(d.pop("info",o.msg[T]),T+=1);let i=o.map;!_.isEmpty(i)&&function(t){for(let o in t){if(!o.startsWith("node.status.")||o===_.get(n.currentApp,o))continue;o.startsWith("node.status.")&&o!==_.get(n.currentApp,o)&&_.set(n.currentApp,o,t[o]);let i=o;o=o.replace("node.status.","");let a=$("#"+o);switch(t[i]){case"5":case"6":e.includes("app.predict.run")&&(a.find(".the-graph-spin").show(),a.find(".the-graph-success-icon").hide(),a.find(".the-graph-error-icon").hide()),(e.includes("app.exp.run")||e.includes("app.exp.history"))&&(x.find(".edge").filter(function(){return this.id.match(new RegExp("^edge-.*"+o+"$"))}).find(".edge-fg").removeClass("dashing"),a.find(".the-graph-spin").show(),a.find(".the-graph-success-icon").hide(),a.find(".the-graph-error-icon").hide());break;case"1":if(e.includes("app.exp.run")||e.includes("app.exp.history")){x.find(".edge").filter(function(){return this.id.match(new RegExp("^edge-.*"+o+"$"))}).find(".edge-fg").addClass("dashing");let e=document.querySelector(".edges");document.querySelectorAll(".edge-fg.dashing").forEach(function(t,o){o>0&&e.appendChild(t.parentNode)}),(!C[o]||s.now()-C[o]>2e3)&&(r.updateScreenshot(o,!0),C[o]=s.now())}a.find(".the-graph-spin").show(),a.find(".the-graph-success-icon").hide(),a.find(".the-graph-error-icon").hide();break;case"4":x.find(".edge").filter(function(){return this.id.match(new RegExp("^edge-.*"+o+"$"))}).find(".edge-fg").removeClass("dashing"),a.find(".the-graph-spin").hide(),a.find(".the-graph-success-icon").hide(),a.find(".the-graph-error-icon").show();break;case"3":x.find(".edge").filter(function(){return this.id.match(new RegExp("^edge-.*"+o+"$"))}).find(".edge-fg").removeClass("dashing"),a.find(".the-graph-spin").hide(),a.find(".the-graph-success-icon").show(),a.find(".the-graph-error-icon").hide(),(e.includes("app.exp.run")||e.includes("app.exp.history"))&&(!C[o]||s.now()-C[o]>1e4)&&(r.updateScreenshot(o,!0),C[o]=s.now());break;default:x.find(".edge").filter(function(){return this.id.match(new RegExp("^edge-.*"+o+"$"))}).find(".edge-fg").removeClass("dashing"),a.find(".the-graph-spin").hide(),a.find(".the-graph-success-icon").hide(),a.find(".the-graph-error-icon").hide()}}}(i),y&&"5"!=i.status&&(d.clear(y),y=null),w&&"9"!=i.status&&(d.clear(w),w=null),b&&"6"!=i.status&&(d.clear(w),w=null);let a=I;if(e.includes("app.exp.run")||e.includes("app.predict.run"))switch(i.status){case"5":y||(y=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"启动中"},timeout:0}));break;case"9":w||(w=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"等待资源"},timeout:0}));break;case"1":"predict"===n.currentApp.type&&g();break;case"2":return d.pop("success","已停止"),void E("app."+n.currentApp.type+".edit");case"3":if("predict"===n.currentApp.type)return g(),d.pop("success","部署成功"),void E("app.predict.run");if("algo"===t.type)d.pop("success","运行成功, 将释放资源"),a=5e3;else if("rpa"===t.type)return d.pop("success","运行成功"),void E("app.exp.run");break;case"4":if("algo"!==t.type)return d.pop("error",`${"predict"===n.currentApp.type?"部署":"运行"}失败`),void E("app."+n.currentApp.type+".edit");d.pop("error","运行失败, 将释放资源"),a=5e3;break;case"6":b||(b=d.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"停止中"},timeout:0}));break;case"7":return d.pop("error",`${"predict"===n.currentApp.type?"部署":"运行"}失败`),void E("app."+n.currentApp.type+".edit")}else if(e.includes("app.exp.history"))switch(i.status){case"1":case"5":break;default:return}v=window.setTimeout(P,a)};window.SuanpanAPI.predictService.handleAppStatus=k;let P=function(){x&&x.length?(e.includes("app.exp")&&(S||(S=!0,r.showAllScreenshots())),"predict"===t.type&&n.appConfig._board?i.post("status",{id:t.id,boardId:n.appConfig._board.id}).then(function(e){k(e)},function(e){v=window.setTimeout(P,I)}):N.getNetworkStatus(t.id).then(function(e){k(e)},function(e){v=window.setTimeout(P,I)})):v=window.setTimeout(P,I)};P(),o.$on("$destroy",function(){x.find(".edge").find(".edge-fg").removeClass("dashing"),x.find(".the-graph-spin").hide(),v&&window.clearTimeout(v),r.setNodeRectImgDblclickHandler(null),r.setNodeSelectionHandler(null),r.setGroupSelectionHandler(null),n.readOnly=void 0,f.disconnect(t.id),delete n.sockets[t.id],n.appSocket&&n.appSocket.disconnect(),n.appSocket=null,m.disconnect(),y&&d.clear(y),w&&d.clear(w),b&&d.clear(w)})}]).controller("readNodeController",["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService","appService",function(e,t,o,n,r,i,a,s,c){let p=$("#editor #"+t.nodeId);if(!p||0===p.length)return void e.go("^");var l;o.nodeId=t.nodeId,o.node=a.getNode(o.nodeId),o.nodeTabInfo=((l=_.get(o.node.metadata,"ui.tabs",{}))||(l={}),Object.assign({},l,{debug:{tabName:{en_US:"Debug Log",zh_CN:"调试日志",zh:"调试日志"},controls:[{uuid:`${t.nodeId}-debuglog`,type:"debug_log",label:{zh_CN:"调试日志"}}]}})),o.componentId=o.node.component,n.nodeCompType=o.node.metadata.def.type;let d=n.appConfig._board?n.appConfig._board.id:null;o.logId=s.getLogId(window.appConfig.userId,t.id,t.nodeId,d),n.$broadcast("toggle.node",o.node),o.resetTabInfo(o.node.metadata.def.params,o.nodeTabInfo),o.appList=[],998===n.nodeCompType&&c.list(9999,"algo").then(function(e){e&&e.list&&(o.appList=e.list)},function(e){toaster.pop("error","获取项目列表失败: "+e.msg)}),p.addClass("selected");let u=document.querySelector(".edges"),f=document.querySelector(".edges").childNodes,h=[];for(let e=0;e<f.length;e++)f[e].attributes&&($(f[e]).removeClass("active"),f[e].getAttribute("id")&&f[e].getAttribute("id").indexOf(t.nodeId)>-1&&($(f[e]).addClass("active"),h.push(f[e])));for(let e=0;e<h.length;e++)u.appendChild(h[e]);$(document).on("keydown.node.read",function(e){let t=$(e.target);if(!t.is("input")&&!t.is("textarea"))switch(e.keyCode){case 67:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),n.copyNode(o.node.metadata,o.node.component))}}),o.$on("$destroy",function(){p.removeClass("selected"),$(f).removeClass("active"),$(document).off("keydown.node.read"),n.nodeCompType=void 0,f=void 0,n.$broadcast("toggle.node",null)})}]).controller("readGroupController",["$state","$stateParams","$scope","$rootScope","multiselect","common","nodeService","logService","appService",function(e,t,o,n,r,i,a,s,c){o.group=a.getGroup(t.groupId);let p=$("#editor #"+t.groupId);p.addClass("selection"),o.$on("$destroy",function(){p.removeClass("selection"),p=void 0})}]).controller("prepareController",["$state","$stateParams","$scope","rpaService","toaster","$rootScope","predictService","appService","loopService",function(e,t,o,n,r,i,a,s,c){let p,l,d,u=!0,f=function(e){u&&s.edgeImageStatus(e).then(function(t){let o=0,n=0,i=!1;if(Object.keys(t).forEach(function(e){if(t[e]){let r=t[e].match(/^(\d+(\.\d+)?)%$/);if(r&&r[1]){let e=parseInt(r[1],10);if(!isNaN(e)&&e>=0&&e<=100)return o+=e,void n++}}i=e}),i)g("文件 "+i+" 下载失败");else if(0!==n){if(100===(o=Math.floor(o/n)))return p?(p.toaster.title="下载完成",r.reset(p)):p=r.pop({type:"info",title:"下载完成",timeout:3e3}),void w();p?(p.toaster.title="正在下载项目所需文件 "+o+"%",r.reset(p)):p=r.pop({type:"info",title:"正在下载项目所需文件 "+o+"%",timeout:3e3,tapToDismiss:!1}),window.setTimeout(function(){f(e)},1e3)}else w()},function(e){g("获取下载进度失败")})},h=function(){"edge"===window.appConfig.env?s.edgeImagePrepare(t.id).then(function(e){f(e)},function(e){g("下载文件失败")}):w()},m=function(e,t){t||h(),r.clear(l)};let g=function(e){r.clear(l),l=r.pop({type:"error",title:e,body:'<a style="margin-top: 4px; color: #00c1de">重试</a>',bodyOutputType:"trustedHtml",showCloseButton:!0,tapToDismiss:!1,timeout:0,clickHandler:m})},v=i.appConfig._board,y=function(){d=r.pop({type:"info",body:"starting-html",bodyOutputType:"directive",directiveData:{title:"正在将资源发送到边缘端"},timeout:0}),hardwareService.post("storage.create",{appId:t.id,boardId:v.id,keys:["dashboard","configs","share"]}).then(function(e){r.clear(d),r.pop("success","发送完成"),b()},function(e){r.clear(d),r.pop("error","发送失败："+e.msg)})},b=function(){hardwareService.post("get",{hwtype:"board",boardId:v.id}).then(function(o){o.success&&"online"===_.get(o,"data.state")?hardwareService.post("app/deploy",{boardId:v.id,appId:t.id}).then(function(t){t.success?(r.pop("success","正在部署"),e.params.nodeId?e.go("app.predict.run.node",{nodeId:e.params.nodeId}):e.go("app.predict.run")):r.pop("error","部署失败")},function(e){r.pop("error","部署失败: "+e.msg)}):r.pop("error","板子 "+v.id+" 已经掉线")})},w=function(){if(e.includes("app.exp")){("rpa"===t.type?n:s).run(t.id,t.targetNodeId,t.runType).then(function(t){r.pop("success","开始运行"),e.params.nodeId?e.go("app.exp.run.node",{nodeId:e.params.nodeId}):e.go("app.exp.run")},function(e){r.pop("error","运行失败: "+e.msg)})}else e.includes("app.predict")&&(v?s.export(t.id,{type:"appDashboardExport"}).then(function(e){c.fetchJob({title:"正在导出"},e.job.id,s.getJob,y)},function(e){}):a.deploy(t.id).then(function(t){r.pop("success","正在部署"),e.params.nodeId?e.go("app.predict.run.node",{nodeId:e.params.nodeId}):e.go("app.predict.run")},function(e){r.pop("error","部署失败: "+e.msg)}))};h(),o.stop=function(){let o=e.current.name.split(".prepare")[0];e.go(o,{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1})},o.release=function(){e.go("app.predict",{type:t.type,id:t.id,nodeId:t.nodeId,refresh:t.refresh+1})},o.$on("$destroy",function(){u=!1,r.clear(l)})}]),angular.module("app").controller("predictNodeSettingTestController",["$state","$scope","$rootScope","$http",function(e,t,o,n){t.currentTab.type=e.current.data.type,t.currentTab.title=_.get(_.find(t.tabs,{type:t.currentTab.type}),"name.zh_CN"),t.testing=!1,t.test=function(e){try{e=JSON.parse(e)}catch(e){return void(t.test_error="请输入正确的 JSON 字符串")}if(t.test_error="",t.testing)return;t.testing=!0;const r=("hardware"==o.appConfig._context?location.protocol+"//"+o.appConfig._board.ip:location.protocol+"//"+t.appConfig.predictHost)+"/"+t.appInfo.id+"/"+_.get(t.node,"metadata.apiName")||"api名称未设置";n({method:"POST",url:r,data:{debug:!0,data:e}}).then(function(e){"object"==typeof e.data&&(e.data=JSON.stringify(e.data)),t.testResult=e.data},function(e,o){t.testResult="error"}).finally(function(){t.testing=!1})}}]),angular.module("app").factory("remoteService",["$http","$q",function(e,t){let o={},n=function(e){return window.appConfig.affinity?["/app/status","/app/stop","/app/run","/app/cron/start","/app/cron/stop","/app/get/permission","/app/set/permission","/component/get/permission","/component/set/permission","/predict/release","/predict/deploy","/predict/status","/oss/object/check"].includes(e)?e:0===e.indexOf("/edge")?e:0===e.indexOf("http")?e:e.startsWith("/table/meta")?e:e.startsWith("/local")||e.startsWith("/system")?e:window.appConfig.affinity+e:window.appConfig.redirectRequest?e.startsWith("http")||e.startsWith("https")?e:`${window.appConfig.redirectRequest}${e}`:e};return o.get=function(o){let r=t.defer();return e({method:"GET",url:n(o),headers:{"x-sp-user-id":window.appConfig.userId,"x-sp-signature":window.appConfig.signature,"x-sp-sign-version":window.appConfig.signVersion}}).then(function(e){e&&e.data&&e.data.success?r.resolve(e.data):r.reject(e.data)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},o.post=function(o,r){let i=t.defer();return e({method:"POST",url:n(o),headers:{"Content-Type":"application/json; charset=utf-8","x-sp-user-id":window.appConfig.userId,"x-sp-signature":window.appConfig.signature,"x-sp-sign-version":window.appConfig.signVersion},data:r}).then(function(e){e.data.success?i.resolve(e.data):i.reject(e.data)},function(e,t){i.reject({success:!1,msg:"网络错误"})}),i.promise},o.getBinary=function(o,r){let i=t.defer();return e({method:"GET",url:n(o),responseType:r}).then(function(e){i.resolve(e.data)},function(e,t){i.reject({success:!1,msg:_.get(e,"statusText")||"网络错误"})}),i.promise},o.head=function(o){let r=t.defer();return e({method:"HEAD",url:n(o)}).then(function(e){r.resolve(e)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},o.delete=function(o){let r=t.defer();return e({method:"DELETE",url:n(o)}).then(function(e){r.resolve(e)},function(e,t){r.reject({success:!1,msg:"网络错误"})}),r.promise},o.put=function(o,r){let i=t.defer();return e({method:"PUT",url:n(o),headers:{"Content-Type":"application/octet-stream;"},data:r,transformRequest:[]}).then(function(e){i.resolve(e)},function(e,t){i.reject({success:!1,msg:"网络错误"})}),i.promise},o}]).factory("appService",["$http","remoteService","$q","ossService","ccc","appDataStoreService","statisticsService",function(e,t,o,n,r,i,a){let s={},c={};return s.create=function(e,n,r){let i=o.defer();return t.post("/app/create",{name:e,dir:n,type:r}).then(function(e){c={},a.trackEvent(a.STAT_ACTIONS.APP.CREATE,e.id,{},e),i.resolve(e)},function(e){i.reject(e)}),i.promise},s.get=function(e,i){let a=o.defer();return t.post("/app/get",{id:e}).then(function(e){if(i)return void a.resolve(e.appInfo);const t=e.appInfo.data;n.getObject(window.appConfig.oss.bucket,t,null,!0).then(function(t){e.appInfo.data=r.d(t),a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},s.head=function(e){let r=o.defer();return t.post("/app/get",{id:e}).then(function(e){const t=e.appInfo.data;n.headObject(window.appConfig.oss.bucket,t).then(function(e){r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},s.del=function(e){let n=o.defer();return t.post("/app/del",{id:e}).then(function(t){c={},a.trackEvent(a.STAT_ACTIONS.APP.DELETE,e),n.resolve(t)},function(e){n.reject(e)}),n.promise},s.edgeImagePrepare=function(e){let n=o.defer();return t.get("/edge/images/prepare/"+e).then(function(e){try{let t=JSON.parse(e.result);n.resolve(t.download_id)}catch(e){n.reject(e)}},function(e){n.reject(e)}),n.promise},s.edgeImageStatus=function(e){let n=o.defer();return t.get("/edge/images/status/"+e).then(function(e){try{let t=JSON.parse(e.result);n.resolve(t)}catch(e){n.reject(e)}},function(e){n.reject(e)}),n.promise},s.delnode=function(e,n){let r=o.defer();return t.post("/app/delnode",{id:e,nodeId:n}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.getPermission=function(e){let n=o.defer();return t.post("/app/get/permission",{id:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.setPermission=function(e){let n=o.defer();return t.post("/app/set/permission",{id:e,permission:"write"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.listCron=function(e,n,r){let i=o.defer();return t.post("/app/cron/list",{id:e,limit:n,offset:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},s.save=function(e,t,i){let a=o.defer(),s="studio/"+window.appConfig.userId+"/"+e+"/data",c="predict"===i?"v2":"v1";return n.putObject(window.appConfig.oss.bucket,s,r.c(JSON.stringify(t),c)).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},s.saveScripts=function(e,t){let i=o.defer(),a="studio/"+window.appConfig.userId+"/"+e+"/data";return n.putObject(window.appConfig.oss.bucket,a,r.c(JSON.stringify(t),"v2"),void 0,void 0,!0).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},s.share=function(e,n,r,i,s,c=!1){let p=o.defer();return t.post("/app/share",{id:e,targetUserId:r,name:n,description:i,type:s,withData:c}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.SHARE,e,{id:e,userId:appConfig.userId,name:n,description:i,type:s,withData:c},{id:t.id,userId:r,name:n,description:i,type:s}),p.resolve(t)},function(e){p.reject(e)}),p.promise},s.duplicate=function(e,n,r,i,s=!1,p){let l=o.defer();return t.post("/app/duplicate",{id:e,name:n,description:r,type:i,withData:s,dir:p}).then(function(t){c={},l.resolve(t),a.trackEvent(a.STAT_ACTIONS.APP.COPY,e,{id:e,description:r,type:i,withData:s},{id:t.id,name:n,dir:p})},function(e){l.reject(e)}),l.promise},s.duplicatePublic=function(e,n,r,i){let s=o.defer();return t.post("/app/public/duplicate",{id:e,name:n,description:r,type:i}).then(function(t){c={},a.trackEvent(a.STAT_ACTIONS.APP.DUPLICATE_FROM_TEMPLATE,e,{id:e,name:n,description:r,type:i},{id:t.id}),s.resolve(t)},function(e){s.reject(e)}),s.promise},s.changeName=function(e,n){let r=o.defer();return t.post("/app/update/name",{id:e,name:n}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeTags=function(e,n){let r=o.defer();return t.post("/app/update/tags",{id:e,tags:n}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeDir=function(e,n){let r=o.defer();return t.post("/app/update/dir",{id:e,dir:n}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.changeDescription=function(e,n){let r=o.defer();return t.post("/app/update/description",{id:e,description:n}).then(function(e){c={},r.resolve(e)},function(e){r.reject(e)}),r.promise},s.list=function(e,n,r){let i=o.defer(),a=e+"-"+n;return!r&&c[a]?i.resolve(c[a]):t.post("/app/list",{limit:e,type:n}).then(function(e){c={},i.resolve(e)},function(e){i.reject(e)}),i.promise},s.listPublic=function(e){let n=o.defer();return t.post("/app/public/list",{type:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.getVersion=function(){let t=o.defer();return e({method:"GET",url:window.appConfig.publicOss+"/version.json?"+(new Date).getTime()}).then(function(e){200==e.status&&t.resolve(e.data)},function(e){t.reject(e)}),t.promise},s.startCron=function(e,n){let r=o.defer();return t.post("/app/cron/start",{id:e,cronConfig:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.RUN_CRON,e,{},{id:e,cronConfig:n}),r.resolve(t)},function(e){r.reject(e)}),r.promise},s.stopCron=function(e,n){let r=o.defer();return t.post("/app/cron/stop",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.STOP_CRON,e),r.resolve(t)},function(e){r.reject(e)}),r.promise},s.run=function(e,n,r){let i=o.defer();return t.post("/app/run",{id:e,nodeId:n,type:r}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.RUN,e,{},{id:e,nodeId:n,type:r}),i.resolve(t)},function(e){i.reject(e)}),i.promise},s.stop=function(e){let n=o.defer();return t.post("/app/stop",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.STOP,e),n.resolve(t)},function(e){n.reject(e)}),n.promise},s.getNetworkStatus=function(e){let n=o.defer();return t.post("/app/status",{id:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.getContents=function(e,t,n=1e3,r=!1){let a=o.defer(),s=[],c=[],p=e.length;return function(t){i.list(e,t,n).then(function(e){if(e.success){let t=e.data.CommonPrefixes,o=e.data.Contents;_.isEmpty(t)||t.forEach(function(e){let t=e.Prefix.slice(p);c.push({id:e.Prefix,label:t,isFolder:!0,type:"folder",checked:r})}),_.isEmpty(o)||o.forEach(function(e){let t=e.Key.slice(p),o=Math.ceil(e.Size/1024),n=_.toLower(t.split(".")[1]);"upload_meta"!==t&&s.push({id:e.Key,label:t,size:o,type:n,checked:r})}),a.resolve({prefixes:c,catalog:s,NextMarker:e.data.NextMarker})}else a.resolve({prefixes:c,catalog:s})},function(e){a.reject(e)})}(t),a.promise},s.getImgUrl=function(e,r){const a=o.defer(),s=window.appConfig.oss.bucket;return(r?n.headObject(s,e):i.head(e)).then(function(o){t.post("/oss/object/get",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){if(e.success){let t=e.data;a.resolve(t)}},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},s.getMetrics=function(e){let n=o.defer();return t.get(e).then(function(e){e.success?n.resolve(e.result):n.reject(err)},function(e){n.reject(e)}),n.promise},s.getMetricsList=function(e){let n=o.defer();return t.get("/app/metrics?type="+e).then(function(e){n.resolve(e.result)},function(e){n.reject(e)}),n.promise},s.import=function(e){const n=o.defer(),{id:r,name:i,dataPath:a,dir:s}=e;return t.post("/app/import",{appId:r,newAppName:i,importAppDataPath:a,dir:s}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.export=function(e,n){const r=o.defer();return t.post("/app/"+e+"/export",n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.switch=function(e,n){const r=o.defer();return t.post("/app/"+e+"/switch",{appVersion:n}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.getJobs=function(e){const n=o.defer();return t.get("/app/"+e+"/jobs").then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},s.getJob=function(e){const n=o.defer();return t.get("/app/job/"+e).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},window.appService=s,s}]).factory("componentService",["$http","remoteService","$q","ccc","ossService","appDataStoreService","statisticsService",function(e,t,o,n,r,i,a){let s={create:function(e,n,r,i,s){let c=o.defer();return t.post("/component/create",{name:e,dir:n,type:r,fromAppId:i,fromNodeId:s}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.CREATE,t.id,{},{id:t.id,name:e,dir:n,type:r,fromAppId:i,fromNodeId:s}),c.resolve(t)},function(e){c.reject(e)}),c.promise},import:function(e,n,r,i){const s=o.defer();return t.post("/component/import",{newComponentName:e,componentId:n||"",dir:r,importComponentDataPath:i}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.IMPORT,n,{},{id:t.id,newComponentName:e,componentId:n||"",dir:r,importComponentDataPath:i}),s.resolve(t)},function(e){s.reject(e)}),s.promise},export:function(e){const n=o.defer();return t.post("/component/"+e+"/export",{packComponentNext:!0}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.EXPORT,e),n.resolve(t)},function(e){n.reject(e)}),n.promise},switch:function(e,n){const r=o.defer();return t.post("/component/"+e+"/switch",{componentVersion:n}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getJob:function(e){const n=o.defer();return t.get("/component/job/"+e).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},exportModel:function(e,o,n,r,s){const c="studio/{USER_ID}/{APP_ID}/{NODE_ID}/{PORT_ID}/model".replace(/{USER_ID}/g,window.appConfig.userId).replace(/{APP_ID}/g,e).replace(/{NODE_ID}/g,o).replace(/{PORT_ID}/g,n);return i.sync(c,"upload").then(function(){return t.post("/component/export/model",{id:e,nodeId:o,portId:n,name:r,overwrite:s})}).then(function(t){a.trackEvent(a.STAT_ACTIONS.APP.EXPORT_MODEL,e,{},{id:e,nodeId:o,portId:n,name:r,overwrite:s});const c="studio/{USER_ID}/component/{COMPONENT_ID}/out1/model/{MODEL_VERSION}".replace(/{USER_ID}/g,window.appConfig.userId).replace(/{COMPONENT_ID}/g,t.componentInfo.id).replace(/{MODEL_VERSION}/g,t.componentInfo.data.version);return i.sync(c,"download").then(function(){return t})})},get:function(e){let i=o.defer();return t.post("/component/get",{id:e}).then(function(e){r.getObject(window.appConfig.oss.bucket,e.componentInfo.data,null,!0).then(function(t){e.componentInfo.data=n.d(t),i.resolve(e)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},getPublic:function(e){let r=o.defer();return t.post("/component/public/get",{id:e}).then(function(e){t.getBinary(e.componentInfo.data,"arraybuffer").then(function(t){e.componentInfo.data=n.d(new Uint8Array(t)),r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},getExternal:function(t,n){const r=o.defer();return e({method:"GET",url:t,params:n,withCredentials:!0}).then(function(e){200==e.status?r.resolve(e.data):r.reject(e.data)},function(e){r.reject(e)}),r.promise},del:function(e){let n=o.defer();return t.post("/component/del",{id:e}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.DEL,e),n.resolve(t)},function(e){n.reject(e)}),n.promise},removeList:function(e){const t=o.defer(),n=[],r=e.length;let i=0;const a=function(o){i++,s.del(o.id).then(function(e){n.push(Object.assign({},o,{removed:!0}))},function(e){n.push(Object.assign({},o,{removed:!1}))}).finally(function(){i==r?t.resolve(n):a(e[i])})};return a(e[i]),t.promise},getPermission:function(e){let n=o.defer();return t.post("/component/get/permission",{id:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},setPermission:function(e){let n=o.defer();return t.post("/component/set/permission",{id:e,permission:"write"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},save:function(e,t){let i=o.defer(),a="studio/"+window.appConfig.userId+"/component/"+e+"/data";return r.putObject(window.appConfig.oss.bucket,a,n.c(JSON.stringify(t)),"application/octet-stream").then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},share:function(e,n,r){let i=o.defer();return t.post("/component/share",{id:e,targetUserId:r,name:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.SHARE,e,{id:e,userId:appConfig.userId,name:n},{id:t.id,userId:r,name:n}),i.resolve(t)},function(e){i.reject(e)}),i.promise},duplicate:function(e,n){let r=o.defer();return t.post("/component/duplicate",{id:e,name:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.COPY,e,{id:e,name:n},{id:t.id,name:n}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeName:function(e,n){let r=o.defer();return t.post("/component/update/name",{id:e,name:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{id:e},{id:e,name:n}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeTags:function(e,n){let r=o.defer();return t.post("/component/update/tags",{id:e,tags:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{},{id:e,tags:n}),r.resolve(t)},function(e){r.reject(e)}),r.promise},changeDir:function(e,n){let r=o.defer();return t.post("/component/update/dir",{id:e,dir:n}).then(function(t){a.trackEvent(a.STAT_ACTIONS.COMPONENT.NODE_UPDATED,e,{},{id:e,dir:n}),r.resolve(t)},function(e){r.reject(e)}),r.promise},list:function(e,n){const r=o.defer();return t.post("/component/list",{limit:n||9999,type:e}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},listPublic:function(e){let n=o.defer();return t.post("/component/public/list",{type:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}};return window.componentService=s,s}]).factory("predictScriptService",["remoteService","$q","ccc","ossService",function(e,t,o,n){let r={getPredictScriptPath:function(e,t){return"studio/"+window.appConfig.userId+"/predict/"+e+"/"+t+"/predict_script"},get:function(e,o){let i=t.defer();return n.getObject(window.appConfig.oss.bucket,r.getPredictScriptPath(e,o),null,!1).then(function(e){i.resolve(e)}),i.promise},save:function(e,o,i){let a=t.defer();return n.putObject(window.appConfig.oss.bucket,r.getPredictScriptPath(e,o),i,"application/octet-stream").then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}};return r}]).factory("predictService",["remoteService","$q","ccc","ossService","nodeService","statisticsService",function(e,t,o,n,r,i){let a={getNetworkStatus:function(o){let n=t.defer();return e.post("/predict/status",{id:o}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},deploy:function(o){let n=t.defer();return e.post("/predict/deploy",{id:o,predictConfig:r.getPredictConfig()}).then(function(e){i.trackEvent(i.STAT_ACTIONS.APP.RUN,o,{},{id:o,predictConfig:r.getPredictConfig()}),n.resolve(e)},function(e){n.reject(e)}),n.promise},release:function(o){let n=t.defer();return e.post("/predict/release",{id:o}).then(function(e){i.trackEvent(i.STAT_ACTIONS.APP.STOP,o),n.resolve(e)},function(e){n.reject(e)}),n.promise}};return a}]).factory("rpaService",["remoteService","$q","ccc","ossService","nodeService",function(e,t,o,n,r){let i={getNetworkStatus:function(o){let n=t.defer();return e.post("/rpa/status",{id:o}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},run:function(o,n,r){let i=t.defer();return e.post("/rpa/run",{id:o,nodeId:n,type:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},stop:function(o){let n=t.defer();return e.post("/rpa/stop",{id:o}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}};return i}]).factory("userService",["remoteService","$q","ossService","ccc","USER_CONFIG",function(e,t,o,n,r){const i={getConfig:function(){let e=t.defer();return o.getObject(window.appConfig.oss.bucket,window.appConfig.userConfigPath,null,!0).then(function(t){let o=n.d(t);try{o=JSON.parse(o)}catch(e){}_.isEmpty(o)?i.saveConfig(r).then(function(t){e.resolve(r)},function(t){e.reject(t)}):e.resolve(o)},function(t){e.reject(t)}),e.promise},saveConfig:function(e){let r=t.defer();return o.putObject(window.appConfig.oss.bucket,window.appConfig.userConfigPath,n.c(JSON.stringify(e))).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getAccessKey:function(){let o=t.defer();return e.get("/oss/ak").then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}};return window.userService=i,i}]).factory("hardwareService",["remoteService","$q",function(e,t){const o={},n={broadcast:"/hardware/broadcast",register:"/hardware/register",list:"/hardware/list",get:"/hardware/get",remove:"/hardware/remove","app/deploy":"/hardware/app/deploy","app/release":"/hardware/app/release",status:"/hardware/status","storage.list":"/hardware/storage/list","storage.create":"/hardware/storage/create","storage.remove":"/hardware/storage/remove"};return o.post=function(o,r){let i=t.defer();return e.post(n[o],r).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},window.hardwareService=o,o}]),angular.module("app").factory("getStsToken",["remoteService","$q",function(e,t){let o="",n=!1,r=[];return function(){let i=t.defer();return o&&o.Credentials&&o.Credentials.Expiration&&new Date(o.Credentials.Expiration).getTime()-(new Date).getTime()>18e5?i.resolve({token:o,refresh:!1}):n?r.push(i):(n=!0,e.get("/oss/token").then(function(e){for(o=e,i.resolve({token:e,refresh:!0});r.length;){r.pop().resolve({token:e,refresh:!0})}},function(e){for(i.reject(e);r.length;){r.pop().reject(e)}}).finally(function(){n=!1})),i.promise}}]).factory("logService",["ossService","$q",function(e,t){let o={getLogId:function(e,t,o,n){return _.isEmpty(n)||(t=n+"-"+t),"studio/"+e+"/logs/"+t+"/"+o},getAppLogId:function(e,t,o,n){return _.isEmpty(n)||(t=n+"-"+t),"studio/"+e+"/logs/"+t+"/app.log"},getLog:function(o,n){let r=t.defer();return e.headObject(window.appConfig.oss.bucket,o).then(function(t){let i=t.NextAppendPosition-1;i>n?e.getObject(window.appConfig.oss.bucket,o,n+"-"+i).then(function(e){r.resolve({text:e,nextLogPosition:i})}):i===n?r.resolve():r.resolve("reload")},function(e){r.resolve("reload")}),r.promise}};return o}]).factory("ossService",["$http","$q","$timeout","$rootScope","getStsToken","remoteService",function(e,t,o,n,r,i){let a,s=window.ALY,c=function(e){let t="";return e.code,t="网络错误"},p=function(){let e=t.defer();return r().then(function(t){let o=t.token;!a||t.refresh?(a=new s.OSS({accessKeyId:o.Credentials.AccessKeyId,secretAccessKey:o.Credentials.AccessKeySecret,securityToken:o.Credentials.SecurityToken,endpoint:window.appConfig.oss.endpoint,apiVersion:"2013-10-15"}),e.resolve(a)):e.resolve(a)},function(t){e.reject(t)}),e.promise};const l=function(e,o,n,r,i){let a=t.defer();return p().then(function(t){t.putObject({Bucket:e,Key:o,Body:n,ACL:i,ContentType:r,Expires:0,CacheControl:"no-cache, must-revalidate"},function(e,t){e?a.reject({err:e,msg:c(e)}):a.resolve(t)})},function(e){a.reject(e)}),a.promise};let d=function(e,o,n,r){let a=t.defer();return i.post("/oss/object/get",{Bucket:e,Key:o}).then(function(e){i.getBinary(e.data,r?"arraybuffer":"").then(function(e){r?a.resolve(new Uint8Array(e)):a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},u=function(e,o){let n=t.defer();return i.post("/oss/object/head",{Bucket:e,Key:o}).then(function(e){e.data.NextAppendPosition=e.data.ContentLength,n.resolve(e.data)},function(e){n.reject(e)}),n.promise},f=function(e,o){let n=t.defer();return i.post("/oss/object/delete",{Bucket:e,Key:o}).then(function(e){i.delete(e.data).then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},h=function(e,o,n,r,a,s=!1){let c=t.defer();return i.post("/oss/object/put",{Bucket:e,Key:o,Expires:0,CacheControl:"no-cache, must-revalidate",ignoreCheck:s}).then(function(e){i.put(e.data,n).then(function(e){c.resolve(e)},function(e){c.reject(e)})},function(e){c.reject(e)}),c.promise},m=function(e,o,n,r,a){let s=t.defer();return i.post("/oss/object/put",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){let t=new XMLHttpRequest;t.onload=function(){200===t.status?a():r(t.statusText)},t.onprogress=function(e){n(e)},t.open("PUT",e.data,!0),t.send(o),s.resolve(e)},function(e){s.reject(e)}),s.promise},g={getOss:p,upload:function(e,o,n,i,a){let s=t.defer();return r().then(function(t){new window.OssUpload({bucket:window.appConfig.oss.bucket,endpoint:window.appConfig.oss.endpoint,chunkSize:1048576,concurrency:3,stsToken:t.token}).upload({file:o,key:e,maxRetry:1,headers:{ServerSideEncryption:""},onprogress:function(e){n(e)},onerror:function(e){i(e)},oncomplete:function(e){a(e)}}),s.resolve("uploaded")},function(e){s.reject(e)}),s.promise},getObject:function(e,o,n,r){let a=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:o,type:"get"}).then(function(t){p().then(function(t){t.getObject({Bucket:e,Key:o,Range:n?"bytes="+n:""},function(e,t){e?a.reject({err:e,msg:c(e)}):r?a.resolve(t.Body):a.resolve(t.Body.toString())})},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},headObject:function(e,o){let n=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:o,type:"head"}).then(function(t){p().then(function(t){t.headObject({Bucket:e,Key:o},function(e,t){e?n.reject({err:e,msg:c(e)}):n.resolve(t)})},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},putObject:function(e,o,n,r,a,s){let c=t.defer();return s?l(e,o,n,r,a).then(function(e){c.resolve(e)},function(){c.reject(err)}):i.post("/oss/object/check",{Bucket:e,Key:o,type:"put"}).then(function(t){l(e,o,n,r,a).then(function(e){c.resolve(e)},function(e){c.reject(e)})},function(e){c.reject(e)}),c.promise},putObjectAcl:function(e,o,n){let r=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:o,type:"put"}).then(function(t){p().then(function(t){t.putObjectAcl({Bucket:e,Key:o,ACL:n},function(e,t){e?r.reject({err:e,msg:c(e)}):r.resolve(t)})},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},deleteObject:function(e,o){let n=t.defer();return i.post("/oss/object/check",{Bucket:e,Key:o,type:"get"}).then(function(t){p().then(function(t){t.deleteObject({Bucket:e,Key:o},function(e,t){e?n.reject({err:e,msg:c(e)}):n.resolve(t)})},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},getSignedUrl:function(e){let o=t.defer();return i.post("/oss/object/get",{Bucket:window.appConfig.oss.bucket,Key:e}).then(function(e){o.resolve(e.data)},function(e){o.reject(e)}),o.promise}};return"minio"===window.appConfig.ossType&&(g.getObject=d,g.headObject=u,g.deleteObject=f,g.putObject=h,g.upload=m),window.ossService=g,g}]),angular.module("app").factory("pageLoading",function(){const e=angular.element(".page-loading");return{show:function(){e.css({display:"block"}).css({opacity:1})},hide:function(){window.setTimeout(function(){e.css({opacity:0}).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){e.css({display:"none"})})},300)}}}).factory("ccc",function(){let e=function(){let e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function r(e,t){if(!n[e]){n[e]={};for(let t=0;t<e.length;t++)n[e][e.charAt(t)]=t}return n[e][t]}let i={compressToBase64:function(e){if(null==e)return"";let o=i._compress(e,6,function(e){return t.charAt(e)});switch(o.length%4){default:case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(o){return r(t,e.charAt(o))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},encoder:new TextEncoder,decoder:new TextDecoder,secret:new Uint8Array([8,2,1,2,1,6]),checkVersion:function(e){return 8!==e[e.length-6]?"v1":2!==e[e.length-5]?"v1":1!==e[e.length-4]?"v1":2!==e[e.length-3]?"v1":1!==e[e.length-2]?"v1":6!==e[e.length-1]?"v1":"v2"},compressToUint8Array:function(e,t){switch(t=t||"v1"){case"v1":let o=i.compress(e),n=new Uint8Array(2*o.length);for(let e=0,t=o.length;e<t;e++){let t=o.charCodeAt(e);n[2*e]=t>>>8,n[2*e+1]=t%256}return n;case"v2":let r=i.encoder.encode(e),a=new Uint8Array(r.length+i.secret.length);return a.set(r,0),a.set(i.secret,r.length),a}},decompressFromUint8Array:function(t){switch(i.checkVersion(t)){case"v1":if(null==t)return i.decompress(t);{let o=new Array(t.length/2);for(let e=0,n=o.length;e<n;e++)o[e]=256*t[2*e]+t[2*e+1];let n=[];return o.forEach(function(t){n.push(e(t))}),i.decompress(n.join(""))}case"v2":let o=new Uint8Array(t.buffer,0,t.length-i.secret.length);return i.decoder.decode(o)}},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return o.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return r(o,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,o){if(!e)return"";let n,r,i,a={},s={},c="",p="",l="",d=2,u=3,f=2,h=[],m=0,g=0;for(i=0;i<e.length;i+=1)if(c=e.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=u++,s[c]=!0),p=l+c,Object.prototype.hasOwnProperty.call(a,p))l=p;else{if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(n=0;n<f;n++)m<<=1,g==t-1?(g=0,h.push(o(m)),m=0):g++;for(r=l.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1}else{for(r=1,n=0;n<f;n++)m=m<<1|r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r=0;for(r=l.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1}0==--d&&(d=Math.pow(2,f),f++),delete s[l]}else for(r=a[l],n=0;n<f;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1;0==--d&&(d=Math.pow(2,f),f++),a[p]=u++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(n=0;n<f;n++)m<<=1,g==t-1?(g=0,h.push(o(m)),m=0):g++;for(r=l.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1}else{for(r=1,n=0;n<f;n++)m=m<<1|r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r=0;for(r=l.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1}0==--d&&(d=Math.pow(2,f),f++),delete s[l]}else for(r=a[l],n=0;n<f;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1;0==--d&&(d=Math.pow(2,f),f++)}for(r=2,n=0;n<f;n++)m=m<<1|1&r,g==t-1?(g=0,h.push(o(m)),m=0):g++,r>>=1;for(;;){if(m<<=1,g==t-1){h.push(o(m));break}g++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,o,n){let r,i,a,s,c,p,l,d,u=[],f=4,h=4,m=3,g="",v=[],y={val:n(0),position:o,index:1};for(i=0;i<3;i+=1)u[i]=i;for(s=0,p=Math.pow(2,2),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;switch(r=s){case 0:for(s=0,p=Math.pow(2,8),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;d=e(s);break;case 1:for(s=0,p=Math.pow(2,16),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;d=e(s);break;case 2:return""}for(u[3]=d,a=d,v.push(d);;){if(y.index>t)return"";for(s=0,p=Math.pow(2,m),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;switch(d=s){case 0:for(s=0,p=Math.pow(2,8),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;u[h++]=e(s),d=h-1,f--;break;case 1:for(s=0,p=Math.pow(2,16),l=1;l!=p;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=n(y.index++)),s|=(c>0?1:0)*l,l<<=1;u[h++]=e(s),d=h-1,f--;break;case 2:return v.join("")}if(0==f&&(f=Math.pow(2,m),m++),u[d])g=u[d];else{if(d!==h)return null;g=a+a.charAt(0)}v.push(g),u[h++]=a+g.charAt(0),a=g,0==--f&&(f=Math.pow(2,m),m++)}}};return i}(),t={};return t.c=e.compressToUint8Array,t.d=e.decompressFromUint8Array,t.c1=e.compressToBase64,t.d1=e.decompressFromBase64,t}).factory("xssList",function(){let e=[];return{filterXSS:function(e){return filterXSS(e)},escape:function(e){return escape(e)},add:function(t){let o=!1;e.map(function(e,n){e.data==t.data&&(o=!0)}),o||e.push(t)},xss:function(){e.map(function(e,t){let o=e.data[e.key];e.data[e.key]=filterXSS(o)}),e=[]}}}).factory("common",function(){let e={now:function(){return(new Date).getTime()},uuid:function(e,t,o){return(o=o||"")+uuidv1().replace(/-/g,"")},arrayContainsArray:function(e,t){return!!(e&&t&&e.length&&t.length)&&(!(e.length<t.length)&&e.filter(function(e){return t.includes(e)}).length===t.length)},getIndexFromPortUuid:function(e){return e.includes("in")?parseInt(e.substr(2),10):parseInt(e.substr(3),10)},getDirList:function(t,o){let n=[];if(!t||!t.length)return n;for(let r=0;r<t.length;r++){let i=t[r];o&&(i.parentId=o),i.selected&&delete i.selected,n.push(i),i.children&&(n=n.concat(e.getDirList(i.children,i.id)))}return n},getDirMap:function(t){let o={},n=e.getDirList(t);for(let e=0;e<n.length;e++)o[n[e].id]=n[e];return o},expandDir:function(e,t){for(;t;){let o=e[t];void 0===o.expanded&&(o.expanded=!0),t=o.parentId}},handleLinkInDesc:function(e){function t(e){let t="";return 0===e.length?t:t=(t+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let o=e.indexOf("http");if(o>-1){let n=e.slice(o),r=n.indexOf(" "),i=n.indexOf("\n"),a=n.length;r>0?a=r:i>0&&(a=i);let s=n.slice(0,a);e=t(e.slice(0,o))+'<a href="'+s+'" target="_blank" ng-click="$event.stopPropagation()">'+s+"</a>"+t(e.slice(o+a))}else e=t(e);return e},getUploadPath:function(t,o,n){return"studio/"+t+"/component/"+o+"/uploaded_code_"+e.uuid()},getUploadPyLibPath:function(e,t){return"studio/"+e+"/component/"+t+"/uploaded_py_lib.zip"},getUploadNodeDataPath:function(e,t="data"){return"studio/{{userId}}/{{appId}}/{{nodeId}}/"+e+"/"+t+"/"},getUploadDataPath:function(e){return"studio/{{userId}}/share/{{appId}}/uploads/"+e+"/"},getScreenshotKey:function(e,t){return`studio/${e}/${t}/screen_shot.png`},getImportPath:function(e){return`studio/${e}/tmp/import/`},calImageSize:function(e,t){let o=new Image;o.src=e,o.onload=function(){let e=o.naturalWidth,n=o.naturalHeight;t({width:126,height:126*(n/e)})}},isEmpty:function(e){for(let t in e)if(e.hasOwnProperty(t))return!1;return!0},changeBackspaceDefault:function(e){let t=e.srcElement||e.target,o=!1;(o=("INPUT"!==t.tagName.toUpperCase()||"TEXT"!==t.type.toUpperCase()&&"PASSWORD"!==t.type.toUpperCase()&&"FILE"!==t.type.toUpperCase()&&"EMAIL"!==t.type.toUpperCase()&&"SEARCH"!==t.type.toUpperCase()&&"DATE"!==t.type.toUpperCase())&&"TEXTAREA"!==t.tagName.toUpperCase()||(t.readOnly||t.disabled))&&e.preventDefault()},detectFormElement:function(e){let t,o=e.srcElement||e.target;return t="INPUT"===o.tagName.toUpperCase()&&("TEXT"===o.type.toUpperCase()||"PASSWORD"===o.type.toUpperCase()||"FILE"===o.type.toUpperCase()||"SEARCH"===o.type.toUpperCase()||"DATE"===o.type.toUpperCase())||"TEXTAREA"===o.tagName.toUpperCase()},getInitedNodeColor:function(e){switch(e){case"default":return"rgba(255,255,255,1)";case"primary":return"rgba(69,112,253,1)";case"info":return"rgba(214,69,250,1)";case"success":return"rgba(253,91,70,1)";case"warning":return"rgba(254,70,144,1)";case"danger":return"rgba(79,86,104,1)";case"orange":return"rgba(243,152,0,1)";case"green":return"rgba(0,153,68,1)";case"blue":return"rgba(0,70,134,1)";case"cyan":return"rgba(19,181,177,1)";case"golden":return"rgba(237,0,27,1)";case"warmgreen":return"rgba(179,212,101,1)";default:return"rgba(255,255,255,1)"}}};return window.handleLinkInDesc=e.handleLinkInDesc,window.common={uuid:e.uuid,getImportPath:e.getImportPath},e}).factory("multiselect",function(){let e,t,o,n=[];return{init:function(r,i,a){let s=$(r);e=s,t=i,o=a;s.on("dragstart",{distance:2},function(e,t){return n=[],$('<div class="drag-selection" />').css({position:"fixed",zIndex:1e3}).appendTo(document.body)}).on("drag",function(e,t){$(t.proxy).css({top:Math.min(e.clientY,t.startY),left:Math.min(e.clientX,t.startX),height:Math.abs(e.clientY-t.startY),width:Math.abs(e.clientX-t.startX)})}).on("dragend",function(e,t){$(t.proxy).remove(),"function"==typeof a&&a(n)}),s.find(".element").on("dropstart",function(e,t){$(this).addClass("mock-selected"),n.push(this),"function"==typeof i&&i()}).on("dropend",function(e,t){$(this).removeClass("mock-selected");let o=n.indexOf(this);n.splice(o,1),"function"==typeof i&&i()}).on("drop",function(e,t){$(this).addClass("selected"),n.push(this)}),$.drop({multi:!0})},select:function(e){e&&e.map(function(e){let t=$("#player #"+e.id);t.addClass("selected"),n.push(t[0])})},add:function(o){e.find("#"+o.id).on("dropstart",function(e,o){$(this).addClass("mock-selected"),n.push(this),"function"==typeof t&&t()}).on("dropend",function(e,o){$(this).removeClass("mock-selected");let r=n.indexOf(this);n.splice(r,1),"function"==typeof t&&t()}).on("drop",function(e,t){$(this).addClass("selected"),n.push(this)})},remove:function(t){e.find("#"+t.id).off("drop dropstart dragend")},disable:function(){e.off("drag dragstart dragend"),e.find(".element").off("drop dropstart dropend")},getCurrent:function(){return n},clearCurrent:function(){n=[],e&&e.find(".element").removeClass("selected")}}}).factory("align",function(){function e(e,t){let o=[];for(let n=0;n<e.length;n++)o.push(e[n].css[t]);return Math.min.apply(null,o)}function t(e,t){$("#player #"+e).css(t),$(".app-aside #"+e).css(t)}return{left:function(o){let n=e(o,"left");for(let e=0;e<o.length;e++)o[e].css.left=n,t(o[e].id,{left:n})},top:function(o){let n=e(o,"top");for(let e=0;e<o.length;e++)o[e].css.top=n,t(o[e].id,{top:n})},right:function(e){let o=[];for(let t=0;t<e.length;t++)o.push(parseInt(e[t].css.left)+parseInt(e[t].css.width));let n=Math.max.apply(null,o);for(let o=0;o<e.length;o++)e[o].css.left=n-parseInt(e[o].css.width),t(e[o].id,{left:n-parseInt(e[o].css.width)})},bottom:function(e){let o=[];for(let t=0;t<e.length;t++)o.push(parseInt(e[t].css.top)+parseInt(e[t].css.height));let n=Math.max.apply(null,o);for(let o=0;o<e.length;o++)e[o].css.top=n-parseInt(e[o].css.height),t(e[o].id,{top:n-parseInt(e[o].css.height)})},center:function(o){let n=e(o,"left"),r=[];for(let e=0;e<o.length;e++)r.push(parseInt(o[e].css.left)+parseInt(o[e].css.width));let i=Math.max.apply(null,r)/2+n/2;for(let e=0;e<o.length;e++)o[e].css.left=i-parseInt(o[e].css.width)/2,t(o[e].id,{left:i-parseInt(o[e].css.width)/2})},middle:function(o){let n=e(o,"top"),r=[];for(let e=0;e<o.length;e++)r.push(parseInt(o[e].css.top)+parseInt(o[e].css.height));let i=n/2+Math.max.apply(null,r)/2;for(let e=0;e<o.length;e++)o[e].css.top=i-parseInt(o[e].css.height)/2,t(o[e].id,{top:i-parseInt(o[e].css.height)/2})}}}).factory("multidrag",function(){let e,t,o,n,r,i,a,s;return{enable:function(c,p,l){let d=$(l);function u(e){let t,o=$(e).attr("id");return p.map(function(e){e.id==o&&(t=e)}),t}a=d,d.on("mousedown.multi",function(a){(s=Draggable.create(this,{type:"top,left",zIndexBoost:!1,bounds:".edit_main",onPress:function(){e=[],t=this.x,o=this.y;for(let t=0;t<d.length;t++)if(d[t]!==this.target){let o=u(d[t]),n={element:d[t],preview:$(".app-aside #"+$(d[t]).attr("id")),data:o,x:o.css.left,y:o.css.top};e.push(n)}r=$(this.target),i=$(".app-aside #"+$(this.target).attr("id")),TweenLite.killTweensOf(d)},onDragStart:function(){n=function(e){let t=[];for(let o=0;o<e.length;o++)t.push(e[o].css.top);let o=Math.min.apply(null,t),n=[];for(let t=0;t<e.length;t++)n.push(e[t].css.left);let r=Math.min.apply(null,n);return{top:o,left:r}}(p)},onDrag:function(){d.addClass("user-move");let n={left:this.x,top:this.y};TweenLite.set(i,{css:n}),angular.extend(u(r).css,n),function(){let n,r=this.x-t,i=this.y-o;for(let t=0;t<e.length;t++){let o={top:(n=e[t]).y+i,left:n.x+r};TweenLite.set(n.element,{css:o}),TweenLite.set(n.preview,{css:o}),angular.extend(n.data.css,o)}}.apply(this)},onDragEnd:function(){d.removeClass("user-move"),s[0].kill()}}))[0].startDrag(a)})},disable:function(){a&&a.off("mousedown.multi")}}}).factory("ossImageProcess",function(){return function(e){return e.rotate+"r|"+(t=e.x,o=e.y,n=e.width,r=e.height,t+"-"+o+"-"+n+"-"+r+"a")+"|506h_320w_0e";var t,o,n,r}}).factory("selectionOp",function(){return function(e){try{document.execCommand("MultipleSelection",null,!0)}catch(e){}rangy.init();let t=null,o=rangy.createHighlighter();return o.addClassApplier(rangy.createClassApplier("highlight",{ignoreWhiteSpace:!0,tagNames:["span","a"]})),e.on("focus.rangy",function(){t&&rangy.removeMarkers(t),t=rangy.saveSelection()}).on("blur.rangy",function(){o.highlightSelection("highlight")}),function(){e.off("focus.rangy").off("focus.rangy"),$("input.sp-input").off("focus.current").off("blur.current")}}}).factory("enabledUser",function(){let e=[["s","h","a","n","g","l","u","e"]];e=_.map(e,function(e){return e.join("")});let t=-1==_.indexOf(e,window.appConfig.userId);return window.enabled=t,t}).factory("format",["$stateParams",function(e){return function(t,o){if(o||(o={"{{userId}}":window.appConfig.userId,"{{appId}}":e.id,"{{nodeId}}":e.nodeId,"{{componentId}}":e.componentId}),_.isEmpty(t))return t;let n=t;return _.keys(o).forEach(e=>{n=n.replace(e,o[e])}),n}}]).factory("loopService",["$q","toaster",function(e,t){const o={};let n,r,i;const a=function(o,s,c,p){o&&o.asyncable&&(i=e.defer()),_.has(o,"title")&&(r?r&&(r.toaster.title=o.title,t.reset(r)):r=t.pop({type:"info",title:o.title,timeout:0,tapToDismiss:!1}));const l=function(){n&&(clearTimeout(n),n=null),n=setTimeout(function(){c(s).then(function(e){"completed"===e.job.status?_.get(e.job.returnvalue,"id")&&"export"===o.type?a({type:o.type},e.job.returnvalue.id,c,p):(r&&t.clear(r),clearTimeout(n),n=null,r=null,p&&p(e.job.returnvalue),i&&i.resolve(e.job.returnvalue)):"failed"===e.job.status?(r&&t.clear(r),clearTimeout(n),n=null,r=null,i&&i.reject({msg:e.job.failedReason})):(r&&(r.toaster.title=o.title+"，已完成 "+e.job.progress+"%",t.reset(r)),l())},function(e){i&&i.reject(e)})},2e3)};if(l(),i)return i.promise};return o.fetchJob=a,window.loopService=o,o}]).factory("downloadFile",["appDataStoreService","$q",function(e,t){let o={};function n(e,t){if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(e,t);else{let o=document.createElement("a"),n=document.querySelector("body");o.href=window.URL.createObjectURL(e),o.download=t,o.style.display="none",n.appendChild(o),o.click(),n.removeChild(o),window.URL.revokeObjectURL(o.href)}}function r(e,t){o.getBlob(e).then(function(e){n(e,t)},function(e){})}let i={oss:r,minio:r,local:function(e){open("/local/"+e)}};return o.getBlob=function(o,n){let r=t.defer();return e.get(o,!0).then(function(e){return new Blob([e.buffer])}).then(function(e){if(n){let t=new FileReader;t.onloadend=function(){r.resolve(t.result)},t.readAsDataURL(e)}else r.resolve(e)}).catch(function(e){r.reject(e)}),r.promise},o.download=function(e,t){i[appConfig.appDataStoreType](e,t)},o.downloadZip=function(e,r){let i=t.defer(),a=new JSZip,s=e.length,c=0,p=[],l=function(){c<s?d(e[c]):a.generateAsync({type:"blob"}).then(function(e){n(e,r+".zip"),i.resolve({completed:!p.length,failedFile:p})})},d=function(t){c++,o.getBlob(t.id).then(function(e){a.file(t.label,e),l()},function(o){p.push({id:e.id,label:t.label,error:o}),l()})};return d(e[c]),i.promise},o}]),angular.module("app").factory("nodeService",["$q","$rootScope","common","componentService","$state","toaster","$stateParams","appDataStoreService","statisticsService","eventService",function(e,t,o,n,r,i,a,s,c,l){let d,u,f,h=window.TheGraph.fbpGraph,m={getComponentInfo:function(e){return m[e]}},g=null,v=null,y=null,b=null,w=null,x=null,S=null,C=null,I=null,E=null,N=function(e,t,o){g&&g(e,t,o)},T=function(e){l.emit(l.EVENTS.sp.node.contextmenu,[e]),E&&E(e)},$=function(e,t,o){v&&v(e,t,o)},k=function(e,t,o){y&&y(e,t,o)},P=function(e,t,o,n){b&&b(e,t,o,n)},A=function(e){w&&w(e)},O=function(){let e={x:u.properties.x||0,y:u.properties.y||0,readonly:!1,height:d.height(),width:d.width(),graph:u,library:m,showScriptEditIcon:r.includes("app.predict"),onEdgeSelection:k,onClickEdgeCode:P,onNodeSelection:N,showContext:T,onNodeRectImgDblclick:$,onGroupSelection:A,onExpandIconClicked:function(e,t){I&&I(e,t)},onMoved:function(e,t){u.properties.x=e,u.properties.y=t},menus:{node:{s4:{icon:"trash-o",iconLabel:"delete",action:function(e,t,o){e.removeNode(t);for(var n=[],r=0,i=this.selectedNodes.length;r<i;r++){var a=this.selectedNodes[r];a!==o&&n.push(a)}this.selectedNodes=n}}}}},t=React.createElement(TheGraph.App,e);f=ReactDOM.render(t,d.get(0))};const M=function(e){const t=[],o=[];for(let n in e)t.push(e[n].metadata.x),o.push(e[n].metadata.y);return{x:{min:_.min(t),max:_.max(t)},y:{min:_.min(o),max:_.max(o)}}};let L={init:function(e,t,o){d=e,t&&"{}"!==t?(t=function(e){let t=JSON.parse(e);try{t=JSON.parse(e)}catch(e){}let o=document.body.offsetWidth,n=document.body.offsetHeight-50,r=t.properties.x,i=t.properties.y;const a=M(t.processes);let s=a.x.min,c=a.y.min,p=a.x.max,l=a.y.max;return(s+r<250&&p+r<250||s+r>o-250&&p+r>o-250)&&(t.properties.x=(o-p+s)/2-s-45-50),(c+i<0&&l+i<0||c+i>n-45&&l+i>n-45)&&(t.properties.y=(n-l+c)/2-c-45),JSON.stringify(t)}(t),h.graph.loadJSON(t,function(e,t){u=t,O(),o()})):(u=new h.Graph,O(),o()),u.on("endTransaction",function(e){x&&x(e)}),window.addEventListener("resize",function(){L.resetCanvas()})},resetCanvas:function(){let e=d.width(),t=d.height();if(d.is(":hidden")){const o=d.parents("#edit");e=o.width(),t=o.height()-64-16-2,o.hasClass("left-hidden")?e-=32:e-=296,o.hasClass("right-hidden")?e-=32:e-=296,e-=2}f.setState({width:e,height:t})},getPosition:function(){return{x:f.state.x,y:f.state.y,scale:f.state.scale}},setPosition:function(e,t,o){f.setState({x:e,y:t,scale:o||1})},addGroup:function(e,t,o){u.addGroup(e,t,o)},getGroups:function(){return u.groups},getGroup:function(e){for(let t=0;t<u.groups.length;t++){let o=u.groups[t];if(o.name===e)return o}return null},getChildGroup:function(e){let t=[],n=L.getGroups(),r=L.getGroup(e);if(!r||!r.nodes)return!1;for(let i=0;i<n.length;i++){let a=n[i];a.name!==e&&(o.arrayContainsArray(r.nodes,a.nodes)&&t.push(a))}return t},getParentGroup:function(e){let t=[],n=L.getGroups(),r=L.getGroup(e);if(!r||!r.nodes)return!1;for(let i=0;i<n.length;i++){let a=n[i];a.name!==e&&(o.arrayContainsArray(a.nodes,r.nodes)&&t.push(a))}return t},whichGroup:function(e){let t=[],o=L.getGroups();if(!o)return t;for(let n=0;n<o.length;n++){let r=o[n];r.nodes&&(r.nodes.includes(e)&&t.push(r))}return t},removeGroup:function(e){u.removeGroup(e)},getPortHasTargetNodePort:function(e,t,o,n){let r=0;for(let i=0;i<e.length;i++){let a=e[i];if(a.ioType===t&&(r++,a.targetNode===o&&a.targetPort===n))return{result:!0,id:a.uuid}}return{result:!1,id:t+(r+1)}},expandGroup:function(e){let t=L.whichGroup(e.id),o=u.toJSON(),n=function(t){for(let o=0;o<e.metadata.def.ports.length;o++){let n=e.metadata.def.ports[o];if(n.uuid===t)return n}},r=_.get(e,"metadata.def.composite"),a=0,s=0;if(e.metadata.initCoord)a=e.metadata.x-e.metadata.initCoord.x,s=e.metadata.y-e.metadata.initCoord.y;else if(r){const t=M(r.processes);let o=t.x.min+(t.x.max-t.x.min)/2,n=t.y.min+(t.y.max-t.y.min)/2;a=e.metadata.x-o,s=e.metadata.y-n}let c=[];Object.keys(r.processes).forEach(function(e){c.push(e);const o=r.processes[e].metadata;o.x+=a,o.y+=s,L.addNode(e,r.processes[e].component,o),t.forEach(function(t){t.nodes.push(e)})}),o.connections.forEach(function(t){if(t.src.process===e.id){let e=n(t.src.port);e&&e.display?u.addEdge(e.targetNode,e.targetPort,t.tgt.process,t.tgt.port):(u.removeEdge(t.src.process,t.src.port,t.tgt.process,t.tgt.port),i.pop("info","运行项目更新，连线删除"))}else if(t.tgt.process===e.id){let e=n(t.tgt.port);e&&e.display?u.addEdge(t.src.process,t.src.port,e.targetNode,e.targetPort):(u.removeEdge(t.src.process,t.src.port,t.tgt.process,t.tgt.port),i.pop("info","运行项目更新，连线删除"))}}),r.connections.forEach(function(e){u.addEdge(e.src.process,e.src.port,e.tgt.process,e.tgt.port)}),-1==_.findIndex(u.groups,{name:e.id})?L.addGroup(e.id,c,{name:e.metadata.label,component:e.component,data:e.metadata}):u.setGroupMetadata(e.id,{name:e.metadata.label,component:e.component,data:e.metadata}),e.id,u.removeNode(e.id)},collectCompositePorts:function(e,t){const o=Object.keys(e.processes);_.remove(t,function(e){return-1==_.indexOf(o,e.targetNode)});let n=_.map(_.filter(t,{ioType:"in"}),function(e){return parseInt(e.uuid.slice(2))}),r=_.map(_.filter(t,{ioType:"out"}),function(e){return parseInt(e.uuid.slice(3))}),i=_.isEmpty(n)?1:_.max(n)+1,a=_.isEmpty(r)?1:_.max(r)+1,s={};e.connections.forEach(function(e){s[e.src.process+"-"+e.src.port]=1,s[e.tgt.process+"-"+e.tgt.port]=1}),o.forEach(function(o){e.processes[o].metadata.def.ports.forEach(function(e){const n=_.findIndex(t,function(t){return t.targetNode==o&&t.targetPort==e.uuid});var r;if(e.display){if(!s[o+"-"+e.uuid])return n>-1?(t[n].type=e.type,t[n].display=e.display,void(t[n].description=e.description)):void t.push({description:e.description,display:1,ioType:e.ioType,targetNode:o,targetPort:e.uuid,type:e.type,uuid:(r=e.ioType,"in"===r?"in"+i++:"out"+a++)});n>-1&&t.splice(n,1)}else n>-1&&(t[n].display=e.display)})})},collectGroupInport:function(e,t){for(let o=0;o<e.length;o++){let n=e[o],r=L.getPort(n.tgt.process,n.tgt.port);if(!r)continue;let i=L.getPortHasTargetNodePort(t,"in",n.tgt.process,n.tgt.port);i.result||t.push({description:angular.copy(r.description),display:1,ioType:"in",targetNode:n.tgt.process,targetPort:n.tgt.port,type:r.type,uuid:i.id})}t.length||t.push({description:"",display:0,ioType:"in",uuid:"in1"})},collectGroupOutport:function(e,t){for(let o=0;o<e.length;o++){let n=e[o],r=L.getPort(n.src.process,n.src.port);if(!r)continue;let i=L.getPortHasTargetNodePort(t,"out",n.src.process,n.src.port);i.result||t.push({description:angular.copy(r.description),display:1,ioType:"out",targetNode:n.src.process,targetPort:n.src.port,type:r.type,uuid:i.id})}},findGroupMinMax:function(e){return window.TheGraph.findMinMax(u,e)},getGroupNodeUiControl:function(e,t){let o;if(t.metadata.ui.tabs.fields&&t.metadata.ui.tabs.fields.controls){o=t.metadata.ui.tabs.fields.controls;for(let t=0;t<o.length;t++){let n=o[t];if(n.uuid===e.controlId)return n}}if(t.metadata.ui.tabs.params&&t.metadata.ui.tabs.params.controls){o=t.metadata.ui.tabs.params.controls;for(let t=0;t<o.length;t++){let n=o[t];if(n.uuid===e.controlId)return n}}if(t.metadata.ui.tabs.tune&&t.metadata.ui.tabs.tune.controls){o=t.metadata.ui.tabs.tune.controls;for(let t=0;t<o.length;t++){let n=o[t];if(n.uuid===e.controlId)return n}}return null},genGroupTabInfo:function(e){let t=[];if(!e)return t;for(let o=0;o<e.length;o++){let n=e[o],r=L.getNode(n.nodeId),i=L.getGroupNodeUiControl(n,r);i&&t.push(i)}return t},genCompositeTabInfo:function(e,t,o,n){let r=[];if(!e)return r;for(let i=0;i<e.length;i++){let a=e[i];if("global"===a.type)o&&o.forEach(function(e){e.id===a.id&&r.push({type:"global",uuid:e.id})});else{let e=t[a.nodeId],o=L.getGroupNodeUiControl(a,e);o&&(p.nodeId=a.nodeId,p.appId=n,r.push(o))}}return r},getInitedMetadata:function(){return{def:{description:{zh_CN:""},type:999,params:{},ports:[]},ui:{tabs:{params:{tabName:{en_US:"Parameters Setting",zh_CN:"参数设置",zh:"参数设置"},controls:[]}}},locale:"zh_CN"}},foldGroup:function(e){let t=L.getParentGroup(e),o=L.getGroup(e);if(!o)return;let n=_.isEmpty(o.metadata.data)?L.getInitedMetadata():Object.assign({},_.get(o,"metadata.data"));if(n.label=o.metadata.name,o&&!_.isEmpty(o.nodes)){const e=L.findGroupMinMax(o.nodes);if(e){const t=(e.minX+e.maxX)/2-45,o=(e.minY+e.maxY)/2-45;n.x=t,n.y=o,n.initCoord={x:t,y:o}}}_.has(o,"metadata.def")&&Object.assign(n.def,o.metadata.def);let r=u.toJSON(),i=L.getGroupConnections(r,o);L.collectGroupInport(i.inConnections,n.def.ports),L.collectGroupOutport(i.outConnections,n.def.ports),L.genParamsFromPorts(n.def.ports,n.def.params),"composite"==o.metadata.component&&_.isEmpty(n.def.composite)&&(n.def.composite=JSON.parse('{"caseSensitive":false,"properties":{},"inports":{},"outports":{},"groups":[],"processes":{},"connections":[]}'),n.def.composite.connections=angular.copy(i.innerConnections),Object.keys(r.processes).forEach(function(e){o.nodes.includes(e)&&(n.def.composite.processes[e]=r.processes[e])})),u.removeGroup(e),o.nodes,o.nodes.forEach(function(e){u.removeNode(e)}),-1==_.findIndex(u.nodes,{id:e})?u.addNode(e,o.metadata.component,n):u.setNodeMetadata(e,n);for(let t=0;t<i.inConnections.length;t++){let o=i.inConnections[t],r=L.getPortHasTargetNodePort(n.def.ports,"in",o.tgt.process,o.tgt.port);u.addEdge(o.src.process,o.src.port,e,r.id)}for(let t=0;t<i.outConnections.length;t++){let o=i.outConnections[t],r=L.getPortHasTargetNodePort(n.def.ports,"out",o.src.process,o.src.port);u.addEdge(e,r.id,o.tgt.process,o.tgt.port)}t.forEach(function(t){t.nodes.push(e)})},getPort:function(e,t){let o=L.getNode(e);if(!o)return null;let n=o.metadata.def.ports;for(let e=0;e<n.length;e++){let o=n[e];if(o.uuid===t)return o}return null},genParamsFromPorts:function(e,t){for(let o=0;o<e.length;o++){let n=e[o];if(n.display&&n.type){let e=L.getNode(n.targetNode);if(e){let r=e.metadata.def.params;for(let e in r){let i=r[e];"in"===n.ioType?i.defInPortUuid===n.targetPort&&(t[e+o]=angular.copy(i),t[e+o].defInPortUuid=n.uuid):i.defOutPortUuid===n.targetPort&&(t[e+o]=angular.copy(i),t[e+o].defOutPortUuid=n.uuid)}}}}},getGroupConnections:function(e,t){let o=[],n=[],r=[],i=[];return Object.keys(e.connections).forEach(function(a){let s=e.connections[a];t.nodes.includes(s.tgt.process)?t.nodes.includes(s.src.process)?r.push(s):o.push(s):t.nodes.includes(s.src.process)?n.push(s):i.push(s)}),angular.copy({inConnections:o,outConnections:n,innerConnections:r,outerConnections:i})},getNode:function(e){return u?u.getNode(e):null},showAllScreenshots:function(){},updateScreenshot:function(e){},getEdge:function(e,t,o,n){return u.getEdge(e,t,o,n)},getNodeScriptEdges:function(e){return _.filter(u.edges,function(t){return(t.from.node==e||t.to.node==e)&&_.has(t,"metadata.script")})},setEdgeMetadata:function(e,t,o,n,r){return u.setEdgeMetadata(e,t,o,n,r)},getPredictConfig:function(){return angular.copy(u.properties.predictConfig)},getCronConfig:function(){return angular.copy(u.properties.cronConfig)},setCronConfig:function(e){u.properties.cronConfig=angular.copy(e)},getDashboardConfig:function(){return angular.copy(u.properties.dashboardConfig)},setDashboardConfig:function(e){u.properties.dashboardConfig=angular.copy(e)},setEdgeScript:function(e,t,o,n){return u.appScripts||(u.appScripts={}),_.set(u,`appScripts.${e}.${t}.${o}`,n),u},setGlobalScript:function(e){return u.appScripts||(u.appScripts={}),u.appScripts.global=e,u},getGraph:function(){return u},getParamsModel:function(e){let t={port:{},control:{}},o=function(e,o){if(!o.controlInstUuid||"undefined"===o.controlInstUuid)return;const n=_.cloneDeep(o);_.unset(n,"controlInstUuid");let r=t.control[o.controlInstUuid]={meta:n};r.value=e,o.defInPortUuid&&(r.inport=o.defInPortUuid),o.defOutPortUuid&&(r.outport=o.defOutPortUuid,r.outportProperty=o.propertyName);for(let e in o)switch(e){case"type":case"defInPortUuid":case"defOutPortUuid":case"controlInstUuid":case"propertyName":break;default:r.meta[e]=o[e]}},n=function(e,o){t.port[o.defInPortUuid]||(t.port[o.defInPortUuid]={});let n=t.port[o.defInPortUuid];"tableName"===o.propertyName&&(n.table=e),"partitionName"===o.propertyName&&(n.partition=e),"modelName"===o.propertyName&&(n.model=e),"dataName"===o.propertyName&&(n.data=e),"visualName"===o.propertyName&&(n.visual=e)},r=function(e,n){t.port[n.defOutPortUuid]||(t.port[n.defOutPortUuid]={});let r=t.port[n.defOutPortUuid];"tableName"===n.propertyName&&(r.table=e),"partitionName"===n.propertyName&&(r.partition=e),"modelName"===n.propertyName&&(r.model=e),"dataName"===n.propertyName&&(r.data=e),"visualName"===n.propertyName&&(r.visual=e),n.defOutPortUuid&&o("",n)};for(let t in e)e[t].defOutPortUuid?r(t,e[t]):e[t].controlInstUuid?o(t,e[t]):e[t].defInPortUuid&&n(t,e[t]);return t},getCustomizeNodeMetadata:function(e,t){let o={},n=function(e){switch(e){case"table":return"tableName";case"partition":return"partitionName";case"model":return"modelName";case"visual":return"visualName";case"data":return"dataName"}};for(let e in t.port){let r=t.port[e];for(let t in r)r[t]&&(0===e.indexOf("in")?o[r[t]]={type:"string",propertyName:n(t),defInPortUuid:e}:o[r[t]]={type:"string",propertyName:n(t),defOutPortUuid:e})}for(let e in t.control)if(t.control[e].value){o[t.control[e].value]={type:"string",controlInstUuid:e};for(let n in t.control[e].meta)o[t.control[e].value][n]=t.control[e].meta[n];t.control[e].inport&&(o[t.control[e].value].defInPortUuid=t.control[e].inport)}else if(t.control[e].outport)for(let n in o)if(o[n].defOutPortUuid===t.control[e].outport&&o[n].propertyName===t.control[e].outportProperty){o[n].controlInstUuid=e;for(let r in t.control[e].meta)o[n][r]=t.control[e].meta[r]}let r=angular.copy(L.getNode(e)).metadata;return delete r.x,delete r.y,delete r.width,delete r.height,delete r.label,r.def.params=o,r},addNode:function(e,t,o){let n=u.addNode(e,t,o);return L.analyzeGraph(),setTimeout(function(){c.trackEvent(c.STAT_ACTIONS.APP.NODE_ADDED,t,{},{nodeId:e,componentId:t,metadata:o})},0),n},addPublicRemoteNode:function(e,t,r,a){n.getPublic(e).then(function(n){let i=JSON.parse(n.componentInfo.data),s=d.offset(),c=d.find(".view").attr("transform"),p=_.toNumber(_.split(_.split(c,",")[0],"(")[1]);r=r||0,t=((t=t||0)-s.left-45*p-f.state.x)/p,r=(r-s.top-45*p-f.state.y)/p,i.label=n.componentInfo.name,i.x=t,i.y=r,i.type=a;const l=o.uuid();return 10002==i.def.type&&(i.apiName=l),L.addNode(l,e,i),l},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addRemoteNode:function(e,t,r,a){n.get(e).then(function(n){let i=JSON.parse(n.componentInfo.data),s=d.offset(),c=d.find(".view").attr("transform"),p=_.toNumber(_.split(_.split(c,",")[0],"(")[1]);r=r||0,t=((t=t||0)-s.left-45*p-f.state.x)/p,r=(r-s.top-45*p-f.state.y)/p,i.label=n.componentInfo.name,i.x=t,i.y=r,i.type=a;let l=o.uuid();return L.addNode(l,e,i),l},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addRemoteDashboardNode:function(e){n.get(e).then(function(e){let t=JSON.parse(e.componentInfo.data).def.dashboardComponentType;S(t)},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addDashboardNode:function(e){if(!e.x||!e.y){const t=f.state.scale,o=Math.floor(9*Math.random()),n=Math.floor(6*Math.random()),r=(90*o+30-f.state.x)/t,i=(90*n+30-f.state.y)/t;e.x=r,e.y=i}let t=o.uuid();return L.addNode(t,"dashboard",e),t},addExternalNode:function(e,t,r,a){t=t||0,r=r||0;const s=e.componentId,c=e.label,p=d.offset(),l=d.find(".view").attr("transform"),u=_.toNumber(_.split(_.split(l,",")[0],"(")[1]);t=(t-p.left-45*u-f.state.x)/u,r=(r-p.top-45*u-f.state.y)/u;const h=o.uuid();let m=n.getPublic;"device_component"===a&&(m=n.get),m(s).then(function(o){let n=JSON.parse(o.componentInfo.data),i=o.componentInfo.id;if(n.label=c,n.x=t,n.y=r,n.type=a,n.tags=o.componentInfo.tags,"device_component"===a){n.def.params.param2.value=e.deviceId,n.def.dashboardComponentType="xly-iframe";const t=n.def.dashboardComponentType;S(t,{propName:e.label,url:e.mxgraphUrl})}return L.addNode(h,i,n),h},function(e){_.isError(e.err)?i.pop("error","组件加载失败: "+e.err.message):i.pop("error","组件加载失败: "+e.msg)})},addWebCompNode:function(e,t,n,r,i){let a;"__web_input"===e&&(a={uuid:r,apiName:"",icon:"globe",def:{description:{zh_CN:"web input "+i},type:"web-input",theme:"green",docUrl:"",author:"aliyun",params:{__script:{type:"string",value:"",isRequired:!0}},ports:[{uuid:"out1",description:{en_US:"input data",zh_CN:"web input 数据"},display:1,ioType:"out",type:"data"}]},locale:"zh_CN"}),"__web_output"===e&&(a={uuid:r,icon:"globe",def:{icon:"globe",description:{zh_CN:"web output "+i},type:"web-output",theme:"green",docUrl:"",author:"aliyun",params:{},ports:[{uuid:"in1",description:{en_US:"output data",zh_CN:"web output 数据"},display:1,ioType:"in",type:"data"}]},locale:"zh_CN"});let s=d.offset(),c=d.find(".view").attr("transform"),p=_.toNumber(_.split(_.split(c,",")[0],"(")[1]);n=n||0,t=((t=t||0)-s.left-45*p-f.state.x)/p,n=(n-s.top-45*p-f.state.y)/p,a.label=a.def.description.zh_CN,a.x=t,a.y=n;let l=o.uuid();return L.addNode(l,e,a),l},addCustomNode:function(e,t,n){"string"==typeof t&&(t=JSON.parse(t));let r=angular.copy(t);r.label=e,r.x=f.state.width/2-100,r.y=200,r.type=n;let i=o.uuid();return L.addNode(i,"custom",r),i},deleteNode:function(){a.nodeId},copyNode:function(e){e||(e=a.nodeId);const t=this.getNode(e);return{nodeInfo:angular.copy(t.metadata),component:angular.copy(t.component)}},pasteNode:function(e,t){let n=angular.copy(e),r=(d.offset(),n.x+20),i=n.y+20;n.x=r,n.y=i;let a=o.uuid();return L.addNode(a,t,n)},removeNode:function(e,t){if(e||(e=a.nodeId),!t){const t=L.getNode(e),o=_.get(t,"metadata.def.dashboardId");o&&C&&C(o)}u.removeNode(e),setTimeout(function(){c.trackEvent(c.STAT_ACTIONS.APP.NODE_DELETED,e)},0)},removeEdge:function(e,t,o,n){u.removeEdge(e,t,o,n)},getGraphJson:function(){return angular.copy(u.toJSON())},hightEdges:function(e){let t=document.querySelector(".edges"),o=document.querySelector(".edges").childNodes,n=[];for(let t=0;t<o.length;t++)o[t].attributes&&(angular.element(o[t]).removeClass("active"),o[t].getAttribute("id")&&o[t].getAttribute("id").indexOf(e)>-1&&(angular.element(o[t]).addClass("active"),n.push(o[t])));for(let e=0;e<n.length;e++)t.appendChild(n[e]);return o},getDashboardNode:function(e){for(let t=0;t<u.nodes.length;t++)if(_.get(u.nodes[t],"metadata.def.dashboardId")===e)return u.nodes[t]},analyzeGraph:function(e){let t={},o={},n={};u.nodes.forEach(function(e){_.get(e,"metadata.def.ports").forEach(function(r){if(!r.display||!r.type||!r.subType)return;let i=r.type+":"+r.subType;t[e.id+":"+r.uuid]=i,"out"===r.ioType?(o[i]||(o[i]=[]),o[i].push({nodeId:e.id,port:r.uuid})):r.autoReceive&&(n[e.id+":"+r.uuid]={nodeId:e.id,port:r.uuid,type:i})})}),u.edges.forEach(function(e){e.metadata&&e.metadata.auto?(t[e.from.node+":"+e.from.port]!==t[e.to.node+":"+e.to.port]&&u.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port),n[e.to.node+":"+e.to.port]||u.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)):n[e.to.node+":"+e.to.port]&&u.removeEdge(e.from.node,e.from.port,e.to.node,e.to.port)});for(let e in n){let t=n[e],r=o[t.type];r&&r.forEach(function(e){e.nodeId!==t.nodeId&&u.addEdge(e.nodeId,e.port,t.nodeId,t.port,{auto:1})})}L.changeNode()},addEdge:function(e){let t=u.nodes,o=t.length;if(o<1)return;let n=e||t[Math.floor(Math.random()*o)].id,r=t[Math.floor(Math.random()*o)].id,i="out"+Math.floor(3*Math.random()),a="in"+Math.floor(12*Math.random()),s={route:Math.floor(10*Math.random())};return u.addEdge(n,i,r,a,s)},updateEdges:function(e,t,o,n){const r={in:"to",out:"from"};for(let i=0;i<u.edges.length;i++){const a=u.edges[i][r[e]];if(a.node==t&&a.port==e+o){a.port=n;break}}},getNodeOriginalPosision:function(e,t){let o=d.offset(),n=d.find(".view").attr("transform"),r=_.toNumber(_.split(_.split(n,",")[0],"(")[1]);return t=t||0,{x:e=(e=e||0)*r+f.state.x+45*r+o.left,y:t=t*r+f.state.y+45*r+o.left}},getTheGraphInstance:function(){return f},setNodeSelectionHandler:function(e){g=e},setNodeContextMenuHandler:function(e){E=e},setNodeRectImgDblclickHandler:function(e){v=e},setEdgeSelectionHandler:function(e){y=e},setEdgeIconClickHandler:function(e){b=e},setGroupSelectionHandler:function(e){w=e},setGraphChangeHandler:function(e){x=e},setGraphAddNodeHandler:function(e){S=e},setGraphDeleteNodeHandler:function(e){C=e},setExpandIconClickedHandler:function(e){I=e},getComponentInfo:function(e){return m.getComponentInfo(e)},changeNode:function(e){u.setNodeMetadata(e,{})},changeGraph:function(e){u.setGroupMetadata(e,{})},getRunJson:function(){let e=L.getGraphJson();for(let t in e.processes){let o=e.processes[t];o.metadata={codeName:o.metadata.def.codeName,type:o.metadata.def.type,baseRunner:o.metadata.def.baseRunner,codePath:o.metadata.def.codePath,pyLibPath:o.metadata.def.pyLibPath,params:o.metadata.def.params,ports:o.metadata.def.ports,author:o.metadata.def.author}}return e},getIgnoredNodes:function(e){let t={};for(let o=0;o<e.length;o++)t[e[o]]=!0;let o=[];for(let e=0;e<u.nodes.length;e++)t[u.nodes[e].id]||o.push(u.nodes[e].id);return o},getAllUpstreamNodes:function(e){let t=L.getUpstreamNodes(e);for(let e=0;e<t.length;e++)t=t.concat(L.getAllUpstreamNodes(t[e]));let o=[];for(let e=0;e<t.length;e++)o.indexOf(t[e])<0&&o.push(t[e]);return o},getUpstreamNodes:function(e){let t=[];if(!u||!u.edges)return t;for(let o=0;o<u.edges.length;o++){let n=u.edges[o];n.to.node===e&&t.push(n.from.node)}return t},getUpstreamNodeByPort:function(e,t){return u&&u.edges?_.map(_.filter(u.edges,{to:{port:t,node:e}}),"from")[0]:null},getDownstreamNodeByPort:function(e,t){return u&&u.edges?_.map(_.filter(u.edges,{from:{port:t,node:e}}),"to"):null},getDownstreamNodes:function(e){let t=[];if(!u||!u.edges)return t;for(let o=0;o<u.edges.length;o++){let n=u.edges[o];n.from.node===e&&t.push(n.to.node)}return t},getAllDownstreamNodes:function(e){let t=L.getDownstreamNodes(e);for(let e=0;e<t.length;e++)t=t.concat(L.getAllDownstreamNodes(t[e]));let o=[];for(let e=0;e<t.length;e++)o.indexOf(t[e])<0&&o.push(t[e]);return o},load:function(t){let o=e.defer();return u.loadJSON(t,function(){o.resolve(res)}),o.promise},getNodeOutputTypeArr:function(e){let t=[];if(!e)return t;let n=L.getNode(e);if(!n)return t;let r=_.filter(n.metadata.def.ports,{ioType:"out"});for(let e in n.metadata.def.params){let i=n.metadata.def.params[e],a=_.findIndex(t,{portId:i.defOutPortUuid}),s=-1==_.findIndex(r,{uuid:i.defOutPortUuid});if(a>-1||!i.propertyName||"partitionName"===i.propertyName||s)continue;let c={},p="";for(let e=0;e<n.metadata.def.ports.length;e++)if(n.metadata.def.ports[e].uuid==i.defOutPortUuid){c=n.metadata.def.ports[e];const t=n.metadata.def.ports[e].type;"model"!=t&&"data"!=t||"/"!=(p=_.get(i,"value")||o.getUploadNodeDataPath(c.uuid,t)).slice(-1)&&(p+="/")}let l={portId:i.defOutPortUuid,propertyName:i.propertyName,label:_.get(c,"description.zh_CN","")};p&&(l.path=p),_.isEmpty(c.subType)||(l.subType=c.subType),t.push(l)}return t},onValidated:function(e){if(_.isEmpty(u.nodes))return{status:"error",message:"项目中没有节点"};const t=_.filter(u.nodes,function(t){if(e&&t.id!==e)return!1;const o=_.filter(_.values(_.get(t,"metadata.def.params")),function(e){return(e.required||e.isRequired)&&_.isUndefined(e.value)});return!_.isEmpty(o)}),o=_.map(t,function(e){return e.metadata.label});if(!_.isEmpty(t))return{status:"error",message:o.join("、")+" 中的必填参数不能为空！"};if(!e&&_.findIndex(u.edges,"metadata.error")>-1)return{status:"error",message:"请检查项目中的连线！"};const n=_.filter(u.groups,function(e){return"composite"!==e.metadata.component});if(!e&&!_.isEmpty(n)){return{status:"error",message:"请将项目中的复合组件 “"+_.map(n,"metadata.name").join("”、“")+"” 折叠！"}}}};return L}]),angular.module("app").directive("scriptLog",["appDataStoreService",function(e){return{restrict:"EA",link:function(t,o,n){o.on("click","a[data-preview]",function(t){const o=t.target,n=o.getAttribute("data-preview"),r=o.getAttribute("data-subtype"),i=o.parentNode.querySelector(".data-container");switch(r){case"file":e.get(n).then(e=>{i.innerHTML=`文件内容：<br /><pre style="color: #fff; background-color: #272822;">${e}</pre>`});break;default:i.innerHTML=`<pre style="color: #fff; background-color: #272822;">${n}</pre>`}}),t.$watch(function(e){return e.$eval(n.scriptLog)},function(e){o.html(e)})}}}]).factory("scriptService",["$rootScope","appService","nodeService","$state","$stateParams","toaster",function(e,t,o,n,r,i){return{DIRECTION:{IN:"in",OUT:"out"},APP_GLOBAL_SCRIPT_NODEID:"app",APP_GLOBAL_SCRIPT_PORTID:"global",APP_GLOBAL_SCRIPT_KEYWORD:"content",MAX_LOG_LIMIT:100,sockets:{},logs:{},connect:function(e){const t=this,o=window.io(`${location.protocol}//${window.appConfig.predictHost}/appScripts`,{path:`/socket/${e}`});return o.on("connect",function(){o.id,t.logs[e]=[]}),o.on("disconnect",function(){o.id}),o.on("scriptParseError",function({err:o}){t.logs[e].push({type:"error",appId:e,err:o.message,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),o.on("scriptProcessed",function({node:o,port:n,when:r,before:i,after:a}){t.logs[e].push({type:"port",node:o,port:n,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,timestamp:moment().format("YYYY-MM-DD hh:mm:ss"),before:i,after:a})}),o.on("scriptRuntimeError",function({node:o,port:n,when:r,err:i}){t.logs[e].push({type:"error",node:o,port:n,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,timestamp:moment().format("YYYY-MM-DD hh:mm:ss"),err:i})}),o.on("globalLogging",function({userId:e,appId:o,content:n}){t.logs[o].push({type:"app",appId:o,userId:e,msg:`${n}\n\n`,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),o.on("scriptLogging",function({node:o,port:n,when:r,content:i}){t.logs[e].push({type:"app",node:o,port:n,direction:"postOut"===r?t.DIRECTION.OUT:t.DIRECTION.IN,msg:`${i}\n\n`,timestamp:moment().format("YYYY-MM-DD hh:mm:ss")})}),this.sockets[e]=o,o},disconnect:function(e){this.sockets[e]&&(this.sockets[e].disconnect(),delete this.sockets[e])},getAppLogs:function(e,t=(e=>e)){const n=[];return this.logs[e]||(this.logs[e]=[]),this.logs[e].sort((e,t)=>moment(e.timestamp).isAfter(moment(t.timestamp))).filter(t).forEach(({type:e,before:t,after:r,timestamp:i,err:a,msg:s,node:c,port:p})=>{switch(e){case"port":const l=o.getPort(c,p);n.push(`<div>${i} 输入 <a data-preview="${t}" data-subtype="${l.subType}" href="javascript:void(0)">${t}</a><div class="data-container"></div></div>`),n.push(`<div>${i} 输出 <a data-preview="${r}" data-subtype="${l.subType}" href="javascript:void(0)">${r}</a><div class="data-container"></div></div>`);break;case"error":n.push(`<div>${i} ${a}</div>`);break;case"app":n.push(`<div>${i} ${s}</div>`);break;default:return}}),n.slice(-this.MAX_LOG_LIMIT).join("")},getGlobalLogs:function(e){return this.getAppLogs(e,e=>"app"===e.type||"error"===e.type)},getLogsByEdge:function(e,{from:t,to:o}){return this.getAppLogs(e,({type:e,node:n,port:r})=>"error"===e||"port"===e&&(t.node===n&&t.port===r||o.node===n&&o.port===r))},getLogsByPort:function(e,t,o){return this.getAppLogs(e,({type:e,node:n,port:r})=>"error"===e||"port"===e&&t===n&&o===r)},getPortLogs:function(e){return this.getAppLogs(e,e=>"port"===e.type)},getErrorLogs:function(e){return this.getAppLogs(e,e=>"error"===e.type)},cleanOldScripts:function(e){delete e.properties.appScripts,delete e.properties.appScriptString,e.edges.forEach(function(e){delete e.metadata.script})},doSaveScript:function(o,n){const r=this.packScripts(n);_.set(n,"properties.packedScripts",r),this.cleanOldScripts(n),t.saveScripts(o,n).then(function(){i.pop("success","脚本数据保存成功"),setTimeout(function(){e.sockets&&e.sockets[o]&&e.sockets[o].emit("scriptsChanged",n.properties.packedScripts)},2e3)},function(e){i.pop("error","脚本数据保存失败："+e.msg)})},getOldEdgeScripts:function(e){if(!e)return"";if(e.content)return e.content;const{afterLeave:t,beforeEnter:o}=e;return`${t}\n${o}`},getFunctionBlock:function(e){switch(e){case"afterLeave":case"beforeEnter":return`\n${e}((data, $) => {});\n`;case"initializer":return`\n${e}(($) => {});\n`;case"onSystemMessage":return`\n${e}((data) => {});\n`;default:return"() => {};\n"}},getKeyword:function(e=""){return{in:"beforeEnter",out:"afterLeave",beforeEnter:"beforeEnter",afterLeave:"afterLeave",content:"content"}[e]||""},getAppGlobalScriptKey:function(){return`${this.APP_GLOBAL_SCRIPT_NODEID}.${this.APP_GLOBAL_SCRIPT_PORTID}.${this.APP_GLOBAL_SCRIPT_KEYWORD}`},getSupportedFunctions:function(){return["afterLeave","beforeEnter","onSystemMessage","initializer"]},getScriptKey:function(e,t,o){return`properties.scripts.${e}.${t}.${this.getKeyword(o)}`},getScriptsByNode:function(e,t){const n=o.getGraph();return _.get(n,`properties.scripts.${e.node}.${e.port}.${this.getKeyword(t)}`,"")},idNodeDeletable:function(e){const t=_.get(o.getGraph(),`properties.scripts.${e}`,{});return _.isEmpty(t)},isEdgeDeletable:function(e){const{from:t,to:n}=e,r=o.getGraph(),i=_.get(r,`properties.scripts.${t.node}.${t.port}`,{}),a=_.get(r,`properties.scripts.${n.node}.${n.port}`,{});return!_.isEmpty(i)||!_.isEmpty(a)},packBlock:function(e){return"\n(function() {\n"+e+"\n})();\n"},packFunction:function(e,t,o,n){n=n||"";const r=new RegExp(`${e}\\(`,"g");return n.replace(r,`${e}('${t}', '${o}', `)},packScripts:function(e){const t=this;let n="";const r=_.get(e,"properties.scripts",{}),i=this.getAppGlobalScriptKey();Object.keys(r).forEach(function(e){Object.keys(r[e]).forEach(function(a){Object.keys(r[e][a]).forEach(function(s){if(`${e}.${a}.${s}`===i)return;const c=o.getNode(e),p=`// <${_.get(c,"metadata.label","")}> - <${a}> - <${s}>\n`;n+=t.packBlock(`${p}${t.packFunction(s,e,a,r[e][a][s])}`)})})});const a=`// 全局脚本\n${_.get(r,i,"")}\n`;return n=this.packBlock(`${a}${n}`)},removeScriptByEdge:function(e){const{from:t,to:n}=e,r=o.getGraph();_.get(r,`properties.scripts.${t.node}.${t.port}`,null)&&delete r.properties.scripts[t.node][t.port],_.get(r,`properties.scripts.${n.node}.${n.port}`,null)&&delete r.properties.scripts[n.node][n.port]},removeScriptByNode:function(e){const t=this,n=o.getGraph();delete _.get(n,"properties.scripts",{})[e];const r=_.filter(n.edges,function(t){return t.from.node===e||t.to.node===e});r&&r.forEach(function(e){t.removeScriptByEdge(e)})},setScript:function(e,t,n,r){return _.set(o.getGraph(),this.getScriptKey(e,t,n),r)},saveEdgeScripts:function(e,t,n){const r=o.getGraph();_.set(r,this.getScriptKey(e.node,e.port,t),n),this.saveAppScripts()},saveAppScripts:function(){const e=this,a=r.id,s=o.getGraph();n.includes("app.predict.edit")?e.doSaveScript(a,s):t.setPermission(a).then(function(t){e.doSaveScript(a,s)},function(e){i.pop("error","请求失败: "+e.msg)})}}}]),angular.module("app").directive("nodeDebugLog",["instantNodeLogService",function(e){return{strict:"EA",template:'<div class="node-debug-log">\n                    <input type="checkbox" class="sp-checkbox" ng-checked="isEnabled" style="vertical-align: middle;margin: 0;" ng-click="toggleNodeLog()">\n                    <span style="color: #b3b3b3;">开启</span>\n                    <div class="json-viewer"><textarea class="textarea" ng-model="logs"></textarea></div>\n                   </textarea></div>',scope:{nodeId:"="},link:function(t,o,n,r){const{nodeId:i}=t;t.isEnabled=e.getNodeLogStatus(i);let a=null;const s=function(){t.logs=e.getNodeLog(i).map(function(e){return e.timestamp+"\n"+e.type+" : "+e.port+"\n数据："+e.data}).join("\n"),a=setTimeout(s,2e3)};t.toggleNodeLog=function(){t.isEnabled=!t.isEnabled,t.isEnabled?(e.enableNodeLog(i),s()):(e.disableNodeLog(i),t.logs="",a&&(clearTimeout(a),a=null))},t.isEnabled&&s()}}}]).factory("instantNodeLogService",["$rootScope","appService","nodeService","$state","$stateParams","toaster",function(e,t,o,n,r,i){return{MAP_DIRECTION_LABEL:{source:"输出",target:"输入"},nodeLogs:{},isAnimationEnabled:!1,isNodeDataLogEnabled:{},edgeAnimator:null,nodeDataLogSocket:null,appendLog:function(e,t){this.nodeLogs[e.node_id]||(this.nodeLogs[e.node_id]=[]),this.nodeLogs[e.node_id].push({data:"string"==typeof e.data?e.data:JSON.stringify(e.data),type:this.MAP_DIRECTION_LABEL[t],port:e.port,timestamp:moment(new Date(e.timestamp)).format("YYYY-MM-DD hh:mm:ss")})},connect:function(){const t=this,n=this.nodeDataLogSocket=window.io(`${location.protocol}//${window.appConfig.predictHost}`,{path:`/socket/${r.id}/pstream`});return n.on("data.replay",function(e){t.packNodeLog(e)}),n.on("listen.replay.status",({success:e,data:o})=>{e&&(t.isAnimationEnabled=o)}),n.on("connect",function(){o.getGraph()?t.initAnimator():e.$on("editor.ready",t.initAnimator.bind(t))}),n},disconnect:function(){this.nodeDataLogSocket&&(this.nodeDataLogSocket.disconnect(),this.nodeDataLogSocket=null)},toggleAnimation:function(e){this.isAnimationEnabled=e||!_.isEmpty(this.isNodeDataLogEnabled),this.nodeDataLogSocket&&this.nodeDataLogSocket.emit("control.replay",{start:this.isAnimationEnabled})},enableNodeLog:function(e){delete this.nodeLogs[e],this.nodeDataLogSocket&&(this.isNodeDataLogEnabled[e]=!0,this.toggleAnimation(!0))},disableNodeLog:function(e){delete this.isNodeDataLogEnabled[e],delete this.nodeLogs[e],this.toggleAnimation(!1)},getNodeLog:function(e){return this.nodeLogs[e]&&this.isNodeDataLogEnabled[e]?this.nodeLogs[e]:[]},getNodeLogStatus:function(e){return this.isNodeDataLogEnabled[e]},initAnimator:function(){this.nodeDataLogSocket&&this.nodeDataLogSocket.emit("query.replay.status")},packNodeLog:function(e){const t=this;for(const o in e)if(e.hasOwnProperty(o)){const{messages:n=[]}=e[o];n.forEach(({source:e,target:o})=>{t.appendLog(e,"source"),t.appendLog(o,"target")})}},toggle:function(e){this.nodeDataLogSocket&&this.nodeDataLogSocket.emit("control.replay",{start:e})}}}]).factory("componentLogService",["common","$stateParams","remoteService","$q",function(e,t,o,n){return{processors:{},connect:function(){const e=n.defer(),r=this;return o.get((window.appConfig.suanpanWebHost||"")+"/oss/token","json").then(function(o){const n=r.nodeDataLogSocket=window.io((window.appConfig.suanpanWebHost||"")+"/logkit",{query:{"x-sp-user-id":window.appConfig.userId,"x-sp-signature":ALY.util.crypto.hmac(o.Credentials.AccessKeySecret,window.appConfig.userId,"base64","sha1"),"x-sp-sign-version":"v1"}});n.on(`publish.app.${t.id}`,e=>{Object.keys(r.processors).forEach(t=>{const{callback:o=(()=>{}),context:n=null,data:i={}}=r.processors[t];o.call(n,e,i)})}),e.resolve(n)}).catch(function(t){e.resolve({id:"unknown"})}),e.promise},disconnect:function(){this.nodeDataLogSocket&&(this.nodeDataLogSocket.disconnect(),this.nodeDataLogSocket=null)},registerLogProcessor:function(t,o=null,n={}){const r=e.uuid();return this.processors[r]={callback:t,context:o,data:n},r},unregisterLogProcessor:function(e){delete this.processors[e]},clean:function(){this.nodeDataLogSocket.emit("clean",{app:t.id})},query:function(){const e=n.defer();return this.nodeDataLogSocket.emit("query",{app:t.id},function(t){t.success?e.resolve(t.data):e.reject(t.err||t.msg)}),e.promise},append:function(e){this.nodeDataLogSocket.emit("append",{app:t.id,logs:e})}}}]),angular.module("app").factory("eventService",[function(){return{EVENTS:{sp:{node:{select:"sp:node:select",deselect:"sp:node:deselect",contextmenu:"sp:node:contextmenu"},ng:{transition:{success:"sp:transition:success"}}},rto:{setting:{params:"rto:setting:params"}}},getPubSub:function(){return window.PubSub},emit:function(e,t){this.getPubSub().publish(e,t)},on:function(e,t){return this.getPubSub().subscribe(e,t)},off:function(e){return this.getPubSub().unsubscribe(e)}}}]),angular.module("app").factory("tableService",["$rootScope","format","$q","remoteService","nodeService","appDataStoreService",function(e,t,o,n,r,i){let a={getUpstreamTableName:function(n,i,s){let c,p,l=o.defer(),d=r.getNode(i);for(let e in d.metadata.def.params){let t=d.metadata.def.params[e];if(t.controlInstUuid===s){c=t.defInPortUuid||"in1",p=t;break}}if(c){let o=r.getUpstreamNodeByPort(i,c);if(o){let r=o.node,i=o.port;const s={"{{userId}}":e.appConfig.userId,"{{appId}}":n,"{{nodeId}}":r};a.getNodeTableName(n,r,i).then(function(e){l.resolve({propertyName:e.propertyName,value:t(e.value,s),controlObj:p})},function(e){l.reject("未获取到上游节点输出表名")})}else l.reject("未找到上游节点")}else l.reject("未获取到输入桩信息");return l.promise},getNodeTableName:function(e,t,i){let a=o.defer(),s=r.getNode(t),c=!1;for(let e=0;e<s.metadata.def.ports.length;e++){let t=s.metadata.def.ports[e];if("in"===t.ioType&&0!==t.display){c=!0;break}}let p="xuelang"===s.metadata.def.author&&"save"===s.metadata.def.codeName;if(!c||p)for(let e in s.metadata.def.params){let t=s.metadata.def.params[e];t.defOutPortUuid!==i||"tableName"!==t.propertyName&&"dataName"!==t.propertyName||a.resolve(t)}else{let o=_.find(_.values(s.metadata.def.params),{defOutPortUuid:i});if(o)if(_.isEmpty(o.value))if("tableName"==o.propertyName)n.get("/table/name/"+e+"/"+t+"/"+i).then(function(e){a.resolve({propertyName:"tableName",value:e.table})},function(e){a.reject(e)});else if("dataName"==o.propertyName){let n="studio/"+window.appConfig.userId+"/"+e+"/"+t+"/"+i+"/data/";a.resolve({propertyName:o.propertyName,value:n})}else a.reject("类型不匹配");else a.resolve({propertyName:o.propertyName,value:o.value})}return a.promise},getTableMeta:function(e,t){let r=o.defer();return"dataName"==t?i.get(e+"data.csv").then(function(e){let t=_.slice(_.split(e.split(/\r\n|\n/)[0],","),1);r.resolve(t)},function(e){r.reject(e)}):n.post("/table/meta/"+e,{}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},listTable:function(e){let t=o.defer();return n.post("/table/list/"+e,{}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},existTable:function(e){let t=o.defer();return n.post("/table/exist/"+e,{}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}};return a}]),angular.module("app").factory("dashboardAssetService",["appDataStoreService","userService","$q","$rootScope",function(e,t,o,n){return{nextMarker:null,filter:"",maxKeys:10,listImages:function(){const t=this;let n=o.defer();const r=`studio/${window.appConfig.userId}/dashboard/assets/`;return e.list(r,this.nextMarker,this.maxKeys).then(function(e){const o=e.data;t.nextMarker=o.NextMarker;let r=o.Contents.sort((e,t)=>moment(e.LastModified).isBefore(moment(t.LastModified))?1:-1).map(e=>({type:"image",key:e.Key,name:e.Key.slice(e.Key.lastIndexOf("/")+1),src:`/oss_public/${e.Key}`}));t.filter&&(r=r.filter(function(e){return e.name.indexOf(t.filter.trim())>-1})),n.resolve(r.map(e=>_.assign(e)))},function(e){n.reject(e)}),n.promise},reset:function(){this.nextMarker=null,this.filter="",this.maxKeys=10},search:function(e){return this.filter=e||"",this.nextMarker=null,this.maxKeys=e?1e3:10,this.listImages()},uploadImage:function(t){let n=o.defer(),r=t.name||"",i=`${(new Date).getTime()}_${r}`;const a=`studio/${window.appConfig.userId}/dashboard/assets/${i}`;return e.upload(a,t,function(){},function(e){n.reject(e)},function(o){const r={name:t.name,key:a,src:`/oss_public/${a}`};"oss"===window.appConfig.ossType?e.putObjectAcl(window.appConfig.oss.bucket,a,"public-read").then(()=>{n.resolve(r)},e=>{console.warn("set public failed",e),n.reject(e)}):n.resolve(r)}),n.promise},deleteImage:function(t){let n=o.defer();return t.key?e.remove(t.key).then(function(e){n.resolve(t)},function(e){n.reject(e)}):n.resolve(t),n.promise}}}]),angular.module("app").factory("statisticsService",["remoteService","toaster","$q",function(e,t,o){const n={UNDEFINED:"undefined",SYSTEM:{LOGIN:"login",LOGOUT:"logout",ERROR:"error"},APP:{CREATE:"appCreated",COPY:"appDuplicated",DUPLICATE_FROM_TEMPLATE:"appDuplicatedFromTemplate",IMPORT:"appImported",EXPORT:"appExported",SHARE:"appShared",DELETE:"appDeleted",RUN:"appDeployed",STOP:"appReleased",ERROR:"error",RUN_CRON:"runCron",STOP_CRON:"stopCron",EXPORT_MODEL:"modelExported",NODE_ADDED:"appNodeAdded",NODE_DELETED:"appNodeDeleted",NODE_UPDATED:"appNodeUpdated"},COMPONENT:{CREATE:"componentCreated",IMPORT:"componentImported",EXPORT:"componentExported",SHARE:"componentShared",COPY:"componentDuplicated",DEL:"componentDeleted",EDIT_PARAM:"componentUpdated"}},r={login:function({objectId:e,oldState:t,newState:o}){return{event:"登录",objectId:e,oldState:t,newState:o}},logout:function({objectId:e,oldState:t,newState:o}){return{event:"登出",objectId:e,oldState:t,newState:o}},error:function({objectId:e,oldState:t,newState:o}){return{event:"发生错误",objectId:e,oldState:t,newState:o}},appCreated:function({objectId:e,oldState:t,newState:o}){return{event:"新建项目",objectId:e,oldState:t,newState:o}},appDuplicated:function({objectId:e,oldState:t,newState:o}){return{event:"复制项目",objectId:e,oldState:t,newState:o}},appDuplicatedFromTemplate:function({objectId:e,oldState:t,newState:o}){return{event:"从模板创建项目",objectId:e,oldState:t,newState:o}},appImported:function({objectId:e,oldState:t,newState:o}){return{event:"导入项目",objectId:e,oldState:t,newState:o}},appExported:function({objectId:e,oldState:t,newState:o}){return{event:"导出项目",objectId:e,oldState:t,newState:o}},appShared:function({objectId:e,oldState:t,newState:o}){return{event:"分享项目",objectId:e,oldState:t,newState:o}},appDeleted:function({objectId:e,oldState:t,newState:o}){return{event:"删除项目",objectId:e,oldState:t,newState:o}},appDeployed:function({objectId:e,oldState:t,newState:o}){return{event:"部署项目",objectId:e,oldState:t,newState:o}},appReleased:function({objectId:e,oldState:t,newState:o}){return{event:"释放项目",objectId:e,oldState:t,newState:o}},runCron:function({objectId:e,oldState:t,newState:o}){return{event:"运行定时任务",objectId:e,oldState:t,newState:o}},stopCron:function({objectId:e,oldState:t,newState:o}){return{event:"停止定时任务",objectId:e,oldState:t,newState:o}},modelExported:function({objectId:e,oldState:t,newState:o}){return{event:"导出模型",objectId:e,oldState:t,newState:o}},appNodeAdded:function({objectId:e,oldState:t,newState:o}){return{event:"向项目中拖入新组件",objectId:e,oldState:t,newState:o}},appNodeDeleted:function({objectId:e,oldState:t,newState:o}){return{event:"删除项目中的组件",objectId:e,oldState:t,newState:o}},appNodeUpdated:function({objectId:e,oldState:t,newState:o}){return{event:"更新项目中的组件",objectId:e,oldState:t,newState:o}},componentCreated:function({objectId:e,oldState:t,newState:o}){return{event:"新建组件",objectId:e,oldState:t,newState:o}},componentImported:function({objectId:e,oldState:t,newState:o}){return{event:"导入组件",objectId:e,oldState:t,newState:o}},componentExported:function({objectId:e,oldState:t,newState:o}){return{event:"导出组件",objectId:e,oldState:t,newState:o}},componentShared:function({objectId:e,oldState:t,newState:o}){return{event:"分享组件",objectId:e,oldState:t,newState:o}},componentDuplicated:function({objectId:e,oldState:t,newState:o}){return{event:"复制组件",objectId:e,oldState:t,newState:o}},componentDeleted:function({objectId:e,oldState:t,newState:o}){return{event:"删除组件",objectId:e,oldState:t,newState:o}},componentUpdated:function({objectId:e,oldState:t,newState:o}){return{event:"修改组件",objectId:e,oldState:t,newState:o}}},i={},a={page:1,size:50};return{STAT_ACTIONS:n,getLogs:function(){const t=o.defer();return e.post("/api/v1/audit/events/list",{filter:i,pagination:a}).then(function(e){const{success:o=!1,items:n=[]}=e,i=[];o&&(n.forEach(function(e){r[e.event]&&i.push(r[e.event](e))}),t.resolve(i))},function(e){t.reject(e)}),t.promise},setPagination:function(e){return Object.assign(a,e),this.getLogs()},setFilter:function(e){return Object.assign(i,e),this.getLogs()},trackEvent:function(t=n.UNDEFINED,o,r={},i={}){window.appConfig.auditEnable&&e.post("/api/v1/audit/events",{event:t,objectId:o,oldState:r,newState:i}).then(function(e){},function(e){console.error("error in recording",t,e)})},trackLoginEvent:function(){this.trackEvent(n.SYSTEM.LOGIN,void 0,{},appConfig)},trackLogoutEvent:function(){this.trackEvent(n.SYSTEM.LOGOUT,void 0,{},appConfig)},trackErrorEvent:function(e){this.trackEvent(n.SYSTEM.ERROR,appConfig.appId||appConfig.userId,{},{appConfig:appConfig,err:e})}}}]),angular.module("app").factory("uiService",["$rootScope","applyFn",function(e,t){return e.uiConfig={isShowHeader:!0,isShowScreenshot:!0},{showHeader:function(o){t(function(){e.uiConfig.isShowHeader=o})},showScreenshot:function(o){t(function(){e.uiConfig.isShowScreenshot=o})}}}]),angular.module("app").factory("appDataStoreService",["$q","remoteService","ossService","localStorageService","fileServerService","toaster",function(e,t,o,n,r,i){let a=window.appConfig.oss.bucket,s=window.appConfig.appDataStoreType,c={head:function(e){return o.headObject(a,e)},get:function(e,t){return o.getObject(a,e,null,t)},list:function(e,o,n=1e3){return t.post("/oss/object/list",{Bucket:a,Key:e,Delimiter:"/",Marker:o,MaxKeys:n})},putObjectAcl:function(e,t,n){return o.putObjectAcl(e,t,n)},url:function(e){return t.post("/oss/object/get",{Bucket:a,Key:e})},upload:function(e,n,r,s,c){return t.post("/oss/object/check",{Bucket:a,Key:e,type:"put"}).then(function(t){if(t.success)return o.upload(e,n,r,s,c)},function(e){i.pop("error","上传失败："+e.msg)})},remove:function(e){function t(e){return o.deleteObject(a,e)}return c.head(e).then(function(){return t(e)},function(){return function e(o,n){return c.list(o,n).then(function(n){if(n.success){let r=n.data.NextMarker?[e(o,n.data.NextMarker)]:[],i=_.map(n.data.Contents,function(e){return t(e.Key)}),a=_.map(n.data.CommonPrefixes,function(t){return e(t.Prefix)});return r.concat(i,a)}})}(e)})},copy:function(e,t){},sync:function(t,o){return console.debug("Nothing to sync (appDataStoreType is oss)"),e.resolve()}},p={oss:c,minio:c,local:{head:function(e){return n.head(e)},get:function(e){return n.get(e)},list:function(e,t){return n.list(e,t)},url:function(e){return n.url(e)},upload:function(e,t,o,r,i){return n.upload(e,t,o,r,i)},remove:function(e){return n.remove(e)},sync:function(e,t){return new Promise(function(o,r){n.sync(e,t).then(function(e){o(e)}).catch(function(e){o()})})}},fileServer:{head:function(e){return r.head(e)},get:function(e){return r.get(e)},list:function(e,t){return r.list(e,t)},url:function(e){return r.url(e)},upload:function(e,t,o,n,i){return r.upload(e,t,o,n,i)},remove:function(e){return r.remove(e)},sync:function(e,t){return new Promise(function(o,n){r.sync(e,t).then(function(e){o(e)}).catch(function(e){o()})})}}}[s];if(!p)throw Error("Unknown App Data Store Type: "+s);return window.appDataStore=p,p}]),angular.module("app").factory("localStorageService",["$q","$http","remoteService",function(e,t,o){return{url:function(t){return e.resolve({success:!0,data:"/local/"+t})},head:function(e){return o.head("/local/"+e).then(function(e){return e.ContentType=e.headers("Content-Type"),e.ContentLength=e.headers("Content-Length"),e})},get:function(e){return t.get("/local/"+e).then(function(e){return e.data})},list:function(e){return o.post("/local/list",{Key:e})},upload:function(e,t,n,r,i){return o.post("/local/upload",{Key:e,file:t.path}).then(function(e){return i(e),e},function(e){throw r(e),e})},remove:function(e){return o.post("/local/remove",{Key:e})},sync:function(e,t){return o.post("/local/sync",{key:e,action:t})}}}]),angular.module("app").factory("fileServerService",["$q","$http","localStorageService",function(e,t,o){return{url:o.url,head:o.head,get:o.get,list:o.list,upload:function(o,n,r,i,a){let s=e.defer();return t({method:"POST",url:"/local/upload",headers:{"Content-Type":void 0},data:{key:o,files:n},transformRequest:function(e,t){return Object.keys(e).reduce(function(t,o){return t.append(o,e[o]),t},new FormData)},uploadEventHandlers:{progress:r}}).then(function(e){a(e),s.resolve(e)},function(e){i(e),s.reject(e)}),s.promise},remove:o.remove,sync:o.sync}}]);